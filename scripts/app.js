/**
 * @license
 * lodash 3.4.0 (Custom Build) <https://lodash.com/>
 * Build: `lodash modern -o ./lodash.js`
 * Copyright 2012-2015 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.8.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <https://lodash.com/license>
 */

/**
 * Random number god
 * This code is an implementation of Alea algorithm; (C) 2010 Johannes Baagøe.
 * Alea is licensed according to the http://en.wikipedia.org/wiki/MIT_License.
 */

/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

/**
   * http://paulirish.com/2011/requestanimationframe-for-smart-animating/
   * http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
   * requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel
   * MIT license
   */

(function(){function e(e,n){if(e!==n){var t=e===e,r=n===n;if(e>n||!t||"undefined"==typeof e&&r)return 1;if(n>e||!r||"undefined"==typeof n&&t)return-1}return 0}function n(e,n,t){if(n!==n)return p(e,t);for(var r=t-1,i=e.length;++r<i;)if(e[r]===n)return r;return-1}function t(e){return"function"==typeof e||!1}function r(e){return"string"==typeof e?e:null==e?"":e+""}function i(e){return e.charCodeAt(0)}function o(e,n){for(var t=-1,r=e.length;++t<r&&n.indexOf(e.charAt(t))>-1;);return t}function a(e,n){for(var t=e.length;t--&&n.indexOf(e.charAt(t))>-1;);return t}function u(n,t){return e(n.criteria,t.criteria)||n.index-t.index}function c(n,t,r){for(var i=-1,o=n.criteria,a=t.criteria,u=o.length,c=r.length;++i<u;){var l=e(o[i],a[i]);if(l)return i>=c?l:r[i]?l:-1*l}return n.index-t.index}function l(e){return En[e]}function f(e){return Bn[e]}function s(e){return"\\"+$n[e]}function p(e,n,t){for(var r=e.length,i=n+(t?0:-1);t?i--:++i<r;){var o=e[i];if(o!==o)return i}return-1}function h(e){return e&&"object"==typeof e||!1}function d(e){return 160>=e&&e>=9&&13>=e||32==e||160==e||5760==e||6158==e||e>=8192&&(8202>=e||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}function g(e,n){for(var t=-1,r=e.length,i=-1,o=[];++t<r;)if(e[t]===n){e[t]=B;o[++i]=t}return o}function v(e,n){for(var t,r=-1,i=e.length,o=-1,a=[];++r<i;){var u=e[r],c=n?n(u,r,e):u;if(!r||t!==c){t=c;a[++o]=u}}return a}function y(e){for(var n=-1,t=e.length;++n<t&&d(e.charCodeAt(n)););return n}function _(e){for(var n=e.length;n--&&d(e.charCodeAt(n)););return n}function m(e){return Un[e]}function b(d){function z(e){if(h(e)&&!nc(e)&&!(e instanceof En)){if(e instanceof Z)return e;if(ou.call(e,"__chain__")&&ou.call(e,"__wrapped__"))return Er(e)}return new Z(e)}function X(){}function Z(e,n,t){this.__wrapped__=e;this.__actions__=t||[];this.__chain__=!!n}function En(e){this.__wrapped__=e;this.__actions__=null;this.__dir__=1;this.__dropCount__=0;this.__filtered__=!1;this.__iteratees__=null;this.__takeCount__=Iu;this.__views__=null}function Bn(){var e=this.__actions__,n=this.__iteratees__,t=this.__views__,r=new En(this.__wrapped__);r.__actions__=e?Zn(e):null;r.__dir__=this.__dir__;r.__dropCount__=this.__dropCount__;r.__filtered__=this.__filtered__;r.__iteratees__=n?Zn(n):null;r.__takeCount__=this.__takeCount__;r.__views__=t?Zn(t):null;return r}function Un(){if(this.__filtered__){var e=new En(this);e.__dir__=-1;e.__filtered__=!0}else{e=this.clone();e.__dir__*=-1}return e}function Gn(){var e=this.__wrapped__.value();if(!nc(e))return Kt(e,this.__actions__);var n=this.__dir__,t=0>n,r=wr(0,e.length,this.__views__),i=r.start,o=r.end,a=o-i,u=this.__dropCount__,c=Nu(a,this.__takeCount__),l=t?o:i-1,f=this.__iteratees__,s=f?f.length:0,p=0,h=[];e:for(;a--&&c>p;){l+=n;for(var d=-1,g=e[l];++d<s;){var v=f[d],y=v.iteratee,_=v.type;if(_!=C)var m=y(g);else{v.done=v.done&&(t?l<v.index:l>v.index);v.index=l;m=v.done||(v.done=!y(g))}if(_==S)g=m;else if(!m){if(_==T)break e;continue e}}u?u--:h[p++]=g}return h}function $n(){this.__data__={}}function qn(e){return this.has(e)&&delete this.__data__[e]}function Jn(e){return"__proto__"==e?x:this.__data__[e]}function Hn(e){return"__proto__"!=e&&ou.call(this.__data__,e)}function zn(e,n){"__proto__"!=e&&(this.__data__[e]=n);return this}function Yn(e){var n=e?e.length:0;this.data={hash:Wu(null),set:new _u};for(;n--;)this.push(e[n])}function Xn(e,n){var t=e.data,r="string"==typeof n||Ro(n)?t.set.has(n):t.hash[n];return r?0:-1}function Kn(e){var n=this.data;"string"==typeof e||Ro(e)?n.set.add(e):n.hash[e]=!0}function Zn(e,n){var t=-1,r=e.length;n||(n=qa(r));for(;++t<r;)n[t]=e[t];return n}function et(e,n){for(var t=-1,r=e.length;++t<r&&n(e[t],t,e)!==!1;);return e}function nt(e,n){for(var t=e.length;t--&&n(e[t],t,e)!==!1;);return e}function tt(e,n){for(var t=-1,r=e.length;++t<r;)if(!n(e[t],t,e))return!1;return!0}function rt(e,n){for(var t=-1,r=e.length,i=-1,o=[];++t<r;){var a=e[t];n(a,t,e)&&(o[++i]=a)}return o}function it(e,n){for(var t=-1,r=e.length,i=qa(r);++t<r;)i[t]=n(e[t],t,e);return i}function ot(e){for(var n=-1,t=e.length,r=Du;++n<t;){var i=e[n];i>r&&(r=i)}return r}function at(e){for(var n=-1,t=e.length,r=Iu;++n<t;){var i=e[n];r>i&&(r=i)}return r}function ut(e,n,t,r){var i=-1,o=e.length;r&&o&&(t=e[++i]);for(;++i<o;)t=n(t,e[i],i,e);return t}function ct(e,n,t,r){var i=e.length;r&&i&&(t=e[--i]);for(;i--;)t=n(t,e[i],i,e);return t}function lt(e,n){for(var t=-1,r=e.length;++t<r;)if(n(e[t],t,e))return!0;return!1}function ft(e,n){return"undefined"==typeof e?n:e}function st(e,n,t,r){return"undefined"!=typeof e&&ou.call(r,t)?e:n}function pt(e,n,t){var r=ac(n);if(!t)return dt(n,e,r);for(var i=-1,o=r.length;++i<o;){var a=r[i],u=e[a],c=t(u,n[a],a,e,n);(c===c?c===u:u!==u)&&("undefined"!=typeof u||a in e)||(e[a]=c)}return e}function ht(e,n){for(var t=-1,r=e.length,i=Nr(r),o=n.length,a=qa(o);++t<o;){var u=n[t];if(i){u=parseFloat(u);a[t]=Mr(u,r)?e[u]:x}else a[t]=e[u]}return a}function dt(e,n,t){if(!t){t=n;n={}}for(var r=-1,i=t.length;++r<i;){var o=t[r];n[o]=e[o]}return n}function gt(e,n){for(var t=-1,r=n.length;++t<r;){var i=n[t];e[i]=gr(e[i],k,e)}return e}function vt(e,n,t){var r=typeof e;return"function"==r?"undefined"!=typeof n&&Pr(e)?nr(e,n,t):e:null==e?La:"object"==r?Tt(e):"undefined"==typeof n?Gt(e+""):Et(e+"",n)}function yt(e,n,t,r,i,o,a){var u;t&&(u=i?t(e,r,i):t(e));if("undefined"!=typeof u)return u;if(!Ro(e))return e;var c=nc(e);if(c){u=kr(e);if(!n)return Zn(e,u)}else{var l=uu.call(e),f=l==H;if(l!=Q&&l!=U&&(!f||i))return Sn[l]?Wr(e,l,n):i?e:{};u=Ar(f?{}:e);if(!n)return dt(e,u,ac(e))}o||(o=[]);a||(a=[]);for(var s=o.length;s--;)if(o[s]==e)return a[s];o.push(e);a.push(u);(c?et:Rt)(e,function(r,i){u[i]=yt(r,n,t,i,e,o,a)});return u}function _t(e,n,t,r){if("function"!=typeof e)throw new Za(E);return mu(function(){e.apply(x,Ht(t,r))},n)}function mt(e,t){var r=e?e.length:0,i=[];if(!r)return i;var o=-1,a=xr(),u=a==n,c=u&&t.length>=200?Ju(t):null,l=t.length;if(c){a=Xn;u=!1;t=c}e:for(;++o<r;){var f=e[o];if(u&&f===f){for(var s=l;s--;)if(t[s]===f)continue e;i.push(f)}else a(t,f,0)<0&&i.push(f)}return i}function bt(e,n){var t=e?e.length:0;if(!Nr(t))return Rt(e,n);for(var r=-1,i=Tr(e);++r<t&&n(i[r],r,i)!==!1;);return e}function xt(e,n){var t=e?e.length:0;if(!Nr(t))return Lt(e,n);for(var r=Tr(e);t--&&n(r[t],t,r)!==!1;);return e}function wt(e,n){var t=!0;bt(e,function(e,r,i){t=!!n(e,r,i);return t});return t}function kt(e,n,t,r){var i=e.length;t=null==t?0:+t||0;0>t&&(t=-t>i?0:i+t);r="undefined"==typeof r||r>i?i:+r||0;0>r&&(r+=i);i=t>r?0:r>>>0;t>>>=0;for(;i>t;)e[t++]=n;return e}function At(e,n){var t=[];bt(e,function(e,r,i){n(e,r,i)&&t.push(e)});return t}function Wt(e,n,t,r){var i;t(e,function(e,t,o){if(n(e,t,o)){i=r?t:e;return!1}});return i}function Pt(e,n,t,r){for(var i=r-1,o=e.length,a=-1,u=[];++i<o;){var c=e[i];if(h(c)&&Nr(c.length)&&(nc(c)||ko(c))){n&&(c=Pt(c,n,t,0));var l=-1,f=c.length;u.length+=f;for(;++l<f;)u[++a]=c[l]}else t||(u[++a]=c)}return u}function Mt(e,n,t){for(var r=-1,i=Tr(e),o=t(e),a=o.length;++r<a;){var u=o[r];if(n(i[u],u,i)===!1)break}return e}function jt(e,n,t){for(var r=Tr(e),i=t(e),o=i.length;o--;){var a=i[o];if(n(r[a],a,r)===!1)break}return e}function Nt(e,n){return Mt(e,n,Zo)}function Rt(e,n){return Mt(e,n,ac)}function Lt(e,n){return jt(e,n,ac)}function Ot(e,n){for(var t=-1,r=n.length,i=-1,o=[];++t<r;){var a=n[t];rc(e[a])&&(o[++i]=a)}return o}function Ft(e,n,t){var r=-1,i="function"==typeof n,o=e?e.length:0,a=Nr(o)?qa(o):[];bt(e,function(e){var o=i?n:null!=e&&e[n];a[++r]=o?o.apply(e,t):x});return a}function Dt(e,n,t,r,i,o){if(e===n)return 0!==e||1/e==1/n;var a=typeof e,u=typeof n;return"function"!=a&&"object"!=a&&"function"!=u&&"object"!=u||null==e||null==n?e!==e&&n!==n:It(e,n,Dt,t,r,i,o)}function It(e,n,t,r,i,o,a){var u=nc(e),c=nc(n),l=G,f=G;if(!u){l=uu.call(e);l==U?l=Q:l!=Q&&(u=To(e))}if(!c){f=uu.call(n);f==U?f=Q:f!=Q&&(c=To(n))}var s=l==Q,p=f==Q,h=l==f;if(h&&!u&&!s)return yr(e,n,l);var d=s&&ou.call(e,"__wrapped__"),g=p&&ou.call(n,"__wrapped__");if(d||g)return t(d?e.value():e,g?n.value():n,r,i,o,a);if(!h)return!1;o||(o=[]);a||(a=[]);for(var v=o.length;v--;)if(o[v]==e)return a[v]==n;o.push(e);a.push(n);var y=(u?vr:_r)(e,n,t,r,i,o,a);o.pop();a.pop();return y}function Ct(e,n,t,r,i){var o=n.length;if(null==e)return!o;for(var a=-1,u=!i;++a<o;)if(u&&r[a]?t[a]!==e[n[a]]:!ou.call(e,n[a]))return!1;a=-1;for(;++a<o;){var c=n[a];if(u&&r[a])var l=ou.call(e,c);else{var f=e[c],s=t[a];l=i?i(f,s,c):x;"undefined"==typeof l&&(l=Dt(s,f,i,!0))}if(!l)return!1}return!0}function St(e,n){var t=[];bt(e,function(e,r,i){t.push(n(e,r,i))});return t}function Tt(e){var n=ac(e),t=n.length;if(1==t){var r=n[0],i=e[r];if(Rr(i))return function(e){return null!=e&&e[r]===i&&ou.call(e,r)}}for(var o=qa(t),a=qa(t);t--;){i=e[n[t]];o[t]=i;a[t]=Rr(i)}return function(e){return Ct(e,n,o,a)}}function Et(e,n){return Rr(n)?function(t){return null!=t&&t[e]===n}:function(t){return null!=t&&Dt(n,t[e],null,!0)}}function Bt(e,n,t,r,i){if(!Ro(e))return e;var o=Nr(n.length)&&(nc(n)||To(n));(o?et:Rt)(n,function(n,a,u){if(h(n)){r||(r=[]);i||(i=[]);return Ut(e,u,a,Bt,t,r,i)}var c=e[a],l=t?t(c,n,a,e,u):x,f="undefined"==typeof l;f&&(l=n);!o&&"undefined"==typeof l||!f&&(l===l?l===c:c!==c)||(e[a]=l)});return e}function Ut(e,n,t,r,i,o,a){for(var u=o.length,c=n[t];u--;)if(o[u]==c){e[t]=a[u];return}var l=e[t],f=i?i(l,c,t,e,n):x,s="undefined"==typeof f;if(s){f=c;Nr(c.length)&&(nc(c)||To(c))?f=nc(l)?l:l?Zn(l):[]:ic(c)||ko(c)?f=ko(l)?Uo(l):ic(l)?l:{}:s=!1}o.push(c);a.push(f);s?e[t]=r(f,c,i,o,a):(f===f?f!==l:l===l)&&(e[t]=f)}function Gt(e){return function(n){return null==n?x:n[e]}}function $t(n,t){var r=t.length,i=ht(n,t);t.sort(e);for(;r--;){var o=parseFloat(t[r]);if(o!=a&&Mr(o)){var a=o;bu.call(n,o,1)}}return i}function qt(e,n){return e+du(Fu()*(n-e+1))}function Jt(e,n,t,r,i){i(e,function(e,i,o){t=r?(r=!1,e):n(t,e,i,o)});return t}function Ht(e,n,t){var r=-1,i=e.length;n=null==n?0:+n||0;0>n&&(n=-n>i?0:i+n);t="undefined"==typeof t||t>i?i:+t||0;0>t&&(t+=i);i=n>t?0:t-n>>>0;n>>>=0;for(var o=qa(i);++r<i;)o[r]=e[r+n];return o}function zt(e,n){var t;bt(e,function(e,r,i){t=n(e,r,i);return!t});return!!t}function Yt(e,n){var t=e.length;e.sort(n);for(;t--;)e[t]=e[t].value;return e}function Qt(e,n,t){var r=-1,i=e.length,o=Nr(i)?qa(i):[];bt(e,function(e){for(var t=n.length,i=qa(t);t--;)i[t]=null==e?x:e[n[t]];o[++r]={criteria:i,index:r,value:e}});return Yt(o,function(e,n){return c(e,n,t)})}function Vt(e,t){var r=-1,i=xr(),o=e.length,a=i==n,u=a&&o>=200,c=u?Ju():null,l=[];if(c){i=Xn;a=!1}else{u=!1;c=t?[]:l}e:for(;++r<o;){var f=e[r],s=t?t(f,r,e):f;if(a&&f===f){for(var p=c.length;p--;)if(c[p]===s)continue e;t&&c.push(s);l.push(f)}else if(i(c,s,0)<0){(t||u)&&c.push(s);l.push(f)}}return l}function Xt(e,n){for(var t=-1,r=n.length,i=qa(r);++t<r;)i[t]=e[n[t]];return i}function Kt(e,n){var t=e;t instanceof En&&(t=t.value());for(var r=-1,i=n.length;++r<i;){var o=[t],a=n[r];vu.apply(o,a.args);t=a.func.apply(a.thisArg,o)}return t}function Zt(e,n,t){var r=0,i=e?e.length:r;if("number"==typeof n&&n===n&&Tu>=i){for(;i>r;){var o=r+i>>>1,a=e[o];(t?n>=a:n>a)?r=o+1:i=o}return i}return er(e,n,La,t)}function er(e,n,t,r){n=t(n);for(var i=0,o=e?e.length:0,a=n!==n,u="undefined"==typeof n;o>i;){var c=du((i+o)/2),l=t(e[c]),f=l===l;if(a)var s=f||r;else s=u?f&&(r||"undefined"!=typeof l):r?n>=l:n>l;s?i=c+1:o=c}return Nu(o,Su)}function nr(e,n,t){if("function"!=typeof e)return La;if("undefined"==typeof n)return e;switch(t){case 1:return function(t){return e.call(n,t)};case 3:return function(t,r,i){return e.call(n,t,r,i)};case 4:return function(t,r,i,o){return e.call(n,t,r,i,o)};case 5:return function(t,r,i,o,a){return e.call(n,t,r,i,o,a)}}return function(){return e.apply(n,arguments)}}function tr(e){return su.call(e,0)}function rr(e,n,t){for(var r=t.length,i=-1,o=ju(e.length-r,0),a=-1,u=n.length,c=qa(o+u);++a<u;)c[a]=n[a];for(;++i<r;)c[t[i]]=e[i];for(;o--;)c[a++]=e[i++];return c}function ir(e,n,t){for(var r=-1,i=t.length,o=-1,a=ju(e.length-i,0),u=-1,c=n.length,l=qa(a+c);++o<a;)l[o]=e[o];for(var f=o;++u<c;)l[f+u]=n[u];for(;++r<i;)l[f+t[r]]=e[o++];return l}function or(e,n){return function(t,r,i){var o=n?n():{};r=br(r,i,3);if(nc(t))for(var a=-1,u=t.length;++a<u;){var c=t[a];e(o,c,r(c,a,t),t)}else bt(t,function(n,t,i){e(o,n,r(n,t,i),i)});return o}}function ar(e){return function(){var n=arguments,t=n.length,r=n[0];if(2>t||null==r)return r;var i=n[t-2],o=n[t-1],a=n[3];if(t>3&&"function"==typeof i){i=nr(i,o,5);t-=2}else{i=t>2&&"function"==typeof o?o:null;t-=i?1:0}if(a&&jr(n[1],n[2],a)){i=3==t?null:i;t=2}for(var u=0;++u<t;){var c=n[u];c&&e(r,c,i)}return r}}function ur(e,n){function t(){return(this instanceof t?r:e).apply(n,arguments)}var r=fr(e);return t}function cr(e){return function(){var n=arguments.length,t=n,r=e?n-1:0;if(!n)return function(){return arguments[0]};for(var i=qa(n);t--;){i[t]=arguments[t];if("function"!=typeof i[t])throw new Za(E)}return function(){for(var t=r,o=i[t].apply(this,arguments);e?t--:++t<n;)o=i[t].call(this,o);return o}}}function lr(e){return function(n){for(var t=-1,r=Ma(sa(n)),i=r.length,o="";++t<i;)o=e(o,r[t],t);return o}}function fr(e){return function(){var n=$u(e.prototype),t=e.apply(n,arguments);return Ro(t)?t:n}}function sr(e,n){return function(t,r,o){o&&jr(t,r,o)&&(r=null);var a=br(),u=null==r;if(a!==vt||!u){u=!1;r=a(r,o,3)}if(u){var c=nc(t);if(c||!So(t))return e(c?t:Sr(t));r=i}return mr(t,r,n)}}function pr(e,n,t,r,i,o,a,u,c,l){function f(){for(var b=arguments.length,x=b,w=qa(b);x--;)w[x]=arguments[x];r&&(w=rr(w,r,i));o&&(w=ir(w,o,a));if(d||y){var W=f.placeholder,P=g(w,W);b-=P.length;if(l>b){var M=u?Zn(u):null,R=ju(l-b,0),L=d?P:null,O=d?null:P,F=d?w:null,D=d?null:w;n|=d?j:N;n&=~(d?N:j);v||(n&=~(k|A));var I=pr(e,n,t,F,L,D,O,M,c,R);I.placeholder=W;return I}}var C=p?t:this;h&&(e=C[m]);u&&(w=Dr(w,u));s&&c<w.length&&(w.length=c);return(this instanceof f?_||fr(e):e).apply(C,w)}var s=n&L,p=n&k,h=n&A,d=n&P,v=n&W,y=n&M,_=!h&&fr(e),m=e;return f}function hr(e,n,t){var r=e.length;n=+n;if(r>=n||!Pu(n))return"";var i=n-r;t=null==t?" ":t+"";return ma(t,pu(i/t.length)).slice(0,i)}function dr(e,n,t,r){function i(){for(var n=-1,u=arguments.length,c=-1,l=r.length,f=qa(u+l);++c<l;)f[c]=r[c];for(;u--;)f[c++]=arguments[++n];return(this instanceof i?a:e).apply(o?t:this,f)}var o=n&k,a=fr(e);return i}function gr(e,n,t,r,i,o,a,u){var c=n&A;if(!c&&"function"!=typeof e)throw new Za(E);var l=r?r.length:0;if(!l){n&=~(j|N);r=i=null}l-=i?i.length:0;if(n&N){var f=r,s=i;r=i=null}var p=!c&&Hu(e),h=[e,n,t,r,i,f,s,o,a,u];if(p&&p!==!0){Lr(h,p);n=h[1];u=h[9]}h[9]=null==u?c?0:e.length:ju(u-l,0)||0;if(n==k)var d=ur(h[0],h[2]);else d=n!=j&&n!=(k|j)||h[4].length?pr.apply(x,h):dr.apply(x,h);var g=p?qu:zu;return g(d,h)}function vr(e,n,t,r,i,o,a){var u=-1,c=e.length,l=n.length,f=!0;if(c!=l&&!(i&&l>c))return!1;for(;f&&++u<c;){var s=e[u],p=n[u];f=x;r&&(f=i?r(p,s,u):r(s,p,u));if("undefined"==typeof f)if(i)for(var h=l;h--;){p=n[h];f=s&&s===p||t(s,p,r,i,o,a);if(f)break}else f=s&&s===p||t(s,p,r,i,o,a)}return!!f}function yr(e,n,t){switch(t){case $:case q:return+e==+n;case J:return e.name==n.name&&e.message==n.message;case Y:return e!=+e?n!=+n:0==e?1/e==1/n:e==+n;case V:case K:return e==n+""}return!1}function _r(e,n,t,r,i,o,a){var u=ac(e),c=u.length,l=ac(n),f=l.length;if(c!=f&&!i)return!1;for(var s,p=-1;++p<c;){var h=u[p],d=ou.call(n,h);if(d){var g=e[h],v=n[h];d=x;r&&(d=i?r(v,g,h):r(g,v,h));"undefined"==typeof d&&(d=g&&g===v||t(g,v,r,i,o,a))}if(!d)return!1;s||(s="constructor"==h)}if(!s){var y=e.constructor,_=n.constructor;if(y!=_&&"constructor"in e&&"constructor"in n&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _))return!1}return!0}function mr(e,n,t){var r=t?Iu:Du,i=r,o=i;bt(e,function(e,a,u){var c=n(e,a,u);if((t?i>c:c>i)||c===r&&c===o){i=c;o=e}});return o}function br(e,n,t){var r=z.callback||Na;r=r===Na?vt:r;return t?r(e,n,t):r}function xr(e,t,r){var i=z.indexOf||Zr;i=i===Zr?n:i;return e?i(e,t,r):i}function wr(e,n,t){for(var r=-1,i=t?t.length:0;++r<i;){var o=t[r],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":n-=a;break;case"take":n=Nu(n,e+a);break;case"takeRight":e=ju(e,n-a)}}return{start:e,end:n}}function kr(e){var n=e.length,t=new e.constructor(n);if(n&&"string"==typeof e[0]&&ou.call(e,"index")){t.index=e.index;t.input=e.input}return t}function Ar(e){var n=e.constructor;"function"==typeof n&&n instanceof n||(n=Va);return new n}function Wr(e,n,t){var r=e.constructor;switch(n){case en:return tr(e);case $:case q:return new r(+e);case nn:case tn:case rn:case on:case an:case un:case cn:case ln:case fn:var i=e.buffer;return new r(t?tr(i):i,e.byteOffset,e.length);case Y:case K:return new r(e);case V:var o=new r(e.source,wn.exec(e));o.lastIndex=e.lastIndex}return o}function Pr(e){var n=z.support,t=!(n.funcNames?e.name:n.funcDecomp);if(!t){var r=ru.call(e);n.funcNames||(t=!kn.test(r));if(!t){t=Rn.test(r)||Fo(e);qu(e,t)}}return t}function Mr(e,n){e=+e;n=null==n?Bu:n;return e>-1&&e%1==0&&n>e}function jr(e,n,t){if(!Ro(t))return!1;var r=typeof n;if("number"==r)var i=t.length,o=Nr(i)&&Mr(n,i);else o="string"==r&&n in t;if(o){var a=t[n];return e===e?e===a:a!==a}return!1}function Nr(e){return"number"==typeof e&&e>-1&&e%1==0&&Bu>=e}function Rr(e){return e===e&&(0===e?1/e>0:!Ro(e))}function Lr(e,n){var t=e[1],r=n[1],i=t|r,o=L|R,a=k|A,u=o|a|W|M,c=t&L&&!(r&L),l=t&R&&!(r&R),f=(l?e:n)[7],s=(c?e:n)[8],p=!(t>=R&&r>a||t>a&&r>=R),h=i>=o&&u>=i&&(R>t||(l||c)&&f.length<=s);if(!p&&!h)return e;if(r&k){e[2]=n[2];i|=t&k?0:W}var d=n[3];if(d){var v=e[3];e[3]=v?rr(v,d,n[4]):Zn(d);e[4]=v?g(e[3],B):Zn(n[4])}d=n[5];if(d){v=e[5];e[5]=v?ir(v,d,n[6]):Zn(d);e[6]=v?g(e[5],B):Zn(n[6])}d=n[7];d&&(e[7]=Zn(d));r&L&&(e[8]=null==e[8]?n[8]:Nu(e[8],n[8]));null==e[9]&&(e[9]=n[9]);e[0]=n[0];e[1]=i;return e}function Or(e,n){e=Tr(e);for(var t=-1,r=n.length,i={};++t<r;){var o=n[t];o in e&&(i[o]=e[o])}return i}function Fr(e,n){var t={};Nt(e,function(e,r,i){n(e,r,i)&&(t[r]=e)});return t}function Dr(e,n){for(var t=e.length,r=Nu(n.length,t),i=Zn(e);r--;){var o=n[r];e[r]=Mr(o,t)?i[o]:x}return e}function Ir(e){{var n;z.support}if(!h(e)||uu.call(e)!=Q||!ou.call(e,"constructor")&&(n=e.constructor,"function"==typeof n&&!(n instanceof n)))return!1;var t;Nt(e,function(e,n){t=n});return"undefined"==typeof t||ou.call(e,t)}function Cr(e){for(var n=Zo(e),t=n.length,r=t&&e.length,i=z.support,o=r&&Nr(r)&&(nc(e)||i.nonEnumArgs&&ko(e)),a=-1,u=[];++a<t;){var c=n[a];(o&&Mr(c,r)||ou.call(e,c))&&u.push(c)}return u}function Sr(e){return null==e?[]:Nr(e.length)?Ro(e)?e:Va(e):aa(e)}function Tr(e){return Ro(e)?e:Va(e)}function Er(e){return e instanceof En?e.clone():new Z(e.__wrapped__,e.__chain__,Zn(e.__actions__))}function Br(e,n,t){n=(t?jr(e,n,t):null==n)?1:ju(+n||1,1);for(var r=0,i=e?e.length:0,o=-1,a=qa(pu(i/n));i>r;)a[++o]=Ht(e,r,r+=n);return a}function Ur(e){for(var n=-1,t=e?e.length:0,r=-1,i=[];++n<t;){var o=e[n];o&&(i[++r]=o)}return i}function Gr(){for(var e=arguments,n=-1,t=e.length;++n<t;){var r=e[n];if(nc(r)||ko(r))break}return mt(r,Pt(e,!1,!0,++n))}function $r(e,n,t){var r=e?e.length:0;if(!r)return[];(t?jr(e,n,t):null==n)&&(n=1);return Ht(e,0>n?0:n)}function qr(e,n,t){var r=e?e.length:0;if(!r)return[];(t?jr(e,n,t):null==n)&&(n=1);n=r-(+n||0);return Ht(e,0,0>n?0:n)}function Jr(e,n,t){var r=e?e.length:0;if(!r)return[];n=br(n,t,3);for(;r--&&n(e[r],r,e););return Ht(e,0,r+1)}function Hr(e,n,t){var r=e?e.length:0;if(!r)return[];var i=-1;n=br(n,t,3);for(;++i<r&&n(e[i],i,e););return Ht(e,i)}function zr(e,n,t,r){var i=e?e.length:0;if(!i)return[];if(t&&"number"!=typeof t&&jr(e,n,t)){t=0;r=i}return kt(e,n,t,r)}function Yr(e,n,t){var r=-1,i=e?e.length:0;n=br(n,t,3);for(;++r<i;)if(n(e[r],r,e))return r;return-1}function Qr(e,n,t){var r=e?e.length:0;n=br(n,t,3);for(;r--;)if(n(e[r],r,e))return r;return-1}function Vr(e){return e?e[0]:x}function Xr(e,n,t){var r=e?e.length:0;t&&jr(e,n,t)&&(n=!1);return r?Pt(e,n,!1,0):[]}function Kr(e){var n=e?e.length:0;return n?Pt(e,!0,!1,0):[]}function Zr(e,t,r){var i=e?e.length:0;if(!i)return-1;if("number"==typeof r)r=0>r?ju(i+r,0):r;else if(r){var o=Zt(e,t),a=e[o];return(t===t?t===a:a!==a)?o:-1}return n(e,t,r||0)}function ei(e){return qr(e,1)}function ni(){for(var e=[],t=-1,r=arguments.length,i=[],o=xr(),a=o==n;++t<r;){var u=arguments[t];if(nc(u)||ko(u)){e.push(u);i.push(a&&u.length>=120?Ju(t&&u):null)}}r=e.length;var c=e[0],l=-1,f=c?c.length:0,s=[],p=i[0];e:for(;++l<f;){u=c[l];if((p?Xn(p,u):o(s,u,0))<0){t=r;for(;--t;){var h=i[t];if((h?Xn(h,u):o(e[t],u,0))<0)continue e}p&&p.push(u);s.push(u)}}return s}function ti(e){var n=e?e.length:0;return n?e[n-1]:x}function ri(e,n,t){var r=e?e.length:0;if(!r)return-1;var i=r;if("number"==typeof t)i=(0>t?ju(r+t,0):Nu(t||0,r-1))+1;else if(t){i=Zt(e,n,!0)-1;var o=e[i];return(n===n?n===o:o!==o)?i:-1}if(n!==n)return p(e,i,!0);for(;i--;)if(e[i]===n)return i;return-1}function ii(){var e=arguments,n=e[0];if(!n||!n.length)return n;for(var t=0,r=xr(),i=e.length;++t<i;)for(var o=0,a=e[t];(o=r(n,a,o))>-1;)bu.call(n,o,1);return n}function oi(e){return $t(e||[],Pt(arguments,!1,!1,1))}function ai(e,n,t){var r=-1,i=e?e.length:0,o=[];n=br(n,t,3);for(;++r<i;){var a=e[r];if(n(a,r,e)){o.push(a);bu.call(e,r--,1);i--}}return o}function ui(e){return $r(e,1)}function ci(e,n,t){var r=e?e.length:0;if(!r)return[];if(t&&"number"!=typeof t&&jr(e,n,t)){n=0;t=r}return Ht(e,n,t)}function li(e,n,t,r){var i=br(t);return i===vt&&null==t?Zt(e,n):er(e,n,i(t,r,1))}function fi(e,n,t,r){var i=br(t);return i===vt&&null==t?Zt(e,n,!0):er(e,n,i(t,r,1),!0)}function si(e,n,t){var r=e?e.length:0;if(!r)return[];(t?jr(e,n,t):null==n)&&(n=1);return Ht(e,0,0>n?0:n)}function pi(e,n,t){var r=e?e.length:0;if(!r)return[];(t?jr(e,n,t):null==n)&&(n=1);n=r-(+n||0);return Ht(e,0>n?0:n)}function hi(e,n,t){var r=e?e.length:0;if(!r)return[];n=br(n,t,3);for(;r--&&n(e[r],r,e););return Ht(e,r+1)}function di(e,n,t){var r=e?e.length:0;if(!r)return[];var i=-1;n=br(n,t,3);for(;++i<r&&n(e[i],i,e););return Ht(e,0,i)}function gi(){return Vt(Pt(arguments,!1,!0,0))}function vi(e,t,r,i){var o=e?e.length:0;if(!o)return[];if(null!=t&&"boolean"!=typeof t){i=r;r=jr(e,t,i)?null:t;t=!1}var a=br();(a!==vt||null!=r)&&(r=a(r,i,3));return t&&xr()==n?v(e,r):Vt(e,r)}function yi(e){for(var n=-1,t=(e&&e.length&&ot(it(e,iu)))>>>0,r=qa(t);++n<t;)r[n]=it(e,Gt(n));return r}function _i(e){return mt(e,Ht(arguments,1))}function mi(){for(var e=-1,n=arguments.length;++e<n;){var t=arguments[e];if(nc(t)||ko(t))var r=r?mt(r,t).concat(mt(t,r)):t}return r?Vt(r):[]}function bi(){for(var e=arguments.length,n=qa(e);e--;)n[e]=arguments[e];return yi(n)}function xi(e,n){var t=-1,r=e?e.length:0,i={};!r||n||nc(e[0])||(n=[]);for(;++t<r;){var o=e[t];n?i[o]=n[t]:o&&(i[o[0]]=o[1])}return i}function wi(e){var n=z(e);n.__chain__=!0;return n}function ki(e,n,t){n.call(t,e);return e}function Ai(e,n,t){return n.call(t,e)}function Wi(){return wi(this)}function Pi(){return new Z(this.value(),this.__chain__)}function Mi(e){for(var n,t=this;t instanceof X;){var r=Er(t);n?i.__wrapped__=r:n=r;var i=r;t=t.__wrapped__}i.__wrapped__=e;return n}function ji(){var e=this.__wrapped__;if(e instanceof En){this.__actions__.length&&(e=new En(this));return new Z(e.reverse(),this.__chain__)}return this.thru(function(e){return e.reverse()})}function Ni(){return this.value()+""}function Ri(){return Kt(this.__wrapped__,this.__actions__)}function Li(e){var n=e?e.length:0;Nr(n)&&(e=Sr(e));return ht(e,Pt(arguments,!1,!1,1))}function Oi(e,n,t){var r=nc(e)?tt:wt;("function"!=typeof n||"undefined"!=typeof t)&&(n=br(n,t,3));return r(e,n)}function Fi(e,n,t){var r=nc(e)?rt:At;n=br(n,t,3);return r(e,n)}function Di(e,n,t){if(nc(e)){var r=Yr(e,n,t);return r>-1?e[r]:x}n=br(n,t,3);return Wt(e,n,bt)}function Ii(e,n,t){n=br(n,t,3);return Wt(e,n,xt)}function Ci(e,n){return Di(e,Tt(n))}function Si(e,n,t){return"function"==typeof n&&"undefined"==typeof t&&nc(e)?et(e,n):bt(e,nr(n,t,3))}function Ti(e,n,t){return"function"==typeof n&&"undefined"==typeof t&&nc(e)?nt(e,n):xt(e,nr(n,t,3))}function Ei(e,n,t){var r=e?e.length:0;if(!Nr(r)){e=aa(e);r=e.length}if(!r)return!1;t="number"==typeof t?0>t?ju(r+t,0):t||0:0;return"string"==typeof e||!nc(e)&&So(e)?r>t&&e.indexOf(n,t)>-1:xr(e,n,t)>-1}function Bi(e,n){return Ft(e,n,Ht(arguments,2))}function Ui(e,n,t){var r=nc(e)?it:St;n=br(n,t,3);return r(e,n)}function Gi(e,n){return Ui(e,Gt(n))}function $i(e,n,t,r){var i=nc(e)?ut:Jt;return i(e,br(n,r,4),t,arguments.length<3,bt)}function qi(e,n,t,r){var i=nc(e)?ct:Jt;return i(e,br(n,r,4),t,arguments.length<3,xt)}function Ji(e,n,t){var r=nc(e)?rt:At;n=br(n,t,3);return r(e,function(e,t,r){return!n(e,t,r)})}function Hi(e,n,t){if(t?jr(e,n,t):null==n){e=Sr(e);var r=e.length;return r>0?e[qt(0,r-1)]:x}var i=zi(e);i.length=Nu(0>n?0:+n||0,i.length);return i}function zi(e){e=Sr(e);for(var n=-1,t=e.length,r=qa(t);++n<t;){var i=qt(0,n);n!=i&&(r[n]=r[i]);r[i]=e[n]}return r}function Yi(e){var n=e?e.length:0;return Nr(n)?n:ac(e).length}function Qi(e,n,t){var r=nc(e)?lt:zt;("function"!=typeof n||"undefined"!=typeof t)&&(n=br(n,t,3));return r(e,n)}function Vi(e,n,t){if(null==e)return[];var r=-1,i=e.length,o=Nr(i)?qa(i):[];t&&jr(e,n,t)&&(n=null);n=br(n,t,3);bt(e,function(e,t,i){o[++r]={criteria:n(e,t,i),index:r,value:e}});return Yt(o,u)}function Xi(e){if(null==e)return[];var n=arguments,t=n[3];t&&jr(n[1],n[2],t)&&(n=[e,n[1]]);return Qt(e,Pt(n,!1,!1,1),[])}function Ki(e,n,t,r){if(null==e)return[];r&&jr(n,t,r)&&(t=null);nc(n)||(n=null==n?[]:[n]);nc(t)||(t=null==t?[]:[t]);return Qt(e,n,t)}function Zi(e,n){return Fi(e,Tt(n))}function eo(e,n){if("function"!=typeof n){if("function"!=typeof e)throw new Za(E);var t=e;e=n;n=t}e=Pu(e=+e)?e:0;return function(){return--e<1?n.apply(this,arguments):void 0}}function no(e,n,t){t&&jr(e,n,t)&&(n=null);n=e&&null==n?e.length:ju(+n||0,0);return gr(e,L,null,null,null,null,n)}function to(e,n){var t;if("function"!=typeof n){if("function"!=typeof e)throw new Za(E);var r=e;e=n;n=r}return function(){--e>0?t=n.apply(this,arguments):n=null;return t}}function ro(e,n){var t=k;if(arguments.length>2){var r=Ht(arguments,2),i=g(r,ro.placeholder);t|=j}return gr(e,t,n,r,i)}function io(e){return gt(e,arguments.length>1?Pt(arguments,!1,!1,1):Vo(e))}function oo(e,n){var t=k|A;if(arguments.length>2){var r=Ht(arguments,2),i=g(r,oo.placeholder);t|=j}return gr(n,t,e,r,i)}function ao(e,n,t){t&&jr(e,n,t)&&(n=null);var r=gr(e,P,null,null,null,null,null,n);r.placeholder=ao.placeholder;return r}function uo(e,n,t){t&&jr(e,n,t)&&(n=null);var r=gr(e,M,null,null,null,null,null,n);r.placeholder=uo.placeholder;return r}function co(e,n,t){function r(){p&&hu(p);c&&hu(c);c=p=h=x}function i(){var t=n-(Ku()-f);if(0>=t||t>n){c&&hu(c);var r=h;c=p=h=x;if(r){d=Ku();l=e.apply(s,u);p||c||(u=s=null)}}else p=mu(i,t)}function o(){p&&hu(p);c=p=h=x;if(v||g!==n){d=Ku();l=e.apply(s,u);p||c||(u=s=null)}}function a(){u=arguments;f=Ku();s=this;h=v&&(p||!y);if(g===!1)var t=y&&!p;else{c||y||(d=f);var r=g-(f-d),a=0>=r||r>g;if(a){c&&(c=hu(c));d=f;l=e.apply(s,u)}else c||(c=mu(o,r))}a&&p?p=hu(p):p||n===g||(p=mu(i,n));if(t){a=!0;l=e.apply(s,u)}!a||p||c||(u=s=null);return l}var u,c,l,f,s,p,h,d=0,g=!1,v=!0;if("function"!=typeof e)throw new Za(E);n=0>n?0:+n||0;if(t===!0){var y=!0;v=!1}else if(Ro(t)){y=t.leading;g="maxWait"in t&&ju(+t.maxWait||0,n);v="trailing"in t?t.trailing:v}a.cancel=r;return a}function lo(e){return _t(e,1,arguments,1)}function fo(e,n){return _t(e,n,arguments,2)}function so(e,n){if("function"!=typeof e||n&&"function"!=typeof n)throw new Za(E);var t=function(){var r=arguments,i=t.cache,o=n?n.apply(this,r):r[0];if(i.has(o))return i.get(o);var a=e.apply(this,r);i.set(o,a);return a};t.cache=new so.Cache;return t}function po(e){if("function"!=typeof e)throw new Za(E);return function(){return!e.apply(this,arguments)}}function ho(e){return to(e,2)}function go(e){var n=Ht(arguments,1),t=g(n,go.placeholder);return gr(e,j,null,n,t)}function vo(e){var n=Ht(arguments,1),t=g(n,vo.placeholder);return gr(e,N,null,n,t)}function yo(e){var n=Pt(arguments,!1,!1,1);return gr(e,R,null,null,null,n)}function _o(e){if("function"!=typeof e)throw new Za(E);return function(n){return e.apply(this,n)}}function mo(e,n,t){var r=!0,i=!0;if("function"!=typeof e)throw new Za(E);if(t===!1)r=!1;else if(Ro(t)){r="leading"in t?!!t.leading:r;i="trailing"in t?!!t.trailing:i}Tn.leading=r;Tn.maxWait=+n;Tn.trailing=i;return co(e,n,Tn)}function bo(e,n){n=null==n?La:n;return gr(n,j,null,[e],[])}function xo(e,n,t,r){if(n&&"boolean"!=typeof n&&jr(e,n,t))n=!1;else if("function"==typeof n){r=t;t=n;n=!1}t="function"==typeof t&&nr(t,r,1);return yt(e,n,t)}function wo(e,n,t){n="function"==typeof n&&nr(n,t,1);return yt(e,!0,n)}function ko(e){var n=h(e)?e.length:x;return Nr(n)&&uu.call(e)==U||!1}function Ao(e){return e===!0||e===!1||h(e)&&uu.call(e)==$||!1}function Wo(e){return h(e)&&uu.call(e)==q||!1}function Po(e){return e&&1===e.nodeType&&h(e)&&uu.call(e).indexOf("Element")>-1||!1}function Mo(e){if(null==e)return!0;var n=e.length;return Nr(n)&&(nc(e)||So(e)||ko(e)||h(e)&&rc(e.splice))?!n:!ac(e).length}function jo(e,n,t,r){t="function"==typeof t&&nr(t,r,3);if(!t&&Rr(e)&&Rr(n))return e===n;var i=t?t(e,n):x;return"undefined"==typeof i?Dt(e,n,t):!!i}function No(e){return h(e)&&"string"==typeof e.message&&uu.call(e)==J||!1}function Ro(e){var n=typeof e;return"function"==n||e&&"object"==n||!1}function Lo(e,n,t,r){var i=ac(n),o=i.length;t="function"==typeof t&&nr(t,r,3);if(!t&&1==o){var a=i[0],u=n[a];if(Rr(u))return null!=e&&u===e[a]&&ou.call(e,a)}for(var c=qa(o),l=qa(o);o--;){u=c[o]=n[i[o]];l[o]=Rr(u)}return Ct(e,i,c,l,t)}function Oo(e){return Io(e)&&e!=+e}function Fo(e){return null==e?!1:uu.call(e)==H?lu.test(ru.call(e)):h(e)&&Wn.test(e)||!1}function Do(e){return null===e}function Io(e){return"number"==typeof e||h(e)&&uu.call(e)==Y||!1}function Co(e){return h(e)&&uu.call(e)==V||!1}function So(e){return"string"==typeof e||h(e)&&uu.call(e)==K||!1}function To(e){return h(e)&&Nr(e.length)&&Cn[uu.call(e)]||!1}function Eo(e){return"undefined"==typeof e}function Bo(e){var n=e?e.length:0;return Nr(n)?n?Zn(e):[]:aa(e)}function Uo(e){return dt(e,Zo(e))}function Go(e,n,t){var r=$u(e);t&&jr(e,n,t)&&(n=null);return n?dt(n,r,ac(n)):r}function $o(e){if(null==e)return e;var n=Zn(arguments);n.push(ft);return oc.apply(x,n)}function qo(e,n,t){n=br(n,t,3);return Wt(e,n,Rt,!0)}function Jo(e,n,t){n=br(n,t,3);return Wt(e,n,Lt,!0)}function Ho(e,n,t){("function"!=typeof n||"undefined"!=typeof t)&&(n=nr(n,t,3));return Mt(e,n,Zo)}function zo(e,n,t){n=nr(n,t,3);return jt(e,n,Zo)}function Yo(e,n,t){("function"!=typeof n||"undefined"!=typeof t)&&(n=nr(n,t,3));return Rt(e,n)}function Qo(e,n,t){n=nr(n,t,3);return jt(e,n,ac)}function Vo(e){return Ot(e,Zo(e))}function Xo(e,n){return e?ou.call(e,n):!1}function Ko(e,n,t){t&&jr(e,n,t)&&(n=null);for(var r=-1,i=ac(e),o=i.length,a={};++r<o;){var u=i[r],c=e[u];n?ou.call(a,c)?a[c].push(u):a[c]=[u]:a[c]=u}return a}function Zo(e){if(null==e)return[];Ro(e)||(e=Va(e));var n=e.length;n=n&&Nr(n)&&(nc(e)||Gu.nonEnumArgs&&ko(e))&&n||0;for(var t=e.constructor,r=-1,i="function"==typeof t&&t.prototype===e,o=qa(n),a=n>0;++r<n;)o[r]=r+"";for(var u in e)a&&Mr(u,n)||"constructor"==u&&(i||!ou.call(e,u))||o.push(u);return o}function ea(e,n,t){var r={};n=br(n,t,3);Rt(e,function(e,t,i){r[t]=n(e,t,i)});return r}function na(e,n,t){if(null==e)return{};if("function"!=typeof n){var r=it(Pt(arguments,!1,!1,1),Ka);return Or(e,mt(Zo(e),r))}n=nr(n,t,3);return Fr(e,function(e,t,r){return!n(e,t,r)})}function ta(e){for(var n=-1,t=ac(e),r=t.length,i=qa(r);++n<r;){var o=t[n];i[n]=[o,e[o]]}return i}function ra(e,n,t){return null==e?{}:"function"==typeof n?Fr(e,nr(n,t,3)):Or(e,Pt(arguments,!1,!1,1))}function ia(e,n,t){var r=null==e?x:e[n];"undefined"==typeof r&&(r=t);return rc(r)?r.call(e):r}function oa(e,n,t,r){var i=nc(e)||To(e);n=br(n,r,4);if(null==t)if(i||Ro(e)){var o=e.constructor;t=i?nc(e)?new o:[]:$u(rc(o)&&o.prototype)}else t={};(i?et:Rt)(e,function(e,r,i){return n(t,e,r,i)});return t}function aa(e){return Xt(e,ac(e))}function ua(e){return Xt(e,Zo(e))}function ca(e,n,t){n=+n||0;if("undefined"==typeof t){t=n;n=0}else t=+t||0;return e>=n&&t>e}function la(e,n,t){t&&jr(e,n,t)&&(n=t=null);var r=null==e,i=null==n;if(null==t)if(i&&"boolean"==typeof e){t=e;
e=1}else if("boolean"==typeof n){t=n;i=!0}if(r&&i){n=1;i=!1}e=+e||0;if(i){n=e;e=0}else n=+n||0;if(t||e%1||n%1){var o=Fu();return Nu(e+o*(n-e+parseFloat("1e-"+((o+"").length-1))),n)}return qt(e,n)}function fa(e){e=r(e);return e&&e.charAt(0).toUpperCase()+e.slice(1)}function sa(e){e=r(e);return e&&e.replace(Pn,l)}function pa(e,n,t){e=r(e);n+="";var i=e.length;t=("undefined"==typeof t?i:Nu(0>t?0:+t||0,i))-n.length;return t>=0&&e.indexOf(n,t)==t}function ha(e){e=r(e);return e&&yn.test(e)?e.replace(gn,f):e}function da(e){e=r(e);return e&&Nn.test(e)?e.replace(jn,"\\$&"):e}function ga(e,n,t){e=r(e);n=+n;var i=e.length;if(i>=n||!Pu(n))return e;var o=(n-i)/2,a=du(o),u=pu(o);t=hr("",u,t);return t.slice(0,a)+e+t}function va(e,n,t){e=r(e);return e&&hr(e,n,t)+e}function ya(e,n,t){e=r(e);return e&&e+hr(e,n,t)}function _a(e,n,t){t&&jr(e,n,t)&&(n=0);return Ou(e,n)}function ma(e,n){var t="";e=r(e);n=+n;if(1>n||!e||!Pu(n))return t;do{n%2&&(t+=e);n=du(n/2);e+=e}while(n);return t}function ba(e,n,t){e=r(e);t=null==t?0:Nu(0>t?0:+t||0,e.length);return e.lastIndexOf(n,t)==t}function xa(e,n,t){var i=z.templateSettings;t&&jr(e,n,t)&&(n=t=null);e=r(e);n=pt(pt({},t||n),i,st);var o,a,u=pt(pt({},n.imports),i.imports,st),c=ac(u),l=Xt(u,c),f=0,p=n.interpolate||Mn,h="__p += '",d=Xa((n.escape||Mn).source+"|"+p.source+"|"+(p===bn?xn:Mn).source+"|"+(n.evaluate||Mn).source+"|$","g"),g="//# sourceURL="+("sourceURL"in n?n.sourceURL:"lodash.templateSources["+ ++In+"]")+"\n";e.replace(d,function(n,t,r,i,u,c){r||(r=i);h+=e.slice(f,c).replace(Ln,s);if(t){o=!0;h+="' +\n__e("+t+") +\n'"}if(u){a=!0;h+="';\n"+u+";\n__p += '"}r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'");f=c+n.length;return n});h+="';\n";var v=n.variable;v||(h="with (obj) {\n"+h+"\n}\n");h=(a?h.replace(sn,""):h).replace(pn,"$1").replace(hn,"$1;");h="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var y=ja(function(){return za(c,g+"return "+h).apply(x,l)});y.source=h;if(No(y))throw y;return y}function wa(e,n,t){var i=e;e=r(e);if(!e)return e;if(t?jr(i,n,t):null==n)return e.slice(y(e),_(e)+1);n+="";return e.slice(o(e,n),a(e,n)+1)}function ka(e,n,t){var i=e;e=r(e);return e?e.slice((t?jr(i,n,t):null==n)?y(e):o(e,n+"")):e}function Aa(e,n,t){var i=e;e=r(e);return e?(t?jr(i,n,t):null==n)?e.slice(0,_(e)+1):e.slice(0,a(e,n+"")+1):e}function Wa(e,n,t){t&&jr(e,n,t)&&(n=null);var i=O,o=F;if(null!=n)if(Ro(n)){var a="separator"in n?n.separator:a;i="length"in n?+n.length||0:i;o="omission"in n?r(n.omission):o}else i=+n||0;e=r(e);if(i>=e.length)return e;var u=i-o.length;if(1>u)return o;var c=e.slice(0,u);if(null==a)return c+o;if(Co(a)){if(e.slice(u).search(a)){var l,f,s=e.slice(0,u);a.global||(a=Xa(a.source,(wn.exec(a)||"")+"g"));a.lastIndex=0;for(;l=a.exec(s);)f=l.index;c=c.slice(0,null==f?u:f)}}else if(e.indexOf(a,u)!=u){var p=c.lastIndexOf(a);p>-1&&(c=c.slice(0,p))}return c+o}function Pa(e){e=r(e);return e&&vn.test(e)?e.replace(dn,m):e}function Ma(e,n,t){t&&jr(e,n,t)&&(n=null);e=r(e);return e.match(n||On)||[]}function ja(){for(var e=arguments[0],n=arguments.length,t=qa(n?n-1:0);--n>0;)t[n-1]=arguments[n];try{return e.apply(x,t)}catch(r){return No(r)?r:new Ha(r)}}function Na(e,n,t){t&&jr(e,n,t)&&(n=null);return h(e)?Oa(e):vt(e,n)}function Ra(e){return function(){return e}}function La(e){return e}function Oa(e){return Tt(yt(e,!0))}function Fa(e,n){return Et(e+"",yt(n,!0))}function Da(e,n,t){if(null==t){var r=Ro(n),i=r&&ac(n),o=i&&i.length&&Ot(n,i);if(!(o?o.length:r)){o=!1;t=n;n=e;e=this}}o||(o=Ot(n,ac(n)));var a=!0,u=-1,c=rc(e),l=o.length;t===!1?a=!1:Ro(t)&&"chain"in t&&(a=t.chain);for(;++u<l;){var f=o[u],s=n[f];e[f]=s;c&&(e.prototype[f]=function(n){return function(){var t=this.__chain__;if(a||t){var r=e(this.__wrapped__);(r.__actions__=Zn(this.__actions__)).push({func:n,args:arguments,thisArg:e});r.__chain__=t;return r}var i=[this.value()];vu.apply(i,arguments);return n.apply(e,i)}}(s))}return e}function Ia(){d._=cu;return this}function Ca(){}function Sa(e){return Gt(e+"")}function Ta(e){return function(n){return null==e?x:e[n]}}function Ea(e,n,t){t&&jr(e,n,t)&&(n=t=null);e=+e||0;t=null==t?1:+t||0;if(null==n){n=e;e=0}else n=+n||0;for(var r=-1,i=ju(pu((n-e)/(t||1)),0),o=qa(i);++r<i;){o[r]=e;e+=t}return o}function Ba(e,n,t){e=+e;if(1>e||!Pu(e))return[];var r=-1,i=qa(Nu(e,Cu));n=nr(n,t,1);for(;++r<e;)Cu>r?i[r]=n(r):n(r);return i}function Ua(e){var n=++au;return r(e)+n}function Ga(e,n){return e+n}function $a(e){nc(e)||(e=Sr(e));for(var n=e.length,t=0;n--;)t+=+e[n]||0;return t}d=d?Vn.defaults(Qn.Object(),d,Vn.pick(Qn,Dn)):Qn;var qa=d.Array,Ja=d.Date,Ha=d.Error,za=d.Function,Ya=d.Math,Qa=d.Number,Va=d.Object,Xa=d.RegExp,Ka=d.String,Za=d.TypeError,eu=qa.prototype,nu=Va.prototype,tu=(tu=d.window)&&tu.document,ru=za.prototype.toString,iu=Gt("length"),ou=nu.hasOwnProperty,au=0,uu=nu.toString,cu=d._,lu=Xa("^"+da(uu).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),fu=Fo(fu=d.ArrayBuffer)&&fu,su=Fo(su=fu&&new fu(0).slice)&&su,pu=Ya.ceil,hu=d.clearTimeout,du=Ya.floor,gu=Fo(gu=Va.getPrototypeOf)&&gu,vu=eu.push,yu=nu.propertyIsEnumerable,_u=Fo(_u=d.Set)&&_u,mu=d.setTimeout,bu=eu.splice,xu=Fo(xu=d.Uint8Array)&&xu,wu=Fo(wu=d.WeakMap)&&wu,ku=function(){try{var e=Fo(e=d.Float64Array)&&e,n=new e(new fu(10),0,1)&&e}catch(t){}return n}(),Au=Fo(Au=qa.isArray)&&Au,Wu=Fo(Wu=Va.create)&&Wu,Pu=d.isFinite,Mu=Fo(Mu=Va.keys)&&Mu,ju=Ya.max,Nu=Ya.min,Ru=Fo(Ru=Ja.now)&&Ru,Lu=Fo(Lu=Qa.isFinite)&&Lu,Ou=d.parseInt,Fu=Ya.random,Du=Qa.NEGATIVE_INFINITY,Iu=Qa.POSITIVE_INFINITY,Cu=Ya.pow(2,32)-1,Su=Cu-1,Tu=Cu>>>1,Eu=ku?ku.BYTES_PER_ELEMENT:0,Bu=Ya.pow(2,53)-1,Uu=wu&&new wu,Gu=z.support={};!function(){Gu.funcDecomp=!Fo(d.WinRTError)&&Rn.test(b);Gu.funcNames="string"==typeof za.name;try{Gu.dom=11===tu.createDocumentFragment().nodeType}catch(e){Gu.dom=!1}try{Gu.nonEnumArgs=!yu.call(arguments,1)}catch(e){Gu.nonEnumArgs=!0}}(0,0);z.templateSettings={escape:_n,evaluate:mn,interpolate:bn,variable:"",imports:{_:z}};var $u=function(){function e(){}return function(n){if(Ro(n)){e.prototype=n;var t=new e;e.prototype=null}return t||d.Object()}}(),qu=Uu?function(e,n){Uu.set(e,n);return e}:La;su||(tr=fu&&xu?function(e){var n=e.byteLength,t=ku?du(n/Eu):0,r=t*Eu,i=new fu(n);if(t){var o=new ku(i,0,t);o.set(new ku(e,0,t))}if(n!=r){o=new xu(i,r);o.set(new xu(e,r))}return i}:Ra(null));var Ju=Wu&&_u?function(e){return new Yn(e)}:Ra(null),Hu=Uu?function(e){return Uu.get(e)}:Ca,zu=function(){var e=0,n=0;return function(t,r){var i=Ku(),o=I-(i-n);n=i;if(o>0){if(++e>=D)return t}else e=0;return qu(t,r)}}(),Yu=or(function(e,n,t){ou.call(e,t)?++e[t]:e[t]=1}),Qu=or(function(e,n,t){ou.call(e,t)?e[t].push(n):e[t]=[n]}),Vu=or(function(e,n,t){e[t]=n}),Xu=or(function(e,n,t){e[t?0:1].push(n)},function(){return[[],[]]}),Ku=Ru||function(){return(new Ja).getTime()},Zu=cr(),ec=cr(!0),nc=Au||function(e){return h(e)&&Nr(e.length)&&uu.call(e)==G||!1};Gu.dom||(Po=function(e){return e&&1===e.nodeType&&h(e)&&!ic(e)||!1});var tc=Lu||function(e){return"number"==typeof e&&Pu(e)},rc=t(/x/)||xu&&!t(xu)?function(e){return uu.call(e)==H}:t,ic=gu?function(e){if(!e||uu.call(e)!=Q)return!1;var n=e.valueOf,t=Fo(n)&&(t=gu(n))&&gu(t);return t?e==t||gu(e)==t:Ir(e)}:Ir,oc=ar(pt),ac=Mu?function(e){if(e)var n=e.constructor,t=e.length;return"function"==typeof n&&n.prototype===e||"function"!=typeof e&&t&&Nr(t)?Cr(e):Ro(e)?Mu(e):[]}:Cr,uc=ar(Bt),cc=lr(function(e,n,t){n=n.toLowerCase();return e+(t?n.charAt(0).toUpperCase()+n.slice(1):n)}),lc=lr(function(e,n,t){return e+(t?"-":"")+n.toLowerCase()});8!=Ou(Fn+"08")&&(_a=function(e,n,t){(t?jr(e,n,t):null==n)?n=0:n&&(n=+n);e=wa(e);return Ou(e,n||(An.test(e)?16:10))});var fc=lr(function(e,n,t){return e+(t?"_":"")+n.toLowerCase()}),sc=lr(function(e,n,t){return e+(t?" ":"")+(n.charAt(0).toUpperCase()+n.slice(1))}),pc=sr(ot),hc=sr(at,!0);z.prototype=X.prototype;Z.prototype=$u(X.prototype);Z.prototype.constructor=Z;En.prototype=$u(X.prototype);En.prototype.constructor=En;$n.prototype["delete"]=qn;$n.prototype.get=Jn;$n.prototype.has=Hn;$n.prototype.set=zn;Yn.prototype.push=Kn;so.Cache=$n;z.after=eo;z.ary=no;z.assign=oc;z.at=Li;z.before=to;z.bind=ro;z.bindAll=io;z.bindKey=oo;z.callback=Na;z.chain=wi;z.chunk=Br;z.compact=Ur;z.constant=Ra;z.countBy=Yu;z.create=Go;z.curry=ao;z.curryRight=uo;z.debounce=co;z.defaults=$o;z.defer=lo;z.delay=fo;z.difference=Gr;z.drop=$r;z.dropRight=qr;z.dropRightWhile=Jr;z.dropWhile=Hr;z.fill=zr;z.filter=Fi;z.flatten=Xr;z.flattenDeep=Kr;z.flow=Zu;z.flowRight=ec;z.forEach=Si;z.forEachRight=Ti;z.forIn=Ho;z.forInRight=zo;z.forOwn=Yo;z.forOwnRight=Qo;z.functions=Vo;z.groupBy=Qu;z.indexBy=Vu;z.initial=ei;z.intersection=ni;z.invert=Ko;z.invoke=Bi;z.keys=ac;z.keysIn=Zo;z.map=Ui;z.mapValues=ea;z.matches=Oa;z.matchesProperty=Fa;z.memoize=so;z.merge=uc;z.mixin=Da;z.negate=po;z.omit=na;z.once=ho;z.pairs=ta;z.partial=go;z.partialRight=vo;z.partition=Xu;z.pick=ra;z.pluck=Gi;z.property=Sa;z.propertyOf=Ta;z.pull=ii;z.pullAt=oi;z.range=Ea;z.rearg=yo;z.reject=Ji;z.remove=ai;z.rest=ui;z.shuffle=zi;z.slice=ci;z.sortBy=Vi;z.sortByAll=Xi;z.sortByOrder=Ki;z.spread=_o;z.take=si;z.takeRight=pi;z.takeRightWhile=hi;z.takeWhile=di;z.tap=ki;z.throttle=mo;z.thru=Ai;z.times=Ba;z.toArray=Bo;z.toPlainObject=Uo;z.transform=oa;z.union=gi;z.uniq=vi;z.unzip=yi;z.values=aa;z.valuesIn=ua;z.where=Zi;z.without=_i;z.wrap=bo;z.xor=mi;z.zip=bi;z.zipObject=xi;z.backflow=ec;z.collect=Ui;z.compose=ec;z.each=Si;z.eachRight=Ti;z.extend=oc;z.iteratee=Na;z.methods=Vo;z.object=xi;z.select=Fi;z.tail=ui;z.unique=vi;Da(z,z);z.add=Ga;z.attempt=ja;z.camelCase=cc;z.capitalize=fa;z.clone=xo;z.cloneDeep=wo;z.deburr=sa;z.endsWith=pa;z.escape=ha;z.escapeRegExp=da;z.every=Oi;z.find=Di;z.findIndex=Yr;z.findKey=qo;z.findLast=Ii;z.findLastIndex=Qr;z.findLastKey=Jo;z.findWhere=Ci;z.first=Vr;z.has=Xo;z.identity=La;z.includes=Ei;z.indexOf=Zr;z.inRange=ca;z.isArguments=ko;z.isArray=nc;z.isBoolean=Ao;z.isDate=Wo;z.isElement=Po;z.isEmpty=Mo;z.isEqual=jo;z.isError=No;z.isFinite=tc;z.isFunction=rc;z.isMatch=Lo;z.isNaN=Oo;z.isNative=Fo;z.isNull=Do;z.isNumber=Io;z.isObject=Ro;z.isPlainObject=ic;z.isRegExp=Co;z.isString=So;z.isTypedArray=To;z.isUndefined=Eo;z.kebabCase=lc;z.last=ti;z.lastIndexOf=ri;z.max=pc;z.min=hc;z.noConflict=Ia;z.noop=Ca;z.now=Ku;z.pad=ga;z.padLeft=va;z.padRight=ya;z.parseInt=_a;z.random=la;z.reduce=$i;z.reduceRight=qi;z.repeat=ma;z.result=ia;z.runInContext=b;z.size=Yi;z.snakeCase=fc;z.some=Qi;z.sortedIndex=li;z.sortedLastIndex=fi;z.startCase=sc;z.startsWith=ba;z.sum=$a;z.template=xa;z.trim=wa;z.trimLeft=ka;z.trimRight=Aa;z.trunc=Wa;z.unescape=Pa;z.uniqueId=Ua;z.words=Ma;z.all=Oi;z.any=Qi;z.contains=Ei;z.detect=Di;z.foldl=$i;z.foldr=qi;z.head=Vr;z.include=Ei;z.inject=$i;Da(z,function(){var e={};Rt(z,function(n,t){z.prototype[t]||(e[t]=n)});return e}(),!1);z.sample=Hi;z.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(n){return Hi(n,e)}):Hi(this.value())};z.VERSION=w;et(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){z[e].placeholder=z});et(["dropWhile","filter","map","takeWhile"],function(e,n){var t=n!=S,r=n==C;En.prototype[e]=function(e,i){var o=this.__filtered__,a=o&&r?new En(this):this.clone(),u=a.__iteratees__||(a.__iteratees__=[]);a.__filtered__=o||t;u.push({done:!1,index:0,iteratee:br(e,i,1),type:n});return a}});et(["drop","take"],function(e,n){var t="__"+e+"Count__",r=e+"While";En.prototype[e]=function(r){r=null==r?1:ju(du(r)||0,0);var i=this.clone();if(i.__filtered__){var o=i[t];i[t]=n?Nu(o,r):o+r}else{var a=i.__views__||(i.__views__=[]);a.push({size:r,type:e+(i.__dir__<0?"Right":"")})}return i};En.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()};En.prototype[e+"RightWhile"]=function(e,n){return this.reverse()[r](e,n).reverse()}});et(["first","last"],function(e,n){var t="take"+(n?"Right":"");En.prototype[e]=function(){return this[t](1).value()[0]}});et(["initial","rest"],function(e,n){var t="drop"+(n?"":"Right");En.prototype[e]=function(){return this[t](1)}});et(["pluck","where"],function(e,n){var t=n?"filter":"map",r=n?Tt:Gt;En.prototype[e]=function(e){return this[t](r(e))}});En.prototype.compact=function(){return this.filter(La)};En.prototype.reject=function(e,n){e=br(e,n,1);return this.filter(function(n){return!e(n)})};En.prototype.slice=function(e,n){e=null==e?0:+e||0;var t=0>e?this.takeRight(-e):this.drop(e);if("undefined"!=typeof n){n=+n||0;t=0>n?t.dropRight(-n):t.take(n-e)}return t};En.prototype.toArray=function(){return this.drop(0)};Rt(En.prototype,function(e,n){var t=z[n],r=/^(?:filter|map|reject)|While$/.test(n),i=/^(?:first|last)$/.test(n);z.prototype[n]=function(){var n=arguments,o=(n.length,this.__chain__),a=this.__wrapped__,u=!!this.__actions__.length,c=a instanceof En,l=n[0],f=c||nc(a);f&&r&&"function"==typeof l&&1!=l.length&&(c=f=!1);var s=c&&!u;if(i&&!o)return s?e.call(a):t.call(z,this.value());var p=function(e){var r=[e];vu.apply(r,n);return t.apply(z,r)};if(f){var h=s?a:new En(this),d=e.apply(h,n);if(!i&&(u||d.__actions__)){var g=d.__actions__||(d.__actions__=[]);g.push({func:Ai,args:[p],thisArg:z})}return new Z(d,o)}return this.thru(p)}});et(["concat","join","pop","push","shift","sort","splice","unshift"],function(e){var n=eu[e],t=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:join|pop|shift)$/.test(e);z.prototype[e]=function(){var e=arguments;return r&&!this.__chain__?n.apply(this.value(),e):this[t](function(t){return n.apply(t,e)})}});En.prototype.clone=Bn;En.prototype.reverse=Un;En.prototype.value=Gn;z.prototype.chain=Wi;z.prototype.commit=Pi;z.prototype.plant=Mi;z.prototype.reverse=ji;z.prototype.toString=Ni;z.prototype.run=z.prototype.toJSON=z.prototype.valueOf=z.prototype.value=Ri;z.prototype.collect=z.prototype.map;z.prototype.head=z.prototype.first;z.prototype.select=z.prototype.filter;z.prototype.tail=z.prototype.rest;return z}var x,w="3.4.0",k=1,A=2,W=4,P=8,M=16,j=32,N=64,R=128,L=256,O=30,F="...",D=150,I=16,C=0,S=2,T=3,E="Expected a function",B="__lodash_placeholder__",U="[object Arguments]",G="[object Array]",$="[object Boolean]",q="[object Date]",J="[object Error]",H="[object Function]",z="[object Map]",Y="[object Number]",Q="[object Object]",V="[object RegExp]",X="[object Set]",K="[object String]",Z="[object WeakMap]",en="[object ArrayBuffer]",nn="[object Float32Array]",tn="[object Float64Array]",rn="[object Int8Array]",on="[object Int16Array]",an="[object Int32Array]",un="[object Uint8Array]",cn="[object Uint8ClampedArray]",ln="[object Uint16Array]",fn="[object Uint32Array]",sn=/\b__p \+= '';/g,pn=/\b(__p \+=) '' \+/g,hn=/(__e\(.*?\)|\b__t\)) \+\n'';/g,dn=/&(?:amp|lt|gt|quot|#39|#96);/g,gn=/[&<>"'`]/g,vn=RegExp(dn.source),yn=RegExp(gn.source),_n=/<%-([\s\S]+?)%>/g,mn=/<%([\s\S]+?)%>/g,bn=/<%=([\s\S]+?)%>/g,xn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,wn=/\w*$/,kn=/^\s*function[ \n\r\t]+\w/,An=/^0[xX]/,Wn=/^\[object .+?Constructor\]$/,Pn=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Mn=/($^)/,jn=/[.*+?^${}()|[\]\/\\]/g,Nn=RegExp(jn.source),Rn=/\bthis\b/,Ln=/['\n\r\u2028\u2029\\]/g,On=function(){var e="[A-Z\\xc0-\\xd6\\xd8-\\xde]",n="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(e+"+(?="+e+n+")|"+e+"?"+n+"|"+e+"+|[0-9]+","g")}(),Fn=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",Dn=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window","WinRTError"],In=-1,Cn={};Cn[nn]=Cn[tn]=Cn[rn]=Cn[on]=Cn[an]=Cn[un]=Cn[cn]=Cn[ln]=Cn[fn]=!0;Cn[U]=Cn[G]=Cn[en]=Cn[$]=Cn[q]=Cn[J]=Cn[H]=Cn[z]=Cn[Y]=Cn[Q]=Cn[V]=Cn[X]=Cn[K]=Cn[Z]=!1;var Sn={};Sn[U]=Sn[G]=Sn[en]=Sn[$]=Sn[q]=Sn[nn]=Sn[tn]=Sn[rn]=Sn[on]=Sn[an]=Sn[Y]=Sn[Q]=Sn[V]=Sn[K]=Sn[un]=Sn[cn]=Sn[ln]=Sn[fn]=!0;Sn[J]=Sn[H]=Sn[z]=Sn[X]=Sn[Z]=!1;var Tn={leading:!1,maxWait:0,trailing:!1},En={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Bn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Un={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Gn={"function":!0,object:!0},$n={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},qn=Gn[typeof exports]&&exports&&!exports.nodeType&&exports,Jn=Gn[typeof module]&&module&&!module.nodeType&&module,Hn=qn&&Jn&&"object"==typeof global&&global,zn=Gn[typeof window]&&window,Yn=Jn&&Jn.exports===qn&&qn,Qn=Hn||zn!==(this&&this.window)&&zn||this,Vn=b();if("function"==typeof define&&"object"==typeof define.amd&&define.amd){Qn._=Vn;define("lodash",[],function(){return Vn})}else qn&&Jn?Yn?(Jn.exports=Vn)._=Vn:qn._=Vn:Qn._=Vn}).call(this);define("eventmanager",[""],function(){function e(e,n){topics.hasOwnProperty(e)||(topics[e]=[]);topics[e].push(n);return!0}function n(e,n){if(!topics.hasOwnProperty(e))return!1;for(var t=0,r=topics[e].length;r>t;t++)if(String(topics[e][t])===String(n)){topics[e].splice(t,1);return!0}return!1}function t(){var e=Array.prototype.slice.call(arguments),n=e.shift();if(!topics.hasOwnProperty(n))return!1;for(var t=0,r=topics[n].length;r>t;t++)topics[n][t].apply(void 0,e);return!0}topics={};return{subscribe:e,unsubscrive:n,publish:t,topics:topics}});define("standardlib",["eventmanager"],function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function n(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function t(e,n){var t={};t.x=n+e;t.y=n-e;return t}function r(e,n){var t={};t.x=(e-n)/2;t.y=(e+n)/2;return t}function i(e){e=_.cloneDeep(e);e.x=e.x-app.config.actor.grid.width/2*app.config.actor.tile.width;var n=(e.x/(app.config.actor.tile.width/2)+e.y/(app.config.actor.tile.height/2))/2,t=(e.y/(app.config.actor.tile.height/2)-e.x/(app.config.actor.tile.width/2))/2;n=Math.floor(n);t=Math.floor(t);return{x:n,y:t}}function o(e){var n=i(e);return r(n.x,n.y)}function a(e){var n=r(e.x,e.y),t=n.y*app.config.actor.tile.height,i=n.x*app.config.actor.tile.width+app.config.actor.grid.width/2*app.config.actor.tile.width;return{x:i,y:t}}function u(e,n){var t=setInterval(function(){e()&&clearInterval(t)},1e3)}return{guid:n,isoToTwoD:t,twoDToIso:r,worldPosToGridPos:i,worldPosToIsoPos:o,gridPosToWorldPos:a,checkWait:u}});define("RNG",[],function(){function e(){t(Date.now())}function n(){return l}function t(e){e=1>e?1/e:e;l=e;f=(e>>>0)*d;e=69069*e+1>>>0;s=e*d;e=69069*e+1>>>0;p=e*d;h=1}function r(){var e=2091639*f+h*d;f=s;s=p;h=0|e;p=e-h;return p}function i(e,n){do var t=2*r()-1,i=2*r()-1,o=t*t+i*i;while(o>1||0==o);var a=t*Math.sqrt(-2*Math.log(o)/o);return(e||0)+a*(n||1)}function o(){return 1+Math.floor(100*r())}function a(e){var n=0;for(var t in e)n+=e[t];var i=Math.floor(r()*n),o=0;for(var t in e){o+=e[t];if(o>i)return t}return null}function u(){return[f,s,p,h]}function c(e){f=e[0];s=e[1];p=e[2];h=e[3]}var l,f=0,s=0,p=0,h=0,d=2.3283064365386963e-10;e();return{getSeed:n,setSeed:t,getUniform:r,getNormal:i,getPercentage:o,getWeightedValue:a,getState:u,setState:c}});define("world",["RNG"],function(e){function n(){l=_.compose(o,a,o,o,r,t)()}function t(){var e,n,t=[];for(e=0;c>e;e++){t[e]=[];for(n=0;u>n;n++)t[e][n]=0}return t}function r(n){var t,r;for(t=0;t<n.length;t++)for(r=0;r<n[0].length;r++)n[t][r]=e.getUniform()<h?1:0;return n}function i(e,n,t){for(var r=0,i=0;i<d.length;i++){var o=d[i],a=n+o[0],c=t+o[1];0>a||a>=u||0>a||c>=u||(r+=1===e[a][c]?1:0)}return r}function o(e){for(var n=0,r=t(),o=0;o<e.length;o++){var a=1,u=0;if(6===p){a=2;u=o%2}for(var c=u;c<e[0].length;c+=a){n++;var l=e[c][o],h=i(e,c,o);l&&-1!==s.indexOf(h)?r[c][o]=1:l||-1===f.indexOf(h)||(r[c][o]=1)}}return r}function a(e){for(var n=[],t=2,r=0;r<e.length;r++)for(var i=0;t>i;i++){var o=r*t+i;n[o]=[];for(var a=0;a<e[0].length;a++)for(var u=0;t>u;u++){var c=a*t+u;n[o][c]=e[r][a]}}return n}var u=app.config.terrain.grid.width,c=app.config.terrain.grid.height,l=[],f=[5,6,7,8],s=[4,5,6,7,8],p=8,h=.47,d=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];n();return{grid:l}});!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define("pathfinding",e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.PF=e()}}(function(){return function e(n,t,r){function i(a,u){if(!t[a]){if(!n[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=t[a]={exports:{}};n[a][0].call(l.exports,function(e){var t=n[a][1][e];return i(t?t:e)},l,l.exports,e,n,t,r)}return t[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,n){n.exports=e("./lib/heap")},{"./lib/heap":2}],2:[function(e,n){(function(){var e,t,r,i,o,a,u,c,l,f,s,p,h,d,g;r=Math.floor,f=Math.min;t=function(e,n){return n>e?-1:e>n?1:0};l=function(e,n,i,o,a){var u;null==i&&(i=0);null==a&&(a=t);if(0>i)throw new Error("lo must be non-negative");null==o&&(o=e.length);for(;o>i;){u=r((i+o)/2);a(n,e[u])<0?o=u:i=u+1}return[].splice.apply(e,[i,i-i].concat(n)),n};a=function(e,n,r){null==r&&(r=t);e.push(n);return d(e,0,e.length-1,r)};o=function(e,n){var r,i;null==n&&(n=t);r=e.pop();if(e.length){i=e[0];e[0]=r;g(e,0,n)}else i=r;return i};c=function(e,n,r){var i;null==r&&(r=t);i=e[0];e[0]=n;g(e,0,r);return i};u=function(e,n,r){var i;null==r&&(r=t);if(e.length&&r(e[0],n)<0){i=[e[0],n],n=i[0],e[0]=i[1];g(e,0,r)}return n};i=function(e,n){var i,o,a,u,c,l;null==n&&(n=t);u=function(){l=[];for(var n=0,t=r(e.length/2);t>=0?t>n:n>t;t>=0?n++:n--)l.push(n);return l}.apply(this).reverse();c=[];for(o=0,a=u.length;a>o;o++){i=u[o];c.push(g(e,i,n))}return c};h=function(e,n,r){var i;null==r&&(r=t);i=e.indexOf(n);if(-1!==i){d(e,0,i,r);return g(e,i,r)}};s=function(e,n,r){var o,a,c,l,f;null==r&&(r=t);a=e.slice(0,n);if(!a.length)return a;i(a,r);f=e.slice(n);for(c=0,l=f.length;l>c;c++){o=f[c];u(a,o,r)}return a.sort(r).reverse()};p=function(e,n,r){var a,u,c,s,p,h,d,g,v,y;null==r&&(r=t);if(10*n<=e.length){s=e.slice(0,n).sort(r);if(!s.length)return s;c=s[s.length-1];g=e.slice(n);for(p=0,d=g.length;d>p;p++){a=g[p];if(r(a,c)<0){l(s,a,0,null,r);s.pop();c=s[s.length-1]}}return s}i(e,r);y=[];for(u=h=0,v=f(n,e.length);v>=0?v>h:h>v;u=v>=0?++h:--h)y.push(o(e,r));return y};d=function(e,n,r,i){var o,a,u;null==i&&(i=t);o=e[r];for(;r>n;){u=r-1>>1;a=e[u];if(!(i(o,a)<0))break;e[r]=a;r=u}return e[r]=o};g=function(e,n,r){var i,o,a,u,c;null==r&&(r=t);o=e.length;c=n;a=e[n];i=2*n+1;for(;o>i;){u=i+1;o>u&&!(r(e[i],e[u])<0)&&(i=u);e[n]=e[i];n=i;i=2*n+1}e[n]=a;return d(e,c,n,r)};e=function(){function e(e){this.cmp=null!=e?e:t;this.nodes=[]}e.push=a;e.pop=o;e.replace=c;e.pushpop=u;e.heapify=i;e.updateItem=h;e.nlargest=s;e.nsmallest=p;e.prototype.push=function(e){return a(this.nodes,e,this.cmp)};e.prototype.pop=function(){return o(this.nodes,this.cmp)};e.prototype.peek=function(){return this.nodes[0]};e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)};e.prototype.replace=function(e){return c(this.nodes,e,this.cmp)};e.prototype.pushpop=function(e){return u(this.nodes,e,this.cmp)};e.prototype.heapify=function(){return i(this.nodes,this.cmp)};e.prototype.updateItem=function(e){return h(this.nodes,e,this.cmp)};e.prototype.clear=function(){return this.nodes=[]};e.prototype.empty=function(){return 0===this.nodes.length};e.prototype.size=function(){return this.nodes.length};e.prototype.clone=function(){var n;n=new e;n.nodes=this.nodes.slice(0);return n};e.prototype.toArray=function(){return this.nodes.slice(0)};e.prototype.insert=e.prototype.push;e.prototype.top=e.prototype.peek;e.prototype.front=e.prototype.peek;e.prototype.has=e.prototype.contains;e.prototype.copy=e.prototype.clone;return e}();("undefined"!=typeof n&&null!==n?n.exports:void 0)?n.exports=e:window.Heap=e}).call(this)},{}],3:[function(e,n){var t={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4};n.exports=t},{}],4:[function(e,n){function t(e,n,t){this.width=e;this.height=n;this.nodes=this._buildNodes(e,n,t)}var r=e("./Node"),i=e("./DiagonalMovement");t.prototype._buildNodes=function(e,n,t){var i,o,a=new Array(n);for(i=0;n>i;++i){a[i]=new Array(e);for(o=0;e>o;++o)a[i][o]=new r(o,i)}if(void 0===t)return a;if(t.length!==n||t[0].length!==e)throw new Error("Matrix size does not fit");for(i=0;n>i;++i)for(o=0;e>o;++o)t[i][o]&&(a[i][o].walkable=!1);return a};t.prototype.getNodeAt=function(e,n){return this.nodes[n][e]};t.prototype.isWalkableAt=function(e,n){return this.isInside(e,n)&&this.nodes[n][e].walkable};t.prototype.isInside=function(e,n){return e>=0&&e<this.width&&n>=0&&n<this.height};t.prototype.setWalkableAt=function(e,n,t){this.nodes[n][e].walkable=t};t.prototype.getNeighbors=function(e,n){var t=e.x,r=e.y,o=[],a=!1,u=!1,c=!1,l=!1,f=!1,s=!1,p=!1,h=!1,d=this.nodes;if(this.isWalkableAt(t,r-1)){o.push(d[r-1][t]);a=!0}if(this.isWalkableAt(t+1,r)){o.push(d[r][t+1]);c=!0}if(this.isWalkableAt(t,r+1)){o.push(d[r+1][t]);f=!0}if(this.isWalkableAt(t-1,r)){o.push(d[r][t-1]);p=!0}if(n===i.Never)return o;if(n===i.OnlyWhenNoObstacles){u=p&&a;l=a&&c;s=c&&f;h=f&&p}else if(n===i.IfAtMostOneObstacle){u=p||a;l=a||c;s=c||f;h=f||p}else{if(n!==i.Always)throw new Error("Incorrect value of diagonalMovement");u=!0;l=!0;s=!0;h=!0}u&&this.isWalkableAt(t-1,r-1)&&o.push(d[r-1][t-1]);l&&this.isWalkableAt(t+1,r-1)&&o.push(d[r-1][t+1]);s&&this.isWalkableAt(t+1,r+1)&&o.push(d[r+1][t+1]);h&&this.isWalkableAt(t-1,r+1)&&o.push(d[r+1][t-1]);return o};t.prototype.clone=function(){var e,n,i=this.width,o=this.height,a=this.nodes,u=new t(i,o),c=new Array(o);for(e=0;o>e;++e){c[e]=new Array(i);for(n=0;i>n;++n)c[e][n]=new r(n,e,a[e][n].walkable)}u.nodes=c;return u};n.exports=t},{"./DiagonalMovement":3,"./Node":6}],5:[function(e,n){n.exports={manhattan:function(e,n){return e+n},euclidean:function(e,n){return Math.sqrt(e*e+n*n)},octile:function(e,n){var t=Math.SQRT2-1;return n>e?t*e+n:t*n+e},chebyshev:function(e,n){return Math.max(e,n)}}},{}],6:[function(e,n){function t(e,n,t){this.x=e;this.y=n;this.walkable=void 0===t?!0:t}n.exports=t},{}],7:[function(e,n,t){function r(e){for(var n=[[e.x,e.y]];e.parent;){e=e.parent;n.push([e.x,e.y])}return n.reverse()}function i(e,n){var t=r(e),i=r(n);return t.concat(i.reverse())}function o(e){var n,t,r,i,o,a=0;for(n=1;n<e.length;++n){t=e[n-1];r=e[n];i=t[0]-r[0];o=t[1]-r[1];a+=Math.sqrt(i*i+o*o)}return a}function a(e,n,t,r){var i,o,a,u,c,l,f=Math.abs,s=[];a=f(t-e);u=f(r-n);i=t>e?1:-1;o=r>n?1:-1;c=a-u;for(;;){s.push([e,n]);if(e===t&&n===r)break;l=2*c;if(l>-u){c-=u;e+=i}if(a>l){c+=a;n+=o}}return s}function u(e){var n,t,r,i,o,u,c=[],l=e.length;if(2>l)return c;for(o=0;l-1>o;++o){n=e[o];t=e[o+1];r=a(n[0],n[1],t[0],t[1]);i=r.length;for(u=0;i-1>u;++u)c.push(r[u])}c.push(e[l-1]);return c}function c(e,n){var t,r,i,o,u,c,l,f,s,p,h,d=n.length,g=n[0][0],v=n[0][1],y=n[d-1][0],_=n[d-1][1];t=g;r=v;u=[[t,r]];for(c=2;d>c;++c){f=n[c];i=f[0];o=f[1];s=a(t,r,i,o);h=!1;for(l=1;l<s.length;++l){p=s[l];if(!e.isWalkableAt(p[0],p[1])){h=!0;break}}if(h){lastValidCoord=n[c-1];u.push(lastValidCoord);t=lastValidCoord[0];r=lastValidCoord[1]}}u.push([y,_]);return u}function l(e){if(e.length<3)return e;var n,t,r,i,o,a,u=[],c=e[0][0],l=e[0][1],f=e[1][0],s=e[1][1],p=f-c,h=s-l;o=Math.sqrt(p*p+h*h);p/=o;h/=o;u.push([c,l]);for(a=2;a<e.length;a++){n=f;t=s;r=p;i=h;f=e[a][0];s=e[a][1];p=f-n;h=s-t;o=Math.sqrt(p*p+h*h);p/=o;h/=o;(p!==r||h!==i)&&u.push([n,t])}u.push([f,s]);return u}t.backtrace=r;t.biBacktrace=i;t.pathLength=o;t.interpolate=a;t.expandPath=u;t.smoothenPath=c;t.compressPath=l},{}],8:[function(e,n){n.exports={Heap:e("heap"),Node:e("./core/Node"),Grid:e("./core/Grid"),Util:e("./core/Util"),DiagonalMovement:e("./core/DiagonalMovement"),Heuristic:e("./core/Heuristic"),AStarFinder:e("./finders/AStarFinder"),BestFirstFinder:e("./finders/BestFirstFinder"),BreadthFirstFinder:e("./finders/BreadthFirstFinder"),DijkstraFinder:e("./finders/DijkstraFinder"),BiAStarFinder:e("./finders/BiAStarFinder"),BiBestFirstFinder:e("./finders/BiBestFirstFinder"),BiBreadthFirstFinder:e("./finders/BiBreadthFirstFinder"),BiDijkstraFinder:e("./finders/BiDijkstraFinder"),IDAStarFinder:e("./finders/IDAStarFinder"),JumpPointFinder:e("./finders/JumpPointFinder")}},{"./core/DiagonalMovement":3,"./core/Grid":4,"./core/Heuristic":5,"./core/Node":6,"./core/Util":7,"./finders/AStarFinder":9,"./finders/BestFirstFinder":10,"./finders/BiAStarFinder":11,"./finders/BiBestFirstFinder":12,"./finders/BiBreadthFirstFinder":13,"./finders/BiDijkstraFinder":14,"./finders/BreadthFirstFinder":15,"./finders/DijkstraFinder":16,"./finders/IDAStarFinder":17,"./finders/JumpPointFinder":22,heap:1}],9:[function(e,n){function t(e){e=e||{};this.allowDiagonal=e.allowDiagonal;this.dontCrossCorners=e.dontCrossCorners;this.heuristic=e.heuristic||o.manhattan;this.weight=e.weight||1;this.diagonalMovement=e.diagonalMovement;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?a.OnlyWhenNoObstacles:a.IfAtMostOneObstacle:a.Never);this.heuristic=this.diagonalMovement===a.Never?e.heuristic||o.manhattan:e.heuristic||o.octile}var r=e("heap"),i=e("../core/Util"),o=e("../core/Heuristic"),a=e("../core/DiagonalMovement");t.prototype.findPath=function(e,n,t,o,a){var u,c,l,f,s,p,h,d,g=new r(function(e,n){return e.f-n.f}),v=a.getNodeAt(e,n),y=a.getNodeAt(t,o),_=this.heuristic,m=this.diagonalMovement,b=this.weight,x=Math.abs,w=Math.SQRT2;v.g=0;v.f=0;g.push(v);v.opened=!0;for(;!g.empty();){u=g.pop();u.closed=!0;if(u===y)return i.backtrace(y);c=a.getNeighbors(u,m);for(f=0,s=c.length;s>f;++f){l=c[f];if(!l.closed){p=l.x;h=l.y;d=u.g+(p-u.x===0||h-u.y===0?1:w);if(!l.opened||d<l.g){l.g=d;l.h=l.h||b*_(x(p-t),x(h-o));l.f=l.g+l.h;l.parent=u;if(l.opened)g.updateItem(l);else{g.push(l);l.opened=!0}}}}}return[]};n.exports=t},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],10:[function(e,n){function t(e){r.call(this,e);var n=this.heuristic;this.heuristic=function(e,t){return 1e6*n(e,t)}}var r=e("./AStarFinder");t.prototype=new r;t.prototype.constructor=t;n.exports=t},{"./AStarFinder":9}],11:[function(e,n){function t(e){e=e||{};this.allowDiagonal=e.allowDiagonal;this.dontCrossCorners=e.dontCrossCorners;this.diagonalMovement=e.diagonalMovement;this.heuristic=e.heuristic||o.manhattan;this.weight=e.weight||1;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?a.OnlyWhenNoObstacles:a.IfAtMostOneObstacle:a.Never);this.heuristic=this.diagonalMovement===a.Never?e.heuristic||o.manhattan:e.heuristic||o.octile}var r=e("heap"),i=e("../core/Util"),o=e("../core/Heuristic"),a=e("../core/DiagonalMovement");t.prototype.findPath=function(e,n,t,o,a){var u,c,l,f,s,p,h,d,g=function(e,n){return e.f-n.f},v=new r(g),y=new r(g),_=a.getNodeAt(e,n),m=a.getNodeAt(t,o),b=this.heuristic,x=this.diagonalMovement,w=this.weight,k=Math.abs,A=Math.SQRT2,W=1,P=2;_.g=0;_.f=0;v.push(_);_.opened=W;m.g=0;m.f=0;y.push(m);m.opened=P;for(;!v.empty()&&!y.empty();){u=v.pop();u.closed=!0;c=a.getNeighbors(u,x);for(f=0,s=c.length;s>f;++f){l=c[f];if(!l.closed){if(l.opened===P)return i.biBacktrace(u,l);p=l.x;h=l.y;d=u.g+(p-u.x===0||h-u.y===0?1:A);if(!l.opened||d<l.g){l.g=d;l.h=l.h||w*b(k(p-t),k(h-o));l.f=l.g+l.h;l.parent=u;if(l.opened)v.updateItem(l);else{v.push(l);l.opened=W}}}}u=y.pop();u.closed=!0;c=a.getNeighbors(u,x);for(f=0,s=c.length;s>f;++f){l=c[f];if(!l.closed){if(l.opened===W)return i.biBacktrace(l,u);p=l.x;h=l.y;d=u.g+(p-u.x===0||h-u.y===0?1:A);if(!l.opened||d<l.g){l.g=d;l.h=l.h||w*b(k(p-e),k(h-n));
l.f=l.g+l.h;l.parent=u;if(l.opened)y.updateItem(l);else{y.push(l);l.opened=P}}}}}return[]};n.exports=t},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],12:[function(e,n){function t(e){r.call(this,e);var n=this.heuristic;this.heuristic=function(e,t){return 1e6*n(e,t)}}var r=e("./BiAStarFinder");t.prototype=new r;t.prototype.constructor=t;n.exports=t},{"./BiAStarFinder":11}],13:[function(e,n){function t(e){e=e||{};this.allowDiagonal=e.allowDiagonal;this.dontCrossCorners=e.dontCrossCorners;this.diagonalMovement=e.diagonalMovement;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?i.OnlyWhenNoObstacles:i.IfAtMostOneObstacle:i.Never)}var r=e("../core/Util"),i=e("../core/DiagonalMovement");t.prototype.findPath=function(e,n,t,i,o){var a,u,c,l,f,s=o.getNodeAt(e,n),p=o.getNodeAt(t,i),h=[],d=[],g=this.diagonalMovement,v=0,y=1;h.push(s);s.opened=!0;s.by=v;d.push(p);p.opened=!0;p.by=y;for(;h.length&&d.length;){c=h.shift();c.closed=!0;a=o.getNeighbors(c,g);for(l=0,f=a.length;f>l;++l){u=a[l];if(!u.closed)if(u.opened){if(u.by===y)return r.biBacktrace(c,u)}else{h.push(u);u.parent=c;u.opened=!0;u.by=v}}c=d.shift();c.closed=!0;a=o.getNeighbors(c,g);for(l=0,f=a.length;f>l;++l){u=a[l];if(!u.closed)if(u.opened){if(u.by===v)return r.biBacktrace(u,c)}else{d.push(u);u.parent=c;u.opened=!0;u.by=y}}}return[]};n.exports=t},{"../core/DiagonalMovement":3,"../core/Util":7}],14:[function(e,n){function t(e){r.call(this,e);this.heuristic=function(){return 0}}var r=e("./BiAStarFinder");t.prototype=new r;t.prototype.constructor=t;n.exports=t},{"./BiAStarFinder":11}],15:[function(e,n){function t(e){e=e||{};this.allowDiagonal=e.allowDiagonal;this.dontCrossCorners=e.dontCrossCorners;this.diagonalMovement=e.diagonalMovement;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?i.OnlyWhenNoObstacles:i.IfAtMostOneObstacle:i.Never)}var r=e("../core/Util"),i=e("../core/DiagonalMovement");t.prototype.findPath=function(e,n,t,i,o){var a,u,c,l,f,s=[],p=this.diagonalMovement,h=o.getNodeAt(e,n),d=o.getNodeAt(t,i);s.push(h);h.opened=!0;for(;s.length;){c=s.shift();c.closed=!0;if(c===d)return r.backtrace(d);a=o.getNeighbors(c,p);for(l=0,f=a.length;f>l;++l){u=a[l];if(!u.closed&&!u.opened){s.push(u);u.opened=!0;u.parent=c}}}return[]};n.exports=t},{"../core/DiagonalMovement":3,"../core/Util":7}],16:[function(e,n){function t(e){r.call(this,e);this.heuristic=function(){return 0}}var r=e("./AStarFinder");t.prototype=new r;t.prototype.constructor=t;n.exports=t},{"./AStarFinder":9}],17:[function(e,n){function t(e){e=e||{};this.allowDiagonal=e.allowDiagonal;this.dontCrossCorners=e.dontCrossCorners;this.diagonalMovement=e.diagonalMovement;this.heuristic=e.heuristic||r.manhattan;this.weight=e.weight||1;this.trackRecursion=e.trackRecursion||!1;this.timeLimit=e.timeLimit||1/0;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?o.OnlyWhenNoObstacles:o.IfAtMostOneObstacle:o.Never);this.heuristic=this.diagonalMovement===o.Never?e.heuristic||r.manhattan:e.heuristic||r.octile}var r=(e("../core/Util"),e("../core/Heuristic")),i=e("../core/Node"),o=e("../core/DiagonalMovement");t.prototype.findPath=function(e,n,t,r,o){var a,u,c,l=0,f=(new Date).getTime(),s=function(e,n){return this.heuristic(Math.abs(n.x-e.x),Math.abs(n.y-e.y))}.bind(this),p=function(e,n){return e.x===n.x||e.y===n.y?1:Math.SQRT2},h=function(e,n,t,r,a){l++;if(this.timeLimit>0&&(new Date).getTime()-f>1e3*this.timeLimit)return 1/0;var u=n+s(e,g)*this.weight;if(u>t)return u;if(e==g){r[a]=[e.x,e.y];return e}var c,d,v,y,_=o.getNeighbors(e,this.diagonalMovement);for(v=0,c=1/0;y=_[v];++v){if(this.trackRecursion){y.retainCount=y.retainCount+1||1;y.tested!==!0&&(y.tested=!0)}d=h(y,n+p(e,y),t,r,a+1);if(d instanceof i){r[a]=[e.x,e.y];return d}this.trackRecursion&&0===--y.retainCount&&(y.tested=!1);c>d&&(c=d)}return c}.bind(this),d=o.getNodeAt(e,n),g=o.getNodeAt(t,r),v=s(d,g);for(a=0;!0;++a){u=[];c=h(d,0,v,u,0);if(1/0===c)return[];if(c instanceof i)return u;v=c}return[]};n.exports=t},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Node":6,"../core/Util":7}],18:[function(e,n){function t(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");t.prototype=new r;t.prototype.constructor=t;t.prototype._jump=function(e,n,t,r){var i=this.grid,o=e-t,a=n-r;if(!i.isWalkableAt(e,n))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(e,n).tested=!0);if(i.getNodeAt(e,n)===this.endNode)return[e,n];if(0!==o&&0!==a){if(i.isWalkableAt(e-o,n+a)&&!i.isWalkableAt(e-o,n)||i.isWalkableAt(e+o,n-a)&&!i.isWalkableAt(e,n-a))return[e,n];if(this._jump(e+o,n,e,n)||this._jump(e,n+a,e,n))return[e,n]}else if(0!==o){if(i.isWalkableAt(e+o,n+1)&&!i.isWalkableAt(e,n+1)||i.isWalkableAt(e+o,n-1)&&!i.isWalkableAt(e,n-1))return[e,n]}else if(i.isWalkableAt(e+1,n+a)&&!i.isWalkableAt(e+1,n)||i.isWalkableAt(e-1,n+a)&&!i.isWalkableAt(e-1,n))return[e,n];return this._jump(e+o,n+a,e,n)};t.prototype._findNeighbors=function(e){var n,t,r,o,a,u,c,l,f=e.parent,s=e.x,p=e.y,h=this.grid,d=[];if(f){n=f.x;t=f.y;r=(s-n)/Math.max(Math.abs(s-n),1);o=(p-t)/Math.max(Math.abs(p-t),1);if(0!==r&&0!==o){h.isWalkableAt(s,p+o)&&d.push([s,p+o]);h.isWalkableAt(s+r,p)&&d.push([s+r,p]);h.isWalkableAt(s+r,p+o)&&d.push([s+r,p+o]);h.isWalkableAt(s-r,p)||d.push([s-r,p+o]);h.isWalkableAt(s,p-o)||d.push([s+r,p-o])}else if(0===r){h.isWalkableAt(s,p+o)&&d.push([s,p+o]);h.isWalkableAt(s+1,p)||d.push([s+1,p+o]);h.isWalkableAt(s-1,p)||d.push([s-1,p+o])}else{h.isWalkableAt(s+r,p)&&d.push([s+r,p]);h.isWalkableAt(s,p+1)||d.push([s+r,p+1]);h.isWalkableAt(s,p-1)||d.push([s+r,p-1])}}else{a=h.getNeighbors(e,i.Always);for(c=0,l=a.length;l>c;++c){u=a[c];d.push([u.x,u.y])}}return d};n.exports=t},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],19:[function(e,n){function t(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");t.prototype=new r;t.prototype.constructor=t;t.prototype._jump=function(e,n,t,r){var i=this.grid,o=e-t,a=n-r;if(!i.isWalkableAt(e,n))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(e,n).tested=!0);if(i.getNodeAt(e,n)===this.endNode)return[e,n];if(0!==o&&0!==a){if(i.isWalkableAt(e-o,n+a)&&!i.isWalkableAt(e-o,n)||i.isWalkableAt(e+o,n-a)&&!i.isWalkableAt(e,n-a))return[e,n];if(this._jump(e+o,n,e,n)||this._jump(e,n+a,e,n))return[e,n]}else if(0!==o){if(i.isWalkableAt(e+o,n+1)&&!i.isWalkableAt(e,n+1)||i.isWalkableAt(e+o,n-1)&&!i.isWalkableAt(e,n-1))return[e,n]}else if(i.isWalkableAt(e+1,n+a)&&!i.isWalkableAt(e+1,n)||i.isWalkableAt(e-1,n+a)&&!i.isWalkableAt(e-1,n))return[e,n];return i.isWalkableAt(e+o,n)||i.isWalkableAt(e,n+a)?this._jump(e+o,n+a,e,n):null};t.prototype._findNeighbors=function(e){var n,t,r,o,a,u,c,l,f=e.parent,s=e.x,p=e.y,h=this.grid,d=[];if(f){n=f.x;t=f.y;r=(s-n)/Math.max(Math.abs(s-n),1);o=(p-t)/Math.max(Math.abs(p-t),1);if(0!==r&&0!==o){h.isWalkableAt(s,p+o)&&d.push([s,p+o]);h.isWalkableAt(s+r,p)&&d.push([s+r,p]);(h.isWalkableAt(s,p+o)||h.isWalkableAt(s+r,p))&&d.push([s+r,p+o]);!h.isWalkableAt(s-r,p)&&h.isWalkableAt(s,p+o)&&d.push([s-r,p+o]);!h.isWalkableAt(s,p-o)&&h.isWalkableAt(s+r,p)&&d.push([s+r,p-o])}else if(0===r){if(h.isWalkableAt(s,p+o)){d.push([s,p+o]);h.isWalkableAt(s+1,p)||d.push([s+1,p+o]);h.isWalkableAt(s-1,p)||d.push([s-1,p+o])}}else if(h.isWalkableAt(s+r,p)){d.push([s+r,p]);h.isWalkableAt(s,p+1)||d.push([s+r,p+1]);h.isWalkableAt(s,p-1)||d.push([s+r,p-1])}}else{a=h.getNeighbors(e,i.IfAtMostOneObstacle);for(c=0,l=a.length;l>c;++c){u=a[c];d.push([u.x,u.y])}}return d};n.exports=t},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],20:[function(e,n){function t(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");t.prototype=new r;t.prototype.constructor=t;t.prototype._jump=function(e,n,t,r){var i=this.grid,o=e-t,a=n-r;if(!i.isWalkableAt(e,n))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(e,n).tested=!0);if(i.getNodeAt(e,n)===this.endNode)return[e,n];if(0!==o&&0!==a){if(this._jump(e+o,n,e,n)||this._jump(e,n+a,e,n))return[e,n]}else if(0!==o){if(i.isWalkableAt(e,n-1)&&!i.isWalkableAt(e-o,n-1)||i.isWalkableAt(e,n+1)&&!i.isWalkableAt(e-o,n+1))return[e,n]}else if(0!==a&&(i.isWalkableAt(e-1,n)&&!i.isWalkableAt(e-1,n-a)||i.isWalkableAt(e+1,n)&&!i.isWalkableAt(e+1,n-a)))return[e,n];return i.isWalkableAt(e+o,n)&&i.isWalkableAt(e,n+a)?this._jump(e+o,n+a,e,n):null};t.prototype._findNeighbors=function(e){var n,t,r,o,a,u,c,l,f=e.parent,s=e.x,p=e.y,h=this.grid,d=[];if(f){n=f.x;t=f.y;r=(s-n)/Math.max(Math.abs(s-n),1);o=(p-t)/Math.max(Math.abs(p-t),1);if(0!==r&&0!==o){h.isWalkableAt(s,p+o)&&d.push([s,p+o]);h.isWalkableAt(s+r,p)&&d.push([s+r,p]);h.isWalkableAt(s,p+o)&&h.isWalkableAt(s+r,p)&&d.push([s+r,p+o])}else{var g;if(0!==r){g=h.isWalkableAt(s+r,p);var v=h.isWalkableAt(s,p+1),y=h.isWalkableAt(s,p-1);if(g){d.push([s+r,p]);v&&d.push([s+r,p+1]);y&&d.push([s+r,p-1])}v&&d.push([s,p+1]);y&&d.push([s,p-1])}else if(0!==o){g=h.isWalkableAt(s,p+o);var _=h.isWalkableAt(s+1,p),m=h.isWalkableAt(s-1,p);if(g){d.push([s,p+o]);_&&d.push([s+1,p+o]);m&&d.push([s-1,p+o])}_&&d.push([s+1,p]);m&&d.push([s-1,p])}}}else{a=h.getNeighbors(e,i.OnlyWhenNoObstacles);for(c=0,l=a.length;l>c;++c){u=a[c];d.push([u.x,u.y])}}return d};n.exports=t},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],21:[function(e,n){function t(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");t.prototype=new r;t.prototype.constructor=t;t.prototype._jump=function(e,n,t,r){var i=this.grid,o=e-t,a=n-r;if(!i.isWalkableAt(e,n))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(e,n).tested=!0);if(i.getNodeAt(e,n)===this.endNode)return[e,n];if(0!==o){if(i.isWalkableAt(e,n-1)&&!i.isWalkableAt(e-o,n-1)||i.isWalkableAt(e,n+1)&&!i.isWalkableAt(e-o,n+1))return[e,n]}else{if(0===a)throw new Error("Only horizontal and vertical movements are allowed");if(i.isWalkableAt(e-1,n)&&!i.isWalkableAt(e-1,n-a)||i.isWalkableAt(e+1,n)&&!i.isWalkableAt(e+1,n-a))return[e,n];if(this._jump(e+1,n,e,n)||this._jump(e-1,n,e,n))return[e,n]}return this._jump(e+o,n+a,e,n)};t.prototype._findNeighbors=function(e){var n,t,r,o,a,u,c,l,f=e.parent,s=e.x,p=e.y,h=this.grid,d=[];if(f){n=f.x;t=f.y;r=(s-n)/Math.max(Math.abs(s-n),1);o=(p-t)/Math.max(Math.abs(p-t),1);if(0!==r){h.isWalkableAt(s,p-1)&&d.push([s,p-1]);h.isWalkableAt(s,p+1)&&d.push([s,p+1]);h.isWalkableAt(s+r,p)&&d.push([s+r,p])}else if(0!==o){h.isWalkableAt(s-1,p)&&d.push([s-1,p]);h.isWalkableAt(s+1,p)&&d.push([s+1,p]);h.isWalkableAt(s,p+o)&&d.push([s,p+o])}}else{a=h.getNeighbors(e,i.Never);for(c=0,l=a.length;l>c;++c){u=a[c];d.push([u.x,u.y])}}return d};n.exports=t},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],22:[function(e,n){function t(e){e=e||{};return e.diagonalMovement===r.Never?new i(e):e.diagonalMovement===r.Always?new o(e):e.diagonalMovement===r.OnlyWhenNoObstacles?new a(e):new u(e)}var r=e("../core/DiagonalMovement"),i=e("./JPFNeverMoveDiagonally"),o=e("./JPFAlwaysMoveDiagonally"),a=e("./JPFMoveDiagonallyIfNoObstacles"),u=e("./JPFMoveDiagonallyIfAtMostOneObstacle");n.exports=t},{"../core/DiagonalMovement":3,"./JPFAlwaysMoveDiagonally":18,"./JPFMoveDiagonallyIfAtMostOneObstacle":19,"./JPFMoveDiagonallyIfNoObstacles":20,"./JPFNeverMoveDiagonally":21}],23:[function(e,n){function t(e){e=e||{};this.heuristic=e.heuristic||o.manhattan;this.trackJumpRecursion=e.trackJumpRecursion||!1}{var r=e("heap"),i=e("../core/Util"),o=e("../core/Heuristic");e("../core/DiagonalMovement")}t.prototype.findPath=function(e,n,t,o,a){var u,c=this.openList=new r(function(e,n){return e.f-n.f}),l=this.startNode=a.getNodeAt(e,n),f=this.endNode=a.getNodeAt(t,o);this.grid=a;l.g=0;l.f=0;c.push(l);l.opened=!0;for(;!c.empty();){u=c.pop();u.closed=!0;if(u===f)return i.expandPath(i.backtrace(f));this._identifySuccessors(u)}return[]};t.prototype._identifySuccessors=function(e){{var n,t,r,i,a,u,c,l,f,s,p=this.grid,h=this.heuristic,d=this.openList,g=this.endNode.x,v=this.endNode.y,y=e.x,_=e.y,m=Math.abs;Math.max}n=this._findNeighbors(e);for(i=0,a=n.length;a>i;++i){t=n[i];r=this._jump(t[0],t[1],y,_);if(r){u=r[0];c=r[1];s=p.getNodeAt(u,c);if(s.closed)continue;l=o.octile(m(u-y),m(c-_));f=e.g+l;if(!s.opened||f<s.g){s.g=f;s.h=s.h||h(m(u-g),m(c-v));s.f=s.g+s.h;s.parent=e;if(s.opened)d.updateItem(s);else{d.push(s);s.opened=!0}}}}};n.exports=t},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}]},{},[8])(8)});define("collisionGrid",["eventmanager","world","pathfinding"],function(e,n,t){function r(e){for(var n=[],t=2,r=0;r<e.length;r++)for(var i=0;t>i;i++){var o=r*t+i;n[o]=[];for(var a=0;a<e[0].length;a++)for(var u=0;t>u;u++){var c=a*t+u;n[o][c]=e[r][a]}}return n}var i={};i.init=function(){i.grid={};i.grid.dynamic=r(_.cloneDeep(n.grid));i.grid["static"]=_.cloneDeep(i.grid.dynamic);i.updateStatic({tooArray:[],fromArray:[]})};i.update=function(e){var n=i.generateUpdateArray({grid:e.too,height:e.height,width:e.width}),t=i.generateUpdateArray({grid:e.from,height:e.height,width:e.width});if(_.isEqual(t,n))"undefined"!=typeof e.success&&e.success();else{var r=i.intersect(n,t),o=!0;_.each(r,function(e){0!==i.grid.dynamic[e.x][e.y]&&(o=!1)});if(o){_.each(t,function(e){i.grid.dynamic[e.x][e.y]=0});_.each(n,function(e){i.grid.dynamic[e.x][e.y]=1});"undefined"!=typeof e.success&&e.success();e["static"]&&i.updateStatic({tooArray:n,fromArray:t})}else"undefined"!=typeof e.failure&&e.failure(n)}};i.generateUpdateArray=function(e){var n=[];if("undefined"!=typeof e.grid)for(var t=0;t<e.height;t++)for(var r=0;r<e.width;r++)n.push({x:e.grid.x+r,y:e.grid.y+t});return n};i.intersect=function(e,n){var t=[];_.each(e,function(e){_.findWhere(n,e)||t.push(e)});return t};i.isOpen=function(e){return 0===i.grid.dynamic[e["new"].y][e["new"].x]};i.getSubGrid=function(e){for(var n=[],r=e.end.x-e.start.x<e.end.y-e.start.y?e.end.y-e.start.y:e.end.x-e.start.x,o=0;r>=o;o++){n[o]=[];for(var a=0;r>=a;a++)n[o][a]=i.grid.dynamic[e.start.x+o][e.start.y+a]}return new t.Grid(r+1,r+1,n)};i.updateStatic=function(e){_.each(e.fromArray,function(e){i.grid["static"][e.x][e.y]=0});_.each(e.tooArray,function(e){i.grid["static"][e.x][e.y]=1});i.grid.graph=new t.Grid(i.grid["static"].length,i.grid["static"][0].length,i.grid["static"])};i.init();return i});define("actor",["eventmanager","standardlib","collisionGrid"],function(e,n,t){return function(r){var i={};i.variables={coordinates:{current:r.coordinates,previous:_.cloneDeep(r.coordinates),next:_.cloneDeep(r.coordinates)},collision:{width:1,height:1},tile:{width:app.config.terrain.tile.width,height:app.config.terrain.tile.height},uuid:n.guid(),direction:"down",hp:0,rendered:!1,canvas:{}};i.init=function(){var o={too:n.worldPosToGridPos(r.coordinates),height:i.variables.collision.height,width:i.variables.collision.width,success:function(){_.each(i.handlers,function(n,t){_.each(n,function(n,r){e[t](r,i[n])})});e.publish("actor.create",i.getInfo())},failure:function(){}};t.update(o)};i.handlers={subscribe:{"actor.selected":"actorSelect"}};i.actorSelect=function(e){i.variables.selected=i.variables.uuid==e?!0:!1};i.getInfo=function(){return i};i.destroy=function(){e.publish("actor.delete",variables.uuid)};return i}});define("actorMovement",["collisionGrid","standardlib","pathfinding"],function(e,n,t){function r(e){var n=e.coordinates.current,t=_.cloneDeep(n);if(n.x>e.localGoal.x){var r=n.x-e.localGoal.x;t.x=r<=e.speed?e.localGoal.x:n.x-e.speed}else if(n.x<e.localGoal.x){var r=e.localGoal.x-n.x;t.x=r<=e.speed?e.localGoal.x:n.x+e.speed}if(n.y>e.localGoal.y){var r=n.y-e.localGoal.y;t.y=r<=e.speed?e.localGoal.y:n.y-e.speed/2}else if(n.y<e.localGoal.y){var r=e.localGoal.y-n.y;t.y=r<=e.speed?e.localGoal.y:n.y+e.speed/2}return t}var i={};i.finder=new t.AStarFinder({allowDiagonal:!0,dontCrossCorners:!0});i.generatePath=function(t){var r=e.grid.graph.clone(),o=n.worldPosToGridPos(t.from),a=n.worldPosToGridPos(t.too),u=i.finder.findPath(o.y,o.x,a.y,a.x,r);u.shift();return u};i.move=function(t){var i=t.coordinates.current;t.localGoal=n.gridPosToWorldPos({x:t.path[0][1],y:t.path[0][0]});var o=r(t);e.update({from:n.worldPosToGridPos(i),too:n.worldPosToGridPos(o),height:t.height,width:t.width,success:function(){t.coordinates.next=_.cloneDeep(o)},failure:function(){}});i.x==t.localGoal.x&&i.y==t.localGoal.y&&t.path.shift()};return i});define("actor.unit",["actor","eventmanager","collisionGrid","standardlib","actorMovement"],function(e,n,t,r,i){return function(n){var t=e(n),r={path:[],focus:"",height:2,width:2,strenght:0,dexterity:0,intelligence:0,health:0,death:!1,hp:0,speed:5,attack:10},o={"new.gamecycle":"move"};_.extend(t.variables,r);_.extend(t.handlers.subscribe,o);t.move=function(){t.variables.path.length>0&&i.move({path:t.variables.path,coordinates:t.variables.coordinates,speed:t.variables.speed,height:t.variables.height,width:t.variables.width})};t.generatePath=function(e){t.variables.path=i.generatePath({from:t.variables.coordinates.current,too:e})};return t}});define("actor.unit.local",["actor.unit"],function(e){return function(n){var t=e(n),r={focus:"",state:"base"};_.extend(t.variables,r);var i={"map.click":"checkMapClick"};_.extend(t.handlers.subscribe,i);t.checkMapClick=function(e){t.variables.selected&&t.generatePath(e)};return t}});define("plane",["actor.unit.local","eventmanager"],function(e){return function(n){var t=e(n),r={focus:"",state:"base",direction:0,collision:{width:1,height:1},sprite:{center:{x:24,y:20},height:80,width:55,base:{0:["plane/base/Plane_Large_face0_0.png","plane/base/Plane_Large_face0_1.png","plane/base/Plane_Large_face0_2.png","plane/base/Plane_Large_face0_3.png"],1:["plane/base/Plane_Large_face1_0.png","plane/base/Plane_Large_face1_1.png","plane/base/Plane_Large_face1_2.png","plane/base/Plane_Large_face1_3.png"],2:["plane/base/Plane_Large_face2_0.png","plane/base/Plane_Large_face2_1.png","plane/base/Plane_Large_face2_2.png","plane/base/Plane_Large_face2_3.png"],3:["plane/base/Plane_Large_face3_0.png","plane/base/Plane_Large_face3_1.png","plane/base/Plane_Large_face3_2.png","plane/base/Plane_Large_face3_3.png"]},explode:{0:["plane/explode/color0_Plane_Large_face0_fiery_explode_0.png","plane/explode/color0_Plane_Large_face0_fiery_explode_1.png","plane/explode/color0_Plane_Large_face0_fiery_explode_2.png","plane/explode/color0_Plane_Large_face0_fiery_explode_3.png","plane/explode/color0_Plane_Large_face0_fiery_explode_4.png","plane/explode/color0_Plane_Large_face0_fiery_explode_5.png","plane/explode/color0_Plane_Large_face0_fiery_explode_6.png","plane/explode/color0_Plane_Large_face0_fiery_explode_7.png","plane/explode/color0_Plane_Large_face0_fiery_explode_8.png","plane/explode/color0_Plane_Large_face0_fiery_explode_9.png","plane/explode/color0_Plane_Large_face0_fiery_explode_10.png","plane/explode/color0_Plane_Large_face0_fiery_explode_11.png"],1:["plane/explode/color0_Plane_Large_face1_fiery_explode_0.png","plane/explode/color0_Plane_Large_face1_fiery_explode_1.png","plane/explode/color0_Plane_Large_face1_fiery_explode_2.png","plane/explode/color0_Plane_Large_face1_fiery_explode_3.png","plane/explode/color0_Plane_Large_face1_fiery_explode_4.png","plane/explode/color0_Plane_Large_face1_fiery_explode_5.png","plane/explode/color0_Plane_Large_face1_fiery_explode_6.png","plane/explode/color0_Plane_Large_face1_fiery_explode_7.png","plane/explode/color0_Plane_Large_face1_fiery_explode_8.png","plane/explode/color0_Plane_Large_face1_fiery_explode_9.png","plane/explode/color0_Plane_Large_face1_fiery_explode_10.png","plane/explode/color0_Plane_Large_face1_fiery_explode_11.png"],2:["plane/explode/color0_Plane_Large_face2_fiery_explode_0.png","plane/explode/color0_Plane_Large_face2_fiery_explode_1.png","plane/explode/color0_Plane_Large_face2_fiery_explode_2.png","plane/explode/color0_Plane_Large_face2_fiery_explode_3.png","plane/explode/color0_Plane_Large_face2_fiery_explode_4.png","plane/explode/color0_Plane_Large_face2_fiery_explode_5.png","plane/explode/color0_Plane_Large_face2_fiery_explode_6.png","plane/explode/color0_Plane_Large_face2_fiery_explode_7.png","plane/explode/color0_Plane_Large_face2_fiery_explode_8.png","plane/explode/color0_Plane_Large_face2_fiery_explode_9.png","plane/explode/color0_Plane_Large_face2_fiery_explode_10.png","plane/explode/color0_Plane_Large_face2_fiery_explode_11.png"],3:["plane/explode/color0_Plane_Large_face3_fiery_explode_0.png","plane/explode/color0_Plane_Large_face3_fiery_explode_1.png","plane/explode/color0_Plane_Large_face3_fiery_explode_2.png","plane/explode/color0_Plane_Large_face3_fiery_explode_3.png","plane/explode/color0_Plane_Large_face3_fiery_explode_4.png","plane/explode/color0_Plane_Large_face3_fiery_explode_5.png","plane/explode/color0_Plane_Large_face3_fiery_explode_6.png","plane/explode/color0_Plane_Large_face3_fiery_explode_7.png","plane/explode/color0_Plane_Large_face3_fiery_explode_8.png","plane/explode/color0_Plane_Large_face3_fiery_explode_9.png","plane/explode/color0_Plane_Large_face3_fiery_explode_10.png","plane/explode/color0_Plane_Large_face3_fiery_explode_11.png"]}},health:75,death:!1,hp:100,speed:25};_.extend(t.variables,r);return t}});define("spriteSheet",[""],function(){var e=function(e,n){var t=[],r=e,i=n,o=function(){_.forEach(r.frames,function(e){var n=e,t=.5*-n.frame.w,r=.5*-n.frame.h;if(n.trimmed){t=n.spriteSourceSize.x-.5*n.sourceSize.w;r=n.spriteSourceSize.y-.5*n.sourceSize.h}a(n.filename,n.frame.x,n.frame.y,n.frame.w,n.frame.h,t,r)})},a=function(e,n,r,i,o,a,u){var c={id:e,x:n,y:r,w:i,h:o,cx:null===a?0:a,cy:null===u?0:u};t.push(c)};o();return{img:i,sprites:t}};return e});define("text!assetsList",[],function(){return'{\n  "0" : {\n    "name": "mapTiles",\n    "type": "atlas",\n    "configuration": "./art/panama.json",\n    "file": "./art/panama.png"\n  }\n}'});!function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("q",e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else{if("undefined"==typeof self)throw new Error("This environment was not anticiapted by Q. Please file a bug.");self.Q=e()}}(function(){function e(e){return function(){return z.apply(e,arguments)}}function n(e){return e===Object(e)}function t(e){return"[object StopIteration]"===nn(e)||e instanceof $}function r(e,n){if(B&&n.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(tn)){for(var t=[],r=n;r;r=r.source)r.stack&&t.unshift(r.stack);t.unshift(e.stack);var o=t.join("\n"+tn+"\n");e.stack=i(o)}}function i(e){for(var n=e.split("\n"),t=[],r=0;r<n.length;++r){var i=n[r];u(i)||o(i)||!i||t.push(i)}return t.join("\n")}function o(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function a(e){var n=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(n)return[n[1],Number(n[2])];var t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(t)return[t[1],Number(t[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function u(e){var n=a(e);if(!n)return!1;var t=n[0],r=n[1];return t===G&&r>=q&&un>=r}function c(){if(B)try{throw new Error}catch(e){var n=e.stack.split("\n"),t=n[0].indexOf("@")>0?n[1]:n[2],r=a(t);if(!r)return;G=r[0];return r[1]}}function l(e,n,t){return function(){"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(n+" is deprecated, use "+t+" instead.",new Error("").stack);return e.apply(e,arguments)}}function f(e){return e instanceof d?e:_(e)?M(e):P(e)}function s(){function e(e){n=e;o.source=e;Q(t,function(n,t){f.nextTick(function(){e.promiseDispatch.apply(e,t)})},void 0);t=void 0;r=void 0}var n,t=[],r=[],i=K(s.prototype),o=K(d.prototype);o.promiseDispatch=function(e,i,o){var a=Y(arguments);if(t){t.push(a);"when"===i&&o[1]&&r.push(o[1])}else f.nextTick(function(){n.promiseDispatch.apply(n,a)})};o.valueOf=function(){if(t)return o;var e=v(n);y(e)&&(n=e);return e};o.inspect=function(){return n?n.inspect():{state:"pending"}};if(f.longStackSupport&&B)try{throw new Error}catch(a){o.stack=a.stack.substring(a.stack.indexOf("\n")+1)}i.promise=o;i.resolve=function(t){n||e(f(t))};i.fulfill=function(t){n||e(P(t))};i.reject=function(t){n||e(W(t))};i.notify=function(e){n||Q(r,function(n,t){f.nextTick(function(){t(e)})},void 0)};return i}function p(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var n=s();try{e(n.resolve,n.reject,n.notify)}catch(t){n.reject(t)}return n.promise}function h(e){return p(function(n,t){for(var r=0,i=e.length;i>r;r++)f(e[r]).then(n,t)})}function d(e,n,t){void 0===n&&(n=function(e){return W(new Error("Promise does not support operation: "+e))});void 0===t&&(t=function(){return{state:"unknown"}});var r=K(d.prototype);r.promiseDispatch=function(t,i,o){var a;try{a=e[i]?e[i].apply(r,o):n.call(r,i,o)}catch(u){a=W(u)}t&&t(a)};r.inspect=t;if(t){var i=t();"rejected"===i.state&&(r.exception=i.reason);r.valueOf=function(){var e=t();return"pending"===e.state||"rejected"===e.state?r:e.value}}return r}function g(e,n,t,r){return f(e).then(n,t,r)}function v(e){if(y(e)){var n=e.inspect();if("fulfilled"===n.state)return n.value}return e}function y(e){return e instanceof d}function _(e){return n(e)&&"function"==typeof e.then}function m(e){return y(e)&&"pending"===e.inspect().state}function b(e){return!y(e)||"fulfilled"===e.inspect().state}function x(e){return y(e)&&"rejected"===e.inspect().state}function w(){rn.length=0;on.length=0;an||(an=!0)}function k(e,n){if(an){on.push(e);rn.push(n&&"undefined"!=typeof n.stack?n.stack:"(no stack) "+n)}}function A(e){if(an){var n=V(on,e);if(-1!==n){on.splice(n,1);rn.splice(n,1)}}}function W(e){var n=d({when:function(n){n&&A(this);return n?n(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});k(n,e);return n}function P(e){return d({when:function(){return e},get:function(n){return e[n]},set:function(n,t){e[n]=t},"delete":function(n){delete e[n]},post:function(n,t){return null===n||void 0===n?e.apply(void 0,t):e[n].apply(e,t)},apply:function(n,t){return e.apply(n,t)},keys:function(){return en(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function M(e){var n=s();f.nextTick(function(){try{e.then(n.resolve,n.reject,n.notify)}catch(t){n.reject(t)}});return n.promise}function j(e){return d({isDef:function(){}},function(n,t){return D(e,n,t)},function(){return f(e).inspect()})}function N(e,n,t){return f(e).spread(n,t)}function R(e){return function(){function n(e,n){var a;if("undefined"==typeof StopIteration){try{a=r[e](n)}catch(u){return W(u)}return a.done?f(a.value):g(a.value,i,o)}try{a=r[e](n)}catch(u){return t(u)?f(u.value):W(u)}return g(a,i,o)}var r=e.apply(this,arguments),i=n.bind(n,"next"),o=n.bind(n,"throw");return i()}}function L(e){f.done(f.async(e)())}function O(e){throw new $(e)}function F(e){return function(){return N([this,I(arguments)],function(n,t){return e.apply(n,t)})}}function D(e,n,t){return f(e).dispatch(n,t)}function I(e){return g(e,function(e){var n=0,t=s();Q(e,function(r,i,o){var a;if(y(i)&&"fulfilled"===(a=i.inspect()).state)e[o]=a.value;else{++n;g(i,function(r){e[o]=r;0===--n&&t.resolve(e)},t.reject,function(e){t.notify({index:o,value:e})})}},void 0);0===n&&t.resolve(e);return t.promise})}function C(e){return g(e,function(e){e=X(e,f);return g(I(X(e,function(e){return g(e,J,J)})),function(){return e})})}function S(e){return f(e).allSettled()}function T(e,n){return f(e).then(void 0,void 0,n)}function E(e,n){return f(e).nodeify(n)}var B=!1;try{throw new Error}catch(U){B=!!U.stack}var G,$,q=c(),J=function(){},H=function(){function e(){for(;n.next;){n=n.next;var t=n.task;n.task=void 0;var i=n.domain;if(i){n.domain=void 0;i.enter()}try{t()}catch(a){if(o){i&&i.exit();setTimeout(e,0);i&&i.enter();throw a}setTimeout(function(){throw a},0)}i&&i.exit()}r=!1}var n={task:void 0,next:null},t=n,r=!1,i=void 0,o=!1;H=function(e){t=t.next={task:e,domain:o&&process.domain,next:null};if(!r){r=!0;i()}};if("undefined"!=typeof process&&process.nextTick){o=!0;i=function(){process.nextTick(e)}}else if("function"==typeof setImmediate)i="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var a=new MessageChannel;a.port1.onmessage=function(){i=u;a.port1.onmessage=e;e()};var u=function(){a.port2.postMessage(0)};i=function(){setTimeout(e,0);u()}}else i=function(){setTimeout(e,0)};return H}(),z=Function.call,Y=e(Array.prototype.slice),Q=e(Array.prototype.reduce||function(e,n){var t=0,r=this.length;if(1===arguments.length)for(;;){if(t in this){n=this[t++];break}if(++t>=r)throw new TypeError}for(;r>t;t++)t in this&&(n=e(n,this[t],t));return n}),V=e(Array.prototype.indexOf||function(e){for(var n=0;n<this.length;n++)if(this[n]===e)return n;return-1}),X=e(Array.prototype.map||function(e,n){var t=this,r=[];Q(t,function(i,o,a){r.push(e.call(n,o,a,t))},void 0);return r}),K=Object.create||function(e){function n(){}n.prototype=e;return new n},Z=e(Object.prototype.hasOwnProperty),en=Object.keys||function(e){var n=[];for(var t in e)Z(e,t)&&n.push(t);return n},nn=e(Object.prototype.toString);$="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var tn="From previous event:";f.resolve=f;f.nextTick=H;f.longStackSupport=!1;"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(f.longStackSupport=!0);f.defer=s;s.prototype.makeNodeResolver=function(){var e=this;return function(n,t){n?e.reject(n):e.resolve(arguments.length>2?Y(arguments,1):t)}};f.Promise=p;f.promise=p;p.race=h;p.all=I;p.reject=W;p.resolve=f;f.passByCopy=function(e){return e};d.prototype.passByCopy=function(){return this};f.join=function(e,n){return f(e).join(n)};d.prototype.join=function(e){return f([this,e]).spread(function(e,n){if(e===n)return e;throw new Error("Can't join: not the same: "+e+" "+n)})};f.race=h;d.prototype.race=function(){return this.then(f.race)};f.makePromise=d;d.prototype.toString=function(){return"[object Promise]"};d.prototype.then=function(e,n,t){function i(n){try{return"function"==typeof e?e(n):n}catch(t){return W(t)}}function o(e){if("function"==typeof n){r(e,u);try{return n(e)}catch(t){return W(t)}}return W(e)}function a(e){return"function"==typeof t?t(e):e}var u=this,c=s(),l=!1;f.nextTick(function(){u.promiseDispatch(function(e){if(!l){l=!0;c.resolve(i(e))}},"when",[function(e){if(!l){l=!0;c.resolve(o(e))}}])});u.promiseDispatch(void 0,"when",[void 0,function(e){var n,t=!1;try{n=a(e)}catch(r){t=!0;if(!f.onerror)throw r;f.onerror(r)}t||c.notify(n)}]);return c.promise};f.tap=function(e,n){return f(e).tap(n)};d.prototype.tap=function(e){e=f(e);return this.then(function(n){return e.fcall(n).thenResolve(n)})};f.when=g;d.prototype.thenResolve=function(e){return this.then(function(){return e})};f.thenResolve=function(e,n){return f(e).thenResolve(n)};d.prototype.thenReject=function(e){return this.then(function(){throw e})};f.thenReject=function(e,n){return f(e).thenReject(n)};f.nearer=v;f.isPromise=y;f.isPromiseAlike=_;f.isPending=m;d.prototype.isPending=function(){return"pending"===this.inspect().state};f.isFulfilled=b;d.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state};f.isRejected=x;d.prototype.isRejected=function(){return"rejected"===this.inspect().state};var rn=[],on=[],an=!0;f.resetUnhandledRejections=w;f.getUnhandledReasons=function(){return rn.slice()};f.stopUnhandledRejectionTracking=function(){w();an=!1};w();f.reject=W;f.fulfill=P;f.master=j;f.spread=N;d.prototype.spread=function(e,n){return this.all().then(function(n){return e.apply(void 0,n)},n)};f.async=R;f.spawn=L;f["return"]=O;f.promised=F;f.dispatch=D;d.prototype.dispatch=function(e,n){var t=this,r=s();f.nextTick(function(){t.promiseDispatch(r.resolve,e,n)});return r.promise};f.get=function(e,n){return f(e).dispatch("get",[n])};d.prototype.get=function(e){return this.dispatch("get",[e])};f.set=function(e,n,t){return f(e).dispatch("set",[n,t])};d.prototype.set=function(e,n){return this.dispatch("set",[e,n])};f.del=f["delete"]=function(e,n){return f(e).dispatch("delete",[n])};d.prototype.del=d.prototype["delete"]=function(e){return this.dispatch("delete",[e])
};f.mapply=f.post=function(e,n,t){return f(e).dispatch("post",[n,t])};d.prototype.mapply=d.prototype.post=function(e,n){return this.dispatch("post",[e,n])};f.send=f.mcall=f.invoke=function(e,n){return f(e).dispatch("post",[n,Y(arguments,2)])};d.prototype.send=d.prototype.mcall=d.prototype.invoke=function(e){return this.dispatch("post",[e,Y(arguments,1)])};f.fapply=function(e,n){return f(e).dispatch("apply",[void 0,n])};d.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])};f["try"]=f.fcall=function(e){return f(e).dispatch("apply",[void 0,Y(arguments,1)])};d.prototype.fcall=function(){return this.dispatch("apply",[void 0,Y(arguments)])};f.fbind=function(e){var n=f(e),t=Y(arguments,1);return function(){return n.dispatch("apply",[this,t.concat(Y(arguments))])}};d.prototype.fbind=function(){var e=this,n=Y(arguments);return function(){return e.dispatch("apply",[this,n.concat(Y(arguments))])}};f.keys=function(e){return f(e).dispatch("keys",[])};d.prototype.keys=function(){return this.dispatch("keys",[])};f.all=I;d.prototype.all=function(){return I(this)};f.allResolved=l(C,"allResolved","allSettled");d.prototype.allResolved=function(){return C(this)};f.allSettled=S;d.prototype.allSettled=function(){return this.then(function(e){return I(X(e,function(e){function n(){return e.inspect()}e=f(e);return e.then(n,n)}))})};f.fail=f["catch"]=function(e,n){return f(e).then(void 0,n)};d.prototype.fail=d.prototype["catch"]=function(e){return this.then(void 0,e)};f.progress=T;d.prototype.progress=function(e){return this.then(void 0,void 0,e)};f.fin=f["finally"]=function(e,n){return f(e)["finally"](n)};d.prototype.fin=d.prototype["finally"]=function(e){e=f(e);return this.then(function(n){return e.fcall().then(function(){return n})},function(n){return e.fcall().then(function(){throw n})})};f.done=function(e,n,t,r){return f(e).done(n,t,r)};d.prototype.done=function(e,n,t){var i=function(e){f.nextTick(function(){r(e,o);if(!f.onerror)throw e;f.onerror(e)})},o=e||n||t?this.then(e,n,t):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i));o.then(void 0,i)};f.timeout=function(e,n,t){return f(e).timeout(n,t)};d.prototype.timeout=function(e,n){var t=s(),r=setTimeout(function(){if(!n||"string"==typeof n){n=new Error(n||"Timed out after "+e+" ms");n.code="ETIMEDOUT"}t.reject(n)},e);this.then(function(e){clearTimeout(r);t.resolve(e)},function(e){clearTimeout(r);t.reject(e)},t.notify);return t.promise};f.delay=function(e,n){if(void 0===n){n=e;e=void 0}return f(e).delay(n)};d.prototype.delay=function(e){return this.then(function(n){var t=s();setTimeout(function(){t.resolve(n)},e);return t.promise})};f.nfapply=function(e,n){return f(e).nfapply(n)};d.prototype.nfapply=function(e){var n=s(),t=Y(e);t.push(n.makeNodeResolver());this.fapply(t).fail(n.reject);return n.promise};f.nfcall=function(e){var n=Y(arguments,1);return f(e).nfapply(n)};d.prototype.nfcall=function(){var e=Y(arguments),n=s();e.push(n.makeNodeResolver());this.fapply(e).fail(n.reject);return n.promise};f.nfbind=f.denodeify=function(e){var n=Y(arguments,1);return function(){var t=n.concat(Y(arguments)),r=s();t.push(r.makeNodeResolver());f(e).fapply(t).fail(r.reject);return r.promise}};d.prototype.nfbind=d.prototype.denodeify=function(){var e=Y(arguments);e.unshift(this);return f.denodeify.apply(void 0,e)};f.nbind=function(e,n){var t=Y(arguments,2);return function(){function r(){return e.apply(n,arguments)}var i=t.concat(Y(arguments)),o=s();i.push(o.makeNodeResolver());f(r).fapply(i).fail(o.reject);return o.promise}};d.prototype.nbind=function(){var e=Y(arguments,0);e.unshift(this);return f.nbind.apply(void 0,e)};f.nmapply=f.npost=function(e,n,t){return f(e).npost(n,t)};d.prototype.nmapply=d.prototype.npost=function(e,n){var t=Y(n||[]),r=s();t.push(r.makeNodeResolver());this.dispatch("post",[e,t]).fail(r.reject);return r.promise};f.nsend=f.nmcall=f.ninvoke=function(e,n){var t=Y(arguments,2),r=s();t.push(r.makeNodeResolver());f(e).dispatch("post",[n,t]).fail(r.reject);return r.promise};d.prototype.nsend=d.prototype.nmcall=d.prototype.ninvoke=function(e){var n=Y(arguments,1),t=s();n.push(t.makeNodeResolver());this.dispatch("post",[e,n]).fail(t.reject);return t.promise};f.nodeify=E;d.prototype.nodeify=function(e){if(!e)return this;this.then(function(n){f.nextTick(function(){e(null,n)})},function(n){f.nextTick(function(){e(n)})});return void 0};var un=c();return f});define("assetLoader",["spriteSheet","text!assetsList","q","eventmanager"],function(e,n,t,r){var i={config:{},loaded:{atlas:[],music:[]}};i.config=JSON.parse(n);var o=function(){_.forEach(i.config,function(n){switch(n.type){case"atlas":jQuery.getJSON(n.configuration,function(e){n.configuration=e}).then(function(){var t=new Image;t.src=n.file;t.onload=function(){i.loaded.atlas.push({name:n.name,sprite:new e(n.configuration,t)});r.publish("game.init")}});break;case"music":}})};return{preloadassets:o,assets:i}});define("commandQueue",[""],function(){function e(e){r.push(e)}function n(){r=[]}function t(){return r}var r=[];return{add:e,get:t,clear:n}});define("command",["commandQueue","eventmanager"],function(e,n){function t(n){e.add(n)}function r(){var t=e.get();_.forEach(t,function(e){n.publish(e.event,e.parameters)});e.clear()}n.subscribe("command",function(e){t(e)});n.subscribe("new.gamecycle",function(){r()})});define("gamecycle",["eventmanager","command"],function(e){function n(){t()}function t(){setTimeout(t,app.config.cycle);e.publish("new.gamecycle")}e.subscribe("game.init",function(){n()})});define("RequestAnimationFrame",[""],function(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/16.5)}}()});define("center",["eventmanager"],function(e){function n(){var n={x:0,y:0};1===i.up&&(n.y=n.y-1);1===i.down&&(n.y=n.y+1);1===i.left&&(n.x=n.x-1);1===i.right&&(n.x=n.x+1);if(0!==n.x||0!==n.y){n={x:r.x+n.x,y:r.y+n.y};r.x=n.x;r.y=n.y;e.publish("center.update.start")}else e.publish("center.update.stop")}function t(e,n){var t={};t.x=(e-n)/2;t.y=(e+n)/2;return t}var r=t(0,0),i={up:0,down:0,left:0,right:0};e.subscribe("new.frame",function(){n()});e.subscribe("pan.up",function(e){i.up=e});e.subscribe("pan.down",function(e){i.down=e});e.subscribe("pan.left",function(e){i.left=e});e.subscribe("pan.right",function(e){i.right=e});return r});define("map",["eventmanager","world","standardlib","center","assetLoader"],function(e,n,t,r,i){function o(){p.canvas=app.config.shadowRoot.getElementById("mapCanvas");p.context=p.canvas.getContext("2d");p.canvas.width=app.config.terrain.grid.width*app.config.terrain.tile.width;p.canvas.height=app.config.terrain.grid.height*app.config.terrain.tile.height;p.canvas.addEventListener("contextmenu",function(n){var t=p.canvas.relmouseCoordinates(n);e.publish("map.click",t)});p.canvas.addEventListener("mousedown",function(e){if(1==e.which){$(app.config.shadowRoot).find("#ghost-select").addClass("ghost-active");$(app.config.shadowRoot).find("#ghost-select").css({left:e.pageX,top:e.pageY});initialW=e.pageX;initialH=e.pageY;$(document).bind("mouseup",a);$(document).bind("mousemove",u)}});c();f()}function a(){$(document).unbind("mousemove",u);$(document).unbind("mouseup",a);var n=app.config.shadowRoot.getElementById("ghost-select");e.publish("map.selection",{width:n.offsetWidth,height:n.offsetHeight,left:n.offsetLeft,top:n.offsetTop});$(app.config.shadowRoot).find("#ghost-select").css({left:0,top:0,width:0,height:0}).removeClass("ghost-active")}function u(e){var n=Math.abs(initialW-e.pageX),t=Math.abs(initialH-e.pageY);$(app.config.shadowRoot).find("#ghost-select").css({width:n,height:t});e.pageX<=initialW&&e.pageY>=initialH?$(app.config.shadowRoot).find("#ghost-select").css({left:e.pageX}):e.pageY<=initialH&&e.pageX>=initialW?$(app.config.shadowRoot).find("#ghost-select").css({top:e.pageY}):e.pageY<initialH&&e.pageX<initialW&&$(app.config.shadowRoot).find("#ghost-select").css({left:e.pageX,top:e.pageY})}function c(){p.context.clearRect(0,0,p.canvas.width,p.canvas.height);for(var e={x:0,y:0},t=0;t<n.grid.length;t++)for(var r=0;r<n.grid[0].length;r++)l(1===n.grid[e.y+r][e.x+t]?{sprite:"trees_2.png",x:e.x+r,y:e.y+t,correction:15}:{sprite:"landscapeTiles_066.png",x:e.x+r,y:e.y+t,correction:15})}function l(e){var n,r,o;_.findIndex(i.assets.loaded.atlas,function(t){n=_.findWhere(t.sprite.sprites,{id:e.sprite});o=t.sprite.img;!_.isEmpty(t)});if(!_.isEmpty(n)){r=t.twoDToIso(e.x,e.y);r.x=r.x*app.config.terrain.tile.width+p.canvas.width/2-app.config.terrain.tile.width/2;r.y=r.y*app.config.terrain.tile.height+(n.w/2-(n.h-e.correction));p.context.drawImage(o,n.x,n.y,n.w,n.h,r.x,r.y,n.w,n.h)}}function f(){var e=window.innerWidth/2,n=window.innerHeight/2,t={};t.x=-(r.x*app.config.actor.tile.width+p.canvas.width/2-e);t.y=-((r.y+app.config.terrain.tile.height/app.config.actor.tile.height)*app.config.actor.tile.height)+n;$(app.config.shadowRoot).find(p.canvas).css("margin-left",t.x).css("margin-top",t.y)}function s(){f(r)}var p={};e.subscribe("new.frame",function(){s()});e.subscribe("game.init",function(){o()})});define("actorList",["eventmanager"],function(e){var n=[],t=[];e.subscribe("actor.create",function(e){n.push(e)});e.subscribe("actor.update",function(e){var t=_.findWhere(n,{uuid:e.variables.uuid});_.merge(t,e)});e.subscribe("actor.delete",function(e){var r=_.findWhere(n,{uuid:e});t.push(r.variables.uuid);n=_.without(n,r)});var r=function(){return n},i=function(){return t},o=function(){t=[]};return{getCleanUpList:i,clearCleanUpList:o,getActorList:r}});define("actors",["eventmanager","standardlib","actorList","center","assetLoader"],function(e,n,t,r,i){function o(){_.each(t.getCleanUpList(),function(e){$(app.config.shadowRoot).find("canvas."+e.uuid).remove()});t.clearCleanUpList();_.each(t.getActorList(),function(n){if(l(n.variables.coordinates.current)){if(!n.variables.rendered){app.config.shadowRoot.getElementById("ActorsWrapper").insertAdjacentHTML("beforeend",'<canvas id="'+n.variables.uuid+'"></canvas>');n.variables.canvas=app.config.shadowRoot.getElementById(n.variables.uuid);n.variables.canvas.context=n.variables.canvas.getContext("2d");n.variables.canvas.addEventListener("click",function(){e.publish("actor.selected",n.variables.uuid)});n.variables.rendered=!0}a(n);u(n);c(n)}else{if(n.variables.rendered){$(app.config.shadowRoot).find("canvas#"+n.variables.uuid).remove();n.variables.rendered=!1;n.variables.canvas=""}u(n)}})}function a(e){var n=e.variables.coordinates.next,t=e.variables.coordinates.current,r={x:t.x-n.x,y:t.y-n.y};r.x<0?e.variables.direction=0:r.x>0?e.variables.direction=2:r.y<0?e.variables.direction=1:r.y>0&&(e.variables.direction=3)}function u(e){var n=window.innerWidth,t=window.innerHeight,i=e.variables.coordinates.current,o=e.variables.coordinates.next;e.variables.coordinates.previous=_.cloneDeep(i);var a=e.variables.speed/(app.config.framerate/(1e3/app.config.cycle));if(i.x>o.x){var u=i.x-o.x;i.x=a>=u?o.x:i.x-a}else if(i.x<o.x){var u=o.x-i.x;i.x=a>=u?o.x:i.x+a}if(i.y>o.y){var u=i.y-o.y;i.y=a>=u?o.y:i.y-a/2}else if(i.y<o.y){var u=o.y-i.y;i.y=a>=u?o.y:i.y+a/2}var c=i.y-r.y*app.config.actor.tile.height,l=t/2-c,f=i.x-app.config.actor.tile.width*app.config.actor.grid.width/2-e.variables.sprite.width/2-(r.x*app.config.actor.tile.width-n/2);$(app.config.shadowRoot).find(e.variables.canvas).css("z-index",Math.floor(e.variables.coordinates.current.y/app.config.actor.tile.height)).css("bottom",l).css("left",f)}function c(e){e.variables.canvas.context.clearRect(0,0,e.variables.canvas.width,e.variables.canvas.height);"undefined"==typeof e.variables.sprite[e.variables.state][e.variables.direction][e.variables.spriteIndex]&&(e.variables.spriteIndex=0);f(e);e.variables.selected&&s(e);e.variables.spriteIndex++}function l(e){var t=n.worldPosToIsoPos({x:e.x,y:e.y}),i=r,o=Math.ceil(window.innerWidth/app.config.actor.tile.width),a=Math.ceil(window.innerHeight/app.config.actor.tile.height);return t.x>=i.x-o/2&&t.x<=i.x+o/2&&t.y>=i.y-a/2&&t.y<=i.y+a/2?!0:!1}function f(e){var n,t;_.findIndex(i.assets.loaded.atlas,function(r){n=_.findWhere(r.sprite.sprites,{id:e.variables.sprite[e.variables.state][e.variables.direction][e.variables.spriteIndex]});t=r.sprite.img;!_.isEmpty(r)});if(!_.isEmpty(n)){e.variables.canvas.width=e.variables.sprite.width;e.variables.canvas.height=e.variables.sprite.height+h;var r=0,o=e.variables.canvas.height-n.h;e.variables.canvas.context.drawImage(t,n.x,n.y,n.w,n.h,r,o,n.w,n.h)}}function s(e){e.variables.canvas.context.fillStyle="red";e.variables.canvas.context.fillRect((e.variables.canvas.width-40)/2,0,38,h-2);e.variables.canvas.context.fillStyle="green";var n=e.variables.health/e.variables.hp;e.variables.canvas.context.fillRect((e.variables.canvas.width-40)/2,0,38*n,h-2)}function p(e){var i=window.innerWidth/2,o=window.innerHeight/2,a={};a.x=-(r.x*app.config.actor.tile.width+app.config.actor.grid.width*app.config.actor.tile.width/2-i);a.y=-(r.y*app.config.actor.tile.height)+o;var u=-a.x+e.left,c=-a.y+e.top,l=n.worldPosToIsoPos({x:u,y:c}),f=n.worldPosToIsoPos({x:u+e.width,y:c+e.height});_.each(t.getActorList(),function(e){var t=n.worldPosToIsoPos({x:e.variables.coordinates.current.x,y:e.variables.coordinates.current.y});e.variables.selected=t.x>=l.x&&t.x<=f.x&&t.y>=l.y&&t.y<=f.y?!0:!1})}var h=7.5;e.subscribe("new.frame",function(){o()});e.subscribe("center.update.start",function(){$(app.config.shadowRoot).find(".ActorsWrapper").removeClass("no-panning")});e.subscribe("center.update.stop",function(){$(app.config.shadowRoot).find(".ActorsWrapper").addClass("no-panning")});e.subscribe("map.selection",function(e){p(e)})});define("animate",["eventmanager","RequestAnimationFrame","map","actors"],function(e){function n(){e.publish("new.frame");window.setTimeout(n,1e3/app.config.framerate)}e.subscribe("game.init",function(){n()});return{}});define("mouse",["eventmanager"],function(e){HTMLCanvasElement.prototype.relmouseCoordinates=function(e){var n=0,t=0,r=0,i=0,o=this;do{n+=o.offsetLeft-o.scrollLeft;t+=o.offsetTop-o.scrollTop}while(o===o.offsetParent);r=e.pageX-n;i=e.pageY-t;return{x:r,y:i}};window.oncontextmenu=function(e){e.preventDefault();e.stopPropagation();return!1};var n=function(){};e.subscribe("game.init",function(){n()})});define("input",["eventmanager","mouse","Keypress"],function(e,n,t){var r=new t.Listener,i=[{keys:"up",prevent_repeat:!0,on_keydown:function(){e.publish("pan.up",1)},on_keyup:function(){e.publish("pan.up",0)}},{keys:"down",prevent_repeat:!0,on_keydown:function(){e.publish("pan.down",1)},on_keyup:function(){e.publish("pan.down",0)}},{keys:"left",prevent_repeat:!0,on_keydown:function(){e.publish("pan.left",1)},on_keyup:function(){e.publish("pan.left",0)}},{keys:"right",prevent_repeat:!0,on_keydown:function(){e.publish("pan.right",1)},on_keyup:function(){e.publish("pan.right",0)}}];r.register_many(i)});define("scripts/app",["lodash","jquery","plane","assetLoader","eventmanager","gamecycle","animate","input"],function(e,n,t,r){r.preloadassets();t({coordinates:{x:3960,y:0}}).init(),t({coordinates:{x:4e3,y:200}}).init(),t({coordinates:{x:4100,y:200}}).init(),t({coordinates:{x:4200,y:200}}).init(),t({coordinates:{x:4300,y:200}}).init(),t({coordinates:{x:4400,y:200}}).init()});