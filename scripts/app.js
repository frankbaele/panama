/**
 * Random number god
 * This code is an implementation of Alea algorithm; (C) 2010 Johannes Baagøe.
 * Alea is licensed according to the http://en.wikipedia.org/wiki/MIT_License.
 */

/**
     * @namespace
     * This code is an implementation of the ROT.js cellular map generation by Ondřej Žára, https://github.com/ondras/rot.js
     * Alea is licensed according to the http://en.wikipedia.org/wiki/MIT_License.
     */

/**
   * http://paulirish.com/2011/requestanimationframe-for-smart-animating/
   * http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
   * requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel
   * MIT license
   */

define("eventmanager",[""],function(){function e(e,n){topics.hasOwnProperty(e)||(topics[e]=[]);topics[e].push(n);return!0}function n(e,n){if(!topics.hasOwnProperty(e))return!1;for(var t=0,a=topics[e].length;a>t;t++)if(String(topics[e][t])===String(n)){topics[e].splice(t,1);return!0}return!1}function t(){var e=Array.prototype.slice.call(arguments),n=e.shift();if(!topics.hasOwnProperty(n))return!1;for(var t=0,a=topics[n].length;a>t;t++)topics[n][t].apply(void 0,e);return!0}topics={};return{subscribe:e,unsubscrive:n,publish:t,topics:topics}});define("scripts/app/controllers/uiController",["eventmanager"],function(e){ActorController=function(n){n.focus={};e.subscribe("actor.selected",function(t){n.focus.Uuid=t;e.subscribe("actor.object."+t,function(e){n.focus.actor=e;n.$digest()});e.publish("actor.getObject."+t)});e.subscribe("actor.unselected",function(t){if(n.focus.Uuid===t){e.unsubscrive("actor.object."+t,function(e){n.focus.actor=e;n.$digest()});n.focus.Uuid="";n.focus.actor="";n.$digest()}})};return["$scope","$interval",ActorController]});define("actorList",["eventmanager","underscore"],function(e){var n=[],t=[];e.subscribe("actor.create",function(e){n.push(e)});e.subscribe("actor.update",function(e){var t=_.findWhere(n,{uuid:e.variables.uuid});_.merge(t,e)});e.subscribe("actor.delete",function(e){var a=_.findWhere(n,{uuid:e});t.push(a.variables.uuid);n=_.without(n,a)});var a=function(){return n},r=function(){return t},i=function(){t=[]};return{getCleanUpList:r,clearCleanUpList:i,getActorList:a}});define("RNG",[],function(){function e(){t(Date.now())}function n(){return s}function t(e){e=1>e?1/e:e;s=e;p=(e>>>0)*_;e=69069*e+1>>>0;u=e*_;e=69069*e+1>>>0;f=e*_;d=1}function a(){var e=2091639*p+d*_;p=u;u=f;d=0|e;f=e-d;return f}function r(e,n){do var t=2*a()-1,r=2*a()-1,i=t*t+r*r;while(i>1||0==i);var o=t*Math.sqrt(-2*Math.log(i)/i);return(e||0)+o*(n||1)}function i(){return 1+Math.floor(100*a())}function o(e){var n=0;for(var t in e)n+=e[t];var r=Math.floor(a()*n),i=0;for(var t in e){i+=e[t];if(i>r)return t}return null}function c(){return[p,u,f,d]}function l(e){p=e[0];u=e[1];f=e[2];d=e[3]}var s,p=0,u=0,f=0,d=0,_=2.3283064365386963e-10;e();return{getSeed:n,setSeed:t,getUniform:a,getNormal:r,getPercentage:i,getWeightedValue:o,getState:c,setState:l}});define("graphNode",[],function(){function e(e,n,t){this.data={};this.x=e;this.y=n;this.pos={x:e,y:n};this.type=t}var n={OPEN:0,WALL:1};e.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};e.prototype.isWall=function(){return this.type==n.WALL};return e});define("graph",["graphNode"],function(e){function n(n){for(var t=[],a=0;a<n.length;a++){t[a]=[];for(var r=0,i=n[a];r<i.length;r++)t[a][r]=new e(a,r,i[r])}this.input=n;this.nodes=t}n.prototype.toString=function(){for(var e,n,t,a,r="\n",i=this.nodes,o=0,c=i.length;c>o;o++){e="";n=i[o];for(t=0,a=n.length;a>t;t++)e+=n[t].type+" ";r=r+e+"\n"}return r};return n});define("world",["RNG","underscore","graph","eventmanager"],function(e,n,t,a){function r(){m=n.compose(s,p,s,s,i,o)();g=new t(m)}function i(n){var t,a;for(t=0;h>t;t++)for(a=0;v>a;a++)n[t][a]=e.getUniform()<C?1:0;return n}function o(){var e,n,t=[];for(e=0;h>e;e++){t[e]=[];for(n=0;v>n;n++)t[e][n]=0}return t}function c(e,n,t){for(var a=0,r=0;r<W.length;r++){var i=W[r],o=n+i[0],c=t+i[1];0>o||o>=v||0>o||c>=v||(a+=1===e[o][c]?1:0)}return a}function l(e,n){var t={};t.x=(e-n)/2;t.y=(e+n)/2;return t}function s(e){for(var n=0,t=o(),a=0;h>a;a++){var r=1,i=0;if(6===L){r=2;i=a%2}for(var l=i;v>l;l+=r){n++;var s=e[l][a],p=c(e,l,a);s&&-1!==w.indexOf(p)?t[l][a]=1:s||-1===y.indexOf(p)||(t[l][a]=1)}}return t}function p(e){for(var n=[],t=2,a=0;h>a;a++)for(var r=0;t>r;r++){var i=a*t+r;n[i]=[];for(var o=0;v>o;o++)for(var c=0;t>c;c++){var l=o*t+c;n[i][l]=e[a][o]}}v*=t;h*=t;return n}function u(e,n){return e>=0&&n>=0&&v>e&&h>n?!1:!0}function f(e,n){return{x:e,y:n}}function d(e){return 0===m[e.y][e.x]?!0:!1}function _(){var e={x:0,y:0};1===k.up&&(e.y=e.y-1);1===k.down&&(e.y=e.y+1);1===k.left&&(e.x=e.x-1);1===k.right&&(e.x=e.x+1);if(0!==e.x||0!==e.y){e=f(P.x+e.x,P.y+e.y);P.x=e.x;P.y=e.y;a.publish("center.update.start")}else a.publish("center.update.stop")}var g,h=30,v=30,x=132,b=66,m=[],y=[5,6,7,8],w=[4,5,6,7,8],L=8,P=l(30,30),C=.47,W=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],k={up:0,down:0,left:0,right:0};a.subscribe("new.frame",function(){_()});a.subscribe("pan.up",function(e){k.up=e});a.subscribe("pan.down",function(e){k.down=e});a.subscribe("pan.left",function(e){k.left=e});a.subscribe("pan.right",function(e){k.right=e});r();return{tileWidth:x,tileHeight:b,inBoundTile:f,outOfBound:u,tileIsOpen:d,height:h,width:v,mapData:m,center:P,graph:g}});define("standardlib",["world","eventmanager"],function(e){function n(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function t(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function a(e,n){var t={};t.x=n+e;t.y=n-e;return t}function r(e,n){var t={};t.x=(e-n)/2;t.y=(e+n)/2;return t}function i(n,t){n-=e.width/2*e.tileWidth;var a=(n/(e.tileWidth/2)+t/(e.tileHeight/2))/2,r=(t/(e.tileHeight/2)-n/(e.tileWidth/2))/2;a=Math.floor(a);r=Math.floor(r);return{x:a,y:r}}function o(){}function c(e,n){var t=setInterval(function(){e()&&clearInterval(t)},1e3)}return{guid:t,isoToTwoD:a,twoDToIso:r,worldPosToGridPos:i,windowPosToGridPos:o,checkWait:c}});define("actor",["eventmanager","actorList","standardlib","world"],function(e,n,t,a){return function(n){var r={};r.init=function(){_.each(r.handlers,function(n,t){_.each(n,function(n,a){e[t](a,r[n])})});e.publish("actor.create",r.getInfo())};r.variables={coordinates:n.coordinates,width:a.tileWidth,height:a.tileHeight,uuid:t.guid(),direction:"down",hp:0,rendered:!1,canvas:{}};r.handlers={subscribe:{"actor.selected":"actorSelect"}};r.actorSelect=function(e){r.variables.selected=r.variables.uuid==e?!0:!1};r.getInfo=function(){return r};r.destroy=function(){e.publish("actor.delete",variables.uuid)};return r}});define("binaryHeap",[""],function(){function e(e){this.content=[];this.scoreFunction=e}e.prototype={push:function(e){this.content.push(e);this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],n=this.content.pop();if(this.content.length>0){this.content[0]=n;this.bubbleUp(0)}return e},remove:function(e){var n=this.content.indexOf(e),t=this.content.pop();if(n!==this.content.length-1){this.content[n]=t;this.scoreFunction(t)<this.scoreFunction(e)?this.sinkDown(n):this.bubbleUp(n)}},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var n=this.content[e];e>0;){var t=(e+1>>1)-1,a=this.content[t];if(!(this.scoreFunction(n)<this.scoreFunction(a)))break;this.content[t]=n;this.content[e]=a;e=t}},bubbleUp:function(e){for(var n=this.content.length,t=this.content[e],a=this.scoreFunction(t);;){var r=e+1<<1,i=r-1,o=null;if(n>i){var c=this.content[i],l=this.scoreFunction(c);a>l&&(o=i)}if(n>r){var s=this.content[r],p=this.scoreFunction(s);(null===o?a:l)>p&&(o=r)}if(null===o)break;this.content[e]=this.content[o];this.content[o]=t;e=o}}};return e});define("astar",["binaryHeap"],function(e){var n={init:function(e){for(var n=0,t=e.length;t>n;n++)for(var a=0,r=e[n].length;r>a;a++){var i=e[n][a];i.f=0;i.g=0;i.h=0;i.cost=i.type;i.visited=!1;i.closed=!1;i.parent=null}},heap:function(){return new e(function(e){return e.f})},search:function(e,t,a,r,i){n.init(e);i=i||n.manhattan;r=!!r;var o=n.heap();o.push(t);for(;o.size()>0;){var c=o.pop();if(c===a){for(var l=c,s=[];l.parent;){s.push(l);l=l.parent}return s.reverse()}c.closed=!0;for(var p=n.neighbors(e,c,r),u=0,f=p.length;f>u;u++){var d=p[u];if(!d.closed&&!d.isWall()){var _=c.g+d.cost,g=d.visited;if(!g||_<d.g){d.visited=!0;d.parent=c;d.h=d.h||i(d.pos,a.pos);d.g=_;d.f=d.g+d.h;g?o.rescoreElement(d):o.push(d)}}}}return[]},manhattan:function(e,n){var t=Math.abs(n.x-e.x),a=Math.abs(n.y-e.y);return t+a},neighbors:function(e,n,t){var a=[],r=n.x,i=n.y;e[r-1]&&e[r-1][i]&&a.push(e[r-1][i]);e[r+1]&&e[r+1][i]&&a.push(e[r+1][i]);e[r]&&e[r][i-1]&&a.push(e[r][i-1]);e[r]&&e[r][i+1]&&a.push(e[r][i+1]);if(t){e[r-1]&&e[r-1][i-1]&&a.push(e[r-1][i-1]);e[r+1]&&e[r+1][i-1]&&a.push(e[r+1][i-1]);e[r-1]&&e[r-1][i+1]&&a.push(e[r-1][i+1]);e[r+1]&&e[r+1][i+1]&&a.push(e[r+1][i+1])}return a}};return n});define("actor.unit",["actor","eventmanager","astar","world","underscore"],function(e,n,t,a){return function(r){var i=e(r),o={path:[],focus:"",strenght:0,dexterity:0,intelligence:0,health:0,death:!1,hp:0,attack:10},c={"new.gamecycle":"move"};_.extend(i.variables,o);_.extend(i.handlers.subscribe,c);i.generatePath=function(){var e=a.graph.nodes[i.variables.coordinates.y][i.variables.coordinates.x],n=a.graph.nodes[i.variables.goal.y][i.variables.goal.x];i.variables.path=t.search(a.graph.nodes,e,n,!0)};i.move=function(){if(0!==i.variables.path.length){var e=_.first(i.variables.path);i.variables.path=_.rest(i.variables.path);var t={x:i.variables.coordinates.x-e.y,y:i.variables.coordinates.y-e.x};-1==t.x?i.variables.direction=0:1==t.x?i.variables.direction=2:-1==t.y?i.variables.direction=1:1==t.y&&(i.variables.direction=3);i.variables.coordinates={x:e.y,y:e.x};n.publish("command",{event:"actor.update",parameters:i})}};return i}});define("actor.unit.local",["actor.unit","eventmanager"],function(e){return function(n){var t=e(n),a={focus:"",state:"base"};_.extend(t.variables,a);var r={"map.click":"checkMapClick"};_.extend(t.handlers.subscribe,r);t.checkMapClick=function(e){if(t.variables.selected){t.variables.goal=e;t.generatePath()}};return t}});define("plane",["actor.unit.local","eventmanager"],function(e){return function(n){var t=e(n),a={focus:"",state:"base",direction:0,sprite:{center:{x:24,y:20},base:{0:["plane/base/Plane_Large_face0_0.png","plane/base/Plane_Large_face0_1.png","plane/base/Plane_Large_face0_2.png","plane/base/Plane_Large_face0_3.png"],1:["plane/base/Plane_Large_face1_0.png","plane/base/Plane_Large_face1_1.png","plane/base/Plane_Large_face1_2.png","plane/base/Plane_Large_face1_3.png"],2:["plane/base/Plane_Large_face2_0.png","plane/base/Plane_Large_face2_1.png","plane/base/Plane_Large_face2_2.png","plane/base/Plane_Large_face2_3.png"],3:["plane/base/Plane_Large_face3_0.png","plane/base/Plane_Large_face3_1.png","plane/base/Plane_Large_face3_2.png","plane/base/Plane_Large_face3_3.png"]},explode:{0:["plane/explode/color0_Plane_Large_face0_fiery_explode_0.png","plane/explode/color0_Plane_Large_face0_fiery_explode_1.png","plane/explode/color0_Plane_Large_face0_fiery_explode_2.png","plane/explode/color0_Plane_Large_face0_fiery_explode_3.png","plane/explode/color0_Plane_Large_face0_fiery_explode_4.png","plane/explode/color0_Plane_Large_face0_fiery_explode_5.png","plane/explode/color0_Plane_Large_face0_fiery_explode_6.png","plane/explode/color0_Plane_Large_face0_fiery_explode_7.png","plane/explode/color0_Plane_Large_face0_fiery_explode_8.png","plane/explode/color0_Plane_Large_face0_fiery_explode_9.png","plane/explode/color0_Plane_Large_face0_fiery_explode_10.png","plane/explode/color0_Plane_Large_face0_fiery_explode_11.png"],1:["plane/explode/color0_Plane_Large_face1_fiery_explode_0.png","plane/explode/color0_Plane_Large_face1_fiery_explode_1.png","plane/explode/color0_Plane_Large_face1_fiery_explode_2.png","plane/explode/color0_Plane_Large_face1_fiery_explode_3.png","plane/explode/color0_Plane_Large_face1_fiery_explode_4.png","plane/explode/color0_Plane_Large_face1_fiery_explode_5.png","plane/explode/color0_Plane_Large_face1_fiery_explode_6.png","plane/explode/color0_Plane_Large_face1_fiery_explode_7.png","plane/explode/color0_Plane_Large_face1_fiery_explode_8.png","plane/explode/color0_Plane_Large_face1_fiery_explode_9.png","plane/explode/color0_Plane_Large_face1_fiery_explode_10.png","plane/explode/color0_Plane_Large_face1_fiery_explode_11.png"],2:["plane/explode/color0_Plane_Large_face2_fiery_explode_0.png","plane/explode/color0_Plane_Large_face2_fiery_explode_1.png","plane/explode/color0_Plane_Large_face2_fiery_explode_2.png","plane/explode/color0_Plane_Large_face2_fiery_explode_3.png","plane/explode/color0_Plane_Large_face2_fiery_explode_4.png","plane/explode/color0_Plane_Large_face2_fiery_explode_5.png","plane/explode/color0_Plane_Large_face2_fiery_explode_6.png","plane/explode/color0_Plane_Large_face2_fiery_explode_7.png","plane/explode/color0_Plane_Large_face2_fiery_explode_8.png","plane/explode/color0_Plane_Large_face2_fiery_explode_9.png","plane/explode/color0_Plane_Large_face2_fiery_explode_10.png","plane/explode/color0_Plane_Large_face2_fiery_explode_11.png"],3:["plane/explode/color0_Plane_Large_face3_fiery_explode_0.png","plane/explode/color0_Plane_Large_face3_fiery_explode_1.png","plane/explode/color0_Plane_Large_face3_fiery_explode_2.png","plane/explode/color0_Plane_Large_face3_fiery_explode_3.png","plane/explode/color0_Plane_Large_face3_fiery_explode_4.png","plane/explode/color0_Plane_Large_face3_fiery_explode_5.png","plane/explode/color0_Plane_Large_face3_fiery_explode_6.png","plane/explode/color0_Plane_Large_face3_fiery_explode_7.png","plane/explode/color0_Plane_Large_face3_fiery_explode_8.png","plane/explode/color0_Plane_Large_face3_fiery_explode_9.png","plane/explode/color0_Plane_Large_face3_fiery_explode_10.png","plane/explode/color0_Plane_Large_face3_fiery_explode_11.png"]}},health:75,death:!1,hp:100};_.extend(t.variables,a);return t}});define("scripts/app/controllers/gameController",["eventmanager","plane"],function(e,n){gameController=function(){n({coordinates:{x:30,y:30}}).init();n({coordinates:{x:29,y:30}}).init();n({coordinates:{x:31,y:30}}).init();n({coordinates:{x:30,y:29}}).init();n({coordinates:{x:30,y:31}}).init();n({coordinates:{x:33,y:30}}).init();n({coordinates:{x:29,y:31}}).init();n({coordinates:{x:31,y:31}}).init();n({coordinates:{x:30,y:28}}).init();n({coordinates:{x:30,y:32}}).init()};return["$scope","$timeout",gameController]});define("scripts/app/controllers/CanvasController",["eventmanager"],function(e){canvasController=function(){e.publish("game.init")};return["$scope",canvasController]});define("commandQueue",[""],function(){function e(e){a.push(e)}function n(){a=[]}function t(){return a}var a=[];return{add:e,get:t,clear:n}});define("command",["commandQueue","eventmanager"],function(e,n){function t(n){e.add(n)}function a(){var t=e.get();_.forEach(t,function(e){n.publish(e.event,e.parameters)});e.clear()}n.subscribe("command",function(e){t(e)});n.subscribe("new.gamecycle",function(){a()})});define("gamecycle",["eventmanager","command"],function(e){function n(){t()}function t(){setTimeout(t,200);e.publish("new.gamecycle")}e.subscribe("game.init",function(){n()})});define("text!assetsList",[],function(){return'{\n  "0" : {\n    "name": "mapTiles",\n    "type": "atlas",\n    "configuration": "./art/panama.json",\n    "file": "./art/panama.png"\n  }\n}'});define("spriteSheet",[""],function(){var e=function(e,n){var t=[],a=e,r=n,i=function(){_.forEach(a.frames,function(e){var n=e,t=.5*-n.frame.w,a=.5*-n.frame.h;if(n.trimmed){t=n.spriteSourceSize.x-.5*n.sourceSize.w;a=n.spriteSourceSize.y-.5*n.sourceSize.h}o(n.filename,n.frame.x,n.frame.y,n.frame.w,n.frame.h,t,a)})},o=function(e,n,a,r,i,o,c){var l={id:e,x:n,y:a,w:r,h:i,cx:null===o?0:o,cy:null===c?0:c};t.push(l)};i();return{img:r,sprites:t}};return e});define("assetLoader",["spriteSheet","underscore","jQuery"],function(e){var n=function(n){var t=this;_.forEach(n.config,function(a){t.queue++;switch(a.type){case"atlas":t.loadAtlas(a,function(r){n.loaded.atlas.push({name:a.name,sprite:new e(r.configuration,r.file)});t.queue--});break;case"music":}});return n},t=function(){return this.queue>0?!1:!0},a=function(e,n){jQuery.getJSON(e.configuration,function(n){e.configuration=n}).then(function(){var t=new Image;t.src=e.file;e.file=t;n(e)})};return{preloadassets:n,preloadComplete:t,loadAtlas:a}});define("assets",["text!assetsList","assetLoader","eventmanager"],function(e,n,t){function a(){var e=setInterval(function(){if(n.preloadComplete()){t.publish("assets.loaded");clearInterval(e)}},1e3)}var r={config:{},loaded:{atlas:[],music:[]}};r.config=JSON.parse(e);r=n.preloadassets(r);a();return r});define("RequestAnimationFrame",[""],function(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/16.5)}}()});define("map",["eventmanager","world","standardlib","assets","underscore","jQuery"],function(e,n,t,a){function r(){u.canvas=document.getElementById("mapCanvas");u.context=u.canvas.getContext("2d");u.canvas.width=n.width*n.tileWidth;u.canvas.height=n.height*n.tileHeight;u.canvas.addEventListener("contextmenu",function(n){var a=u.canvas.relmouseCoordinates(n);a=t.worldPosToGridPos(a.x,a.y);e.publish("map.click",a)});u.canvas.addEventListener("mousedown",function(e){if(1==e.which){$(".ghost-select").addClass("ghost-active");$(".ghost-select").css({left:e.pageX,top:e.pageY});initialW=e.pageX;initialH=e.pageY;$(document).bind("mouseup",i);$(document).bind("mousemove",o)}});c();s()}function i(){$(document).unbind("mousemove",o);$(document).unbind("mouseup",i);var n=$(".ghost-select");e.publish("map.selection",{width:n.width(),height:n.height(),left:n.offset().left,top:n.offset().top});$(".ghost-select").css({left:0,top:0,width:0,height:0}).removeClass("ghost-active")}function o(e){var n=Math.abs(initialW-e.pageX),t=Math.abs(initialH-e.pageY);$(".ghost-select").css({width:n,height:t});e.pageX<=initialW&&e.pageY>=initialH?$(".ghost-select").css({left:e.pageX}):e.pageY<=initialH&&e.pageX>=initialW?$(".ghost-select").css({top:e.pageY}):e.pageY<initialH&&e.pageX<initialW&&$(".ghost-select").css({left:e.pageX,top:e.pageY})}function c(){u.context.clearRect(0,0,u.canvas.width,u.canvas.height);for(var e={x:0,y:0},t=0;n.height>t;t++)for(var a=0;n.width>a;a++)n.outOfBound(e.y+t,e.x+a)||l(1===n.mapData[e.y+t][e.x+a]?{sprite:"trees_2.png",x:e.x+a,y:e.y+t,correction:15}:{sprite:"landscapeTiles_066.png",x:e.x+a,y:e.y+t,correction:15})}function l(e){var r,i,o;_.findIndex(a.loaded.atlas,function(n){r=_.findWhere(n.sprite.sprites,{id:e.sprite});o=n.sprite.img;!_.isEmpty(n)});if(!_.isEmpty(r)){i=t.twoDToIso(e.x,e.y);i.x=i.x*n.tileWidth+u.canvas.width/2-(r.w-n.tileWidth)/2-n.tileWidth/2;i.y=i.y*n.tileHeight+(r.w/2-(r.h-e.correction));u.context.drawImage(o,r.x,r.y,r.w,r.h,i.x,i.y,r.w,r.h)}}function s(){var e=window.innerWidth/2,t=window.innerHeight/2,a={};a.x=-(n.center.x*n.tileWidth+u.canvas.width/2-e);a.y=-(n.center.y*n.tileHeight)+t;$(u.canvas).css("margin-left",a.x).css("margin-top",a.y)}function p(){s(n.center)}var u={};e.subscribe("new.frame",function(){p()});e.subscribe("game.init",function(){r()})});define("actors",["eventmanager","standardlib","world","actorList","assets","jQuery","underscore"],function(e,n,t,a,r){function i(){_.each(a.getCleanUpList(),function(e){$("canvas."+e.uuid).remove()});a.clearCleanUpList();_.each(a.getActorList(),function(n){if(s(n.variables.coordinates))if(n.variables.rendered)o(n);else{$(".ActorsWrapper").append('<canvas id="'+n.variables.uuid+'"></canvas>');n.variables.canvas=document.getElementById(n.variables.uuid);n.variables.canvas.context=n.variables.canvas.getContext("2d");n.variables.canvas.addEventListener("click",function(){e.publish("actor.selected",n.variables.uuid)});n.variables.rendered=!0;o(n)}else if(n.variables.rendered){$("canvas#"+n.variables.uuid).remove();n.variables.rendered=!1;n.variables.canvas=""}})}function o(e){c(e);l(e)}function c(e){var a=window.innerWidth/t.tileWidth,r=window.innerHeight/t.tileHeight,i=n.twoDToIso(e.variables.coordinates.x,e.variables.coordinates.y),o=t.center,c=i.y-o.y,l=(r/2-c-1)*t.tileHeight+20;$(e.variables.canvas).css("z-index",e.variables.coordinates.y).css("bottom",l);var s=i.x-(o.x-a/2),p=s*t.tileWidth-e.variables.sprite.center.x;$(e.variables.canvas).css("left",p)}function l(e){e.variables.canvas.context.clearRect(0,0,e.variables.canvas.width,e.variables.canvas.height);"undefined"==typeof e.variables.sprite[e.variables.state][e.variables.direction][e.variables.spriteIndex]&&(e.variables.spriteIndex=0);p({sprite:e.variables.sprite[e.variables.state][e.variables.direction][e.variables.spriteIndex],canvas:e.variables.canvas});e.variables.selected&&u({canvas:e.variables.canvas,health:e.variables.health,hp:e.variables.hp});e.variables.spriteIndex++}function s(e){var a=n.twoDToIso(e.x,e.y),r=t.center,i=Math.ceil(window.innerWidth/t.tileWidth),o=Math.ceil(window.innerHeight/t.tileHeight);return a.x>=r.x-i/2&&a.x<=r.x+i/2&&a.y>=r.y-o/2&&a.y<=r.y+o/2?!0:!1}function p(e){var n,t;_.findIndex(r.loaded.atlas,function(a){n=_.findWhere(a.sprite.sprites,{id:e.sprite});t=a.sprite.img;!_.isEmpty(a)});if(!_.isEmpty(n)){e.canvas.width=n.w;e.canvas.height=n.h+d;e.canvas.context.drawImage(t,n.x,n.y,n.w,n.h,0,d,n.w,n.h)}}function u(e){e.canvas.context.fillStyle="red";e.canvas.context.fillRect((e.canvas.width-40)/2,0,38,d-2);e.canvas.context.fillStyle="green";var n=e.health/e.hp;e.canvas.context.fillRect((e.canvas.width-40)/2,0,38*n,d-2)}function f(e){var r=window.innerWidth/2,i=window.innerHeight/2,o={};o.x=-(t.center.x*t.tileWidth+t.width*t.tileWidth/2-r);o.y=-(t.center.y*t.tileHeight)+i;var c=-o.x+e.left,l=-o.y+e.top,s=n.worldPosToGridPos(c,l);s=n.twoDToIso(s.x,s.y);var p=n.worldPosToGridPos(c+e.width,l+e.height);p=n.twoDToIso(p.x,p.y);_.each(a.getActorList(),function(e){var t=n.twoDToIso(e.variables.coordinates.x,e.variables.coordinates.y);e.variables.selected=t.x>=s.x&&t.x<=p.x&&t.y>=s.y&&t.y<=p.y?!0:!1})}var d=7.5;e.subscribe("new.frame",function(){i()});e.subscribe("center.update.start",function(){$(".ActorsWrapper").removeClass("no-panning")});e.subscribe("center.update.stop",function(){$(".ActorsWrapper").addClass("no-panning")});e.subscribe("map.selection",function(e){f(e)})});define("animate",["eventmanager","RequestAnimationFrame","map","actors"],function(e){function n(){e.publish("new.frame");window.setTimeout(n,100)}e.subscribe("game.init",function(){n()});return{}});define("mouse",["eventmanager"],function(e){HTMLCanvasElement.prototype.relmouseCoordinates=function(e){var n=0,t=0,a=0,r=0,i=this;do{n+=i.offsetLeft-i.scrollLeft;t+=i.offsetTop-i.scrollTop}while(i===i.offsetParent);a=e.pageX-n;r=e.pageY-t;return{x:a,y:r}};window.oncontextmenu=function(e){e.preventDefault();e.stopPropagation();return!1};var n=function(){};e.subscribe("game.init",function(){n()})});define("input",["eventmanager","mouse","keypress"],function(e){var n=[{keys:"up",prevent_repeat:!0,on_keydown:function(){e.publish("pan.up",1)},on_keyup:function(){e.publish("pan.up",0)}},{keys:"down",prevent_repeat:!0,on_keydown:function(){e.publish("pan.down",1)},on_keyup:function(){e.publish("pan.down",0)}},{keys:"left",prevent_repeat:!0,on_keydown:function(){e.publish("pan.left",1)},on_keyup:function(){e.publish("pan.left",0)}},{keys:"right",prevent_repeat:!0,on_keydown:function(){e.publish("pan.right",1)},on_keyup:function(){e.publish("pan.right",0)}}];keypress.register_many(n)});define("scripts/app",["scripts/app/controllers/uiController","scripts/app/controllers/gameController","scripts/app/controllers/CanvasController","angular","angular-ui-router","gamecycle","assets","animate","input"],function(e,n,t){var a=angular.module("panama",["ui.router"]);a.config(["$stateProvider",function(e){e.state("menu",{templateUrl:"templates/menu.html"}).state("game",{"abstract":!0,templateUrl:"templates/game.html",controller:"gameController"}).state("game.content",{views:{canvas:{templateUrl:"templates/game.canvas.html",controller:"canvasController"},actor:{templateUrl:"templates/game.ui.html",controller:"uiController"}}})}]);a.controller("uiController",e);a.controller("gameController",n);a.controller("canvasController",t);a.run(["$state",function(e){e.transitionTo("game.content")}]);angular.element(document).ready(function(){angular.bootstrap(document,["panama"])});return a});