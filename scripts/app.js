/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

/**
 * Random number god
 * This code is an implementation of Alea algorithm; (C) 2010 Johannes Baagøe.
 * Alea is licensed according to the http://en.wikipedia.org/wiki/MIT_License.
 */

/**
 * @license
 * lodash 3.4.0 (Custom Build) <https://lodash.com/>
 * Build: `lodash modern -o ./lodash.js`
 * Copyright 2012-2015 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.8.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <https://lodash.com/license>
 */

/*
Copyright (C) 2008-10 University of North Carolina at Chapel Hill.
All rights reserved.

Permission to use, copy, modify, and distribute this software and its
documentation for educational, research, and non-profit purposes, without fee,
and without a written agreement is hereby granted, provided that the above
copyright notice, this paragraph, and the following four paragraphs appear in
all copies.

Permission to incorporate this software into commercial products may be obtained
by contacting the University of North Carolina at Chapel Hill.

This software program and documentation are copyrighted by the University of
North Carolina at Chapel Hill. The software program and documentation are
supplied "as is", without any accompanying services from the University of North
Carolina at Chapel Hill or the authors. The University of North Carolina at
Chapel Hill and the authors do not warrant that the operation of the program
will be uninterrupted or error-free. The end-user understands that the program
was developed for research purposes and is advised not to rely exclusively on
the program for any reason.

IN NO EVENT SHALL THE UNIVERSITY OF NORTH CAROLINA AT CHAPEL HILL OR ITS
EMPLOYEES OR THE AUTHORS BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT, SPECIAL,
INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS, ARISING OUT OF THE
USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF THE UNIVERSITY OF NORTH
CAROLINA AT CHAPEL HILL OR THE AUTHORS HAVE BEEN ADVISED OF THE POSSIBILITY OF
SUCH DAMAGE.

THE UNIVERSITY OF NORTH CAROLINA AT CHAPEL HILL AND THE AUTHORS SPECIFICALLY
DISCLAIM ANY WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE AND ANY STATUTORY
WARRANTY OF NON-INFRINGEMENT. THE SOFTWARE PROVIDED HEREUNDER IS ON AN "AS IS"
BASIS, AND THE UNIVERSITY OF NORTH CAROLINA AT CHAPEL HILL AND THE AUTHORS HAVE
NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR
MODIFICATIONS.
*/

/**
   * http://paulirish.com/2011/requestanimationframe-for-smart-animating/
   * http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
   * requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel
   * MIT license
   */

define("spriteSheet",[""],function(){var t=function(t,e){var n=[],r=t,i=e,o=function(){_.forEach(r.frames,function(t){var e=t,n=.5*-e.frame.w,r=.5*-e.frame.h;if(e.trimmed){n=e.spriteSourceSize.x-.5*e.sourceSize.w;r=e.spriteSourceSize.y-.5*e.sourceSize.h}a(e.filename,e.frame.x,e.frame.y,e.frame.w,e.frame.h,n,r)})},a=function(t,e,r,i,o,a,u){var s={id:t,x:e,y:r,w:i,h:o,cx:null===a?0:a,cy:null===u?0:u};n.push(s)};o();return{img:i,sprites:n}};return t});define("text!assetsList",[],function(){return'{\n  "0" : {\n    "name": "terrain",\n    "type": "atlas",\n    "configuration": "./art/terrain.json",\n    "file": "./art/terrain.png"\n  },\n  "1" : {\n    "name": "units",\n    "type": "atlas",\n    "configuration": "./art/units.json",\n    "file": "./art/units.png"\n  },\n  "2" : {\n    "name": "towers",\n    "type": "atlas",\n    "configuration": "./art/towers.json",\n    "file": "./art/towers.png"\n  }\n}'});!function(t){if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define("q",t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else{if("undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");self.Q=t()}}(function(){function t(t){return function(){return Y.apply(t,arguments)}}function e(t){return t===Object(t)}function n(t){return"[object StopIteration]"===ne(t)||t instanceof z}function r(t,e){if(E&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(re)){for(var n=[],r=e;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(t.stack);var o=n.join("\n"+re+"\n");t.stack=i(o)}}function i(t){for(var e=t.split("\n"),n=[],r=0;r<e.length;++r){var i=e[r];u(i)||o(i)||!i||n.push(i)}return n.join("\n")}function o(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function a(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function u(t){var e=a(t);if(!e)return!1;var n=e[0],r=e[1];return n===U&&r>=H&&se>=r}function s(){if(E)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=e[0].indexOf("@")>0?e[1]:e[2],r=a(n);if(!r)return;U=r[0];return r[1]}}function c(t,e,n){return function(){"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(e+" is deprecated, use "+n+" instead.",new Error("").stack);return t.apply(t,arguments)}}function l(t){return t instanceof d?t:_(t)?k(t):A(t)}function f(){function t(t){e=t;o.source=t;K(n,function(e,n){l.nextTick(function(){t.promiseDispatch.apply(t,n)})},void 0);n=void 0;r=void 0}var e,n=[],r=[],i=Z(f.prototype),o=Z(d.prototype);o.promiseDispatch=function(t,i,o){var a=J(arguments);if(n){n.push(a);"when"===i&&o[1]&&r.push(o[1])}else l.nextTick(function(){e.promiseDispatch.apply(e,a)})};o.valueOf=function(){if(n)return o;var t=v(e);y(t)&&(e=t);return t};o.inspect=function(){return e?e.inspect():{state:"pending"}};if(l.longStackSupport&&E)try{throw new Error}catch(a){o.stack=a.stack.substring(a.stack.indexOf("\n")+1)}i.promise=o;i.resolve=function(n){e||t(l(n))};i.fulfill=function(n){e||t(A(n))};i.reject=function(n){e||t(w(n))};i.notify=function(t){e||K(r,function(e,n){l.nextTick(function(){n(t)})},void 0)};return i}function p(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=f();try{t(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}return e.promise}function h(t){return p(function(e,n){for(var r=0,i=t.length;i>r;r++)l(t[r]).then(e,n)})}function d(t,e,n){void 0===e&&(e=function(t){return w(new Error("Promise does not support operation: "+t))});void 0===n&&(n=function(){return{state:"unknown"}});var r=Z(d.prototype);r.promiseDispatch=function(n,i,o){var a;try{a=t[i]?t[i].apply(r,o):e.call(r,i,o)}catch(u){a=w(u)}n&&n(a)};r.inspect=n;if(n){var i=n();"rejected"===i.state&&(r.exception=i.reason);r.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?r:t.value}}return r}function g(t,e,n,r){return l(t).then(e,n,r)}function v(t){if(y(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function y(t){return t instanceof d}function _(t){return e(t)&&"function"==typeof t.then}function m(t){return y(t)&&"pending"===t.inspect().state}function b(t){return!y(t)||"fulfilled"===t.inspect().state}function V(t){return y(t)&&"rejected"===t.inspect().state}function x(){ie.length=0;oe.length=0;ue||(ue=!0)}function O(t,e){if(ue){"object"==typeof process&&"function"==typeof process.emit&&l.nextTick.runAfter(function(){if(-1!==G(oe,t)){process.emit("unhandledRejection",e,t);ae.push(t)}});oe.push(t);ie.push(e&&"undefined"!=typeof e.stack?e.stack:"(no stack) "+e)}}function R(t){if(ue){var e=G(oe,t);if(-1!==e){"object"==typeof process&&"function"==typeof process.emit&&l.nextTick.runAfter(function(){var n=G(ae,t);if(-1!==n){process.emit("rejectionHandled",ie[e],t);ae.splice(n,1)}});oe.splice(e,1);ie.splice(e,1)}}}function w(t){var e=d({when:function(e){e&&R(this);return e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});O(e,t);return e}function A(t){return d({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},"delete":function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return ee(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function k(t){var e=f();l.nextTick(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}});return e.promise}function P(t){return d({isDef:function(){}},function(e,n){return S(t,e,n)},function(){return l(t).inspect()})}function N(t,e,n){return l(t).spread(e,n)}function M(t){return function(){function e(t,e){var a;if("undefined"==typeof StopIteration){try{a=r[t](e)}catch(u){return w(u)}return a.done?l(a.value):g(a.value,i,o)}try{a=r[t](e)}catch(u){return n(u)?l(u.value):w(u)}return g(a,i,o)}var r=t.apply(this,arguments),i=e.bind(e,"next"),o=e.bind(e,"throw");return i()}}function W(t){l.done(l.async(t)())}function T(t){throw new z(t)}function L(t){return function(){return N([this,j(arguments)],function(e,n){return t.apply(e,n)})}}function S(t,e,n){return l(t).dispatch(e,n)}function j(t){return g(t,function(t){var e=0,n=f();K(t,function(r,i,o){var a;if(y(i)&&"fulfilled"===(a=i.inspect()).state)t[o]=a.value;else{++e;g(i,function(r){t[o]=r;0===--e&&n.resolve(t)},n.reject,function(t){n.notify({index:o,value:t})})}},void 0);0===e&&n.resolve(t);return n.promise})}function D(t){if(0===t.length)return l.resolve();var e=l.defer(),n=0;K(t,function(r,i,o){function a(t){e.resolve(t)}function u(){n--;0===n&&e.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function s(t){e.notify({index:o,value:t})}var c=t[o];n++;g(c,a,u,s)},void 0);return e.promise}function I(t){return g(t,function(t){t=Q(t,l);return g(j(Q(t,function(t){return g(t,$,$)})),function(){return t})})}function C(t){return l(t).allSettled()}function F(t,e){return l(t).then(void 0,void 0,e)}function q(t,e){return l(t).nodeify(e)}var E=!1;try{throw new Error}catch(B){E=!!B.stack}var U,z,H=s(),$=function(){},X=function(){function t(){for(var t,r;n.next;){n=n.next;t=n.task;n.task=void 0;r=n.domain;if(r){n.domain=void 0;r.enter()}e(t,r)}for(;u.length;){t=u.pop();e(t)}i=!1}function e(e,n){try{e()}catch(r){if(a){n&&n.exit();setTimeout(t,0);n&&n.enter();throw r}setTimeout(function(){throw r},0)}n&&n.exit()}var n={task:void 0,next:null},r=n,i=!1,o=void 0,a=!1,u=[];X=function(t){r=r.next={task:t,domain:a&&process.domain,next:null};if(!i){i=!0;o()}};if("object"==typeof process&&"[object process]"===process.toString()&&process.nextTick){a=!0;o=function(){process.nextTick(t)}}else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=function(){o=c;s.port1.onmessage=t;t()};var c=function(){s.port2.postMessage(0)};o=function(){setTimeout(t,0);c()}}else o=function(){setTimeout(t,0)};X.runAfter=function(t){u.push(t);if(!i){i=!0;o()}};return X}(),Y=Function.call,J=t(Array.prototype.slice),K=t(Array.prototype.reduce||function(t,e){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)n in this&&(e=t(e,this[n],n));return e}),G=t(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),Q=t(Array.prototype.map||function(t,e){var n=this,r=[];K(n,function(i,o,a){r.push(t.call(e,o,a,n))},void 0);return r}),Z=Object.create||function(t){function e(){}e.prototype=t;return new e},te=t(Object.prototype.hasOwnProperty),ee=Object.keys||function(t){var e=[];for(var n in t)te(t,n)&&e.push(n);return e},ne=t(Object.prototype.toString);z="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var re="From previous event:";l.resolve=l;l.nextTick=X;l.longStackSupport=!1;"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(l.longStackSupport=!0);l.defer=f;f.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):t.resolve(arguments.length>2?J(arguments,1):n)}};l.Promise=p;l.promise=p;p.race=h;p.all=j;p.reject=w;p.resolve=l;l.passByCopy=function(t){return t};d.prototype.passByCopy=function(){return this};l.join=function(t,e){return l(t).join(e)};d.prototype.join=function(t){return l([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})};l.race=h;d.prototype.race=function(){return this.then(l.race)};l.makePromise=d;d.prototype.toString=function(){return"[object Promise]"};d.prototype.then=function(t,e,n){function i(e){try{return"function"==typeof t?t(e):e}catch(n){return w(n)}}function o(t){if("function"==typeof e){r(t,u);try{return e(t)}catch(n){return w(n)}}return w(t)}function a(t){return"function"==typeof n?n(t):t}var u=this,s=f(),c=!1;l.nextTick(function(){u.promiseDispatch(function(t){if(!c){c=!0;s.resolve(i(t))}},"when",[function(t){if(!c){c=!0;s.resolve(o(t))}}])});u.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=a(t)}catch(r){n=!0;if(!l.onerror)throw r;l.onerror(r)}n||s.notify(e)}]);return s.promise};l.tap=function(t,e){return l(t).tap(e)};d.prototype.tap=function(t){t=l(t);return this.then(function(e){return t.fcall(e).thenResolve(e)})};l.when=g;d.prototype.thenResolve=function(t){return this.then(function(){return t})};l.thenResolve=function(t,e){return l(t).thenResolve(e)};d.prototype.thenReject=function(t){return this.then(function(){throw t})};l.thenReject=function(t,e){return l(t).thenReject(e)};l.nearer=v;l.isPromise=y;l.isPromiseAlike=_;l.isPending=m;d.prototype.isPending=function(){return"pending"===this.inspect().state};l.isFulfilled=b;d.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state};l.isRejected=V;d.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ie=[],oe=[],ae=[],ue=!0;l.resetUnhandledRejections=x;l.getUnhandledReasons=function(){return ie.slice()};l.stopUnhandledRejectionTracking=function(){x();ue=!1};x();l.reject=w;l.fulfill=A;l.master=P;l.spread=N;d.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)};l.async=M;l.spawn=W;l["return"]=T;l.promised=L;l.dispatch=S;d.prototype.dispatch=function(t,e){var n=this,r=f();l.nextTick(function(){n.promiseDispatch(r.resolve,t,e)});return r.promise};l.get=function(t,e){return l(t).dispatch("get",[e])};d.prototype.get=function(t){return this.dispatch("get",[t])};l.set=function(t,e,n){return l(t).dispatch("set",[e,n])};d.prototype.set=function(t,e){return this.dispatch("set",[t,e])};l.del=l["delete"]=function(t,e){return l(t).dispatch("delete",[e])};d.prototype.del=d.prototype["delete"]=function(t){return this.dispatch("delete",[t])};l.mapply=l.post=function(t,e,n){return l(t).dispatch("post",[e,n])};d.prototype.mapply=d.prototype.post=function(t,e){return this.dispatch("post",[t,e])};l.send=l.mcall=l.invoke=function(t,e){return l(t).dispatch("post",[e,J(arguments,2)])};d.prototype.send=d.prototype.mcall=d.prototype.invoke=function(t){return this.dispatch("post",[t,J(arguments,1)])};l.fapply=function(t,e){return l(t).dispatch("apply",[void 0,e])};d.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])};l["try"]=l.fcall=function(t){return l(t).dispatch("apply",[void 0,J(arguments,1)])};d.prototype.fcall=function(){return this.dispatch("apply",[void 0,J(arguments)])};l.fbind=function(t){var e=l(t),n=J(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(J(arguments))])}};d.prototype.fbind=function(){var t=this,e=J(arguments);return function(){return t.dispatch("apply",[this,e.concat(J(arguments))])}};l.keys=function(t){return l(t).dispatch("keys",[])};d.prototype.keys=function(){return this.dispatch("keys",[])};l.all=j;d.prototype.all=function(){return j(this)};l.any=D;d.prototype.any=function(){return D(this)};l.allResolved=c(I,"allResolved","allSettled");d.prototype.allResolved=function(){return I(this)};l.allSettled=C;d.prototype.allSettled=function(){return this.then(function(t){return j(Q(t,function(t){function e(){return t.inspect()}t=l(t);return t.then(e,e)}))})};l.fail=l["catch"]=function(t,e){return l(t).then(void 0,e)};d.prototype.fail=d.prototype["catch"]=function(t){return this.then(void 0,t)};l.progress=F;d.prototype.progress=function(t){return this.then(void 0,void 0,t)};l.fin=l["finally"]=function(t,e){return l(t)["finally"](e)};d.prototype.fin=d.prototype["finally"]=function(t){t=l(t);return this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})};l.done=function(t,e,n,r){return l(t).done(e,n,r)};d.prototype.done=function(t,e,n){var i=function(t){l.nextTick(function(){r(t,o);if(!l.onerror)throw t;l.onerror(t)})},o=t||e||n?this.then(t,e,n):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i));o.then(void 0,i)};l.timeout=function(t,e,n){return l(t).timeout(e,n)};d.prototype.timeout=function(t,e){var n=f(),r=setTimeout(function(){if(!e||"string"==typeof e){e=new Error(e||"Timed out after "+t+" ms");e.code="ETIMEDOUT"}n.reject(e)},t);this.then(function(t){clearTimeout(r);n.resolve(t)},function(t){clearTimeout(r);n.reject(t)},n.notify);return n.promise};l.delay=function(t,e){if(void 0===e){e=t;t=void 0}return l(t).delay(e)};d.prototype.delay=function(t){return this.then(function(e){var n=f();setTimeout(function(){n.resolve(e)},t);return n.promise})};l.nfapply=function(t,e){return l(t).nfapply(e)};d.prototype.nfapply=function(t){var e=f(),n=J(t);n.push(e.makeNodeResolver());this.fapply(n).fail(e.reject);return e.promise};l.nfcall=function(t){var e=J(arguments,1);return l(t).nfapply(e)};d.prototype.nfcall=function(){var t=J(arguments),e=f();t.push(e.makeNodeResolver());this.fapply(t).fail(e.reject);return e.promise};l.nfbind=l.denodeify=function(t){var e=J(arguments,1);return function(){var n=e.concat(J(arguments)),r=f();n.push(r.makeNodeResolver());l(t).fapply(n).fail(r.reject);return r.promise}};d.prototype.nfbind=d.prototype.denodeify=function(){var t=J(arguments);t.unshift(this);return l.denodeify.apply(void 0,t)};l.nbind=function(t,e){var n=J(arguments,2);return function(){function r(){return t.apply(e,arguments)}var i=n.concat(J(arguments)),o=f();i.push(o.makeNodeResolver());l(r).fapply(i).fail(o.reject);return o.promise}};d.prototype.nbind=function(){var t=J(arguments,0);t.unshift(this);return l.nbind.apply(void 0,t)};l.nmapply=l.npost=function(t,e,n){return l(t).npost(e,n)};d.prototype.nmapply=d.prototype.npost=function(t,e){var n=J(e||[]),r=f();n.push(r.makeNodeResolver());this.dispatch("post",[t,n]).fail(r.reject);return r.promise};l.nsend=l.nmcall=l.ninvoke=function(t,e){var n=J(arguments,2),r=f();n.push(r.makeNodeResolver());l(t).dispatch("post",[e,n]).fail(r.reject);return r.promise};d.prototype.nsend=d.prototype.nmcall=d.prototype.ninvoke=function(t){var e=J(arguments,1),n=f();e.push(n.makeNodeResolver());this.dispatch("post",[t,e]).fail(n.reject);return n.promise};l.nodeify=q;d.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){l.nextTick(function(){t(null,e)})},function(e){l.nextTick(function(){t(e)})});return void 0};var se=s();return l});define("assetLoader",["spriteSheet","text!assetsList","q"],function(t,e,n){var r={config:{},loaded:{atlas:[],music:[]}};r.config=JSON.parse(e);var i=function(){var e=[];_.forEach(r.config,function(i){var o=n.defer();jQuery.getJSON(i.configuration,function(t){i.configuration=t}).then(function(){var e=new Image;e.src=i.file;e.onload=function(){r.loaded.atlas.push({name:i.name,sprite:new t(i.configuration,e)});o.resolve()}});e.push(o.promise)});return n.all(e)};return{preloadassets:i,assets:r}});define("eventmanager",[""],function(){function t(t,e){topics.hasOwnProperty(t)||(topics[t]=[]);topics[t].push(e);return!0}function e(t,e){if(!topics.hasOwnProperty(t))return!1;for(var n=0,r=topics[t].length;r>n;n++)if(String(topics[t][n])===String(e)){topics[t].splice(n,1);return!0}return!1}function n(){var t=Array.prototype.slice.call(arguments),e=t.shift();if(!topics.hasOwnProperty(e))return!1;for(var n=0,r=topics[e].length;r>n;n++)topics[e][n].apply(void 0,t);return!0}topics={};return{subscribe:t,unsubscrive:e,publish:n,topics:topics}});define("RNG",[],function(){function t(){n(Date.now())}function e(){return c}function n(t){t=1>t?1/t:t;c=t;l=(t>>>0)*d;t=69069*t+1>>>0;f=t*d;t=69069*t+1>>>0;p=t*d;h=1}function r(){var t=2091639*l+h*d;l=f;f=p;h=0|t;p=t-h;return p}function i(t,e){do var n=2*r()-1,i=2*r()-1,o=n*n+i*i;while(o>1||0==o);var a=n*Math.sqrt(-2*Math.log(o)/o);return(t||0)+a*(e||1)}function o(){return 1+Math.floor(100*r())}function a(t){var e=0;for(var n in t)e+=t[n];var i=Math.floor(r()*e),o=0;for(var n in t){o+=t[n];if(o>i)return n}return null}function u(){return[l,f,p,h]}function s(t){l=t[0];f=t[1];p=t[2];h=t[3]}var c,l=0,f=0,p=0,h=0,d=2.3283064365386963e-10;t();return{getSeed:e,setSeed:n,getUniform:r,getNormal:i,getPercentage:o,getWeightedValue:a,getState:u,setState:s}});define("world",["RNG"],function(t){var e=(app.config.terrain.grid.width,app.config.terrain.grid.height,[]);return{grid:e}});define("mapLoader",["q","world"],function(t,e){function n(t){for(var e=[],n=0;n<t.width;n++)e.push(t.data.splice(0,30));return e}var r={};r.load=function(r){var i=t.defer();jQuery.getJSON("maps/"+r+"/"+r+".json").then(function(t){app.config.terrain.grid={width:t.width,height:t.height};app.config.terrain.tileSet=_.findWhere(t.tilesets,{name:"terrain"});_.each(app.config.terrain.tileSet.tiles,function(t){t.image=t.image.split("terrain/").pop()});app.config.actor.grid={width:2*t.width,height:2*t.height};app.config.collision=_.findWhere(t.layers,{name:"collision"});e.grid=n(_.findWhere(t.layers,{name:"tiles"}));i.resolve()});return i.promise};return r});(function(){function t(t,e){if(t!==e){var n=t===t,r=e===e;if(t>e||!n||"undefined"==typeof t&&r)return 1;if(e>t||!r||"undefined"==typeof e&&n)return-1}return 0}function e(t,e,n){if(e!==e)return p(t,n);for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function n(t){return"function"==typeof t||!1}function r(t){return"string"==typeof t?t:null==t?"":t+""}function i(t){return t.charCodeAt(0)}function o(t,e){for(var n=-1,r=t.length;++n<r&&e.indexOf(t.charAt(n))>-1;);return n}function a(t,e){for(var n=t.length;n--&&e.indexOf(t.charAt(n))>-1;);return n}function u(e,n){return t(e.criteria,n.criteria)||e.index-n.index}function s(e,n,r){for(var i=-1,o=e.criteria,a=n.criteria,u=o.length,s=r.length;++i<u;){var c=t(o[i],a[i]);if(c)return i>=s?c:r[i]?c:-1*c}return e.index-n.index}function c(t){return Ce[t]}function l(t){return Fe[t]}function f(t){return"\\"+Be[t]}function p(t,e,n){for(var r=t.length,i=e+(n?0:-1);n?i--:++i<r;){var o=t[i];if(o!==o)return i}return-1}function h(t){return t&&"object"==typeof t||!1}function d(t){return 160>=t&&t>=9&&13>=t||32==t||160==t||5760==t||6158==t||t>=8192&&(8202>=t||8232==t||8233==t||8239==t||8287==t||12288==t||65279==t)}function g(t,e){for(var n=-1,r=t.length,i=-1,o=[];++n<r;)if(t[n]===e){t[n]=q;o[++i]=n}return o}function v(t,e){for(var n,r=-1,i=t.length,o=-1,a=[];++r<i;){var u=t[r],s=e?e(u,r,t):u;if(!r||n!==s){n=s;a[++o]=u}}return a}function y(t){for(var e=-1,n=t.length;++e<n&&d(t.charCodeAt(e)););return e}function _(t){for(var e=t.length;e--&&d(t.charCodeAt(e)););return e}function m(t){return qe[t]}function b(d){function X(t){if(h(t)&&!es(t)&&!(t instanceof Ce)){if(t instanceof Z)return t;if(ou.call(t,"__chain__")&&ou.call(t,"__wrapped__"))return Fr(t)}return new Z(t)}function G(){}function Z(t,e,n){this.__wrapped__=t;this.__actions__=n||[];this.__chain__=!!e}function Ce(t){this.__wrapped__=t;this.__actions__=null;this.__dir__=1;this.__dropCount__=0;this.__filtered__=!1;this.__iteratees__=null;this.__takeCount__=ju;this.__views__=null}function Fe(){var t=this.__actions__,e=this.__iteratees__,n=this.__views__,r=new Ce(this.__wrapped__);r.__actions__=t?Qe(t):null;r.__dir__=this.__dir__;r.__dropCount__=this.__dropCount__;r.__filtered__=this.__filtered__;r.__iteratees__=e?Qe(e):null;r.__takeCount__=this.__takeCount__;r.__views__=n?Qe(n):null;return r}function qe(){if(this.__filtered__){var t=new Ce(this);t.__dir__=-1;t.__filtered__=!0}else{t=this.clone();t.__dir__*=-1}return t}function Ee(){var t=this.__wrapped__.value();if(!es(t))return Qn(t,this.__actions__);var e=this.__dir__,n=0>e,r=xr(0,t.length,this.__views__),i=r.start,o=r.end,a=o-i,u=this.__dropCount__,s=Nu(a,this.__takeCount__),c=n?o:i-1,l=this.__iteratees__,f=l?l.length:0,p=0,h=[];t:for(;a--&&s>p;){c+=e;for(var d=-1,g=t[c];++d<f;){var v=l[d],y=v.iteratee,_=v.type;if(_!=D)var m=y(g);else{v.done=v.done&&(n?c<v.index:c>v.index);v.index=c;m=v.done||(v.done=!y(g))}if(_==I)g=m;else if(!m){if(_==C)break t;continue t}}u?u--:h[p++]=g}return h}function Be(){this.__data__={}}function Ue(t){return this.has(t)&&delete this.__data__[t]}function ze(t){return"__proto__"==t?V:this.__data__[t]}function He(t){return"__proto__"!=t&&ou.call(this.__data__,t)}function $e(t,e){"__proto__"!=t&&(this.__data__[t]=e);return this}function Xe(t){var e=t?t.length:0;this.data={hash:wu(null),set:new _u};for(;e--;)this.push(t[e])}function Ke(t,e){var n=t.data,r="string"==typeof e||Mo(e)?n.set.has(e):n.hash[e];return r?0:-1}function Ge(t){var e=this.data;"string"==typeof t||Mo(t)?e.set.add(t):e.hash[t]=!0}function Qe(t,e){var n=-1,r=t.length;e||(e=za(r));for(;++n<r;)e[n]=t[n];return e}function Ze(t,e){for(var n=-1,r=t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function tn(t,e){for(var n=t.length;n--&&e(t[n],n,t)!==!1;);return t}function en(t,e){for(var n=-1,r=t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function nn(t,e){for(var n=-1,r=t.length,i=-1,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[++i]=a)}return o}function rn(t,e){for(var n=-1,r=t.length,i=za(r);++n<r;)i[n]=e(t[n],n,t);return i}function on(t){for(var e=-1,n=t.length,r=Su;++e<n;){var i=t[e];i>r&&(r=i)}return r}function an(t){for(var e=-1,n=t.length,r=ju;++e<n;){var i=t[e];r>i&&(r=i)}return r}function un(t,e,n,r){var i=-1,o=t.length;r&&o&&(n=t[++i]);for(;++i<o;)n=e(n,t[i],i,t);return n}function sn(t,e,n,r){var i=t.length;r&&i&&(n=t[--i]);for(;i--;)n=e(n,t[i],i,t);return n}function cn(t,e){for(var n=-1,r=t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function ln(t,e){return"undefined"==typeof t?e:t}function fn(t,e,n,r){return"undefined"!=typeof t&&ou.call(r,n)?t:e}function pn(t,e,n){var r=as(e);if(!n)return dn(e,t,r);for(var i=-1,o=r.length;++i<o;){var a=r[i],u=t[a],s=n(u,e[a],a,t,e);(s===s?s===u:u!==u)&&("undefined"!=typeof u||a in t)||(t[a]=s)}return t}function hn(t,e){for(var n=-1,r=t.length,i=Nr(r),o=e.length,a=za(o);++n<o;){var u=e[n];if(i){u=parseFloat(u);a[n]=kr(u,r)?t[u]:V}else a[n]=t[u]}return a}function dn(t,e,n){if(!n){n=e;e={}}for(var r=-1,i=n.length;++r<i;){var o=n[r];e[o]=t[o]}return e}function gn(t,e){for(var n=-1,r=e.length;++n<r;){var i=e[n];t[i]=gr(t[i],O,t)}return t}function vn(t,e,n){var r=typeof t;return"function"==r?"undefined"!=typeof e&&Ar(t)?er(t,e,n):t:null==t?Wa:"object"==r?Cn(t):"undefined"==typeof e?Bn(t+""):Fn(t+"",e)}function yn(t,e,n,r,i,o,a){var u;n&&(u=i?n(t,r,i):n(t));if("undefined"!=typeof u)return u;if(!Mo(t))return t;var s=es(t);if(s){u=Or(t);if(!e)return Qe(t,u)}else{var c=uu.call(t),l=c==$;if(c!=J&&c!=E&&(!l||i))return De[c]?wr(t,c,e):i?t:{};u=Rr(l?{}:t);if(!e)return dn(t,u,as(t))}o||(o=[]);a||(a=[]);for(var f=o.length;f--;)if(o[f]==t)return a[f];o.push(t);a.push(u);(s?Ze:Mn)(t,function(r,i){u[i]=yn(r,e,n,i,t,o,a)});return u}function _n(t,e,n,r){if("function"!=typeof t)throw new Za(F);return mu(function(){t.apply(V,$n(n,r))},e)}function mn(t,n){var r=t?t.length:0,i=[];if(!r)return i;var o=-1,a=Vr(),u=a==e,s=u&&n.length>=200?Hu(n):null,c=n.length;if(s){a=Ke;u=!1;n=s}t:for(;++o<r;){var l=t[o];if(u&&l===l){for(var f=c;f--;)if(n[f]===l)continue t;i.push(l)}else a(n,l,0)<0&&i.push(l)}return i}function bn(t,e){var n=t?t.length:0;if(!Nr(n))return Mn(t,e);for(var r=-1,i=Cr(t);++r<n&&e(i[r],r,i)!==!1;);return t}function Vn(t,e){var n=t?t.length:0;if(!Nr(n))return Wn(t,e);for(var r=Cr(t);n--&&e(r[n],n,r)!==!1;);return t}function xn(t,e){var n=!0;bn(t,function(t,r,i){n=!!e(t,r,i);return n});return n}function On(t,e,n,r){var i=t.length;n=null==n?0:+n||0;0>n&&(n=-n>i?0:i+n);r="undefined"==typeof r||r>i?i:+r||0;0>r&&(r+=i);i=n>r?0:r>>>0;n>>>=0;for(;i>n;)t[n++]=e;return t}function Rn(t,e){var n=[];bn(t,function(t,r,i){e(t,r,i)&&n.push(t)});return n}function wn(t,e,n,r){var i;n(t,function(t,n,o){if(e(t,n,o)){i=r?n:t;return!1}});return i}function An(t,e,n,r){for(var i=r-1,o=t.length,a=-1,u=[];++i<o;){var s=t[i];if(h(s)&&Nr(s.length)&&(es(s)||Oo(s))){e&&(s=An(s,e,n,0));var c=-1,l=s.length;u.length+=l;for(;++c<l;)u[++a]=s[c]}else n||(u[++a]=s)}return u}function kn(t,e,n){for(var r=-1,i=Cr(t),o=n(t),a=o.length;++r<a;){var u=o[r];if(e(i[u],u,i)===!1)break}return t}function Pn(t,e,n){for(var r=Cr(t),i=n(t),o=i.length;o--;){var a=i[o];if(e(r[a],a,r)===!1)break}return t}function Nn(t,e){return kn(t,e,Zo)}function Mn(t,e){return kn(t,e,as)}function Wn(t,e){return Pn(t,e,as)}function Tn(t,e){for(var n=-1,r=e.length,i=-1,o=[];++n<r;){var a=e[n];rs(t[a])&&(o[++i]=a)}return o}function Ln(t,e,n){var r=-1,i="function"==typeof e,o=t?t.length:0,a=Nr(o)?za(o):[];bn(t,function(t){var o=i?e:null!=t&&t[e];a[++r]=o?o.apply(t,n):V});return a}function Sn(t,e,n,r,i,o){if(t===e)return 0!==t||1/t==1/e;var a=typeof t,u=typeof e;return"function"!=a&&"object"!=a&&"function"!=u&&"object"!=u||null==t||null==e?t!==t&&e!==e:jn(t,e,Sn,n,r,i,o)}function jn(t,e,n,r,i,o,a){var u=es(t),s=es(e),c=B,l=B;if(!u){c=uu.call(t);c==E?c=J:c!=J&&(u=Co(t))}if(!s){l=uu.call(e);l==E?l=J:l!=J&&(s=Co(e))}var f=c==J,p=l==J,h=c==l;if(h&&!u&&!f)return yr(t,e,c);var d=f&&ou.call(t,"__wrapped__"),g=p&&ou.call(e,"__wrapped__");if(d||g)return n(d?t.value():t,g?e.value():e,r,i,o,a);if(!h)return!1;o||(o=[]);a||(a=[]);for(var v=o.length;v--;)if(o[v]==t)return a[v]==e;o.push(t);a.push(e);var y=(u?vr:_r)(t,e,n,r,i,o,a);o.pop();a.pop();return y}function Dn(t,e,n,r,i){var o=e.length;if(null==t)return!o;for(var a=-1,u=!i;++a<o;)if(u&&r[a]?n[a]!==t[e[a]]:!ou.call(t,e[a]))return!1;a=-1;for(;++a<o;){var s=e[a];if(u&&r[a])var c=ou.call(t,s);else{var l=t[s],f=n[a];c=i?i(l,f,s):V;"undefined"==typeof c&&(c=Sn(f,l,i,!0))}if(!c)return!1}return!0}function In(t,e){var n=[];bn(t,function(t,r,i){n.push(e(t,r,i))});return n}function Cn(t){var e=as(t),n=e.length;if(1==n){var r=e[0],i=t[r];if(Mr(i))return function(t){return null!=t&&t[r]===i&&ou.call(t,r)}}for(var o=za(n),a=za(n);n--;){i=t[e[n]];o[n]=i;a[n]=Mr(i)}return function(t){return Dn(t,e,o,a)}}function Fn(t,e){return Mr(e)?function(n){return null!=n&&n[t]===e}:function(n){return null!=n&&Sn(e,n[t],null,!0)}}function qn(t,e,n,r,i){if(!Mo(t))return t;var o=Nr(e.length)&&(es(e)||Co(e));(o?Ze:Mn)(e,function(e,a,u){if(h(e)){r||(r=[]);i||(i=[]);return En(t,u,a,qn,n,r,i)}var s=t[a],c=n?n(s,e,a,t,u):V,l="undefined"==typeof c;l&&(c=e);!o&&"undefined"==typeof c||!l&&(c===c?c===s:s!==s)||(t[a]=c)});return t}function En(t,e,n,r,i,o,a){for(var u=o.length,s=e[n];u--;)if(o[u]==s){t[n]=a[u];return}var c=t[n],l=i?i(c,s,n,t,e):V,f="undefined"==typeof l;if(f){l=s;Nr(s.length)&&(es(s)||Co(s))?l=es(c)?c:c?Qe(c):[]:is(s)||Oo(s)?l=Oo(c)?Eo(c):is(c)?c:{}:f=!1}o.push(s);a.push(l);f?t[n]=r(l,s,i,o,a):(l===l?l!==c:c===c)&&(t[n]=l)}function Bn(t){return function(e){return null==e?V:e[t]}}function Un(e,n){var r=n.length,i=hn(e,n);n.sort(t);for(;r--;){var o=parseFloat(n[r]);if(o!=a&&kr(o)){var a=o;bu.call(e,o,1)}}return i}function zn(t,e){return t+du(Lu()*(e-t+1))}function Hn(t,e,n,r,i){i(t,function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)});return n}function $n(t,e,n){var r=-1,i=t.length;e=null==e?0:+e||0;0>e&&(e=-e>i?0:i+e);n="undefined"==typeof n||n>i?i:+n||0;0>n&&(n+=i);i=e>n?0:n-e>>>0;e>>>=0;for(var o=za(i);++r<i;)o[r]=t[r+e];return o}function Xn(t,e){var n;bn(t,function(t,r,i){n=e(t,r,i);return!n});return!!n}function Yn(t,e){var n=t.length;t.sort(e);for(;n--;)t[n]=t[n].value;return t}function Jn(t,e,n){var r=-1,i=t.length,o=Nr(i)?za(i):[];bn(t,function(t){for(var n=e.length,i=za(n);n--;)i[n]=null==t?V:t[e[n]];o[++r]={criteria:i,index:r,value:t}});return Yn(o,function(t,e){return s(t,e,n)})}function Kn(t,n){var r=-1,i=Vr(),o=t.length,a=i==e,u=a&&o>=200,s=u?Hu():null,c=[];if(s){i=Ke;a=!1}else{u=!1;s=n?[]:c}t:for(;++r<o;){var l=t[r],f=n?n(l,r,t):l;if(a&&l===l){for(var p=s.length;p--;)if(s[p]===f)continue t;n&&s.push(f);c.push(l)}else if(i(s,f,0)<0){(n||u)&&s.push(f);c.push(l)}}return c}function Gn(t,e){for(var n=-1,r=e.length,i=za(r);++n<r;)i[n]=t[e[n]];return i}function Qn(t,e){var n=t;n instanceof Ce&&(n=n.value());for(var r=-1,i=e.length;++r<i;){var o=[n],a=e[r];vu.apply(o,a.args);n=a.func.apply(a.thisArg,o)}return n}function Zn(t,e,n){var r=0,i=t?t.length:r;if("number"==typeof e&&e===e&&Cu>=i){for(;i>r;){var o=r+i>>>1,a=t[o];(n?e>=a:e>a)?r=o+1:i=o}return i}return tr(t,e,Wa,n)}function tr(t,e,n,r){e=n(e);for(var i=0,o=t?t.length:0,a=e!==e,u="undefined"==typeof e;o>i;){var s=du((i+o)/2),c=n(t[s]),l=c===c;if(a)var f=l||r;else f=u?l&&(r||"undefined"!=typeof c):r?e>=c:e>c;f?i=s+1:o=s}return Nu(o,Iu)}function er(t,e,n){if("function"!=typeof t)return Wa;if("undefined"==typeof e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)};case 5:return function(n,r,i,o,a){return t.call(e,n,r,i,o,a)}}return function(){return t.apply(e,arguments)}}function nr(t){return fu.call(t,0)}function rr(t,e,n){for(var r=n.length,i=-1,o=Pu(t.length-r,0),a=-1,u=e.length,s=za(o+u);++a<u;)s[a]=e[a];for(;++i<r;)s[n[i]]=t[i];for(;o--;)s[a++]=t[i++];return s}function ir(t,e,n){for(var r=-1,i=n.length,o=-1,a=Pu(t.length-i,0),u=-1,s=e.length,c=za(a+s);++o<a;)c[o]=t[o];for(var l=o;++u<s;)c[l+u]=e[u];for(;++r<i;)c[l+n[r]]=t[o++];return c}function or(t,e){return function(n,r,i){var o=e?e():{};r=br(r,i,3);if(es(n))for(var a=-1,u=n.length;++a<u;){var s=n[a];t(o,s,r(s,a,n),n)}else bn(n,function(e,n,i){t(o,e,r(e,n,i),i)});return o}}function ar(t){return function(){var e=arguments,n=e.length,r=e[0];if(2>n||null==r)return r;var i=e[n-2],o=e[n-1],a=e[3];if(n>3&&"function"==typeof i){i=er(i,o,5);n-=2}else{i=n>2&&"function"==typeof o?o:null;n-=i?1:0}if(a&&Pr(e[1],e[2],a)){i=3==n?null:i;n=2}for(var u=0;++u<n;){var s=e[u];s&&t(r,s,i)}return r}}function ur(t,e){function n(){return(this instanceof n?r:t).apply(e,arguments)}var r=lr(t);return n}function sr(t){return function(){var e=arguments.length,n=e,r=t?e-1:0;if(!e)return function(){return arguments[0]};for(var i=za(e);n--;){i[n]=arguments[n];if("function"!=typeof i[n])throw new Za(F)}return function(){for(var n=r,o=i[n].apply(this,arguments);t?n--:++n<e;)o=i[n].call(this,o);
return o}}}function cr(t){return function(e){for(var n=-1,r=ka(fa(e)),i=r.length,o="";++n<i;)o=t(o,r[n],n);return o}}function lr(t){return function(){var e=Uu(t.prototype),n=t.apply(e,arguments);return Mo(n)?n:e}}function fr(t,e){return function(n,r,o){o&&Pr(n,r,o)&&(r=null);var a=br(),u=null==r;if(a!==vn||!u){u=!1;r=a(r,o,3)}if(u){var s=es(n);if(s||!Io(n))return t(s?n:Ir(n));r=i}return mr(n,r,e)}}function pr(t,e,n,r,i,o,a,u,s,c){function l(){for(var b=arguments.length,V=b,x=za(b);V--;)x[V]=arguments[V];r&&(x=rr(x,r,i));o&&(x=ir(x,o,a));if(d||y){var w=l.placeholder,A=g(x,w);b-=A.length;if(c>b){var k=u?Qe(u):null,M=Pu(c-b,0),W=d?A:null,T=d?null:A,L=d?x:null,S=d?null:x;e|=d?P:N;e&=~(d?N:P);v||(e&=~(O|R));var j=pr(t,e,n,L,W,S,T,k,s,M);j.placeholder=w;return j}}var D=p?n:this;h&&(t=D[m]);u&&(x=Sr(x,u));f&&s<x.length&&(x.length=s);return(this instanceof l?_||lr(t):t).apply(D,x)}var f=e&W,p=e&O,h=e&R,d=e&A,v=e&w,y=e&k,_=!h&&lr(t),m=t;return l}function hr(t,e,n){var r=t.length;e=+e;if(r>=e||!Au(e))return"";var i=e-r;n=null==n?" ":n+"";return ma(n,pu(i/n.length)).slice(0,i)}function dr(t,e,n,r){function i(){for(var e=-1,u=arguments.length,s=-1,c=r.length,l=za(u+c);++s<c;)l[s]=r[s];for(;u--;)l[s++]=arguments[++e];return(this instanceof i?a:t).apply(o?n:this,l)}var o=e&O,a=lr(t);return i}function gr(t,e,n,r,i,o,a,u){var s=e&R;if(!s&&"function"!=typeof t)throw new Za(F);var c=r?r.length:0;if(!c){e&=~(P|N);r=i=null}c-=i?i.length:0;if(e&N){var l=r,f=i;r=i=null}var p=!s&&$u(t),h=[t,e,n,r,i,l,f,o,a,u];if(p&&p!==!0){Wr(h,p);e=h[1];u=h[9]}h[9]=null==u?s?0:t.length:Pu(u-c,0)||0;if(e==O)var d=ur(h[0],h[2]);else d=e!=P&&e!=(O|P)||h[4].length?pr.apply(V,h):dr.apply(V,h);var g=p?zu:Xu;return g(d,h)}function vr(t,e,n,r,i,o,a){var u=-1,s=t.length,c=e.length,l=!0;if(s!=c&&!(i&&c>s))return!1;for(;l&&++u<s;){var f=t[u],p=e[u];l=V;r&&(l=i?r(p,f,u):r(f,p,u));if("undefined"==typeof l)if(i)for(var h=c;h--;){p=e[h];l=f&&f===p||n(f,p,r,i,o,a);if(l)break}else l=f&&f===p||n(f,p,r,i,o,a)}return!!l}function yr(t,e,n){switch(n){case U:case z:return+t==+e;case H:return t.name==e.name&&t.message==e.message;case Y:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case K:case Q:return t==e+""}return!1}function _r(t,e,n,r,i,o,a){var u=as(t),s=u.length,c=as(e),l=c.length;if(s!=l&&!i)return!1;for(var f,p=-1;++p<s;){var h=u[p],d=ou.call(e,h);if(d){var g=t[h],v=e[h];d=V;r&&(d=i?r(v,g,h):r(g,v,h));"undefined"==typeof d&&(d=g&&g===v||n(g,v,r,i,o,a))}if(!d)return!1;f||(f="constructor"==h)}if(!f){var y=t.constructor,_=e.constructor;if(y!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _))return!1}return!0}function mr(t,e,n){var r=n?ju:Su,i=r,o=i;bn(t,function(t,a,u){var s=e(t,a,u);if((n?i>s:s>i)||s===r&&s===o){i=s;o=t}});return o}function br(t,e,n){var r=X.callback||Na;r=r===Na?vn:r;return n?r(t,e,n):r}function Vr(t,n,r){var i=X.indexOf||Zr;i=i===Zr?e:i;return t?i(t,n,r):i}function xr(t,e,n){for(var r=-1,i=n?n.length:0;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Nu(e,t+a);break;case"takeRight":t=Pu(t,e-a)}}return{start:t,end:e}}function Or(t){var e=t.length,n=new t.constructor(e);if(e&&"string"==typeof t[0]&&ou.call(t,"index")){n.index=t.index;n.input=t.input}return n}function Rr(t){var e=t.constructor;"function"==typeof e&&e instanceof e||(e=Ka);return new e}function wr(t,e,n){var r=t.constructor;switch(e){case te:return nr(t);case U:case z:return new r(+t);case ee:case ne:case re:case ie:case oe:case ae:case ue:case se:case ce:var i=t.buffer;return new r(n?nr(i):i,t.byteOffset,t.length);case Y:case Q:return new r(t);case K:var o=new r(t.source,Ve.exec(t));o.lastIndex=t.lastIndex}return o}function Ar(t){var e=X.support,n=!(e.funcNames?t.name:e.funcDecomp);if(!n){var r=ru.call(t);e.funcNames||(n=!xe.test(r));if(!n){n=Ne.test(r)||Lo(t);zu(t,n)}}return n}function kr(t,e){t=+t;e=null==e?qu:e;return t>-1&&t%1==0&&e>t}function Pr(t,e,n){if(!Mo(n))return!1;var r=typeof e;if("number"==r)var i=n.length,o=Nr(i)&&kr(e,i);else o="string"==r&&e in n;if(o){var a=n[e];return t===t?t===a:a!==a}return!1}function Nr(t){return"number"==typeof t&&t>-1&&t%1==0&&qu>=t}function Mr(t){return t===t&&(0===t?1/t>0:!Mo(t))}function Wr(t,e){var n=t[1],r=e[1],i=n|r,o=W|M,a=O|R,u=o|a|w|k,s=n&W&&!(r&W),c=n&M&&!(r&M),l=(c?t:e)[7],f=(s?t:e)[8],p=!(n>=M&&r>a||n>a&&r>=M),h=i>=o&&u>=i&&(M>n||(c||s)&&l.length<=f);if(!p&&!h)return t;if(r&O){t[2]=e[2];i|=n&O?0:w}var d=e[3];if(d){var v=t[3];t[3]=v?rr(v,d,e[4]):Qe(d);t[4]=v?g(t[3],q):Qe(e[4])}d=e[5];if(d){v=t[5];t[5]=v?ir(v,d,e[6]):Qe(d);t[6]=v?g(t[5],q):Qe(e[6])}d=e[7];d&&(t[7]=Qe(d));r&W&&(t[8]=null==t[8]?e[8]:Nu(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0];t[1]=i;return t}function Tr(t,e){t=Cr(t);for(var n=-1,r=e.length,i={};++n<r;){var o=e[n];o in t&&(i[o]=t[o])}return i}function Lr(t,e){var n={};Nn(t,function(t,r,i){e(t,r,i)&&(n[r]=t)});return n}function Sr(t,e){for(var n=t.length,r=Nu(e.length,n),i=Qe(t);r--;){var o=e[r];t[r]=kr(o,n)?i[o]:V}return t}function jr(t){{var e;X.support}if(!h(t)||uu.call(t)!=J||!ou.call(t,"constructor")&&(e=t.constructor,"function"==typeof e&&!(e instanceof e)))return!1;var n;Nn(t,function(t,e){n=e});return"undefined"==typeof n||ou.call(t,n)}function Dr(t){for(var e=Zo(t),n=e.length,r=n&&t.length,i=X.support,o=r&&Nr(r)&&(es(t)||i.nonEnumArgs&&Oo(t)),a=-1,u=[];++a<n;){var s=e[a];(o&&kr(s,r)||ou.call(t,s))&&u.push(s)}return u}function Ir(t){return null==t?[]:Nr(t.length)?Mo(t)?t:Ka(t):aa(t)}function Cr(t){return Mo(t)?t:Ka(t)}function Fr(t){return t instanceof Ce?t.clone():new Z(t.__wrapped__,t.__chain__,Qe(t.__actions__))}function qr(t,e,n){e=(n?Pr(t,e,n):null==e)?1:Pu(+e||1,1);for(var r=0,i=t?t.length:0,o=-1,a=za(pu(i/e));i>r;)a[++o]=$n(t,r,r+=e);return a}function Er(t){for(var e=-1,n=t?t.length:0,r=-1,i=[];++e<n;){var o=t[e];o&&(i[++r]=o)}return i}function Br(){for(var t=arguments,e=-1,n=t.length;++e<n;){var r=t[e];if(es(r)||Oo(r))break}return mn(r,An(t,!1,!0,++e))}function Ur(t,e,n){var r=t?t.length:0;if(!r)return[];(n?Pr(t,e,n):null==e)&&(e=1);return $n(t,0>e?0:e)}function zr(t,e,n){var r=t?t.length:0;if(!r)return[];(n?Pr(t,e,n):null==e)&&(e=1);e=r-(+e||0);return $n(t,0,0>e?0:e)}function Hr(t,e,n){var r=t?t.length:0;if(!r)return[];e=br(e,n,3);for(;r--&&e(t[r],r,t););return $n(t,0,r+1)}function $r(t,e,n){var r=t?t.length:0;if(!r)return[];var i=-1;e=br(e,n,3);for(;++i<r&&e(t[i],i,t););return $n(t,i)}function Xr(t,e,n,r){var i=t?t.length:0;if(!i)return[];if(n&&"number"!=typeof n&&Pr(t,e,n)){n=0;r=i}return On(t,e,n,r)}function Yr(t,e,n){var r=-1,i=t?t.length:0;e=br(e,n,3);for(;++r<i;)if(e(t[r],r,t))return r;return-1}function Jr(t,e,n){var r=t?t.length:0;e=br(e,n,3);for(;r--;)if(e(t[r],r,t))return r;return-1}function Kr(t){return t?t[0]:V}function Gr(t,e,n){var r=t?t.length:0;n&&Pr(t,e,n)&&(e=!1);return r?An(t,e,!1,0):[]}function Qr(t){var e=t?t.length:0;return e?An(t,!0,!1,0):[]}function Zr(t,n,r){var i=t?t.length:0;if(!i)return-1;if("number"==typeof r)r=0>r?Pu(i+r,0):r;else if(r){var o=Zn(t,n),a=t[o];return(n===n?n===a:a!==a)?o:-1}return e(t,n,r||0)}function ti(t){return zr(t,1)}function ei(){for(var t=[],n=-1,r=arguments.length,i=[],o=Vr(),a=o==e;++n<r;){var u=arguments[n];if(es(u)||Oo(u)){t.push(u);i.push(a&&u.length>=120?Hu(n&&u):null)}}r=t.length;var s=t[0],c=-1,l=s?s.length:0,f=[],p=i[0];t:for(;++c<l;){u=s[c];if((p?Ke(p,u):o(f,u,0))<0){n=r;for(;--n;){var h=i[n];if((h?Ke(h,u):o(t[n],u,0))<0)continue t}p&&p.push(u);f.push(u)}}return f}function ni(t){var e=t?t.length:0;return e?t[e-1]:V}function ri(t,e,n){var r=t?t.length:0;if(!r)return-1;var i=r;if("number"==typeof n)i=(0>n?Pu(r+n,0):Nu(n||0,r-1))+1;else if(n){i=Zn(t,e,!0)-1;var o=t[i];return(e===e?e===o:o!==o)?i:-1}if(e!==e)return p(t,i,!0);for(;i--;)if(t[i]===e)return i;return-1}function ii(){var t=arguments,e=t[0];if(!e||!e.length)return e;for(var n=0,r=Vr(),i=t.length;++n<i;)for(var o=0,a=t[n];(o=r(e,a,o))>-1;)bu.call(e,o,1);return e}function oi(t){return Un(t||[],An(arguments,!1,!1,1))}function ai(t,e,n){var r=-1,i=t?t.length:0,o=[];e=br(e,n,3);for(;++r<i;){var a=t[r];if(e(a,r,t)){o.push(a);bu.call(t,r--,1);i--}}return o}function ui(t){return Ur(t,1)}function si(t,e,n){var r=t?t.length:0;if(!r)return[];if(n&&"number"!=typeof n&&Pr(t,e,n)){e=0;n=r}return $n(t,e,n)}function ci(t,e,n,r){var i=br(n);return i===vn&&null==n?Zn(t,e):tr(t,e,i(n,r,1))}function li(t,e,n,r){var i=br(n);return i===vn&&null==n?Zn(t,e,!0):tr(t,e,i(n,r,1),!0)}function fi(t,e,n){var r=t?t.length:0;if(!r)return[];(n?Pr(t,e,n):null==e)&&(e=1);return $n(t,0,0>e?0:e)}function pi(t,e,n){var r=t?t.length:0;if(!r)return[];(n?Pr(t,e,n):null==e)&&(e=1);e=r-(+e||0);return $n(t,0>e?0:e)}function hi(t,e,n){var r=t?t.length:0;if(!r)return[];e=br(e,n,3);for(;r--&&e(t[r],r,t););return $n(t,r+1)}function di(t,e,n){var r=t?t.length:0;if(!r)return[];var i=-1;e=br(e,n,3);for(;++i<r&&e(t[i],i,t););return $n(t,0,i)}function gi(){return Kn(An(arguments,!1,!0,0))}function vi(t,n,r,i){var o=t?t.length:0;if(!o)return[];if(null!=n&&"boolean"!=typeof n){i=r;r=Pr(t,n,i)?null:n;n=!1}var a=br();(a!==vn||null!=r)&&(r=a(r,i,3));return n&&Vr()==e?v(t,r):Kn(t,r)}function yi(t){for(var e=-1,n=(t&&t.length&&on(rn(t,iu)))>>>0,r=za(n);++e<n;)r[e]=rn(t,Bn(e));return r}function _i(t){return mn(t,$n(arguments,1))}function mi(){for(var t=-1,e=arguments.length;++t<e;){var n=arguments[t];if(es(n)||Oo(n))var r=r?mn(r,n).concat(mn(n,r)):n}return r?Kn(r):[]}function bi(){for(var t=arguments.length,e=za(t);t--;)e[t]=arguments[t];return yi(e)}function Vi(t,e){var n=-1,r=t?t.length:0,i={};!r||e||es(t[0])||(e=[]);for(;++n<r;){var o=t[n];e?i[o]=e[n]:o&&(i[o[0]]=o[1])}return i}function xi(t){var e=X(t);e.__chain__=!0;return e}function Oi(t,e,n){e.call(n,t);return t}function Ri(t,e,n){return e.call(n,t)}function wi(){return xi(this)}function Ai(){return new Z(this.value(),this.__chain__)}function ki(t){for(var e,n=this;n instanceof G;){var r=Fr(n);e?i.__wrapped__=r:e=r;var i=r;n=n.__wrapped__}i.__wrapped__=t;return e}function Pi(){var t=this.__wrapped__;if(t instanceof Ce){this.__actions__.length&&(t=new Ce(this));return new Z(t.reverse(),this.__chain__)}return this.thru(function(t){return t.reverse()})}function Ni(){return this.value()+""}function Mi(){return Qn(this.__wrapped__,this.__actions__)}function Wi(t){var e=t?t.length:0;Nr(e)&&(t=Ir(t));return hn(t,An(arguments,!1,!1,1))}function Ti(t,e,n){var r=es(t)?en:xn;("function"!=typeof e||"undefined"!=typeof n)&&(e=br(e,n,3));return r(t,e)}function Li(t,e,n){var r=es(t)?nn:Rn;e=br(e,n,3);return r(t,e)}function Si(t,e,n){if(es(t)){var r=Yr(t,e,n);return r>-1?t[r]:V}e=br(e,n,3);return wn(t,e,bn)}function ji(t,e,n){e=br(e,n,3);return wn(t,e,Vn)}function Di(t,e){return Si(t,Cn(e))}function Ii(t,e,n){return"function"==typeof e&&"undefined"==typeof n&&es(t)?Ze(t,e):bn(t,er(e,n,3))}function Ci(t,e,n){return"function"==typeof e&&"undefined"==typeof n&&es(t)?tn(t,e):Vn(t,er(e,n,3))}function Fi(t,e,n){var r=t?t.length:0;if(!Nr(r)){t=aa(t);r=t.length}if(!r)return!1;n="number"==typeof n?0>n?Pu(r+n,0):n||0:0;return"string"==typeof t||!es(t)&&Io(t)?r>n&&t.indexOf(e,n)>-1:Vr(t,e,n)>-1}function qi(t,e){return Ln(t,e,$n(arguments,2))}function Ei(t,e,n){var r=es(t)?rn:In;e=br(e,n,3);return r(t,e)}function Bi(t,e){return Ei(t,Bn(e))}function Ui(t,e,n,r){var i=es(t)?un:Hn;return i(t,br(e,r,4),n,arguments.length<3,bn)}function zi(t,e,n,r){var i=es(t)?sn:Hn;return i(t,br(e,r,4),n,arguments.length<3,Vn)}function Hi(t,e,n){var r=es(t)?nn:Rn;e=br(e,n,3);return r(t,function(t,n,r){return!e(t,n,r)})}function $i(t,e,n){if(n?Pr(t,e,n):null==e){t=Ir(t);var r=t.length;return r>0?t[zn(0,r-1)]:V}var i=Xi(t);i.length=Nu(0>e?0:+e||0,i.length);return i}function Xi(t){t=Ir(t);for(var e=-1,n=t.length,r=za(n);++e<n;){var i=zn(0,e);e!=i&&(r[e]=r[i]);r[i]=t[e]}return r}function Yi(t){var e=t?t.length:0;return Nr(e)?e:as(t).length}function Ji(t,e,n){var r=es(t)?cn:Xn;("function"!=typeof e||"undefined"!=typeof n)&&(e=br(e,n,3));return r(t,e)}function Ki(t,e,n){if(null==t)return[];var r=-1,i=t.length,o=Nr(i)?za(i):[];n&&Pr(t,e,n)&&(e=null);e=br(e,n,3);bn(t,function(t,n,i){o[++r]={criteria:e(t,n,i),index:r,value:t}});return Yn(o,u)}function Gi(t){if(null==t)return[];var e=arguments,n=e[3];n&&Pr(e[1],e[2],n)&&(e=[t,e[1]]);return Jn(t,An(e,!1,!1,1),[])}function Qi(t,e,n,r){if(null==t)return[];r&&Pr(e,n,r)&&(n=null);es(e)||(e=null==e?[]:[e]);es(n)||(n=null==n?[]:[n]);return Jn(t,e,n)}function Zi(t,e){return Li(t,Cn(e))}function to(t,e){if("function"!=typeof e){if("function"!=typeof t)throw new Za(F);var n=t;t=e;e=n}t=Au(t=+t)?t:0;return function(){return--t<1?e.apply(this,arguments):void 0}}function eo(t,e,n){n&&Pr(t,e,n)&&(e=null);e=t&&null==e?t.length:Pu(+e||0,0);return gr(t,W,null,null,null,null,e)}function no(t,e){var n;if("function"!=typeof e){if("function"!=typeof t)throw new Za(F);var r=t;t=e;e=r}return function(){--t>0?n=e.apply(this,arguments):e=null;return n}}function ro(t,e){var n=O;if(arguments.length>2){var r=$n(arguments,2),i=g(r,ro.placeholder);n|=P}return gr(t,n,e,r,i)}function io(t){return gn(t,arguments.length>1?An(arguments,!1,!1,1):Ko(t))}function oo(t,e){var n=O|R;if(arguments.length>2){var r=$n(arguments,2),i=g(r,oo.placeholder);n|=P}return gr(e,n,t,r,i)}function ao(t,e,n){n&&Pr(t,e,n)&&(e=null);var r=gr(t,A,null,null,null,null,null,e);r.placeholder=ao.placeholder;return r}function uo(t,e,n){n&&Pr(t,e,n)&&(e=null);var r=gr(t,k,null,null,null,null,null,e);r.placeholder=uo.placeholder;return r}function so(t,e,n){function r(){p&&hu(p);s&&hu(s);s=p=h=V}function i(){var n=e-(Qu()-l);if(0>=n||n>e){s&&hu(s);var r=h;s=p=h=V;if(r){d=Qu();c=t.apply(f,u);p||s||(u=f=null)}}else p=mu(i,n)}function o(){p&&hu(p);s=p=h=V;if(v||g!==e){d=Qu();c=t.apply(f,u);p||s||(u=f=null)}}function a(){u=arguments;l=Qu();f=this;h=v&&(p||!y);if(g===!1)var n=y&&!p;else{s||y||(d=l);var r=g-(l-d),a=0>=r||r>g;if(a){s&&(s=hu(s));d=l;c=t.apply(f,u)}else s||(s=mu(o,r))}a&&p?p=hu(p):p||e===g||(p=mu(i,e));if(n){a=!0;c=t.apply(f,u)}!a||p||s||(u=f=null);return c}var u,s,c,l,f,p,h,d=0,g=!1,v=!0;if("function"!=typeof t)throw new Za(F);e=0>e?0:+e||0;if(n===!0){var y=!0;v=!1}else if(Mo(n)){y=n.leading;g="maxWait"in n&&Pu(+n.maxWait||0,e);v="trailing"in n?n.trailing:v}a.cancel=r;return a}function co(t){return _n(t,1,arguments,1)}function lo(t,e){return _n(t,e,arguments,2)}function fo(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new Za(F);var n=function(){var r=arguments,i=n.cache,o=e?e.apply(this,r):r[0];if(i.has(o))return i.get(o);var a=t.apply(this,r);i.set(o,a);return a};n.cache=new fo.Cache;return n}function po(t){if("function"!=typeof t)throw new Za(F);return function(){return!t.apply(this,arguments)}}function ho(t){return no(t,2)}function go(t){var e=$n(arguments,1),n=g(e,go.placeholder);return gr(t,P,null,e,n)}function vo(t){var e=$n(arguments,1),n=g(e,vo.placeholder);return gr(t,N,null,e,n)}function yo(t){var e=An(arguments,!1,!1,1);return gr(t,M,null,null,null,e)}function _o(t){if("function"!=typeof t)throw new Za(F);return function(e){return t.apply(this,e)}}function mo(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new Za(F);if(n===!1)r=!1;else if(Mo(n)){r="leading"in n?!!n.leading:r;i="trailing"in n?!!n.trailing:i}Ie.leading=r;Ie.maxWait=+e;Ie.trailing=i;return so(t,e,Ie)}function bo(t,e){e=null==e?Wa:e;return gr(e,P,null,[t],[])}function Vo(t,e,n,r){if(e&&"boolean"!=typeof e&&Pr(t,e,n))e=!1;else if("function"==typeof e){r=n;n=e;e=!1}n="function"==typeof n&&er(n,r,1);return yn(t,e,n)}function xo(t,e,n){e="function"==typeof e&&er(e,n,1);return yn(t,!0,e)}function Oo(t){var e=h(t)?t.length:V;return Nr(e)&&uu.call(t)==E||!1}function Ro(t){return t===!0||t===!1||h(t)&&uu.call(t)==U||!1}function wo(t){return h(t)&&uu.call(t)==z||!1}function Ao(t){return t&&1===t.nodeType&&h(t)&&uu.call(t).indexOf("Element")>-1||!1}function ko(t){if(null==t)return!0;var e=t.length;return Nr(e)&&(es(t)||Io(t)||Oo(t)||h(t)&&rs(t.splice))?!e:!as(t).length}function Po(t,e,n,r){n="function"==typeof n&&er(n,r,3);if(!n&&Mr(t)&&Mr(e))return t===e;var i=n?n(t,e):V;return"undefined"==typeof i?Sn(t,e,n):!!i}function No(t){return h(t)&&"string"==typeof t.message&&uu.call(t)==H||!1}function Mo(t){var e=typeof t;return"function"==e||t&&"object"==e||!1}function Wo(t,e,n,r){var i=as(e),o=i.length;n="function"==typeof n&&er(n,r,3);if(!n&&1==o){var a=i[0],u=e[a];if(Mr(u))return null!=t&&u===t[a]&&ou.call(t,a)}for(var s=za(o),c=za(o);o--;){u=s[o]=e[i[o]];c[o]=Mr(u)}return Dn(t,i,s,c,n)}function To(t){return jo(t)&&t!=+t}function Lo(t){return null==t?!1:uu.call(t)==$?cu.test(ru.call(t)):h(t)&&Re.test(t)||!1}function So(t){return null===t}function jo(t){return"number"==typeof t||h(t)&&uu.call(t)==Y||!1}function Do(t){return h(t)&&uu.call(t)==K||!1}function Io(t){return"string"==typeof t||h(t)&&uu.call(t)==Q||!1}function Co(t){return h(t)&&Nr(t.length)&&je[uu.call(t)]||!1}function Fo(t){return"undefined"==typeof t}function qo(t){var e=t?t.length:0;return Nr(e)?e?Qe(t):[]:aa(t)}function Eo(t){return dn(t,Zo(t))}function Bo(t,e,n){var r=Uu(t);n&&Pr(t,e,n)&&(e=null);return e?dn(e,r,as(e)):r}function Uo(t){if(null==t)return t;var e=Qe(arguments);e.push(ln);return os.apply(V,e)}function zo(t,e,n){e=br(e,n,3);return wn(t,e,Mn,!0)}function Ho(t,e,n){e=br(e,n,3);return wn(t,e,Wn,!0)}function $o(t,e,n){("function"!=typeof e||"undefined"!=typeof n)&&(e=er(e,n,3));return kn(t,e,Zo)}function Xo(t,e,n){e=er(e,n,3);return Pn(t,e,Zo)}function Yo(t,e,n){("function"!=typeof e||"undefined"!=typeof n)&&(e=er(e,n,3));return Mn(t,e)}function Jo(t,e,n){e=er(e,n,3);return Pn(t,e,as)}function Ko(t){return Tn(t,Zo(t))}function Go(t,e){return t?ou.call(t,e):!1}function Qo(t,e,n){n&&Pr(t,e,n)&&(e=null);for(var r=-1,i=as(t),o=i.length,a={};++r<o;){var u=i[r],s=t[u];e?ou.call(a,s)?a[s].push(u):a[s]=[u]:a[s]=u}return a}function Zo(t){if(null==t)return[];Mo(t)||(t=Ka(t));var e=t.length;e=e&&Nr(e)&&(es(t)||Bu.nonEnumArgs&&Oo(t))&&e||0;for(var n=t.constructor,r=-1,i="function"==typeof n&&n.prototype===t,o=za(e),a=e>0;++r<e;)o[r]=r+"";for(var u in t)a&&kr(u,e)||"constructor"==u&&(i||!ou.call(t,u))||o.push(u);return o}function ta(t,e,n){var r={};e=br(e,n,3);Mn(t,function(t,n,i){r[n]=e(t,n,i)});return r}function ea(t,e,n){if(null==t)return{};if("function"!=typeof e){var r=rn(An(arguments,!1,!1,1),Qa);return Tr(t,mn(Zo(t),r))}e=er(e,n,3);return Lr(t,function(t,n,r){return!e(t,n,r)})}function na(t){for(var e=-1,n=as(t),r=n.length,i=za(r);++e<r;){var o=n[e];i[e]=[o,t[o]]}return i}function ra(t,e,n){return null==t?{}:"function"==typeof e?Lr(t,er(e,n,3)):Tr(t,An(arguments,!1,!1,1))}function ia(t,e,n){var r=null==t?V:t[e];"undefined"==typeof r&&(r=n);return rs(r)?r.call(t):r}function oa(t,e,n,r){var i=es(t)||Co(t);e=br(e,r,4);if(null==n)if(i||Mo(t)){var o=t.constructor;n=i?es(t)?new o:[]:Uu(rs(o)&&o.prototype)}else n={};(i?Ze:Mn)(t,function(t,r,i){return e(n,t,r,i)});return n}function aa(t){return Gn(t,as(t))}function ua(t){return Gn(t,Zo(t))}function sa(t,e,n){e=+e||0;if("undefined"==typeof n){n=e;e=0}else n=+n||0;return t>=e&&n>t}function ca(t,e,n){n&&Pr(t,e,n)&&(e=n=null);var r=null==t,i=null==e;if(null==n)if(i&&"boolean"==typeof t){n=t;t=1}else if("boolean"==typeof e){n=e;i=!0}if(r&&i){e=1;i=!1}t=+t||0;if(i){e=t;t=0}else e=+e||0;if(n||t%1||e%1){var o=Lu();return Nu(t+o*(e-t+parseFloat("1e-"+((o+"").length-1))),e)}return zn(t,e)}function la(t){t=r(t);return t&&t.charAt(0).toUpperCase()+t.slice(1)}function fa(t){t=r(t);return t&&t.replace(we,c)}function pa(t,e,n){t=r(t);e+="";var i=t.length;n=("undefined"==typeof n?i:Nu(0>n?0:+n||0,i))-e.length;return n>=0&&t.indexOf(e,n)==n}function ha(t){t=r(t);return t&&ve.test(t)?t.replace(de,l):t}function da(t){t=r(t);return t&&Pe.test(t)?t.replace(ke,"\\$&"):t}function ga(t,e,n){t=r(t);e=+e;var i=t.length;if(i>=e||!Au(e))return t;var o=(e-i)/2,a=du(o),u=pu(o);n=hr("",u,n);return n.slice(0,a)+t+n}function va(t,e,n){t=r(t);return t&&hr(t,e,n)+t}function ya(t,e,n){t=r(t);return t&&t+hr(t,e,n)}function _a(t,e,n){n&&Pr(t,e,n)&&(e=0);return Tu(t,e)}function ma(t,e){var n="";t=r(t);e=+e;if(1>e||!t||!Au(e))return n;do{e%2&&(n+=t);e=du(e/2);t+=t}while(e);return n}function ba(t,e,n){t=r(t);n=null==n?0:Nu(0>n?0:+n||0,t.length);return t.lastIndexOf(e,n)==n}function Va(t,e,n){var i=X.templateSettings;n&&Pr(t,e,n)&&(e=n=null);t=r(t);e=pn(pn({},n||e),i,fn);var o,a,u=pn(pn({},e.imports),i.imports,fn),s=as(u),c=Gn(u,s),l=0,p=e.interpolate||Ae,h="__p += '",d=Ga((e.escape||Ae).source+"|"+p.source+"|"+(p===me?be:Ae).source+"|"+(e.evaluate||Ae).source+"|$","g"),g="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++Se+"]")+"\n";t.replace(d,function(e,n,r,i,u,s){r||(r=i);h+=t.slice(l,s).replace(Me,f);if(n){o=!0;h+="' +\n__e("+n+") +\n'"}if(u){a=!0;h+="';\n"+u+";\n__p += '"}r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'");l=s+e.length;return e});h+="';\n";var v=e.variable;v||(h="with (obj) {\n"+h+"\n}\n");h=(a?h.replace(le,""):h).replace(fe,"$1").replace(pe,"$1;");h="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var y=Pa(function(){return Xa(s,g+"return "+h).apply(V,c)});y.source=h;if(No(y))throw y;return y}function xa(t,e,n){var i=t;t=r(t);if(!t)return t;if(n?Pr(i,e,n):null==e)return t.slice(y(t),_(t)+1);e+="";return t.slice(o(t,e),a(t,e)+1)}function Oa(t,e,n){var i=t;t=r(t);return t?t.slice((n?Pr(i,e,n):null==e)?y(t):o(t,e+"")):t}function Ra(t,e,n){var i=t;t=r(t);return t?(n?Pr(i,e,n):null==e)?t.slice(0,_(t)+1):t.slice(0,a(t,e+"")+1):t}function wa(t,e,n){n&&Pr(t,e,n)&&(e=null);var i=T,o=L;if(null!=e)if(Mo(e)){var a="separator"in e?e.separator:a;i="length"in e?+e.length||0:i;o="omission"in e?r(e.omission):o}else i=+e||0;t=r(t);if(i>=t.length)return t;var u=i-o.length;if(1>u)return o;var s=t.slice(0,u);if(null==a)return s+o;if(Do(a)){if(t.slice(u).search(a)){var c,l,f=t.slice(0,u);a.global||(a=Ga(a.source,(Ve.exec(a)||"")+"g"));a.lastIndex=0;for(;c=a.exec(f);)l=c.index;s=s.slice(0,null==l?u:l)}}else if(t.indexOf(a,u)!=u){var p=s.lastIndexOf(a);p>-1&&(s=s.slice(0,p))}return s+o}function Aa(t){t=r(t);return t&&ge.test(t)?t.replace(he,m):t}function ka(t,e,n){n&&Pr(t,e,n)&&(e=null);t=r(t);return t.match(e||We)||[]}function Pa(){for(var t=arguments[0],e=arguments.length,n=za(e?e-1:0);--e>0;)n[e-1]=arguments[e];try{return t.apply(V,n)}catch(r){return No(r)?r:new $a(r)}}function Na(t,e,n){n&&Pr(t,e,n)&&(e=null);return h(t)?Ta(t):vn(t,e)}function Ma(t){return function(){return t}}function Wa(t){return t}function Ta(t){return Cn(yn(t,!0))}function La(t,e){return Fn(t+"",yn(e,!0))}function Sa(t,e,n){if(null==n){var r=Mo(e),i=r&&as(e),o=i&&i.length&&Tn(e,i);if(!(o?o.length:r)){o=!1;n=e;e=t;t=this}}o||(o=Tn(e,as(e)));var a=!0,u=-1,s=rs(t),c=o.length;n===!1?a=!1:Mo(n)&&"chain"in n&&(a=n.chain);for(;++u<c;){var l=o[u],f=e[l];t[l]=f;s&&(t.prototype[l]=function(e){return function(){var n=this.__chain__;if(a||n){var r=t(this.__wrapped__);(r.__actions__=Qe(this.__actions__)).push({func:e,args:arguments,thisArg:t});r.__chain__=n;return r}var i=[this.value()];vu.apply(i,arguments);return e.apply(t,i)}}(f))}return t}function ja(){d._=su;return this}function Da(){}function Ia(t){return Bn(t+"")}function Ca(t){return function(e){return null==t?V:t[e]}}function Fa(t,e,n){n&&Pr(t,e,n)&&(e=n=null);t=+t||0;n=null==n?1:+n||0;if(null==e){e=t;t=0}else e=+e||0;for(var r=-1,i=Pu(pu((e-t)/(n||1)),0),o=za(i);++r<i;){o[r]=t;t+=n}return o}function qa(t,e,n){t=+t;if(1>t||!Au(t))return[];var r=-1,i=za(Nu(t,Du));e=er(e,n,1);for(;++r<t;)Du>r?i[r]=e(r):e(r);return i}function Ea(t){var e=++au;return r(t)+e}function Ba(t,e){return t+e}function Ua(t){es(t)||(t=Ir(t));for(var e=t.length,n=0;e--;)n+=+t[e]||0;return n}d=d?Je.defaults(Ye.Object(),d,Je.pick(Ye,Le)):Ye;var za=d.Array,Ha=d.Date,$a=d.Error,Xa=d.Function,Ya=d.Math,Ja=d.Number,Ka=d.Object,Ga=d.RegExp,Qa=d.String,Za=d.TypeError,tu=za.prototype,eu=Ka.prototype,nu=(nu=d.window)&&nu.document,ru=Xa.prototype.toString,iu=Bn("length"),ou=eu.hasOwnProperty,au=0,uu=eu.toString,su=d._,cu=Ga("^"+da(uu).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),lu=Lo(lu=d.ArrayBuffer)&&lu,fu=Lo(fu=lu&&new lu(0).slice)&&fu,pu=Ya.ceil,hu=d.clearTimeout,du=Ya.floor,gu=Lo(gu=Ka.getPrototypeOf)&&gu,vu=tu.push,yu=eu.propertyIsEnumerable,_u=Lo(_u=d.Set)&&_u,mu=d.setTimeout,bu=tu.splice,Vu=Lo(Vu=d.Uint8Array)&&Vu,xu=Lo(xu=d.WeakMap)&&xu,Ou=function(){try{var t=Lo(t=d.Float64Array)&&t,e=new t(new lu(10),0,1)&&t}catch(n){}return e}(),Ru=Lo(Ru=za.isArray)&&Ru,wu=Lo(wu=Ka.create)&&wu,Au=d.isFinite,ku=Lo(ku=Ka.keys)&&ku,Pu=Ya.max,Nu=Ya.min,Mu=Lo(Mu=Ha.now)&&Mu,Wu=Lo(Wu=Ja.isFinite)&&Wu,Tu=d.parseInt,Lu=Ya.random,Su=Ja.NEGATIVE_INFINITY,ju=Ja.POSITIVE_INFINITY,Du=Ya.pow(2,32)-1,Iu=Du-1,Cu=Du>>>1,Fu=Ou?Ou.BYTES_PER_ELEMENT:0,qu=Ya.pow(2,53)-1,Eu=xu&&new xu,Bu=X.support={};!function(){Bu.funcDecomp=!Lo(d.WinRTError)&&Ne.test(b);Bu.funcNames="string"==typeof Xa.name;try{Bu.dom=11===nu.createDocumentFragment().nodeType}catch(t){Bu.dom=!1}try{Bu.nonEnumArgs=!yu.call(arguments,1)}catch(t){Bu.nonEnumArgs=!0}}(0,0);X.templateSettings={escape:ye,evaluate:_e,interpolate:me,variable:"",imports:{_:X}};var Uu=function(){function t(){}return function(e){if(Mo(e)){t.prototype=e;var n=new t;t.prototype=null}return n||d.Object()}}(),zu=Eu?function(t,e){Eu.set(t,e);return t}:Wa;fu||(nr=lu&&Vu?function(t){var e=t.byteLength,n=Ou?du(e/Fu):0,r=n*Fu,i=new lu(e);if(n){var o=new Ou(i,0,n);o.set(new Ou(t,0,n))}if(e!=r){o=new Vu(i,r);o.set(new Vu(t,r))}return i}:Ma(null));var Hu=wu&&_u?function(t){return new Xe(t)}:Ma(null),$u=Eu?function(t){return Eu.get(t)}:Da,Xu=function(){var t=0,e=0;return function(n,r){var i=Qu(),o=j-(i-e);e=i;if(o>0){if(++t>=S)return n}else t=0;return zu(n,r)}}(),Yu=or(function(t,e,n){ou.call(t,n)?++t[n]:t[n]=1}),Ju=or(function(t,e,n){ou.call(t,n)?t[n].push(e):t[n]=[e]}),Ku=or(function(t,e,n){t[n]=e}),Gu=or(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]}),Qu=Mu||function(){return(new Ha).getTime()},Zu=sr(),ts=sr(!0),es=Ru||function(t){return h(t)&&Nr(t.length)&&uu.call(t)==B||!1};Bu.dom||(Ao=function(t){return t&&1===t.nodeType&&h(t)&&!is(t)||!1});var ns=Wu||function(t){return"number"==typeof t&&Au(t)},rs=n(/x/)||Vu&&!n(Vu)?function(t){return uu.call(t)==$}:n,is=gu?function(t){if(!t||uu.call(t)!=J)return!1;var e=t.valueOf,n=Lo(e)&&(n=gu(e))&&gu(n);return n?t==n||gu(t)==n:jr(t)}:jr,os=ar(pn),as=ku?function(t){if(t)var e=t.constructor,n=t.length;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&n&&Nr(n)?Dr(t):Mo(t)?ku(t):[]}:Dr,us=ar(qn),ss=cr(function(t,e,n){e=e.toLowerCase();return t+(n?e.charAt(0).toUpperCase()+e.slice(1):e)}),cs=cr(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()});8!=Tu(Te+"08")&&(_a=function(t,e,n){(n?Pr(t,e,n):null==e)?e=0:e&&(e=+e);t=xa(t);return Tu(t,e||(Oe.test(t)?16:10))});var ls=cr(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}),fs=cr(function(t,e,n){return t+(n?" ":"")+(e.charAt(0).toUpperCase()+e.slice(1))}),ps=fr(on),hs=fr(an,!0);X.prototype=G.prototype;Z.prototype=Uu(G.prototype);Z.prototype.constructor=Z;Ce.prototype=Uu(G.prototype);Ce.prototype.constructor=Ce;Be.prototype["delete"]=Ue;Be.prototype.get=ze;Be.prototype.has=He;Be.prototype.set=$e;Xe.prototype.push=Ge;fo.Cache=Be;X.after=to;X.ary=eo;X.assign=os;X.at=Wi;X.before=no;X.bind=ro;X.bindAll=io;X.bindKey=oo;X.callback=Na;X.chain=xi;X.chunk=qr;X.compact=Er;X.constant=Ma;X.countBy=Yu;X.create=Bo;X.curry=ao;X.curryRight=uo;X.debounce=so;X.defaults=Uo;X.defer=co;X.delay=lo;X.difference=Br;X.drop=Ur;X.dropRight=zr;X.dropRightWhile=Hr;X.dropWhile=$r;X.fill=Xr;X.filter=Li;X.flatten=Gr;X.flattenDeep=Qr;X.flow=Zu;X.flowRight=ts;X.forEach=Ii;X.forEachRight=Ci;X.forIn=$o;X.forInRight=Xo;X.forOwn=Yo;X.forOwnRight=Jo;X.functions=Ko;X.groupBy=Ju;X.indexBy=Ku;X.initial=ti;X.intersection=ei;X.invert=Qo;X.invoke=qi;X.keys=as;X.keysIn=Zo;X.map=Ei;X.mapValues=ta;X.matches=Ta;X.matchesProperty=La;X.memoize=fo;X.merge=us;X.mixin=Sa;X.negate=po;X.omit=ea;X.once=ho;X.pairs=na;X.partial=go;X.partialRight=vo;X.partition=Gu;X.pick=ra;X.pluck=Bi;X.property=Ia;X.propertyOf=Ca;X.pull=ii;X.pullAt=oi;X.range=Fa;X.rearg=yo;X.reject=Hi;X.remove=ai;X.rest=ui;X.shuffle=Xi;X.slice=si;X.sortBy=Ki;X.sortByAll=Gi;X.sortByOrder=Qi;X.spread=_o;X.take=fi;X.takeRight=pi;X.takeRightWhile=hi;X.takeWhile=di;X.tap=Oi;X.throttle=mo;X.thru=Ri;X.times=qa;X.toArray=qo;X.toPlainObject=Eo;X.transform=oa;X.union=gi;X.uniq=vi;X.unzip=yi;X.values=aa;X.valuesIn=ua;X.where=Zi;X.without=_i;X.wrap=bo;X.xor=mi;X.zip=bi;X.zipObject=Vi;X.backflow=ts;X.collect=Ei;X.compose=ts;X.each=Ii;X.eachRight=Ci;X.extend=os;X.iteratee=Na;X.methods=Ko;X.object=Vi;X.select=Li;X.tail=ui;X.unique=vi;Sa(X,X);X.add=Ba;X.attempt=Pa;X.camelCase=ss;X.capitalize=la;X.clone=Vo;X.cloneDeep=xo;X.deburr=fa;X.endsWith=pa;X.escape=ha;X.escapeRegExp=da;X.every=Ti;X.find=Si;X.findIndex=Yr;X.findKey=zo;X.findLast=ji;X.findLastIndex=Jr;X.findLastKey=Ho;X.findWhere=Di;X.first=Kr;X.has=Go;X.identity=Wa;X.includes=Fi;X.indexOf=Zr;X.inRange=sa;X.isArguments=Oo;X.isArray=es;X.isBoolean=Ro;X.isDate=wo;X.isElement=Ao;X.isEmpty=ko;X.isEqual=Po;X.isError=No;X.isFinite=ns;X.isFunction=rs;X.isMatch=Wo;X.isNaN=To;X.isNative=Lo;X.isNull=So;X.isNumber=jo;X.isObject=Mo;X.isPlainObject=is;X.isRegExp=Do;X.isString=Io;X.isTypedArray=Co;X.isUndefined=Fo;X.kebabCase=cs;X.last=ni;X.lastIndexOf=ri;X.max=ps;X.min=hs;X.noConflict=ja;X.noop=Da;X.now=Qu;X.pad=ga;X.padLeft=va;X.padRight=ya;X.parseInt=_a;X.random=ca;X.reduce=Ui;X.reduceRight=zi;X.repeat=ma;X.result=ia;X.runInContext=b;X.size=Yi;X.snakeCase=ls;X.some=Ji;X.sortedIndex=ci;X.sortedLastIndex=li;X.startCase=fs;X.startsWith=ba;X.sum=Ua;X.template=Va;X.trim=xa;X.trimLeft=Oa;X.trimRight=Ra;X.trunc=wa;X.unescape=Aa;X.uniqueId=Ea;X.words=ka;X.all=Ti;X.any=Ji;X.contains=Fi;X.detect=Si;X.foldl=Ui;X.foldr=zi;X.head=Kr;X.include=Fi;X.inject=Ui;Sa(X,function(){var t={};Mn(X,function(e,n){X.prototype[n]||(t[n]=e)});return t}(),!1);X.sample=$i;X.prototype.sample=function(t){return this.__chain__||null!=t?this.thru(function(e){return $i(e,t)}):$i(this.value())};X.VERSION=x;Ze(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){X[t].placeholder=X});Ze(["dropWhile","filter","map","takeWhile"],function(t,e){var n=e!=I,r=e==D;Ce.prototype[t]=function(t,i){var o=this.__filtered__,a=o&&r?new Ce(this):this.clone(),u=a.__iteratees__||(a.__iteratees__=[]);a.__filtered__=o||n;u.push({done:!1,index:0,iteratee:br(t,i,1),type:e});return a}});Ze(["drop","take"],function(t,e){var n="__"+t+"Count__",r=t+"While";Ce.prototype[t]=function(r){r=null==r?1:Pu(du(r)||0,0);var i=this.clone();if(i.__filtered__){var o=i[n];i[n]=e?Nu(o,r):o+r}else{var a=i.__views__||(i.__views__=[]);a.push({size:r,type:t+(i.__dir__<0?"Right":"")})}return i};Ce.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()};Ce.prototype[t+"RightWhile"]=function(t,e){return this.reverse()[r](t,e).reverse()}});Ze(["first","last"],function(t,e){var n="take"+(e?"Right":"");Ce.prototype[t]=function(){return this[n](1).value()[0]}});Ze(["initial","rest"],function(t,e){var n="drop"+(e?"":"Right");Ce.prototype[t]=function(){return this[n](1)}});Ze(["pluck","where"],function(t,e){var n=e?"filter":"map",r=e?Cn:Bn;Ce.prototype[t]=function(t){return this[n](r(t))}});Ce.prototype.compact=function(){return this.filter(Wa)};Ce.prototype.reject=function(t,e){t=br(t,e,1);return this.filter(function(e){return!t(e)})};Ce.prototype.slice=function(t,e){t=null==t?0:+t||0;var n=0>t?this.takeRight(-t):this.drop(t);if("undefined"!=typeof e){e=+e||0;n=0>e?n.dropRight(-e):n.take(e-t)}return n};Ce.prototype.toArray=function(){return this.drop(0)};Mn(Ce.prototype,function(t,e){var n=X[e],r=/^(?:filter|map|reject)|While$/.test(e),i=/^(?:first|last)$/.test(e);X.prototype[e]=function(){var e=arguments,o=(e.length,this.__chain__),a=this.__wrapped__,u=!!this.__actions__.length,s=a instanceof Ce,c=e[0],l=s||es(a);l&&r&&"function"==typeof c&&1!=c.length&&(s=l=!1);
var f=s&&!u;if(i&&!o)return f?t.call(a):n.call(X,this.value());var p=function(t){var r=[t];vu.apply(r,e);return n.apply(X,r)};if(l){var h=f?a:new Ce(this),d=t.apply(h,e);if(!i&&(u||d.__actions__)){var g=d.__actions__||(d.__actions__=[]);g.push({func:Ri,args:[p],thisArg:X})}return new Z(d,o)}return this.thru(p)}});Ze(["concat","join","pop","push","shift","sort","splice","unshift"],function(t){var e=tu[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:join|pop|shift)$/.test(t);X.prototype[t]=function(){var t=arguments;return r&&!this.__chain__?e.apply(this.value(),t):this[n](function(n){return e.apply(n,t)})}});Ce.prototype.clone=Fe;Ce.prototype.reverse=qe;Ce.prototype.value=Ee;X.prototype.chain=wi;X.prototype.commit=Ai;X.prototype.plant=ki;X.prototype.reverse=Pi;X.prototype.toString=Ni;X.prototype.run=X.prototype.toJSON=X.prototype.valueOf=X.prototype.value=Mi;X.prototype.collect=X.prototype.map;X.prototype.head=X.prototype.first;X.prototype.select=X.prototype.filter;X.prototype.tail=X.prototype.rest;return X}var V,x="3.4.0",O=1,R=2,w=4,A=8,k=16,P=32,N=64,M=128,W=256,T=30,L="...",S=150,j=16,D=0,I=2,C=3,F="Expected a function",q="__lodash_placeholder__",E="[object Arguments]",B="[object Array]",U="[object Boolean]",z="[object Date]",H="[object Error]",$="[object Function]",X="[object Map]",Y="[object Number]",J="[object Object]",K="[object RegExp]",G="[object Set]",Q="[object String]",Z="[object WeakMap]",te="[object ArrayBuffer]",ee="[object Float32Array]",ne="[object Float64Array]",re="[object Int8Array]",ie="[object Int16Array]",oe="[object Int32Array]",ae="[object Uint8Array]",ue="[object Uint8ClampedArray]",se="[object Uint16Array]",ce="[object Uint32Array]",le=/\b__p \+= '';/g,fe=/\b(__p \+=) '' \+/g,pe=/(__e\(.*?\)|\b__t\)) \+\n'';/g,he=/&(?:amp|lt|gt|quot|#39|#96);/g,de=/[&<>"'`]/g,ge=RegExp(he.source),ve=RegExp(de.source),ye=/<%-([\s\S]+?)%>/g,_e=/<%([\s\S]+?)%>/g,me=/<%=([\s\S]+?)%>/g,be=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ve=/\w*$/,xe=/^\s*function[ \n\r\t]+\w/,Oe=/^0[xX]/,Re=/^\[object .+?Constructor\]$/,we=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Ae=/($^)/,ke=/[.*+?^${}()|[\]\/\\]/g,Pe=RegExp(ke.source),Ne=/\bthis\b/,Me=/['\n\r\u2028\u2029\\]/g,We=function(){var t="[A-Z\\xc0-\\xd6\\xd8-\\xde]",e="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(t+"+(?="+t+e+")|"+t+"?"+e+"|"+t+"+|[0-9]+","g")}(),Te=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",Le=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window","WinRTError"],Se=-1,je={};je[ee]=je[ne]=je[re]=je[ie]=je[oe]=je[ae]=je[ue]=je[se]=je[ce]=!0;je[E]=je[B]=je[te]=je[U]=je[z]=je[H]=je[$]=je[X]=je[Y]=je[J]=je[K]=je[G]=je[Q]=je[Z]=!1;var De={};De[E]=De[B]=De[te]=De[U]=De[z]=De[ee]=De[ne]=De[re]=De[ie]=De[oe]=De[Y]=De[J]=De[K]=De[Q]=De[ae]=De[ue]=De[se]=De[ce]=!0;De[H]=De[$]=De[X]=De[G]=De[Z]=!1;var Ie={leading:!1,maxWait:0,trailing:!1},Ce={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Fe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},qe={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Ee={"function":!0,object:!0},Be={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ue=Ee[typeof exports]&&exports&&!exports.nodeType&&exports,ze=Ee[typeof module]&&module&&!module.nodeType&&module,He=Ue&&ze&&"object"==typeof global&&global,$e=Ee[typeof window]&&window,Xe=ze&&ze.exports===Ue&&Ue,Ye=He||$e!==(this&&this.window)&&$e||this,Je=b();if("function"==typeof define&&"object"==typeof define.amd&&define.amd){Ye._=Je;define("lodash",[],function(){return Je})}else Ue&&ze?Xe?(ze.exports=Je)._=Je:Ue._=Je:Ye._=Je}).call(this);!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define("PF",t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.PF=t()}}(function(){return function t(e,n,r){function i(a,u){if(!n[a]){if(!e[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,e){e.exports=t("./lib/heap")},{"./lib/heap":2}],2:[function(t,e){(function(){var t,n,r,i,o,a,u,s,c,l,f,p,h,d,g;r=Math.floor,l=Math.min;n=function(t,e){return e>t?-1:t>e?1:0};c=function(t,e,i,o,a){var u;null==i&&(i=0);null==a&&(a=n);if(0>i)throw new Error("lo must be non-negative");null==o&&(o=t.length);for(;o>i;){u=r((i+o)/2);a(e,t[u])<0?o=u:i=u+1}return[].splice.apply(t,[i,i-i].concat(e)),e};a=function(t,e,r){null==r&&(r=n);t.push(e);return d(t,0,t.length-1,r)};o=function(t,e){var r,i;null==e&&(e=n);r=t.pop();if(t.length){i=t[0];t[0]=r;g(t,0,e)}else i=r;return i};s=function(t,e,r){var i;null==r&&(r=n);i=t[0];t[0]=e;g(t,0,r);return i};u=function(t,e,r){var i;null==r&&(r=n);if(t.length&&r(t[0],e)<0){i=[t[0],e],e=i[0],t[0]=i[1];g(t,0,r)}return e};i=function(t,e){var i,o,a,u,s,c;null==e&&(e=n);u=function(){c=[];for(var e=0,n=r(t.length/2);n>=0?n>e:e>n;n>=0?e++:e--)c.push(e);return c}.apply(this).reverse();s=[];for(o=0,a=u.length;a>o;o++){i=u[o];s.push(g(t,i,e))}return s};h=function(t,e,r){var i;null==r&&(r=n);i=t.indexOf(e);if(-1!==i){d(t,0,i,r);return g(t,i,r)}};f=function(t,e,r){var o,a,s,c,l;null==r&&(r=n);a=t.slice(0,e);if(!a.length)return a;i(a,r);l=t.slice(e);for(s=0,c=l.length;c>s;s++){o=l[s];u(a,o,r)}return a.sort(r).reverse()};p=function(t,e,r){var a,u,s,f,p,h,d,g,v,y;null==r&&(r=n);if(10*e<=t.length){f=t.slice(0,e).sort(r);if(!f.length)return f;s=f[f.length-1];g=t.slice(e);for(p=0,d=g.length;d>p;p++){a=g[p];if(r(a,s)<0){c(f,a,0,null,r);f.pop();s=f[f.length-1]}}return f}i(t,r);y=[];for(u=h=0,v=l(e,t.length);v>=0?v>h:h>v;u=v>=0?++h:--h)y.push(o(t,r));return y};d=function(t,e,r,i){var o,a,u;null==i&&(i=n);o=t[r];for(;r>e;){u=r-1>>1;a=t[u];if(!(i(o,a)<0))break;t[r]=a;r=u}return t[r]=o};g=function(t,e,r){var i,o,a,u,s;null==r&&(r=n);o=t.length;s=e;a=t[e];i=2*e+1;for(;o>i;){u=i+1;o>u&&!(r(t[i],t[u])<0)&&(i=u);t[e]=t[i];e=i;i=2*e+1}t[e]=a;return d(t,s,e,r)};t=function(){function t(t){this.cmp=null!=t?t:n;this.nodes=[]}t.push=a;t.pop=o;t.replace=s;t.pushpop=u;t.heapify=i;t.updateItem=h;t.nlargest=f;t.nsmallest=p;t.prototype.push=function(t){return a(this.nodes,t,this.cmp)};t.prototype.pop=function(){return o(this.nodes,this.cmp)};t.prototype.peek=function(){return this.nodes[0]};t.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)};t.prototype.replace=function(t){return s(this.nodes,t,this.cmp)};t.prototype.pushpop=function(t){return u(this.nodes,t,this.cmp)};t.prototype.heapify=function(){return i(this.nodes,this.cmp)};t.prototype.updateItem=function(t){return h(this.nodes,t,this.cmp)};t.prototype.clear=function(){return this.nodes=[]};t.prototype.empty=function(){return 0===this.nodes.length};t.prototype.size=function(){return this.nodes.length};t.prototype.clone=function(){var e;e=new t;e.nodes=this.nodes.slice(0);return e};t.prototype.toArray=function(){return this.nodes.slice(0)};t.prototype.insert=t.prototype.push;t.prototype.top=t.prototype.peek;t.prototype.front=t.prototype.peek;t.prototype.has=t.prototype.contains;t.prototype.copy=t.prototype.clone;return t}();("undefined"!=typeof e&&null!==e?e.exports:void 0)?e.exports=t:window.Heap=t}).call(this)},{}],3:[function(t,e){var n={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4};e.exports=n},{}],4:[function(t,e){function n(t,e,n){this.width=t;this.height=e;this.nodes=this._buildNodes(t,e,n)}var r=t("./Node"),i=t("./DiagonalMovement");n.prototype._buildNodes=function(t,e,n){var i,o,a=new Array(e);for(i=0;e>i;++i){a[i]=new Array(t);for(o=0;t>o;++o)a[i][o]=new r(o,i)}if(void 0===n)return a;if(n.length!==e||n[0].length!==t)throw new Error("Matrix size does not fit");for(i=0;e>i;++i)for(o=0;t>o;++o)n[i][o]&&(a[i][o].walkable=!1);return a};n.prototype.getNodeAt=function(t,e){return this.nodes[e][t]};n.prototype.isWalkableAt=function(t,e){return this.isInside(t,e)&&this.nodes[e][t].walkable};n.prototype.isInside=function(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height};n.prototype.setWalkableAt=function(t,e,n){this.nodes[e][t].walkable=n};n.prototype.getNeighbors=function(t,e){var n=t.x,r=t.y,o=[],a=!1,u=!1,s=!1,c=!1,l=!1,f=!1,p=!1,h=!1,d=this.nodes;if(this.isWalkableAt(n,r-1)){o.push(d[r-1][n]);a=!0}if(this.isWalkableAt(n+1,r)){o.push(d[r][n+1]);s=!0}if(this.isWalkableAt(n,r+1)){o.push(d[r+1][n]);l=!0}if(this.isWalkableAt(n-1,r)){o.push(d[r][n-1]);p=!0}if(e===i.Never)return o;if(e===i.OnlyWhenNoObstacles){u=p&&a;c=a&&s;f=s&&l;h=l&&p}else if(e===i.IfAtMostOneObstacle){u=p||a;c=a||s;f=s||l;h=l||p}else{if(e!==i.Always)throw new Error("Incorrect value of diagonalMovement");u=!0;c=!0;f=!0;h=!0}u&&this.isWalkableAt(n-1,r-1)&&o.push(d[r-1][n-1]);c&&this.isWalkableAt(n+1,r-1)&&o.push(d[r-1][n+1]);f&&this.isWalkableAt(n+1,r+1)&&o.push(d[r+1][n+1]);h&&this.isWalkableAt(n-1,r+1)&&o.push(d[r+1][n-1]);return o};n.prototype.clone=function(){var t,e,i=this.width,o=this.height,a=this.nodes,u=new n(i,o),s=new Array(o);for(t=0;o>t;++t){s[t]=new Array(i);for(e=0;i>e;++e)s[t][e]=new r(e,t,a[t][e].walkable)}u.nodes=s;return u};e.exports=n},{"./DiagonalMovement":3,"./Node":6}],5:[function(t,e){e.exports={manhattan:function(t,e){return t+e},euclidean:function(t,e){return Math.sqrt(t*t+e*e)},octile:function(t,e){var n=Math.SQRT2-1;return e>t?n*t+e:n*e+t},chebyshev:function(t,e){return Math.max(t,e)}}},{}],6:[function(t,e){function n(t,e,n){this.x=t;this.y=e;this.walkable=void 0===n?!0:n}e.exports=n},{}],7:[function(t,e,n){function r(t){for(var e=[[t.x,t.y]];t.parent;){t=t.parent;e.push([t.x,t.y])}return e.reverse()}function i(t,e){var n=r(t),i=r(e);return n.concat(i.reverse())}function o(t){var e,n,r,i,o,a=0;for(e=1;e<t.length;++e){n=t[e-1];r=t[e];i=n[0]-r[0];o=n[1]-r[1];a+=Math.sqrt(i*i+o*o)}return a}function a(t,e,n,r){var i,o,a,u,s,c,l=Math.abs,f=[];a=l(n-t);u=l(r-e);i=n>t?1:-1;o=r>e?1:-1;s=a-u;for(;;){f.push([t,e]);if(t===n&&e===r)break;c=2*s;if(c>-u){s-=u;t+=i}if(a>c){s+=a;e+=o}}return f}function u(t){var e,n,r,i,o,u,s=[],c=t.length;if(2>c)return s;for(o=0;c-1>o;++o){e=t[o];n=t[o+1];r=a(e[0],e[1],n[0],n[1]);i=r.length;for(u=0;i-1>u;++u)s.push(r[u])}s.push(t[c-1]);return s}function s(t,e){var n,r,i,o,u,s,c,l,f,p,h,d=e.length,g=e[0][0],v=e[0][1],y=e[d-1][0],_=e[d-1][1];n=g;r=v;u=[[n,r]];for(s=2;d>s;++s){l=e[s];i=l[0];o=l[1];f=a(n,r,i,o);h=!1;for(c=1;c<f.length;++c){p=f[c];if(!t.isWalkableAt(p[0],p[1])){h=!0;break}}if(h){lastValidCoord=e[s-1];u.push(lastValidCoord);n=lastValidCoord[0];r=lastValidCoord[1]}}u.push([y,_]);return u}function c(t){if(t.length<3)return t;var e,n,r,i,o,a,u=[],s=t[0][0],c=t[0][1],l=t[1][0],f=t[1][1],p=l-s,h=f-c;o=Math.sqrt(p*p+h*h);p/=o;h/=o;u.push([s,c]);for(a=2;a<t.length;a++){e=l;n=f;r=p;i=h;l=t[a][0];f=t[a][1];p=l-e;h=f-n;o=Math.sqrt(p*p+h*h);p/=o;h/=o;(p!==r||h!==i)&&u.push([e,n])}u.push([l,f]);return u}n.backtrace=r;n.biBacktrace=i;n.pathLength=o;n.interpolate=a;n.expandPath=u;n.smoothenPath=s;n.compressPath=c},{}],8:[function(t,e){e.exports={Heap:t("heap"),Node:t("./core/Node"),Grid:t("./core/Grid"),Util:t("./core/Util"),DiagonalMovement:t("./core/DiagonalMovement"),Heuristic:t("./core/Heuristic"),AStarFinder:t("./finders/AStarFinder"),BestFirstFinder:t("./finders/BestFirstFinder"),BreadthFirstFinder:t("./finders/BreadthFirstFinder"),DijkstraFinder:t("./finders/DijkstraFinder"),BiAStarFinder:t("./finders/BiAStarFinder"),BiBestFirstFinder:t("./finders/BiBestFirstFinder"),BiBreadthFirstFinder:t("./finders/BiBreadthFirstFinder"),BiDijkstraFinder:t("./finders/BiDijkstraFinder"),IDAStarFinder:t("./finders/IDAStarFinder"),JumpPointFinder:t("./finders/JumpPointFinder")}},{"./core/DiagonalMovement":3,"./core/Grid":4,"./core/Heuristic":5,"./core/Node":6,"./core/Util":7,"./finders/AStarFinder":9,"./finders/BestFirstFinder":10,"./finders/BiAStarFinder":11,"./finders/BiBestFirstFinder":12,"./finders/BiBreadthFirstFinder":13,"./finders/BiDijkstraFinder":14,"./finders/BreadthFirstFinder":15,"./finders/DijkstraFinder":16,"./finders/IDAStarFinder":17,"./finders/JumpPointFinder":22,heap:1}],9:[function(t,e){function n(t){t=t||{};this.allowDiagonal=t.allowDiagonal;this.dontCrossCorners=t.dontCrossCorners;this.heuristic=t.heuristic||o.manhattan;this.weight=t.weight||1;this.diagonalMovement=t.diagonalMovement;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?a.OnlyWhenNoObstacles:a.IfAtMostOneObstacle:a.Never);this.heuristic=this.diagonalMovement===a.Never?t.heuristic||o.manhattan:t.heuristic||o.octile}var r=t("heap"),i=t("../core/Util"),o=t("../core/Heuristic"),a=t("../core/DiagonalMovement");n.prototype.findPath=function(t,e,n,o,a){var u,s,c,l,f,p,h,d,g=new r(function(t,e){return t.f-e.f}),v=a.getNodeAt(t,e),y=a.getNodeAt(n,o),_=this.heuristic,m=this.diagonalMovement,b=this.weight,V=Math.abs,x=Math.SQRT2;v.g=0;v.f=0;g.push(v);v.opened=!0;for(;!g.empty();){u=g.pop();u.closed=!0;if(u===y)return i.backtrace(y);s=a.getNeighbors(u,m);for(l=0,f=s.length;f>l;++l){c=s[l];if(!c.closed){p=c.x;h=c.y;d=u.g+(p-u.x===0||h-u.y===0?1:x);if(!c.opened||d<c.g){c.g=d;c.h=c.h||b*_(V(p-n),V(h-o));c.f=c.g+c.h;c.parent=u;if(c.opened)g.updateItem(c);else{g.push(c);c.opened=!0}}}}}return[]};e.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],10:[function(t,e){function n(t){r.call(this,t);var e=this.heuristic;this.heuristic=function(t,n){return 1e6*e(t,n)}}var r=t("./AStarFinder");n.prototype=new r;n.prototype.constructor=n;e.exports=n},{"./AStarFinder":9}],11:[function(t,e){function n(t){t=t||{};this.allowDiagonal=t.allowDiagonal;this.dontCrossCorners=t.dontCrossCorners;this.diagonalMovement=t.diagonalMovement;this.heuristic=t.heuristic||o.manhattan;this.weight=t.weight||1;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?a.OnlyWhenNoObstacles:a.IfAtMostOneObstacle:a.Never);this.heuristic=this.diagonalMovement===a.Never?t.heuristic||o.manhattan:t.heuristic||o.octile}var r=t("heap"),i=t("../core/Util"),o=t("../core/Heuristic"),a=t("../core/DiagonalMovement");n.prototype.findPath=function(t,e,n,o,a){var u,s,c,l,f,p,h,d,g=function(t,e){return t.f-e.f},v=new r(g),y=new r(g),_=a.getNodeAt(t,e),m=a.getNodeAt(n,o),b=this.heuristic,V=this.diagonalMovement,x=this.weight,O=Math.abs,R=Math.SQRT2,w=1,A=2;_.g=0;_.f=0;v.push(_);_.opened=w;m.g=0;m.f=0;y.push(m);m.opened=A;for(;!v.empty()&&!y.empty();){u=v.pop();u.closed=!0;s=a.getNeighbors(u,V);for(l=0,f=s.length;f>l;++l){c=s[l];if(!c.closed){if(c.opened===A)return i.biBacktrace(u,c);p=c.x;h=c.y;d=u.g+(p-u.x===0||h-u.y===0?1:R);if(!c.opened||d<c.g){c.g=d;c.h=c.h||x*b(O(p-n),O(h-o));c.f=c.g+c.h;c.parent=u;if(c.opened)v.updateItem(c);else{v.push(c);c.opened=w}}}}u=y.pop();u.closed=!0;s=a.getNeighbors(u,V);for(l=0,f=s.length;f>l;++l){c=s[l];if(!c.closed){if(c.opened===w)return i.biBacktrace(c,u);p=c.x;h=c.y;d=u.g+(p-u.x===0||h-u.y===0?1:R);if(!c.opened||d<c.g){c.g=d;c.h=c.h||x*b(O(p-t),O(h-e));c.f=c.g+c.h;c.parent=u;if(c.opened)y.updateItem(c);else{y.push(c);c.opened=A}}}}}return[]};e.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],12:[function(t,e){function n(t){r.call(this,t);var e=this.heuristic;this.heuristic=function(t,n){return 1e6*e(t,n)}}var r=t("./BiAStarFinder");n.prototype=new r;n.prototype.constructor=n;e.exports=n},{"./BiAStarFinder":11}],13:[function(t,e){function n(t){t=t||{};this.allowDiagonal=t.allowDiagonal;this.dontCrossCorners=t.dontCrossCorners;this.diagonalMovement=t.diagonalMovement;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?i.OnlyWhenNoObstacles:i.IfAtMostOneObstacle:i.Never)}var r=t("../core/Util"),i=t("../core/DiagonalMovement");n.prototype.findPath=function(t,e,n,i,o){var a,u,s,c,l,f=o.getNodeAt(t,e),p=o.getNodeAt(n,i),h=[],d=[],g=this.diagonalMovement,v=0,y=1;h.push(f);f.opened=!0;f.by=v;d.push(p);p.opened=!0;p.by=y;for(;h.length&&d.length;){s=h.shift();s.closed=!0;a=o.getNeighbors(s,g);for(c=0,l=a.length;l>c;++c){u=a[c];if(!u.closed)if(u.opened){if(u.by===y)return r.biBacktrace(s,u)}else{h.push(u);u.parent=s;u.opened=!0;u.by=v}}s=d.shift();s.closed=!0;a=o.getNeighbors(s,g);for(c=0,l=a.length;l>c;++c){u=a[c];if(!u.closed)if(u.opened){if(u.by===v)return r.biBacktrace(u,s)}else{d.push(u);u.parent=s;u.opened=!0;u.by=y}}}return[]};e.exports=n},{"../core/DiagonalMovement":3,"../core/Util":7}],14:[function(t,e){function n(t){r.call(this,t);this.heuristic=function(){return 0}}var r=t("./BiAStarFinder");n.prototype=new r;n.prototype.constructor=n;e.exports=n},{"./BiAStarFinder":11}],15:[function(t,e){function n(t){t=t||{};this.allowDiagonal=t.allowDiagonal;this.dontCrossCorners=t.dontCrossCorners;this.diagonalMovement=t.diagonalMovement;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?i.OnlyWhenNoObstacles:i.IfAtMostOneObstacle:i.Never)}var r=t("../core/Util"),i=t("../core/DiagonalMovement");n.prototype.findPath=function(t,e,n,i,o){var a,u,s,c,l,f=[],p=this.diagonalMovement,h=o.getNodeAt(t,e),d=o.getNodeAt(n,i);f.push(h);h.opened=!0;for(;f.length;){s=f.shift();s.closed=!0;if(s===d)return r.backtrace(d);a=o.getNeighbors(s,p);for(c=0,l=a.length;l>c;++c){u=a[c];if(!u.closed&&!u.opened){f.push(u);u.opened=!0;u.parent=s}}}return[]};e.exports=n},{"../core/DiagonalMovement":3,"../core/Util":7}],16:[function(t,e){function n(t){r.call(this,t);this.heuristic=function(){return 0}}var r=t("./AStarFinder");n.prototype=new r;n.prototype.constructor=n;e.exports=n},{"./AStarFinder":9}],17:[function(t,e){function n(t){t=t||{};this.allowDiagonal=t.allowDiagonal;this.dontCrossCorners=t.dontCrossCorners;this.diagonalMovement=t.diagonalMovement;this.heuristic=t.heuristic||r.manhattan;this.weight=t.weight||1;this.trackRecursion=t.trackRecursion||!1;this.timeLimit=t.timeLimit||1/0;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?o.OnlyWhenNoObstacles:o.IfAtMostOneObstacle:o.Never);this.heuristic=this.diagonalMovement===o.Never?t.heuristic||r.manhattan:t.heuristic||r.octile}var r=(t("../core/Util"),t("../core/Heuristic")),i=t("../core/Node"),o=t("../core/DiagonalMovement");n.prototype.findPath=function(t,e,n,r,o){var a,u,s,c=0,l=(new Date).getTime(),f=function(t,e){return this.heuristic(Math.abs(e.x-t.x),Math.abs(e.y-t.y))}.bind(this),p=function(t,e){return t.x===e.x||t.y===e.y?1:Math.SQRT2},h=function(t,e,n,r,a){c++;if(this.timeLimit>0&&(new Date).getTime()-l>1e3*this.timeLimit)return 1/0;var u=e+f(t,g)*this.weight;if(u>n)return u;if(t==g){r[a]=[t.x,t.y];return t}var s,d,v,y,_=o.getNeighbors(t,this.diagonalMovement);for(v=0,s=1/0;y=_[v];++v){if(this.trackRecursion){y.retainCount=y.retainCount+1||1;y.tested!==!0&&(y.tested=!0)}d=h(y,e+p(t,y),n,r,a+1);if(d instanceof i){r[a]=[t.x,t.y];return d}this.trackRecursion&&0===--y.retainCount&&(y.tested=!1);s>d&&(s=d)}return s}.bind(this),d=o.getNodeAt(t,e),g=o.getNodeAt(n,r),v=f(d,g);for(a=0;!0;++a){u=[];s=h(d,0,v,u,0);if(1/0===s)return[];if(s instanceof i)return u;v=s}return[]};e.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Node":6,"../core/Util":7}],18:[function(t,e){function n(t){r.call(this,t)}var r=t("./JumpPointFinderBase"),i=t("../core/DiagonalMovement");n.prototype=new r;n.prototype.constructor=n;n.prototype._jump=function(t,e,n,r){var i=this.grid,o=t-n,a=e-r;if(!i.isWalkableAt(t,e))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(t,e).tested=!0);if(i.getNodeAt(t,e)===this.endNode)return[t,e];if(0!==o&&0!==a){if(i.isWalkableAt(t-o,e+a)&&!i.isWalkableAt(t-o,e)||i.isWalkableAt(t+o,e-a)&&!i.isWalkableAt(t,e-a))return[t,e];if(this._jump(t+o,e,t,e)||this._jump(t,e+a,t,e))return[t,e]}else if(0!==o){if(i.isWalkableAt(t+o,e+1)&&!i.isWalkableAt(t,e+1)||i.isWalkableAt(t+o,e-1)&&!i.isWalkableAt(t,e-1))return[t,e]}else if(i.isWalkableAt(t+1,e+a)&&!i.isWalkableAt(t+1,e)||i.isWalkableAt(t-1,e+a)&&!i.isWalkableAt(t-1,e))return[t,e];return this._jump(t+o,e+a,t,e)};n.prototype._findNeighbors=function(t){var e,n,r,o,a,u,s,c,l=t.parent,f=t.x,p=t.y,h=this.grid,d=[];if(l){e=l.x;n=l.y;r=(f-e)/Math.max(Math.abs(f-e),1);o=(p-n)/Math.max(Math.abs(p-n),1);if(0!==r&&0!==o){h.isWalkableAt(f,p+o)&&d.push([f,p+o]);h.isWalkableAt(f+r,p)&&d.push([f+r,p]);h.isWalkableAt(f+r,p+o)&&d.push([f+r,p+o]);h.isWalkableAt(f-r,p)||d.push([f-r,p+o]);h.isWalkableAt(f,p-o)||d.push([f+r,p-o])}else if(0===r){h.isWalkableAt(f,p+o)&&d.push([f,p+o]);h.isWalkableAt(f+1,p)||d.push([f+1,p+o]);h.isWalkableAt(f-1,p)||d.push([f-1,p+o])}else{h.isWalkableAt(f+r,p)&&d.push([f+r,p]);h.isWalkableAt(f,p+1)||d.push([f+r,p+1]);h.isWalkableAt(f,p-1)||d.push([f+r,p-1])}}else{a=h.getNeighbors(t,i.Always);for(s=0,c=a.length;c>s;++s){u=a[s];d.push([u.x,u.y])}}return d};e.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],19:[function(t,e){function n(t){r.call(this,t)}var r=t("./JumpPointFinderBase"),i=t("../core/DiagonalMovement");n.prototype=new r;n.prototype.constructor=n;n.prototype._jump=function(t,e,n,r){var i=this.grid,o=t-n,a=e-r;if(!i.isWalkableAt(t,e))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(t,e).tested=!0);if(i.getNodeAt(t,e)===this.endNode)return[t,e];if(0!==o&&0!==a){if(i.isWalkableAt(t-o,e+a)&&!i.isWalkableAt(t-o,e)||i.isWalkableAt(t+o,e-a)&&!i.isWalkableAt(t,e-a))return[t,e];if(this._jump(t+o,e,t,e)||this._jump(t,e+a,t,e))return[t,e]}else if(0!==o){if(i.isWalkableAt(t+o,e+1)&&!i.isWalkableAt(t,e+1)||i.isWalkableAt(t+o,e-1)&&!i.isWalkableAt(t,e-1))return[t,e]}else if(i.isWalkableAt(t+1,e+a)&&!i.isWalkableAt(t+1,e)||i.isWalkableAt(t-1,e+a)&&!i.isWalkableAt(t-1,e))return[t,e];return i.isWalkableAt(t+o,e)||i.isWalkableAt(t,e+a)?this._jump(t+o,e+a,t,e):null};n.prototype._findNeighbors=function(t){var e,n,r,o,a,u,s,c,l=t.parent,f=t.x,p=t.y,h=this.grid,d=[];if(l){e=l.x;n=l.y;r=(f-e)/Math.max(Math.abs(f-e),1);o=(p-n)/Math.max(Math.abs(p-n),1);if(0!==r&&0!==o){h.isWalkableAt(f,p+o)&&d.push([f,p+o]);h.isWalkableAt(f+r,p)&&d.push([f+r,p]);(h.isWalkableAt(f,p+o)||h.isWalkableAt(f+r,p))&&d.push([f+r,p+o]);!h.isWalkableAt(f-r,p)&&h.isWalkableAt(f,p+o)&&d.push([f-r,p+o]);!h.isWalkableAt(f,p-o)&&h.isWalkableAt(f+r,p)&&d.push([f+r,p-o])}else if(0===r){if(h.isWalkableAt(f,p+o)){d.push([f,p+o]);h.isWalkableAt(f+1,p)||d.push([f+1,p+o]);h.isWalkableAt(f-1,p)||d.push([f-1,p+o])}}else if(h.isWalkableAt(f+r,p)){d.push([f+r,p]);h.isWalkableAt(f,p+1)||d.push([f+r,p+1]);h.isWalkableAt(f,p-1)||d.push([f+r,p-1])}}else{a=h.getNeighbors(t,i.IfAtMostOneObstacle);for(s=0,c=a.length;c>s;++s){u=a[s];d.push([u.x,u.y])}}return d};e.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],20:[function(t,e){function n(t){r.call(this,t)}var r=t("./JumpPointFinderBase"),i=t("../core/DiagonalMovement");n.prototype=new r;n.prototype.constructor=n;n.prototype._jump=function(t,e,n,r){var i=this.grid,o=t-n,a=e-r;if(!i.isWalkableAt(t,e))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(t,e).tested=!0);if(i.getNodeAt(t,e)===this.endNode)return[t,e];if(0!==o&&0!==a){if(this._jump(t+o,e,t,e)||this._jump(t,e+a,t,e))return[t,e]}else if(0!==o){if(i.isWalkableAt(t,e-1)&&!i.isWalkableAt(t-o,e-1)||i.isWalkableAt(t,e+1)&&!i.isWalkableAt(t-o,e+1))return[t,e]}else if(0!==a&&(i.isWalkableAt(t-1,e)&&!i.isWalkableAt(t-1,e-a)||i.isWalkableAt(t+1,e)&&!i.isWalkableAt(t+1,e-a)))return[t,e];return i.isWalkableAt(t+o,e)&&i.isWalkableAt(t,e+a)?this._jump(t+o,e+a,t,e):null};n.prototype._findNeighbors=function(t){var e,n,r,o,a,u,s,c,l=t.parent,f=t.x,p=t.y,h=this.grid,d=[];if(l){e=l.x;n=l.y;r=(f-e)/Math.max(Math.abs(f-e),1);o=(p-n)/Math.max(Math.abs(p-n),1);if(0!==r&&0!==o){h.isWalkableAt(f,p+o)&&d.push([f,p+o]);h.isWalkableAt(f+r,p)&&d.push([f+r,p]);h.isWalkableAt(f,p+o)&&h.isWalkableAt(f+r,p)&&d.push([f+r,p+o])}else{var g;if(0!==r){g=h.isWalkableAt(f+r,p);var v=h.isWalkableAt(f,p+1),y=h.isWalkableAt(f,p-1);if(g){d.push([f+r,p]);v&&d.push([f+r,p+1]);y&&d.push([f+r,p-1])}v&&d.push([f,p+1]);y&&d.push([f,p-1])}else if(0!==o){g=h.isWalkableAt(f,p+o);var _=h.isWalkableAt(f+1,p),m=h.isWalkableAt(f-1,p);if(g){d.push([f,p+o]);_&&d.push([f+1,p+o]);m&&d.push([f-1,p+o])}_&&d.push([f+1,p]);m&&d.push([f-1,p])}}}else{a=h.getNeighbors(t,i.OnlyWhenNoObstacles);for(s=0,c=a.length;c>s;++s){u=a[s];d.push([u.x,u.y])}}return d};e.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],21:[function(t,e){function n(t){r.call(this,t)}var r=t("./JumpPointFinderBase"),i=t("../core/DiagonalMovement");n.prototype=new r;n.prototype.constructor=n;n.prototype._jump=function(t,e,n,r){var i=this.grid,o=t-n,a=e-r;if(!i.isWalkableAt(t,e))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(t,e).tested=!0);if(i.getNodeAt(t,e)===this.endNode)return[t,e];if(0!==o){if(i.isWalkableAt(t,e-1)&&!i.isWalkableAt(t-o,e-1)||i.isWalkableAt(t,e+1)&&!i.isWalkableAt(t-o,e+1))return[t,e]}else{if(0===a)throw new Error("Only horizontal and vertical movements are allowed");if(i.isWalkableAt(t-1,e)&&!i.isWalkableAt(t-1,e-a)||i.isWalkableAt(t+1,e)&&!i.isWalkableAt(t+1,e-a))return[t,e];if(this._jump(t+1,e,t,e)||this._jump(t-1,e,t,e))return[t,e]}return this._jump(t+o,e+a,t,e)};n.prototype._findNeighbors=function(t){var e,n,r,o,a,u,s,c,l=t.parent,f=t.x,p=t.y,h=this.grid,d=[];if(l){e=l.x;n=l.y;r=(f-e)/Math.max(Math.abs(f-e),1);o=(p-n)/Math.max(Math.abs(p-n),1);if(0!==r){h.isWalkableAt(f,p-1)&&d.push([f,p-1]);h.isWalkableAt(f,p+1)&&d.push([f,p+1]);h.isWalkableAt(f+r,p)&&d.push([f+r,p])}else if(0!==o){h.isWalkableAt(f-1,p)&&d.push([f-1,p]);h.isWalkableAt(f+1,p)&&d.push([f+1,p]);h.isWalkableAt(f,p+o)&&d.push([f,p+o])}}else{a=h.getNeighbors(t,i.Never);for(s=0,c=a.length;c>s;++s){u=a[s];d.push([u.x,u.y])}}return d};e.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],22:[function(t,e){function n(t){t=t||{};return t.diagonalMovement===r.Never?new i(t):t.diagonalMovement===r.Always?new o(t):t.diagonalMovement===r.OnlyWhenNoObstacles?new a(t):new u(t)}var r=t("../core/DiagonalMovement"),i=t("./JPFNeverMoveDiagonally"),o=t("./JPFAlwaysMoveDiagonally"),a=t("./JPFMoveDiagonallyIfNoObstacles"),u=t("./JPFMoveDiagonallyIfAtMostOneObstacle");e.exports=n},{"../core/DiagonalMovement":3,"./JPFAlwaysMoveDiagonally":18,"./JPFMoveDiagonallyIfAtMostOneObstacle":19,"./JPFMoveDiagonallyIfNoObstacles":20,"./JPFNeverMoveDiagonally":21}],23:[function(t,e){function n(t){t=t||{};this.heuristic=t.heuristic||o.manhattan;this.trackJumpRecursion=t.trackJumpRecursion||!1}{var r=t("heap"),i=t("../core/Util"),o=t("../core/Heuristic");t("../core/DiagonalMovement")}n.prototype.findPath=function(t,e,n,o,a){var u,s=this.openList=new r(function(t,e){return t.f-e.f}),c=this.startNode=a.getNodeAt(t,e),l=this.endNode=a.getNodeAt(n,o);this.grid=a;c.g=0;c.f=0;s.push(c);c.opened=!0;for(;!s.empty();){u=s.pop();u.closed=!0;if(u===l)return i.expandPath(i.backtrace(l));this._identifySuccessors(u)}return[]};n.prototype._identifySuccessors=function(t){{var e,n,r,i,a,u,s,c,l,f,p=this.grid,h=this.heuristic,d=this.openList,g=this.endNode.x,v=this.endNode.y,y=t.x,_=t.y,m=Math.abs;Math.max}e=this._findNeighbors(t);for(i=0,a=e.length;a>i;++i){n=e[i];r=this._jump(n[0],n[1],y,_);if(r){u=r[0];s=r[1];f=p.getNodeAt(u,s);if(f.closed)continue;c=o.octile(m(u-y),m(s-_));l=t.g+c;if(!f.opened||l<f.g){f.g=l;f.h=f.h||h(m(u-g),m(s-v));f.f=f.g+f.h;f.parent=t;if(f.opened)d.updateItem(f);else{d.push(f);f.opened=!0}}}}};e.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}]},{},[8])(8)});var RVO=RVO||{};RVO.Agent=function(t){this.sim=t;this.agentNeighbors=[];this.maxNeighbors=0;this.maxSpeed=0;this.neighborDist=0;this.newVelocity=[0,0];this.obstacleNeighbors=[];this.orcaLines=[];this.position=[0,0];this.sim=t;this.timeHorizon=0;this.timeHorizonObst=0;this.velocity=[0,0];this.id=0};RVO.Agent.prototype.computeNeighbors=function(){this.obstacleNeighbors=[];var t=RVO.sqr(this.timeHorizonObst*this.maxSpeed+this.radius);this.sim.kdTree.computeObstacleNeighbors(this,t);this.agentNeighbors=[];if(this.maxNeighbors>0){t=RVO.sqr(this.neighborDist);this.sim.kdTree.computeAgentNeighbors(this,t)}};RVO.Agent.prototype.computeNewVelocity=function(){this.orcaLines=[];for(var t=1/this.timeHorizonObst,e=0,n=this.obstacleNeighbors.length;n>e;++e){for(var r=this.obstacleNeighbors[e][1],i=r.nextObstacle,o=RVO.Vector.subtract(r.point,this.position),a=RVO.Vector.subtract(i.point,this.position),u=!1,s=0,c=this.orcaLines.length;c>s;++s)if(RVO.Vector.det(RVO.Vector.multiply(RVO.Vector.subtract(o,this.orcaLines[s][0]),t),this.orcaLines[s][1])-t*this.radius>=-RVO.EPSILON&&RVO.Vector.det(RVO.Vector.multiply(RVO.Vector.subtract(a,this.orcaLines[s][0]),t),this.orcaLines[s][1])-t*this.radius>=-RVO.EPSILON){u=!0;break}if(!u){var l=RVO.Vector.absSq(o),f=RVO.Vector.absSq(a),p=RVO.sqr(this.radius),h=RVO.Vector.subtract(i.point,r.point),d=RVO.Vector.dotProduct(RVO.Vector.invert(o),h)/RVO.Vector.absSq(h),g=RVO.Vector.absSq(RVO.Vector.subtract(RVO.Vector.invert(o),RVO.Vector.multiply(h,d))),v=new Array(2);if(0>d&&p>=l){if(r.isConvex){v[0]=[0,0];v[1]=RVO.Vector.normalize([-o[1],o[0]]);this.orcaLines.push(v)}}else if(d>1&&p>=f){if(i.isConvex&&RVO.Vector.det(a,i.unitDir)>=0){v[0]=[0,0];v[1]=RVO.Vector.normalize([-a[1],a[0]]);this.orcaLines.push(v)}}else if(d>=0&&1>d&&p>=g){v[0]=[0,0];v[1]=RVO.Vector.invert(r.unitDir);this.orcaLines.push(v)}else{var y,_;if(0>d&&p>=g){if(!r.isConvex)continue;i=r;var m=Math.sqrt(l-p);y=RVO.Vector.divide([o[0]*m-o[1]*this.radius,o[0]*this.radius+o[1]*m],l);_=RVO.Vector.divide([o[0]*m-o[1]*this.radius,-o[0]*this.radius+o[1]*m],l)}else if(d>1&&p>=g){if(!i.isConvex)continue;r=i;var b=Math.sqrt(f-p);y=RVO.Vector.divide([a[0]*b-a[1]*this.radius,a[0]*this.radius+a[1]*b],f);_=RVO.Vector.divide([a[0]*b-a[1]*this.radius,-a[0]*this.radius+a[1]*b],f)}else{if(r.isConvex){m=Math.sqrt(l-p);y=RVO.Vector.divide([o[0]*m-o[1]*this.radius,o[0]*this.radius+o[1]*m],l)}else y=RVO.Vector.invert(r.unitDir);if(i.isConvex){b=Math.sqrt(f-p);_=RVO.Vector.divide([a[0]*b-a[1]*this.radius,-a[0]*this.radius+a[1]*b],f)}else _=r.unitDir}var V=r.prevObstacle,x=!1,O=!1;if(r.isConvex&&RVO.Vector.det(y,RVO.Vector.invert(V.unitDir))>=0){y=RVO.Vector.invert(V.unitDir);x=!0}if(i.isConvex&&RVO.Vector.det(_,i.unitDir)<=0){_=RVO.Vector.invert(i.unitDir);O=!0}var R=RVO.Vector.multiply(RVO.Vector.subtract(r.point,this.position),t),w=RVO.Vector.multiply(RVO.Vector.subtract(i.point,this.position),t),A=RVO.Vector.subtract(w,R),k=r==i?.5:RVO.Vector.dotProduct(RVO.Vector.subtract(this.velocity,R),A)/RVO.Vector.absSq(A),P=RVO.Vector.dotProduct(RVO.Vector.subtract(this.velocity,R),y),N=RVO.Vector.dotProduct(RVO.Vector.subtract(this.velocity,w),_);if(0>k&&0>P||r==i&&0>P&&0>N){var M=RVO.Vector.normalize(RVO.Vector.subtract(this.velocity,R));v[1]=[M[1],-M[0]];v[0]=RVO.Vector.add(RVO.Vector.multiply(M,this.radius*t),R);this.orcaLines.push(v)}else if(k>1&&0>N){var M=RVO.Vector.normalize(RVO.Vector.subtract(this.velocity,w));v[1]=[M[1],-M[0]];v[0]=RVO.Vector.add(RVO.Vector.multiply(M,this.radius*t),w);this.orcaLines.push(v)}else{var W=0>k||k>1||r==i?1/0:RVO.Vector.absSq(RVO.Vector.subtract(this.velocity,RVO.Vector.add(R,RVO.Vector.multiply(A,k)))),T=0>P?1/0:RVO.Vector.absSq(RVO.Vector.subtract(this.velocity,RVO.Vector.add(R,RVO.Vector.multiply(y,P)))),L=0>N?1/0:RVO.Vector.absSq(RVO.Vector.subtract(this.velocity,RVO.Vector.add(w,RVO.Vector.multiply(_,N))));
if(T>=W&&L>=W){v[1]=RVO.Vector.invert(r.unitDir);v[0]=RVO.Vector.add(R,RVO.Vector.multiply([-v[1][1],v[1][0]],this.radius*t));this.orcaLines.push(v)}else if(L>=T){if(x)continue;v[1]=y;v[0]=RVO.Vector.add(R,RVO.Vector.multiply([-v[1][1],v[1][0]],this.radiuis*t));this.orcaLines.push(v)}else if(!O){v[1]=RVO.Vector.invert(_);v[0]=RVO.Vector.add(w,RVO.Vector.multiply([v[1][1],v[1][0]],this.radius*t));this.orcaLines.push(v)}}}}}for(var S=this.orcaLines.length,j=1/this.timeHorizon,e=0,D=this.agentNeighbors.length;D>e;++e){var I=this.agentNeighbors[e][1],C=RVO.Vector.subtract(I.position,this.position),F=RVO.Vector.subtract(this.velocity,I.velocity),q=RVO.Vector.absSq(C),E=this.radius+I.radius,B=RVO.sqr(E),v=new Array(2);if(q>B){var U=RVO.Vector.subtract(F,RVO.Vector.multiply(C,j)),z=RVO.Vector.absSq(U),H=RVO.Vector.dotProduct(U,C);if(0>H&&RVO.sqr(H)>B*z){var $=Math.sqrt(z),M=RVO.Vector.divide(U,$),X=RVO.Vector.multiply(M,E*j-$);v[1]=[M[1],-M[0]]}else{var Y=Math.sqrt(q-E);v[1]=RVO.Vector.det(C,U)>0?RVO.Vector.divide([C[0]*Y-C[1]*E,C[0]*E+C[1]*Y],q):RVO.Vector.divide(RVO.Vector.invert([C[0]*Y-C[1]*E,C[0]*E+C[1]*Y]),q);var J=RVO.Vector.dotProduct(F,v[1]),X=RVO.Vector.multiply(RVO.Vector.subtract(v[1],F),J)}}else{var K=1/this.sim.timeStep,U=RVO.Vector.subtract(F,RVO.Vector.multiply(C,K)),$=RVO.Vector.abs(U),M=RVO.Vector.divide(U,$),X=RVO.Vector.multiply(M,E*K-$);v[1]=[M[1],-M[0]]}v[0]=RVO.Vector.add(this.velocity,RVO.Vector.multiply(X,.5));this.orcaLines.push(v)}var G=RVO.Agent.linearProgram2(this.orcaLines,this.maxSpeed,this.prefVelocity,!1,this.newVelocity);G<this.orcaLines.length&&RVO.Agent.linearProgram3(this.orcaLines,S,G,this.maxSpeed,this.newVelocity)};RVO.Agent.prototype.insertAgentNeighbor=function(t,e){if(this!=t){var n=RVO.Vector.absSq(RVO.Vector.subtract(this.position,t.position));if(e>n){this.agentNeighbors.length<this.maxNeighbors&&this.agentNeighbors.push([n,t]);for(var r=this.agentNeighbors.length-1;0!=r&&n<this.agentNeighbors[r-1][0];){this.agentNeighbors[r]=this.agentNeighbors[r-1];--r}this.agentNeighbors[r]=[n,t];if(this.agentNeighbors.length==this.maxNeighbors)var e=this.agentNeighbors[this.agentNeighbors.length-1][0]}}return e};RVO.Agent.prototype.insertObstacleNeighbor=function(t,e){var n=t.nextObstacle,r=RVO.Vector.distSqPointLineSegment(t.point,n.point,this.position);if(e>r){this.obstacleNeighbors.push([r,t]);for(var i=this.obstacleNeighbors.length-1;0!=i&&r<this.obstacleNeighbors[i-1][0];){this.obstacleNeighbors[i]=this.obstacleNeighbors[i-1];--i}this.obstacleNeighbors[i]=[r,t]}};RVO.Agent.prototype.update=function(){this.velocity=this.newVelocity;RVO.Vector.shift(this.position,RVO.Vector.multiply(this.velocity,this.sim.timeStep))};RVO.Agent.linearProgram1=function(t,e,n,r,i,o){var a=RVO.Vector.dotProduct(t[e][0],t[e][1]),u=RVO.sqr(a)+RVO.sqr(n)-RVO.Vector.absSq(t[e][0]);if(0>u)return!1;for(var s=Math.sqrt(u),c=-a-s,l=-a+s,f=0;e>f;++f){var p=RVO.Vector.det(t[e][1],t[f][1]),h=RVO.Vector.det(t[f][1],RVO.Vector.subtract(t[e][0],t[f][0]));if(Math.abs(p)<=RVO.EPSILON){if(0>h)return!1}else{var d=h/p;p>0?l=Math.min(l,d):c=Math.max(c,d);if(c>l)return!1}}if(i)RVO.Vector.dotProduct(r,t[e][1])>0?RVO.Vector.set(o,RVO.Vector.add(t[e][0],RVO.Vector.multiply(t[e][1],l))):RVO.Vector.set(o,RVO.Vector.add(t[e][0],RVO.Vector.multiply(t[e][1],c)));else{d=RVO.Vector.dotProduct(t[e][1],RVO.Vector.subtract(r,t[e][0]));c>d?RVO.Vector.set(o,RVO.Vector.add(t[e][0],RVO.Vector.multiply(t[e][1],c))):d>l?RVO.Vector.set(o,RVO.Vector.add(t[e][0],RVO.Vector.multiply(t[e][1],l))):RVO.Vector.set(o,RVO.Vector.add(t[e][0],RVO.Vector.multiply(t[e][1],d)))}return!0};RVO.Agent.linearProgram2=function(t,e,n,r,i){r?RVO.Vector.set(i,RVO.Vector.multiply(n,e)):RVO.Vector.absSq(n)>RVO.sqr(e)?RVO.Vector.set(i,RVO.Vector.multiply(RVO.Vector.normalize(n),e)):RVO.Vector.set(i,n);for(var o=0,a=t.length;a>o;++o)if(RVO.Vector.det(t[o][1],RVO.Vector.subtract(t[o][0],i))>0){var u=i.slice();if(!RVO.Agent.linearProgram1(t,o,e,n,r,i)){RVO.Vector.set(i,u);return o}}return t.length};RVO.Agent.linearProgram3=function(t,e,n,r,i){for(var o=0,a=n,u=t.length;u>a;++a)if(RVO.Vector.det(t[a][1],RVO.Vector.subtract(t[a][0],i))>o){for(var s=t.slice(0,e),c=e;a>c;++c){var l=new Array(2),f=RVO.Vector.det(t[a][1],t[c][1]);if(Math.abs(f)<=RVO.EPSILON){if(RVO.Vector.dotProduct(t[a][1],t[c][1])>0)continue;l[0]=RVO.Vector.multiply(RVO.Vector.add(t[a][0],t[c][0]),.5)}else l[0]=RVO.Vector.add(t[a][0],RVO.Vector.multiply(t[a][1],RVO.Vector.det(t[c][1],RVO.Vector.subtract(t[a][0],t[c][0]))/f));l[1]=RVO.Vector.normalize(RVO.Vector.subtract(t[c][1],t[a][1]));s.push(l)}var p=i.slice();RVO.Agent.linearProgram2(s,r,[-t[a][1][1],t[a][1][0]],!0,i)<s.length&&RVO.Vector.set(i,p);o=RVO.Vector.det(t[a][1],RVO.Vector.subtract(t[a][0],i))}};var RVO=RVO||{};RVO.KdTree=function(t){this.sim=t;this.agents=[];this.agentTree=[];this.obstacleTree=0};RVO.KdTree.MAX_LEAF_SIZE=10;RVO.KdTree.prototype.buildAgentTree=function(){if(this.agents.length<this.sim.agents.length)for(var t=this.agents.length,e=this.sim.agents.length;e>t;++t)this.agents.push(this.sim.agents[t]);this.agentTree=[];this.agents.length&&this.buildAgentTreeRecursive(0,this.agents.length,0)};RVO.KdTree.prototype.buildAgentTreeRecursive=function(t,e,n){var r=this.agentTree[n]=new RVO.KdTree.AgentTreeNode;r.begin=t;r.end=e;r.minX=r.maxX=this.agents[t].position[0];r.minY=r.maxY=this.agents[t].position[1];for(var i=t+1;e>i;++i){r.maxX=Math.max(r.maxX,this.agents[i].position[0]);r.minX=Math.min(r.minX,this.agents[i].position[0]);r.maxY=Math.max(r.maxY,this.agents[i].position[1]);r.minY=Math.min(r.minY,this.agents[i].position[1])}if(e-t>RVO.KdTree.MAX_LEAF_SIZE){for(var o=r.maxX-r.minX>r.maxY-r.minY,a=o?.5*(r.maxX+r.minX):.5*(r.maxY+r.minY),u=t,s=e-1;;){for(;s>=u&&(o?this.agents[u].position[0]:this.agents[u].position[1])<a;)++u;for(;s>=u&&(o?this.agents[s].position[0]:this.agents[s].position[1])>=a;)--s;if(u>s)break;var c=this.agents[s];this.agents[s]=this.agents[u];this.agents[u]=c;++u;--s}var l=u-t;if(0==l){++l;++u;++s}r.left=n+1;r.right=n+1+(2*l-1);this.buildAgentTreeRecursive(t,u,r.left);this.buildAgentTreeRecursive(u,e,r.right)}};RVO.KdTree.prototype.buildObstacleTree=function(){for(var t=[],e=0,n=this.sim.obstacles.length;n>e;++e)t[e]=this.sim.obstacles[e];this.obstacleTree=this.buildObstacleTreeRecursive(t)};RVO.KdTree.prototype.buildObstacleTreeRecursive=function(t){if(t.length){for(var e=new RVO.KdTree.ObstacleTreeNode,n=0,r=t.length,i=r,o=r,a=0;r>a;++a){for(var u=0,s=0,c=t[a],l=c.nextObstacle,f=0;r>f;++f)if(a!=f){var p=t[f],h=p.nextObstacle,d=RVO.Vector.leftOf(c.point,l.point,p.point),g=RVO.Vector.leftOf(c.point,l.point,h.point);if(d>=-RVO.EPSILON&&g>=-RVO.EPSILON)++u;else if(d<=RVO.EPSILON&&g<=RVO.EPSILON)++s;else{++u;++s}if(Math.max(u,s)>=Math.min(i,o)||Math.min(u,s)>=Math.min(i,o))break}if(Math.max(u,s)<Math.max(i,o)||Math.min(u,s)<Math.min(i,o)){i=u;o=s;n=a}}for(var v=[],y=[],a=n,c=t[a],l=c.nextObstacle,f=0,_=t.length;_>f;++f)if(a!=f){var p=t[f],h=p.nextObstacle,d=RVO.Vector.leftOf(c.point,l.point,p.point),g=RVO.Vector.leftOf(c.point,l.point,h.point);if(d>=-RVO.EPSILON&&g>=-RVO.EPSILON)v.push(t[f]);else if(d<=RVO.EPSILON&&g<=RVO.EPSILON)y.push(t[f]);else{var m=RVO.Vector.det(RVO.Vector.subtract(l.point,c.point),RVO.Vector.subtract(p.point,c.point))/RVO.Vector.det(RVO.Vector.subtract(l.point,c.point),RVO.Vector.subtract(p.point,h.point)),b=RVO.Vector.add(RVO.Vector.multiply(RVO.Vector.subtract(p.point,h.point),m),p.point),V=new RVO.Obstacle;V.point=b;V.prevObstacle=p;V.nextObstacle=h;V.isConvex=!0;V.unitTDir=p.unitDir;V.id=this.sim.obstacles.length;this.sim.obstacles.push(V);p.nextObstacle=V;h.prevObstacle=V;if(d>0){v.push(p);y.push(V)}else{y.push(p);v.push(V)}}}e.obstacle=c;e.left=this.buildObstacleTreeRecursive(v);e.right=this.buildObstacleTreeRecursive(y);return e}return 0};RVO.KdTree.prototype.computeAgentNeighbors=function(t,e){this.queryAgentTreeRecursive(t,e,0)};RVO.KdTree.prototype.computeObstacleNeighbors=function(t,e){this.queryObstacleTreeRecursive(t,e,this.obstacleTree)};RVO.KdTree.prototype.queryAgentTreeRecursive=function(t,e,n){var r=this.agentTree[n],i=e;if(r.end-r.begin<=RVO.KdTree.MAX_LEAF_SIZE)for(var o=r.begin,a=r.end;a>o;++o)i=t.insertAgentNeighbor(this.agents[o],i);else{var u=0,s=0,c=this.agentTree[r.left],l=this.agentTree[r.right];t.position[0]<c.minX?u+=RVO.sqr(c.minX-t.position[0]):t.position[0]>c.maxX&&(u+=RVO.sqr(t.position[0]-c.maxX));t.position[1]<c.minY?u+=RVO.sqr(c.minY-t.position[1]):t.position[1]>c.maxY&&(u+=RVO.sqr(t.position[1]-c.maxY));t.position[0]<l.minX?s+=RVO.sqr(l.minX-t.position[0]):t.position[0]>l.maxX&&(s+=RVO.sqr(t.position[0]-l.maxX));t.position[1]<l.minY?s+=RVO.sqr(l.minY-t.position[1]):t.position[1]>l.maxY&&(s+=RVO.sqr(t.position[1]-l.maxY));if(s>u){if(e>u){i=this.queryAgentTreeRecursive(t,i,r.left);e>s&&(i=this.queryAgentTreeRecursive(t,i,r.right))}}else if(e>s){i=this.queryAgentTreeRecursive(t,i,r.right);e>u&&(i=this.queryAgentTreeRecursive(t,i,r.left))}}return i};RVO.KdTree.prototype.queryObstacleTreeRecursive=function(t,e,n){if(0!=n){var r=n.obstacle,i=r.nextObstacle,o=RVO.Vector.leftOf(r.point,i.point,t.position),a=RVO.sqr(o)/RVO.Vector.absSq(RVO.Vector.subtract(i.point,r.point));this.queryObstacleTreeRecursive(t,e,o>=0?n.left:n.right);if(e>a){0>o&&t.insertObstacleNeighbor(n.obstacle,e);this.queryObstacleTreeRecursive(t,e,o>=0?n.right:n.left)}}};RVO.KdTree.prototype.queryVisibility=function(t,e,n){return this.queryVisibilityRecursive(t,e,n,this.obstacleTree)};RVO.KdTree.prototype.queryVisibilityRecursive=function(t,e,n,r){if(-1==r.obstacleNo)return!0;var i=this.sim.obstacles[r.obstacleNo],o=RVO.Vector.leftOf(i.point1,i.point2,t),a=RVO.Vector.leftOf(i.point1,i.point2,e);if(o>=0&&a>=0)return this.queryVisibilityRecursive(t,e,n,r.left);if(0>=o&&0>=a)return this.queryVisibilityRecursive(t,e,n,r.right);var u=RVO.Vector.leftOf(t,e,i.point1),s=RVO.Vector.leftOf(t,e,i.point2),c=1/RVO.Vector.absSq(RVO.Vector.subtract(e,t));return u*s>=0&&RVO.sqr(u)*c>=RVO.sqr(n)&&RVO.sqr(s)*c>=RVO.sqr(n)&&this.queryVisibilityRecursive(t,e,n,r.left)&&this.queryVisibilityRecursive(t,e,n,r.right)};RVO.KdTree.AgentTreeNode=function(){this.begin=0;this.end=0;this.minX=0;this.minY=0;this.maxX=0;this.maxY=0;this.left=0;this.right=0};RVO.KdTree.ObstacleTreeNode=function(){this.left=null;this.right=null;this.obstacle=0};var RVO=RVO||{};RVO.Obstacle=function(){this.isConvex=!1;this.nextobstacle=0;this.point=[0,0];this.prevObstacle=0;this.unitDir=[0,0];this.id=0};var RVO=RVO||{};RVO.EPSILON=1e-5;RVO.agentDefaults={neighborDist:50,maxNeighbors:5,maxSpeed:1,radius:10,timeHorizon:10,velocity:[0,0]};RVO.sqr=function(t){return t*t};"function"==typeof define&&define.amd&&define.amd.RVO&&define("RVO",[],function(){return RVO});"object"==typeof module&&module.exports&&(module.exports=RVO);var RVO=RVO||{};RVO.Simulator=function(t,e,n,r,i,o,a,u){this.timeStep=t;this.agents=[];this.globalTime=0;this.obstacles=[];this.kdTree=new RVO.KdTree(this);this.agentDefaults={};this.agentDefaults.neighborDist=e||RVO.agentDefaults.neighborDist;this.agentDefaults.maxNeighbors=n||RVO.agentDefaults.maxNeighbors;this.agentDefaults.maxSpeed=a||RVO.agentDefaults.maxSpeed;this.agentDefaults.radius=o||RVO.agentDefaults.radius;this.agentDefaults.timeHorizon=r||RVO.agentdefaults.timeHorizon;this.agentDefaults.timeHorizonObst=i||RVO.agentDefaults.timeHorizonObst;this.agentDefaults.velocity=u||RVO.agentdefaults.velocity};RVO.Simulator.prototype.addAgent=function(t,e,n,r,i,o,a,u){var s=new RVO.Agent(this);s.position=t||this.agentDefaults.position;s.maxNeighbors=n||this.agentDefaults.maxNeighbors;s.maxSpeed=a||this.agentDefaults.maxSpeed;s.neighborDist=e||this.agentDefaults.neighborDist;s.radius=o||this.agentDefaults.radius;s.timeHorizon=r||this.agentDefaults.timeHorizon;s.timeHorizonObst=i||this.agentDefaults.timeHorizonObst;s.velocity=u||this.agentDefaults.velocity;s.id=this.agents.length;this.agents.push(s);return this.agents.length-1};RVO.Simulator.prototype.addObstacle=function(t){if(t.length<2)throw new Error("Obstacle created with less than two vertices");for(var e=this.obstacles.length,n=0,r=t.length;r>n;++n){var i=new RVO.Obstacle;i.point=t[n];if(0!=n){i.prevObstacle=this.obstacles[this.obstacles.length-1];i.prevObstacle.nextObstacle=i}if(n==t.length-1){i.nextObstacle=this.obstacles[e];i.nextObstacle.prevObstacle=i}i.unitDir=RVO.Vector.normalize(RVO.Vector.subtract(t[n==t.length-1?0:n+1],t[n]));i.isConvex=2==t.length?!0:RVO.Vector.leftOf(t[0==n?t.length-1:n-1],t[n],t[n==t.length-1?0:n+1])>=0;i.id=this.obstacles.length;this.obstacles.push(i)}return e};RVO.Simulator.prototype.processObstacles=function(){this.kdTree.buildObstacleTree()};RVO.Simulator.prototype.doStep=function(){this.kdTree.buildAgentTree();for(var t=0,e=this.agents.length;e>t;++t){this.agents[t].computeNeighbors();this.agents[t].computeNewVelocity()}for(var t=0,e=this.agents.length;e>t;++t)this.agents[t].update();this.globalTime+=this.timeStep};var RVO=RVO||{};RVO.Vector={};RVO.Vector.invert=function(t){return[-t[0],-t[1]]};RVO.Vector.dotProduct=function(t,e){return t[0]*e[0]+t[1]*e[1]};RVO.Vector.multiply=function(t,e){return[t[0]*e,t[1]*e]};RVO.Vector.divide=function(t,e){return[t[0]/e,t[1]/e]};RVO.Vector.add=function(t,e){return[t[0]+e[0],t[1]+e[1]]};RVO.Vector.subtract=function(t,e){return[t[0]-e[0],t[1]-e[1]]};RVO.Vector.shift=function(t,e){t[0]+=e[0];t[1]+=e[1];return t};RVO.Vector.set=function(t,e){t[0]=e[0];t[1]=e[1];return t};RVO.Vector.abs=function(t){return Math.sqrt(RVO.Vector.dotProduct(t,t))};RVO.Vector.absSq=function(t){return RVO.Vector.dotProduct(t,t)};RVO.Vector.det=function(t,e){return t[0]*e[1]-t[1]*e[0]};RVO.Vector.normalize=function(t){return RVO.Vector.divide(t,RVO.Vector.abs(t))};RVO.Vector.leftOf=function(t,e,n){return RVO.Vector.det(RVO.Vector.subtract(t,n),RVO.Vector.subtract(e,t))};RVO.Vector.distSqPointLineSegment=function(t,e,n){var r=RVO.Vector.subtract(e,t),i=RVO.Vector.dotProduct(RVO.Vector.subtract(n,t),r)/RVO.Vector.absSq(r);return RVO.Vector.absSq(0>i?RVO.Vector.subtract(n,t):i>1?RVO.Vector.subtract(n,e):RVO.Vector.subtract(n,RVO.Vector.add(RVO.Vector.multiply(r,i),t)))};define("standardlib",["eventmanager"],function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function e(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function n(t){var e=(t.x+t.y)/2,n=(t.y-t.x)/2;return{x:e,y:n}}function r(t){var e={};e.x=(t.x-t.y)/2;e.y=(t.x+t.y)/2;return e}function i(t){t=_.cloneDeep(t);coords={};t.x=t.x-app.config.actor.grid.width/2*app.config.actor.tile.width;coords.x=(t.x/(app.config.actor.tile.width/2)+t.y/(app.config.actor.tile.height/2))/2;coords.y=(t.y/(app.config.actor.tile.height/2)-t.x/(app.config.actor.tile.width/2))/2;coords.x=Math.floor(coords.x);coords.y=Math.floor(coords.y);return coords}function o(t){var e=i(t);return r({x:e.x,y:e.y})}function a(t){t=_.cloneDeep(t);t.x=t.x-app.config.actor.grid.width/2*app.config.actor.tile.width;var e={};e.x=(t.x+t.y)/2;e.y=(t.y-t.x)/2;return e}function u(t){t=_.cloneDeep(t);t={x:t.x/app.config.actor.car.width,y:t.y/app.config.actor.car.height};var e=(t.x-t.y)/2,n=(t.x+t.y)/2;e*=app.config.actor.tile.width;n*=app.config.actor.tile.height;e+=app.config.actor.grid.width/2*app.config.actor.tile.width;return{x:e,y:n}}function s(t){var e=r({x:t.x,y:t.y}),n=e.y*app.config.actor.tile.height,i=e.x*app.config.actor.tile.width+app.config.actor.grid.width/2*app.config.actor.tile.width;return{x:i,y:n}}function c(t){var e=r({x:t.x,y:t.y}),n=e.y*app.config.terrain.tile.height,i=e.x*app.config.terrain.tile.width+app.config.terrain.grid.width/2*app.config.terrain.tile.width;return{x:i,y:n}}function l(t,e){var n=setInterval(function(){t()&&clearInterval(n)},1e3)}return{guid:e,isoToTwoD:n,twoDToIso:r,worldPosToGridPos:i,worldPosToIsoPos:o,gridPosToWorldPos:s,terrainGridPosToWorldPos:c,isoWorldPosToCarWorldPos:a,carWorldPosToIsoWorldPos:u,checkWait:l}});define("center",["eventmanager"],function(t){function e(){var e={x:0,y:0};1===i.up&&(e.y=e.y-1);1===i.down&&(e.y=e.y+1);1===i.left&&(e.x=e.x-1);1===i.right&&(e.x=e.x+1);if(0!==e.x||0!==e.y){e={x:r.x+e.x,y:r.y+e.y};r.x=e.x;r.y=e.y;t.publish("center.update.start")}else t.publish("center.update.stop")}function n(t,e){var n={};n.x=(t-e)/2;n.y=(t+e)/2;return n}var r=n(0,0),i={up:0,down:0,left:0,right:0};t.subscribe("new.frame",function(){e()});t.subscribe("pan.up",function(t){i.up=t});t.subscribe("pan.down",function(t){i.down=t});t.subscribe("pan.left",function(t){i.left=t});t.subscribe("pan.right",function(t){i.right=t});return r});define("collisionGrid",["eventmanager","PF","RVO","standardlib","world","center"],function(t,e,n,r,i){function o(t){for(var e=[],n=2,r=0;r<t.length;r++)for(var i=0;n>i;i++){var o=r*n+i;e[o]=[];for(var a=0;a<t[0].length;a++)for(var u=0;n>u;u++){var s=a*n+u;e[o][s]=t[r][a]}}return e}var a={};a.updateQueue=[];a.debugGrid={};a.init=function(){a.grid=a.fillmap(app.config.terrain.grid.height,app.config.terrain.grid.width);a.simulator=new n.Simulator(4,900,10,5,5,20,1,[0,0]);for(var t=0;t<i.grid.length;t++)for(var u=0;u<i.grid[0].length;u++){var s=i.grid[t][u]-1;if("false"===app.config.terrain.tileSet.tileproperties[s].walkable){a.grid[u][t]=1;var c=r.terrainGridPosToWorldPos({x:u,y:t,type:"terrain"});c.y=c.y-15;a.simulator.addObstacle([[c.x,c.y-app.config.terrain.tile.height/2],[c.x+app.config.terrain.tile.width/2,c.y],[c.x,c.y+app.config.terrain.tile.height/2],[c.x-app.config.terrain.tile.width/2,c.y]])}}a.grid=o(a.grid);a.graph=new e.Grid(a.grid.length,a.grid[0].length,a.grid);a.simulator.processObstacles()};a.update=function(t){var n=a.generateUpdateArray({grid:t.too,height:t.height,width:t.width}),r=a.generateUpdateArray({grid:t.from,height:t.height,width:t.width}),i=a.intersect(n,r),o=!0;_.each(i,function(t){0!==a.grid[t.x][t.y]&&(o=!1)});if(o){_.each(r,function(t){a.grid[t.x][t.y]=0});_.each(n,function(t){a.grid[t.x][t.y]=1});a.graph=new e.Grid(a.grid.length,a.grid[0].length,a.grid);"undefined"!=typeof t.success&&t.success()}else"undefined"!=typeof t.failure&&t.failure(n)};a.generateUpdateArray=function(t){var e=[];if("undefined"!=typeof t.grid)for(var n=0;n<t.height;n++)for(var r=0;r<t.width;r++)e.push({x:t.grid.x+r,y:t.grid.y+n});return e};a.intersect=function(t,e){var n=[];_.each(t,function(t){_.findWhere(e,t)||n.push(t)});return n};a.PolygonToGridCoordinates=function(t){var e=[];_.each(t.polygon,function(n){var r={x:(n.x+t.x)/app.config.terrain.tile.height,y:(n.y+t.y)/app.config.terrain.tile.height};e.push(r)});return e};a.PolygonToIsoWorldCoordinates=function(t){var e=[];_.each(t.polygon,function(n){var i=r.carWorldPosToIsoWorldPos({x:n.x+t.x,y:n.y+t.y});e.push(i)});return e};a.fillmap=function(t,e){var n,r,i=[];for(n=0;t>n;n++){i[n]=[];for(r=0;e>r;r++)i[n][r]=0}return i};a.isOpen=function(t){return 0===a.grid[t["new"].y][t["new"].x]};a.setSubGrid=function(t){for(var e=[],n=0;n<t.size.y;n++){e[n]=[];for(var r=0;r<t.size.x;r++)a.grid[t.start.x+r][t.start.y+n]=1}};a.init();return a});define("commandQueue",[""],function(){function t(t){r.push(t)}function e(){r=[]}function n(){return r}var r=[];return{add:t,get:n,clear:e}});define("command",["commandQueue","eventmanager"],function(t,e){function n(e){t.add(e)}function r(){var n=t.get();_.forEach(n,function(t){e.publish(t.event,t.parameters)});t.clear()}e.subscribe("command",function(t){n(t)});e.subscribe("new.gamecycle",function(){r()})});define("gamecycle",["eventmanager","command"],function(t){function e(){n()}function n(){setTimeout(n,app.config.cycle);t.publish("new.gamecycle")}t.subscribe("game.init",function(){e()})});define("RequestAnimationFrame",[""],function(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/16.5)}}()});define("map",["eventmanager","world","standardlib","center","assetLoader"],function(t,e,n,r,i){function o(){p.canvas=app.config.shadowRoot.getElementById("mapCanvas");p.context=p.canvas.getContext("2d");p.canvas.width=app.config.terrain.grid.width*app.config.terrain.tile.width;p.canvas.height=app.config.terrain.grid.height*app.config.terrain.tile.height;p.canvas.addEventListener("contextmenu",function(e){var n=p.canvas.relmouseCoordinates(e);t.publish("map.click",n)});p.canvas.addEventListener("mousedown",function(t){if(1==t.which){$(app.config.shadowRoot).find("#ghost-select").addClass("ghost-active");$(app.config.shadowRoot).find("#ghost-select").css({left:t.pageX,top:t.pageY});initialW=t.pageX;initialH=t.pageY;$(document).bind("mouseup",a);$(document).bind("mousemove",u)}});s();l()}function a(){$(document).unbind("mousemove",u);$(document).unbind("mouseup",a);var e=app.config.shadowRoot.getElementById("ghost-select");t.publish("map.selection",{width:e.offsetWidth,height:e.offsetHeight,left:e.offsetLeft,top:e.offsetTop});$(app.config.shadowRoot).find("#ghost-select").css({left:0,top:0,width:0,height:0}).removeClass("ghost-active")}function u(t){var e=Math.abs(initialW-t.pageX),n=Math.abs(initialH-t.pageY);$(app.config.shadowRoot).find("#ghost-select").css({width:e,height:n});t.pageX<=initialW&&t.pageY>=initialH?$(app.config.shadowRoot).find("#ghost-select").css({left:t.pageX}):t.pageY<=initialH&&t.pageX>=initialW?$(app.config.shadowRoot).find("#ghost-select").css({top:t.pageY}):t.pageY<initialH&&t.pageX<initialW&&$(app.config.shadowRoot).find("#ghost-select").css({left:t.pageX,top:t.pageY})}function s(){p.context.clearRect(0,0,p.canvas.width,p.canvas.height);for(var t=0;t<e.grid.length;t++)for(var n=0;n<e.grid[0].length;n++){var r=e.grid[t][n]-1;c({sprite:app.config.terrain.tileSet.tiles[r].image,x:n,y:t,correction:15})}}function c(t){var e,r,o;_.findIndex(i.assets.loaded.atlas,function(n){var r=_.findWhere(n.sprite.sprites,{id:t.sprite});if(!_.isEmpty(r)){e=r;o=n.sprite.img}});if(!_.isEmpty(e)){r=n.twoDToIso({x:t.x,y:t.y});r.x=r.x*app.config.terrain.tile.width+p.canvas.width/2-app.config.terrain.tile.width/2;r.y=r.y*app.config.terrain.tile.height+(e.w/2-(e.h-t.correction));p.context.drawImage(o,e.x,e.y,e.w,e.h,r.x,r.y,e.w,e.h)}}function l(){var t=window.innerWidth/2,e=window.innerHeight/2,n={};n.x=-(r.x*app.config.actor.tile.width+p.canvas.width/2-t);n.y=-((r.y+app.config.terrain.tile.height/app.config.actor.tile.height)*app.config.actor.tile.height)+e;$(app.config.shadowRoot).find(p.canvas).css("margin-left",n.x).css("margin-top",n.y)}function f(){l(r)}var p={};t.subscribe("new.frame",function(){f()});t.subscribe("game.init",function(){o()})});define("actorList",["eventmanager"],function(t){var e=[],n=[];t.subscribe("actor.create",function(t){e.push(t)});t.subscribe("actor.update",function(t){var n=_.findWhere(e,{uuid:t.uuid});_.merge(n,t)});t.subscribe("actor.delete",function(t){var r=_.findWhere(e,{uuid:t});n.push(r.variables.uuid);e=_.without(e,r)});var r=function(){return e},i=function(){return n},o=function(){n=[]};return{getCleanUpList:i,clearCleanUpList:o,getActorList:r}});define("actors",["eventmanager","standardlib","actorList","center","assetLoader","RVO","collisionGrid"],function(t,e,n,r,i,o,a){function u(){var e=n.getActorList();_.each(n.getCleanUpList(),function(t){$(app.config.shadowRoot).find("canvas."+t.uuid).remove()});n.clearCleanUpList();_.each(e,function(e){var n=a.simulator.agents[e.agent];if(null!==e.variables.coordinates.next){var r=e.variables.coordinates.next,i=o.Vector.subtract([r.x,r.y],n.position);o.Vector.absSq(i)>1&&(i=o.Vector.normalize(i))}else i=[0,0];n.prefVelocity=i;e.variables.coordinates.current={x:n.position[0],y:n.position[1]};if(f(e.variables.coordinates.current)){if(!e.variables.rendered){app.config.shadowRoot.getElementById("ActorsWrapper").insertAdjacentHTML("beforeend",'<canvas id="'+e.uuid+'"></canvas>');e.variables.canvas=app.config.shadowRoot.getElementById(e.uuid);e.variables.canvas.context=e.variables.canvas.getContext("2d");e.variables.canvas.addEventListener("click",function(){t.publish("actor.selected",e.uuid)});e.variables.rendered=!0}s(e);c(e);l(e)}else{if(e.variables.rendered){$(app.config.shadowRoot).find("canvas#"+e.uuid).remove();e.variables.rendered=!1;e.variables.canvas=""}c(e)}});a.simulator.doStep()}function s(t){var e=a.simulator.agents[t.agent];if(0!=e.velocity[1]||0!=e.velocity[0]){var n=Math.atan2(e.velocity[1],e.velocity[0]);t.variables.direction=n<=-Math.PI/2&&n>=-Math.PI?2:n>-Math.PI/2&&0>=n?3:n>0&&n<=Math.PI/2?0:1}}function c(t){var e=window.innerWidth,n=window.innerHeight,i=t.variables.coordinates.current;t.variables.coordinates.previous=_.cloneDeep(i);var o=i.y-r.y*app.config.actor.tile.height,a=n/2-o,u=i.x-app.config.actor.tile.width*app.config.actor.grid.width/2-t.variables.sprite.width/2-(r.x*app.config.actor.tile.width-e/2);$(app.config.shadowRoot).find(t.variables.canvas).css("z-index",Math.floor(t.variables.coordinates.current.y/app.config.actor.tile.height)).css("bottom",a).css("left",u);t.variables.stuck=!1}function l(t){t.variables.canvas.context.clearRect(0,0,t.variables.canvas.width,t.variables.canvas.height);"undefined"==typeof t.variables.sprite[t.variables.state][t.variables.direction][t.variables.spriteIndex]&&(t.variables.spriteIndex=0);p(t);t.variables.selected&&h(t);t.variables.spriteIndex++}function f(t){var n=e.worldPosToIsoPos({x:t.x,y:t.y}),i=r,o=Math.ceil(window.innerWidth/app.config.actor.tile.width),a=Math.ceil(window.innerHeight/app.config.actor.tile.height);return n.x>=i.x-o/2&&n.x<=i.x+o/2&&n.y>=i.y-a/2&&n.y<=i.y+a/2?!0:!1}function p(t){var e,n;_.findIndex(i.assets.loaded.atlas,function(r){var i=_.findWhere(r.sprite.sprites,{id:t.variables.sprite[t.variables.state][t.variables.direction][t.variables.spriteIndex]});if(!_.isEmpty(i)){e=i;n=r.sprite.img}});if(!_.isEmpty(e)){t.variables.canvas.width=t.variables.sprite.width;t.variables.canvas.height=t.variables.sprite.height+g;var r=0,o=t.variables.canvas.height-e.h;t.variables.canvas.context.drawImage(n,e.x,e.y,e.w,e.h,r,o,e.w,e.h)}}function h(t){t.variables.canvas.context.fillStyle="red";t.variables.canvas.context.fillRect((t.variables.canvas.width-40)/2,0,38,g-2);t.variables.canvas.context.fillStyle="green";var e=t.variables.health/t.variables.hp;t.variables.canvas.context.fillRect((t.variables.canvas.width-40)/2,0,38*e,g-2)}function d(t){var i=window.innerWidth/2,o=window.innerHeight/2,a={};a.x=-(r.x*app.config.actor.tile.width+app.config.actor.grid.width*app.config.actor.tile.width/2-i);a.y=-(r.y*app.config.actor.tile.height)+o;var u=-a.x+t.left,s=-a.y+t.top,c=e.worldPosToIsoPos({x:u,y:s}),l=e.worldPosToIsoPos({x:u+t.width,y:s+t.height});_.each(n.getActorList(),function(t){var n=e.worldPosToIsoPos({x:t.variables.coordinates.current.x,y:t.variables.coordinates.current.y});t.variables.selected=n.x>=c.x&&n.x<=l.x&&n.y>=c.y&&n.y<=l.y?!0:!1})}var g=7.5;t.subscribe("new.frame",function(t){u(t)});t.subscribe("center.update.start",function(){$(app.config.shadowRoot).find(".ActorsWrapper").removeClass("no-panning")});t.subscribe("center.update.stop",function(){$(app.config.shadowRoot).find(".ActorsWrapper").addClass("no-panning")});t.subscribe("map.selection",function(t){d(t)})});define("animate",["eventmanager","RequestAnimationFrame","map","actors"],function(t){function e(){n++;t.publish("new.frame",n);window.setTimeout(e,1e3/app.config.framerate)}var n=0;t.subscribe("game.init",function(){e()});return{}});define("mouse",["eventmanager"],function(t){HTMLCanvasElement.prototype.relmouseCoordinates=function(t){var e=this,n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}};window.oncontextmenu=function(t){t.preventDefault();t.stopPropagation();return!1};var e=function(){};t.subscribe("game.init",function(){e()})});define("input",["eventmanager","mouse","Keypress"],function(t,e,n){var r=new n.Listener,i=[{keys:"up",prevent_repeat:!0,on_keydown:function(){t.publish("pan.up",1)},on_keyup:function(){t.publish("pan.up",0)}},{keys:"down",prevent_repeat:!0,on_keydown:function(){t.publish("pan.down",1)},on_keyup:function(){t.publish("pan.down",0)}},{keys:"left",prevent_repeat:!0,on_keydown:function(){t.publish("pan.left",1)},on_keyup:function(){t.publish("pan.left",0)}},{keys:"right",prevent_repeat:!0,on_keydown:function(){t.publish("pan.right",1)},on_keyup:function(){t.publish("pan.right",0)}}];r.register_many(i)});define("actor",["eventmanager","standardlib","collisionGrid"],function(t,e,n){return function(r){var i={};i.uuid=e.guid();i.variables={coordinates:{current:r.coordinates,previous:_.cloneDeep(r.coordinates),next:null},collision:{width:1,height:1},radius:50,tile:{width:app.config.terrain.tile.width,height:app.config.terrain.tile.height},direction:"down",hp:0,rendered:!1,canvas:{}};i.init=function(){_.each(i.handlers,function(e,n){_.each(e,function(e,r){t[n](r,i[e])})});i.agent=n.simulator.addAgent([i.variables.coordinates.current.x,i.variables.coordinates.current.y]);t.publish("actor.create",i.getInfo())};i.handlers={subscribe:{"actor.selected":"actorSelect"}};i.actorSelect=function(t){i.variables.selected=i.uuid==t?!0:!1};i.getInfo=function(){return i};i.destroy=function(){t.publish("actor.delete",i.uuid)};return i}});define("actorMovement",["collisionGrid","standardlib","PF"],function(t,e,n){function r(t,e,n){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)<=Math.pow(n,2)?!0:!1}var i={};i.finder=new n.AStarFinder({allowDiagonal:!1,dontCrossCorners:!0});i.generatePath=function(e){var r=t.graph.clone();e.from.x=e.from.x>0?e.from.x:0;e.from.y=e.from.y>0?e.from.y:0;var o=i.finder.findPath(e.from.y,e.from.x,e.too.y,e.too.x,r),a=n.Util.smoothenPath(r,o);a.shift();return a};i.move=function(t){var n=e.gridPosToWorldPos({x:t.variables.path[0][1],y:t.variables.path[0][0]});if(r([t.variables.coordinates.current.y,t.variables.coordinates.current.x],[n.y,n.x],t.variables.radius)){t.variables.path.shift();t.variables.coordinates.next=t.variables.path.length>0?e.gridPosToWorldPos({x:t.variables.path[0][1],y:t.variables.path[0][0]}):null}else t.variables.coordinates.next=e.gridPosToWorldPos({x:t.variables.path[0][1],y:t.variables.path[0][0]})};return i});define("actor.unit",["actor","eventmanager","collisionGrid","standardlib","actorMovement"],function(t,e,n,r,i){return function(e){var n=t(e),o={path:[],focus:"",height:2,width:2,strenght:0,dexterity:0,intelligence:0,health:0,death:!1,hp:0,speed:5,attack:10,stuck:!1},a={"new.gamecycle":"move"};_.extend(n.variables,o);_.extend(n.handlers.subscribe,a);n.move=function(){n.variables.path.length>0&&i.move(n)};n.generatePath=function(t){n.variables.path=i.generatePath({from:r.worldPosToGridPos(n.variables.coordinates.current),too:r.worldPosToGridPos(t),path:n.variables.path})};return n}});define("actor.unit.local",["actor.unit"],function(t){return function(e){var n=t(e),r={focus:"",state:"base"};_.extend(n.variables,r);var i={"map.click":"checkMapClick"};_.extend(n.handlers.subscribe,i);n.checkMapClick=function(t){n.variables.selected&&n.generatePath(t)};return n}});define("plane",["actor.unit.local","eventmanager"],function(t){return function(e){var n=t(e),r={focus:"",state:"base",direction:0,collision:{width:2,height:2},sprite:{center:{x:24,y:20},height:80,width:55,base:{0:["plane/base/Plane_Large_face0_0.png","plane/base/Plane_Large_face0_1.png","plane/base/Plane_Large_face0_2.png","plane/base/Plane_Large_face0_3.png"],1:["plane/base/Plane_Large_face1_0.png","plane/base/Plane_Large_face1_1.png","plane/base/Plane_Large_face1_2.png","plane/base/Plane_Large_face1_3.png"],2:["plane/base/Plane_Large_face2_0.png","plane/base/Plane_Large_face2_1.png","plane/base/Plane_Large_face2_2.png","plane/base/Plane_Large_face2_3.png"],3:["plane/base/Plane_Large_face3_0.png","plane/base/Plane_Large_face3_1.png","plane/base/Plane_Large_face3_2.png","plane/base/Plane_Large_face3_3.png"]},explode:{0:["plane/explode/color0_Plane_Large_face0_fiery_explode_0.png","plane/explode/color0_Plane_Large_face0_fiery_explode_1.png","plane/explode/color0_Plane_Large_face0_fiery_explode_2.png","plane/explode/color0_Plane_Large_face0_fiery_explode_3.png","plane/explode/color0_Plane_Large_face0_fiery_explode_4.png","plane/explode/color0_Plane_Large_face0_fiery_explode_5.png","plane/explode/color0_Plane_Large_face0_fiery_explode_6.png","plane/explode/color0_Plane_Large_face0_fiery_explode_7.png","plane/explode/color0_Plane_Large_face0_fiery_explode_8.png","plane/explode/color0_Plane_Large_face0_fiery_explode_9.png","plane/explode/color0_Plane_Large_face0_fiery_explode_10.png","plane/explode/color0_Plane_Large_face0_fiery_explode_11.png"],1:["plane/explode/color0_Plane_Large_face1_fiery_explode_0.png","plane/explode/color0_Plane_Large_face1_fiery_explode_1.png","plane/explode/color0_Plane_Large_face1_fiery_explode_2.png","plane/explode/color0_Plane_Large_face1_fiery_explode_3.png","plane/explode/color0_Plane_Large_face1_fiery_explode_4.png","plane/explode/color0_Plane_Large_face1_fiery_explode_5.png","plane/explode/color0_Plane_Large_face1_fiery_explode_6.png","plane/explode/color0_Plane_Large_face1_fiery_explode_7.png","plane/explode/color0_Plane_Large_face1_fiery_explode_8.png","plane/explode/color0_Plane_Large_face1_fiery_explode_9.png","plane/explode/color0_Plane_Large_face1_fiery_explode_10.png","plane/explode/color0_Plane_Large_face1_fiery_explode_11.png"],2:["plane/explode/color0_Plane_Large_face2_fiery_explode_0.png","plane/explode/color0_Plane_Large_face2_fiery_explode_1.png","plane/explode/color0_Plane_Large_face2_fiery_explode_2.png","plane/explode/color0_Plane_Large_face2_fiery_explode_3.png","plane/explode/color0_Plane_Large_face2_fiery_explode_4.png","plane/explode/color0_Plane_Large_face2_fiery_explode_5.png","plane/explode/color0_Plane_Large_face2_fiery_explode_6.png","plane/explode/color0_Plane_Large_face2_fiery_explode_7.png","plane/explode/color0_Plane_Large_face2_fiery_explode_8.png","plane/explode/color0_Plane_Large_face2_fiery_explode_9.png","plane/explode/color0_Plane_Large_face2_fiery_explode_10.png","plane/explode/color0_Plane_Large_face2_fiery_explode_11.png"],3:["plane/explode/color0_Plane_Large_face3_fiery_explode_0.png","plane/explode/color0_Plane_Large_face3_fiery_explode_1.png","plane/explode/color0_Plane_Large_face3_fiery_explode_2.png","plane/explode/color0_Plane_Large_face3_fiery_explode_3.png","plane/explode/color0_Plane_Large_face3_fiery_explode_4.png","plane/explode/color0_Plane_Large_face3_fiery_explode_5.png","plane/explode/color0_Plane_Large_face3_fiery_explode_6.png","plane/explode/color0_Plane_Large_face3_fiery_explode_7.png","plane/explode/color0_Plane_Large_face3_fiery_explode_8.png","plane/explode/color0_Plane_Large_face3_fiery_explode_9.png","plane/explode/color0_Plane_Large_face3_fiery_explode_10.png","plane/explode/color0_Plane_Large_face3_fiery_explode_11.png"]}},health:75,death:!1,hp:100,speed:25};
_.extend(n.variables,r);return n}});define("scripts/app",["assetLoader","eventmanager","mapLoader","jquery","lodash"],function(t,e,n){n.load("test").then(t.preloadassets).then(function(){require(["collisionGrid"])}).then(function(){require(["gamecycle","animate","input","plane"],function(){e.publish("game.init");{var t=require("plane");t({coordinates:{x:1980,y:250}}).init(),t({coordinates:{x:1980,y:230}}).init(),t({coordinates:{x:1980,y:230}}).init(),t({coordinates:{x:1980,y:230}}).init(),t({coordinates:{x:1980,y:230}}).init(),t({coordinates:{x:1980,y:230}}).init(),t({coordinates:{x:1980,y:250}}).init(),t({coordinates:{x:1980,y:260}}).init()}})})});