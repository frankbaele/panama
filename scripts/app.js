/**
 * Random number god
 * This code is an implementation of Alea algorithm; (C) 2010 Johannes Baagøe.
 * Alea is licensed according to the http://en.wikipedia.org/wiki/MIT_License.
 */

/**
   * @namespace
   * This code is an implementation of the ROT.js cellular map generation by Ondřej Žára, https://github.com/ondras/rot.js
   * Alea is licensed according to the http://en.wikipedia.org/wiki/MIT_License.
   */

/**
   * http://paulirish.com/2011/requestanimationframe-for-smart-animating/
   * http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
   * requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel
   * MIT license
   */

define("eventmanager",[""],function(){function t(t,e){topics.hasOwnProperty(t)||(topics[t]=[]);topics[t].push(e);return!0}function e(t,e){if(!topics.hasOwnProperty(t))return!1;for(var n=0,i=topics[t].length;i>n;n++)if(String(topics[t][n])===String(e)){topics[t].splice(n,1);return!0}return!1}function n(){var t=Array.prototype.slice.call(arguments),e=t.shift();if(!topics.hasOwnProperty(e))return!1;for(var n=0,i=topics[e].length;i>n;n++)topics[e][n].apply(void 0,t);return!0}topics={};return{subscribe:t,unsubscrive:e,publish:n,topics:topics}});define("scripts/app/controllers/uiController",["eventmanager"],function(t){ActorController=function(e){e.focus={};t.subscribe("actor.selected",function(n){e.focus.Uuid=n;t.subscribe("actor.object."+n,function(t){e.focus.actor=t;e.$digest()});t.publish("actor.getObject."+n)});t.subscribe("actor.unselected",function(n){if(e.focus.Uuid===n){t.unsubscrive("actor.object."+n,function(t){e.focus.actor=t;e.$digest()});e.focus.Uuid="";e.focus.actor="";e.$digest()}})};return["$scope","$interval",ActorController]});define("RNG",[],function(){function t(){n(Date.now())}function e(){return u}function n(t){t=1>t?1/t:t;u=t;f=(t>>>0)*d;t=69069*t+1>>>0;l=t*d;t=69069*t+1>>>0;h=t*d;p=1}function i(){var t=2091639*f+p*d;f=l;l=h;p=0|t;h=t-p;return h}function r(t,e){do var n=2*i()-1,r=2*i()-1,o=n*n+r*r;while(o>1||0==o);var a=n*Math.sqrt(-2*Math.log(o)/o);return(t||0)+a*(e||1)}function o(){return 1+Math.floor(100*i())}function a(t){var e=0;for(var n in t)e+=t[n];var r=Math.floor(i()*e),o=0;for(var n in t){o+=t[n];if(o>r)return n}return null}function c(){return[f,l,h,p]}function s(t){f=t[0];l=t[1];h=t[2];p=t[3]}var u,f=0,l=0,h=0,p=0,d=2.3283064365386963e-10;t();return{getSeed:e,setSeed:n,getUniform:i,getNormal:r,getPercentage:o,getWeightedValue:a,getState:c,setState:s}});define("graphNode",[],function(){function t(t,e,n){this.data={};this.x=t;this.y=e;this.pos={x:t,y:e};this.type=n}var e={OPEN:0,WALL:1};t.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};t.prototype.isWall=function(){return this.type==e.WALL};return t});define("graph",["graphNode"],function(t){function e(e){for(var n=[],i=0;i<e.length;i++){n[i]=[];for(var r=0,o=e[i];r<o.length;r++)n[i][r]=new t(i,r,o[r])}this.input=e;this.nodes=n}e.prototype.toString=function(){for(var t,e,n,i,r="\n",o=this.nodes,a=0,c=o.length;c>a;a++){t="";e=o[a];for(n=0,i=e.length;i>n;n++)t+=e[n].type+" ";r=r+t+"\n"}return r};return e});define("world",["RNG","underscore","graph"],function(t,e,n){function i(){m=e.compose(c,c,s,s,c,c,r,o)();n=new n(m)}function r(e){var n,i;for(n=0;h>n;n++)for(i=0;p>i;i++)e[n][i]=t.getUniform()<w?1:0;return e}function o(){var t,e,n=[];for(t=0;h>t;t++){n[t]=[];for(e=0;p>e;e++)n[t][e]=0}return n}function a(t,e,n){for(var i=0,r=0;r<x.length;r++){var o=x[r],a=e+o[0],c=n+o[1];0>a||a>=p||0>a||c>=p||(i+=1===t[a][c]?1:0)}return i}function c(t){for(var e=0,n=o(),i=0;h>i;i++){var r=1,c=0;if(6===y){r=2;c=i%2}for(var s=c;p>s;s+=r){e++;var u=t[s][i],f=a(t,s,i);u&&-1!==b.indexOf(f)?n[s][i]=1:u||-1===v.indexOf(f)||(n[s][i]=1)}}return n}function s(t){for(var e=[],n=2,i=0;h>i;i++)for(var r=0;n>r;r++){var o=i*n+r;e[o]=[];for(var a=0;p>a;a++)for(var c=0;n>c;c++){var s=a*n+c;e[o][s]=t[i][a]}}p*=n;h*=n;return e}function u(t,e){return t>=0&&e>=0?p>t?h>e?!1:!0:!0:!0}function f(t,e){if(u(t,e)){0>=t?t=0:t>=p&&(t=p-1);0>=e?e=0:e>=h&&(e=h-1)}return{x:t,y:e}}function l(t){return 0===m[t.y][t.x]?!0:!1}var n,h=25,p=25,d=128,g=64,m=[],v=[5,6,7,8],b=[4,5,6,7,8],y=8,w=.47,x=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];i();return{tileWidth:d,tileHeight:g,inBoundTile:f,outOfBound:u,tileIsOpen:l,height:h,width:p,mapData:m,graph:n}});define("standardlib",["world","eventmanager"],function(t){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function n(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function i(t,e){console.log(t,e);var n={};n.x=e+t;n.y=e-t;return n}function r(t,e){var n={};n.x=(t-e)/2;n.y=(t+e)/2;return n}function o(e,n){var i=(e/(t.tileWidth/2)+n/(t.tileHeight/2))/2-t.width/2,r=(n/(t.tileHeight/2)-e/(t.tileWidth/2))/2+t.height/2;i=Math.floor(i);r=Math.floor(r);return{x:i,y:r}}function a(t,e){var n=setInterval(function(){t()&&clearInterval(n)},1e3)}return{guid:n,isoToTwoD:i,twoDToIso:r,worldPosToGridPos:o,checkWait:a}});define("canvas",["eventmanager","world"],function(t,e){var n={},i={},r=function(){n.canvas=document.getElementById("mapCanvas");n.context=n.canvas.getContext("2d");i.canvas=document.getElementById("playerCanvas");i.context=i.canvas.getContext("2d");n.canvas.width=e.width*e.tileWidth;n.canvas.height=e.height*e.tileHeight;i.canvas.width=e.width*e.tileWidth;i.canvas.height=e.height*e.tileHeight};t.subscribe("game.init",function(){r()});return{terrain:n,player:i}});define("text!assetsList",[],function(){return'{\n  "0" : {\n    "name": "mapTiles",\n    "type": "atlas",\n    "configuration": "./art/panama.json",\n    "file": "./art/panama.png"\n  }\n}'});define("spriteSheet",[""],function(){var t=function(t,e){var n=[],i=t,r=e,o=function(){_.forEach(i.frames,function(t){var e=t,n=.5*-e.frame.w,i=.5*-e.frame.h;if(e.trimmed){n=e.spriteSourceSize.x-.5*e.sourceSize.w;i=e.spriteSourceSize.y-.5*e.sourceSize.h}a(e.filename,e.frame.x,e.frame.y,e.frame.w,e.frame.h,n,i)})},a=function(t,e,i,r,o,a,c){var s={id:t,x:e,y:i,w:r,h:o,cx:null===a?0:a,cy:null===c?0:c};n.push(s)};o();return{img:r,sprites:n}};return t});define("assetLoader",["spriteSheet","underscore","jQuery"],function(t){var e=function(e){var n=this;_.forEach(e.config,function(i){n.queue++;switch(i.type){case"atlas":n.loadAtlas(i,function(r){e.loaded.atlas.push({name:i.name,sprite:new t(r.configuration,r.file)});n.queue--});break;case"music":}});return e},n=function(){return this.queue>0?!1:!0},i=function(t,e){jQuery.getJSON(t.configuration,function(e){t.configuration=e}).then(function(){var n=new Image;n.src=t.file;t.file=n;e(t)})};return{preloadassets:e,preloadComplete:n,loadAtlas:i}});define("assets",["text!assetsList","assetLoader","eventmanager"],function(t,e,n){function i(){var t=setInterval(function(){if(e.preloadComplete()){n.publish("assets.loaded");clearInterval(t)}},1e3)}var r={config:{},loaded:{atlas:[],music:[]}};r.config=JSON.parse(t);r=e.preloadassets(r);i();return r});define("sprite",["underscore","canvas","standardlib","world","assets"],function(t,e,n,i,r){function o(o,a,c,s){var u,f,l,h,p,d={};switch(s){case"terrain":f=e.terrain.context;h=e.terrain.canvas;break;case"player":f=e.player.context;h=e.player.canvas;break;default:return}l=n.twoDToIso(a,c);l.x=l.x*i.tileWidth+h.width/2;l.y=l.y*i.tileHeight+i.tileHeight/2;t.findIndex(r.loaded.atlas,function(e){u=t.findWhere(e.sprite.sprites,{id:o});p=e.sprite.img;!t.isEmpty(e)});if(!t.isEmpty(u)){d.x=0;d.y=0;f.drawImage(p,u.x,u.y,u.w,u.h,l.x-i.tileWidth/2,l.y-i.tileHeight/2,i.tileWidth,i.tileHeight)}}return{draw:o}});define("actorList",["eventmanager","sprite","underscore"],function(t){var e=[],n=[];t.subscribe("actor.create",function(t){e.push({uuid:t.uuid,coordinates:t.coordinates,sprite:t.sprite})});t.subscribe("actor.update",function(t){var i=_.findWhere(e,{uuid:t.uuid});n.push({coordinates:i.coordinates});e=_.without(e,i);e.push({uuid:t.uuid,coordinates:t.coordinates,sprite:t.sprite})});t.subscribe("actor.delete",function(t){var i=_.findWhere(e,{uuid:t});n.push({coordinates:i.coordinates});e=_.without(e,i)});var i=function(){return e},r=function(){return n},o=function(){n=[]};return{getCleanUpList:r,clearCleanUpList:o,getActorList:i}});define("actor",["eventmanager","standardlib","actorList"],function(t,e){function n(t,n){this.coordinates=n;this.sprite=t;this.uuid=e.guid();this.hp=0}n.prototype.checkLeftClick=function(e){if(e.x==this.coordinates.x&&e.y==this.coordinates.y){this.selected=!0;t.publish("actor.selected",this.uuid)}else if(this.selected){this.selected=!1;t.publish("actor.unselected",this.uuid)}};n.prototype.delete=function(){t.publish("actor.delete",this.uuid)};n.prototype.getInfo=function(){return this};return n});define("binaryHeap",[""],function(){function t(t){this.content=[];this.scoreFunction=t}t.prototype={push:function(t){this.content.push(t);this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();if(this.content.length>0){this.content[0]=e;this.bubbleUp(0)}return t},remove:function(t){var e=this.content.indexOf(t),n=this.content.pop();if(e!==this.content.length-1){this.content[e]=n;this.scoreFunction(n)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e)}},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var n=(t+1>>1)-1,i=this.content[n];if(!(this.scoreFunction(e)<this.scoreFunction(i)))break;this.content[n]=e;this.content[t]=i;t=n}},bubbleUp:function(t){for(var e=this.content.length,n=this.content[t],i=this.scoreFunction(n);;){var r=t+1<<1,o=r-1,a=null;if(e>o){var c=this.content[o],s=this.scoreFunction(c);i>s&&(a=o)}if(e>r){var u=this.content[r],f=this.scoreFunction(u);(null===a?i:s)>f&&(a=r)}if(null===a)break;this.content[t]=this.content[a];this.content[a]=n;t=a}}};return t});define("astar",["binaryHeap"],function(t){var e={init:function(t){for(var e=0,n=t.length;n>e;e++)for(var i=0,r=t[e].length;r>i;i++){var o=t[e][i];o.f=0;o.g=0;o.h=0;o.cost=o.type;o.visited=!1;o.closed=!1;o.parent=null}},heap:function(){return new t(function(t){return t.f})},search:function(t,n,i,r,o){e.init(t);o=o||e.manhattan;r=!!r;var a=e.heap();a.push(n);for(;a.size()>0;){var c=a.pop();if(c===i){for(var s=c,u=[];s.parent;){u.push(s);s=s.parent}return u.reverse()}c.closed=!0;for(var f=e.neighbors(t,c,r),l=0,h=f.length;h>l;l++){var p=f[l];if(!p.closed&&!p.isWall()){var d=c.g+p.cost,g=p.visited;if(!g||d<p.g){p.visited=!0;p.parent=c;p.h=p.h||o(p.pos,i.pos);p.g=d;p.f=p.g+p.h;g?a.rescoreElement(p):a.push(p)}}}}return[]},manhattan:function(t,e){var n=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return n+i},neighbors:function(t,e,n){var i=[],r=e.x,o=e.y;t[r-1]&&t[r-1][o]&&i.push(t[r-1][o]);t[r+1]&&t[r+1][o]&&i.push(t[r+1][o]);t[r]&&t[r][o-1]&&i.push(t[r][o-1]);t[r]&&t[r][o+1]&&i.push(t[r][o+1]);if(n){t[r-1]&&t[r-1][o-1]&&i.push(t[r-1][o-1]);t[r+1]&&t[r+1][o-1]&&i.push(t[r+1][o-1]);t[r-1]&&t[r-1][o+1]&&i.push(t[r-1][o+1]);t[r+1]&&t[r+1][o+1]&&i.push(t[r+1][o+1])}return i}};return e});define("actor.unit",["actor","eventmanager","astar","world","underscore"],function(t,e,n,i){function r(e,n){_.extend(this,new t(e,n));this.path=[];this.focus="";this.strenght=0;this.dexterity=0;this.intelligence=0;this.health=0;this.death=!1;this.hp=50;this.attack=10}r.prototype=Object.create(t.prototype);r.prototype.generatePath=function(){var t=i.graph.nodes[this.coordinates.y][this.coordinates.x],e=i.graph.nodes[this.goal.y][this.goal.x];this.path=n.search(i.graph.nodes,t,e,!0)};r.prototype.move=function(){if(0!==this.path.length){var t=_.first(this.path);this.path=_.rest(this.path);this.coordinates={x:t.y,y:t.x};e.publish("command",{event:"actor.update",parameters:this})}};r.prototype.checkDeath=function(){if(this.hp<=0&&!this.death){this.death=!0;this.delete()}};r.prototype.attackActor=function(){""!==this.focus&&this.focus!==this.uuid&&e.publish("command",{event:"actor.attack."+this.focus,parameters:this.attack})};return r});define("actor.unit.ai",["actor.unit","eventmanager"],function(t){function e(e,n){_.extend(this,new t(e,n))}e.prototype=Object.create(t.prototype);return e});define("actor.unit.ai.enemy",["actor.unit.ai","eventmanager"],function(t,e){function n(n,i){_.extend(this,new t(n,i));var r=this;e.subscribe("mouse.click.left",function(t){r.checkLeftClick(t)});e.subscribe("new.gamecycle",function(){r.move();r.attackActor();r.checkDeath()});e.subscribe("actor.attack."+r.uuid,function(t){r.hp=r.hp-parseInt(t)});e.subscribe("actor.getObject."+r.uuid,function(){e.publish("actor.object."+r.uuid,r)});e.publish("actor.create",r)}n.prototype=Object.create(t.prototype);n.prototype.delete=function(){e.unsubscrive("mouse.click.left",function(t){that.checkLeftClick(t)});e.unsubscrive("new.gamecycle");e.unsubscrive("actor.selected");e.unsubscrive("actor.attack."+this.uuid);e.publish("actor.delete",this.uuid)};return n});define("actor.unit.ai.friendly",["actor.unit.ai","eventmanager"],function(t,e){function n(n,i){_.extend(this,new t(n,i));var r=this;e.subscribe("mouse.click.left",function(t){r.checkLeftClick(t)});e.subscribe("new.gamecycle",function(){r.move();r.attackActor();r.checkDeath()});e.subscribe("actor.attack."+r.uuid,function(t){r.hp=r.hp-parseInt(t)});e.subscribe("actor.getObject."+r.uuid,function(){e.publish("actor.object."+r.uuid,r)});e.publish("actor.create",this)}n.prototype=Object.create(t.prototype);n.prototype.checkRightClick=function(t){this.goal=t;this.generatePath()};n.prototype.checkLeftClick=function(t){var n=this;if(t.x==n.coordinates.x&&t.y==n.coordinates.y){n.selected=!0;e.publish("actor.selected",this.uuid);e.subscribe("mouse.click.right",function(t){n.checkRightClick(t)})}else if(n.selected){n.selected=!1;e.publish("actor.unselected",this.uuid);e.unsubscrive("mouse.click.right",function(t){n.checkRightClick(t)})}};n.prototype.delete=function(){e.unsubscrive("mouse.click.left",function(t){this.checkLeftClick(t)});e.unsubscrive("new.gamecycle");e.unsubscrive("actor.selected");e.unsubscrive("actor.attack."+this.uuid);e.publish("actor.delete",this.uuid)};return n});define("actor.unit.human",["actor.unit","eventmanager"],function(t){function e(e,n){_.extend(this,new t(e,n))}e.prototype=Object.create(t.prototype);return e});define("actor.unit.human.local",["actor.unit.human","eventmanager"],function(t,e){function n(n,i){_.extend(this,new t(n,i));this.focus="";var r=this;e.subscribe("mouse.click.right",function(t){r.checkRightClick(t)});e.subscribe("mouse.click.left",function(t){r.checkLeftClick(t)});e.subscribe("new.gamecycle",function(){r.move();r.attackActor();r.checkDeath()});e.subscribe("actor.selected",function(t){r.focus=t});e.subscribe("actor.unselected",function(t){r.focus===t&&(r.focus="")});e.subscribe("actor.delete",function(t){r.focus===t&&(r.focus="")});e.subscribe("actor.attack."+r.uuid,function(t){r.hp=r.hp-parseInt(t)});e.subscribe("actor.getObject."+r.uuid,function(){e.publish("actor.object."+r.uuid,this)});e.publish("actor.create",this)}n.prototype=Object.create(t.prototype);n.prototype.checkRightClick=function(t){this.goal=t;this.generatePath()};return n});define("scripts/app/controllers/gameController",["eventmanager","actor.unit.ai.enemy","actor.unit.ai.friendly","actor.unit.human.local"],function(t,e,n){gameController=function(){new n("road.png",{x:5,y:5}),new n("road.png",{x:10,y:10})};return["$scope",gameController]});define("scripts/app/controllers/CanvasController",["eventmanager"],function(t){canvasController=function(){t.publish("game.init")};return["$scope",canvasController]});define("commandQueue",[""],function(){function t(t){i.push(t)}function e(){i=[]}function n(){return i}var i=[];return{add:t,get:n,clear:e}});define("command",["commandQueue","eventmanager"],function(t,e){function n(e){t.add(e)}function i(){var n=t.get();_.forEach(n,function(t){e.publish(t.event,t.parameters)});t.clear()}e.subscribe("command",function(t){n(t)});e.subscribe("new.gamecycle",function(){i()})});define("gamecycle",["eventmanager","command"],function(t){function e(){n()}function n(){setTimeout(n,200);t.publish("new.gamecycle")}t.subscribe("game.init",function(){e()})});define("RequestAnimationFrame",[""],function(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/16.5)}}()});define("map",["eventmanager","canvas","world","standardlib","sprite","jQuery"],function(t,e,n,i,r){function o(){a();c(f.x,f.y)}function a(){e.terrain.context.clearRect(0,0,e.terrain.canvas.width,e.terrain.canvas.height);for(var t={x:0,y:0},i=0;n.height>i;i++)for(var o=0;n.width>o;o++)n.outOfBound(t.y+i,t.x+o)||(1===n.mapData[t.y+i][t.x+o]?r.draw("grass.png",t.x+o,t.y+i,"terrain"):r.draw("water.png",t.x+o,t.y+i,"terrain"))}function c(t,r){var o=i.twoDToIso(t,r);o.x=-((o.x-u.x)*n.tileWidth+e.terrain.canvas.width/2);o.y=-((o.y-u.y)*n.tileHeight+n.tileHeight/2);$(e.terrain.canvas).css("margin-left",o.x).css("marginTop",o.y);$(e.terrain.canvas).css("margin-left",o.x).css("marginTop",o.y)}function s(){var t={x:0,y:0};if(1==l.up){t.y--;t.x--}if(1==l.down){t.y++;t.x++}if(1==l.left){t.x--;t.y++}if(1==l.right){t.x++;t.y--}if(0!==t.x||0!==t.y){t=n.inBoundTile(f.x+t.x,f.y+t.y);c(t.x,t.y);f.x=t.x;f.y=t.y}}var u={x:10,y:10},f={x:10,y:10},l={up:0,down:0,left:0,right:0};t.subscribe("game.init",function(){o()});t.subscribe("new.frame",function(){s()});t.subscribe("pan.up",function(t){l.up=t});t.subscribe("pan.down",function(t){l.down=t});t.subscribe("pan.left",function(t){l.left=t});t.subscribe("pan.right",function(t){l.right=t})});define("actors",["eventmanager","sprite","standardlib","world","canvas","actorList","underscore"],function(t,e,n,i,r,o){function a(){s(f.x,f.y)}function c(){var t={x:0,y:0};if(1==l.up){t.y--;t.x--}if(1==l.down){t.y++;t.x++}if(1==l.left){t.x--;t.y++}if(1==l.right){t.x++;t.y--}if(0!==t.x||0!==t.y){t=i.inBoundTile(f.x+t.x,f.y+t.y);s(t.x,t.y);f.x=t.x;f.y=t.y}_.each(o.getCleanUpList(),function(t){e.draw("water.png",t.coordinates.x,t.coordinates.y,"player")});o.clearCleanUpList();_.each(o.getActorList(),function(t){e.draw(t.sprite,t.coordinates.x,t.coordinates.y,"player")})}function s(t,e){var o=n.twoDToIso(t,e);o.x=-((o.x-u.x)*i.tileWidth+r.player.canvas.width/2);o.y=-((o.y-u.y)*i.tileHeight+i.tileHeight/2);$(r.player.canvas).css("margin-left",o.x).css("marginTop",o.y);$(r.terrain.canvas).css("margin-left",o.x).css("marginTop",o.y)}var u={x:10,y:10},f={x:10,y:10},l={up:0,down:0,left:0,right:0};t.subscribe("new.frame",function(){c()});t.subscribe("pan.up",function(t){l.up=t});t.subscribe("pan.down",function(t){l.down=t});t.subscribe("pan.left",function(t){l.left=t});t.subscribe("pan.right",function(t){l.right=t});t.subscribe("game.init",function(){a()})});define("animate",["eventmanager","RequestAnimationFrame","map","actors"],function(t){function e(){t.publish("new.frame");window.setTimeout(e,50)}t.subscribe("game.init",function(){e()});return{}});define("mouse",["canvas","standardlib","eventmanager"],function(t,e,n){function i(t){o=t}function r(t){a=t}var o=function(){console.log("The right mouse click is not assigned, define leftmouseCallback")},a=function(){console.log("The left mouse click is not assigned, define rightmouseCallback")};HTMLCanvasElement.prototype.relmouseCoordinates=function(t){var e=0,n=0,i=0,r=0,o=this;do{e+=o.offsetLeft-o.scrollLeft;n+=o.offsetTop-o.scrollTop}while(o===o.offsetParent);i=t.pageX-e;r=t.pageY-n;return{x:i,y:r}};window.oncontextmenu=function(t){t.preventDefault();t.stopPropagation();return!1};var c=function(){t.player.canvas.addEventListener("click",function(n){var i=t.player.canvas.relmouseCoordinates(n);i=e.worldPosToGridPos(i.x,i.y,t.player.canvas.width);o(i)},!1);t.player.canvas.addEventListener("contextmenu",function(n){var i=t.player.canvas.relmouseCoordinates(n);i=e.worldPosToGridPos(i.x,i.y,t.player.canvas.width);a(i)},!1)};n.subscribe("game.init",function(){c()});return{setLeftmouseCallback:i,setRightmouseCallback:r}});define("input",["eventmanager","mouse","keypress"],function(t,e){var n=[{keys:"up",prevent_repeat:!0,on_keydown:function(){t.publish("pan.up",1)},on_keyup:function(){t.publish("pan.up",0)}},{keys:"down",prevent_repeat:!0,on_keydown:function(){t.publish("pan.down",1)},on_keyup:function(){t.publish("pan.down",0)}},{keys:"left",prevent_repeat:!0,on_keydown:function(){t.publish("pan.left",1)},on_keyup:function(){t.publish("pan.left",0)}},{keys:"right",prevent_repeat:!0,on_keydown:function(){t.publish("pan.right",1)},on_keyup:function(){t.publish("pan.right",0)}}];keypress.register_many(n);e.setLeftmouseCallback(function(e){t.publish("mouse.click.left",e)});e.setRightmouseCallback(function(e){t.publish("mouse.click.right",e)})});define("scripts/app",["scripts/app/controllers/uiController","scripts/app/controllers/gameController","scripts/app/controllers/CanvasController","angular","angular-ui-router","gamecycle","assets","animate","input"],function(t,e,n){var i=angular.module("panama",["ui.router"]);i.config(["$stateProvider",function(t){t.state("menu",{templateUrl:"templates/menu.html"}).state("game",{"abstract":!0,templateUrl:"templates/game.html",controller:"gameController"}).state("game.content",{views:{canvas:{templateUrl:"templates/game.canvas.html",controller:"canvasController"},actor:{templateUrl:"templates/game.ui.html",controller:"uiController"}}})}]);i.controller("uiController",t);i.controller("gameController",e);i.controller("canvasController",n);i.run(["$state",function(t){t.transitionTo("game.content")}]);angular.element(document).ready(function(){angular.bootstrap(document,["panama"])});return i});