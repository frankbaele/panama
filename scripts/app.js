/**
 * @license
 * lodash 3.4.0 (Custom Build) <https://lodash.com/>
 * Build: `lodash modern -o ./lodash.js`
 * Copyright 2012-2015 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.8.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <https://lodash.com/license>
 */

/**
 * Random number god
 * This code is an implementation of Alea algorithm; (C) 2010 Johannes Baagøe.
 * Alea is licensed according to the http://en.wikipedia.org/wiki/MIT_License.
 */

/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

/**
   * http://paulirish.com/2011/requestanimationframe-for-smart-animating/
   * http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
   * requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel
   * MIT license
   */

(function(){function e(e,t){if(e!==t){var n=e===e,r=t===t;if(e>t||!n||"undefined"==typeof e&&r)return 1;if(t>e||!r||"undefined"==typeof t&&n)return-1}return 0}function t(e,t,n){if(t!==t)return p(e,n);for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function n(e){return"function"==typeof e||!1}function r(e){return"string"==typeof e?e:null==e?"":e+""}function i(e){return e.charCodeAt(0)}function o(e,t){for(var n=-1,r=e.length;++n<r&&t.indexOf(e.charAt(n))>-1;);return n}function a(e,t){for(var n=e.length;n--&&t.indexOf(e.charAt(n))>-1;);return n}function u(t,n){return e(t.criteria,n.criteria)||t.index-n.index}function c(t,n,r){for(var i=-1,o=t.criteria,a=n.criteria,u=o.length,c=r.length;++i<u;){var l=e(o[i],a[i]);if(l)return i>=c?l:r[i]?l:-1*l}return t.index-n.index}function l(e){return Tt[e]}function s(e){return Et[e]}function f(e){return"\\"+Gt[e]}function p(e,t,n){for(var r=e.length,i=t+(n?0:-1);n?i--:++i<r;){var o=e[i];if(o!==o)return i}return-1}function h(e){return e&&"object"==typeof e||!1}function d(e){return 160>=e&&e>=9&&13>=e||32==e||160==e||5760==e||6158==e||e>=8192&&(8202>=e||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}function g(e,t){for(var n=-1,r=e.length,i=-1,o=[];++n<r;)if(e[n]===t){e[n]=B;o[++i]=n}return o}function v(e,t){for(var n,r=-1,i=e.length,o=-1,a=[];++r<i;){var u=e[r],c=t?t(u,r,e):u;if(!r||n!==c){n=c;a[++o]=u}}return a}function y(e){for(var t=-1,n=e.length;++t<n&&d(e.charCodeAt(t)););return t}function _(e){for(var t=e.length;t--&&d(e.charCodeAt(t)););return t}function m(e){return Bt[e]}function b(d){function z(e){if(h(e)&&!tc(e)&&!(e instanceof Tt)){if(e instanceof Z)return e;if(ou.call(e,"__chain__")&&ou.call(e,"__wrapped__"))return Er(e)}return new Z(e)}function X(){}function Z(e,t,n){this.__wrapped__=e;this.__actions__=n||[];this.__chain__=!!t}function Tt(e){this.__wrapped__=e;this.__actions__=null;this.__dir__=1;this.__dropCount__=0;this.__filtered__=!1;this.__iteratees__=null;this.__takeCount__=Iu;this.__views__=null}function Et(){var e=this.__actions__,t=this.__iteratees__,n=this.__views__,r=new Tt(this.__wrapped__);r.__actions__=e?Kt(e):null;r.__dir__=this.__dir__;r.__dropCount__=this.__dropCount__;r.__filtered__=this.__filtered__;r.__iteratees__=t?Kt(t):null;r.__takeCount__=this.__takeCount__;r.__views__=n?Kt(n):null;return r}function Bt(){if(this.__filtered__){var e=new Tt(this);e.__dir__=-1;e.__filtered__=!0}else{e=this.clone();e.__dir__*=-1}return e}function Ut(){var e=this.__wrapped__.value();if(!tc(e))return Kn(e,this.__actions__);var t=this.__dir__,n=0>t,r=wr(0,e.length,this.__views__),i=r.start,o=r.end,a=o-i,u=this.__dropCount__,c=Nu(a,this.__takeCount__),l=n?o:i-1,s=this.__iteratees__,f=s?s.length:0,p=0,h=[];e:for(;a--&&c>p;){l+=t;for(var d=-1,g=e[l];++d<f;){var v=s[d],y=v.iteratee,_=v.type;if(_!=C)var m=y(g);else{v.done=v.done&&(n?l<v.index:l>v.index);v.index=l;m=v.done||(v.done=!y(g))}if(_==S)g=m;else if(!m){if(_==T)break e;continue e}}u?u--:h[p++]=g}return h}function Gt(){this.__data__={}}function $t(e){return this.has(e)&&delete this.__data__[e]}function Jt(e){return"__proto__"==e?x:this.__data__[e]}function qt(e){return"__proto__"!=e&&ou.call(this.__data__,e)}function Ht(e,t){"__proto__"!=e&&(this.__data__[e]=t);return this}function zt(e){var t=e?e.length:0;this.data={hash:Pu(null),set:new _u};for(;t--;)this.push(e[t])}function Vt(e,t){var n=e.data,r="string"==typeof t||Lo(t)?n.set.has(t):n.hash[t];return r?0:-1}function Xt(e){var t=this.data;"string"==typeof e||Lo(e)?t.set.add(e):t.hash[e]=!0}function Kt(e,t){var n=-1,r=e.length;t||(t=Ja(r));for(;++n<r;)t[n]=e[n];return t}function Zt(e,t){for(var n=-1,r=e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function en(e,t){for(var n=e.length;n--&&t(e[n],n,e)!==!1;);return e}function tn(e,t){for(var n=-1,r=e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function nn(e,t){for(var n=-1,r=e.length,i=-1,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[++i]=a)}return o}function rn(e,t){for(var n=-1,r=e.length,i=Ja(r);++n<r;)i[n]=t(e[n],n,e);return i}function on(e){for(var t=-1,n=e.length,r=Du;++t<n;){var i=e[t];i>r&&(r=i)}return r}function an(e){for(var t=-1,n=e.length,r=Iu;++t<n;){var i=e[t];r>i&&(r=i)}return r}function un(e,t,n,r){var i=-1,o=e.length;r&&o&&(n=e[++i]);for(;++i<o;)n=t(n,e[i],i,e);return n}function cn(e,t,n,r){var i=e.length;r&&i&&(n=e[--i]);for(;i--;)n=t(n,e[i],i,e);return n}function ln(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function sn(e,t){return"undefined"==typeof e?t:e}function fn(e,t,n,r){return"undefined"!=typeof e&&ou.call(r,n)?e:t}function pn(e,t,n){var r=ac(t);if(!n)return dn(t,e,r);for(var i=-1,o=r.length;++i<o;){var a=r[i],u=e[a],c=n(u,t[a],a,e,t);(c===c?c===u:u!==u)&&("undefined"!=typeof u||a in e)||(e[a]=c)}return e}function hn(e,t){for(var n=-1,r=e.length,i=Nr(r),o=t.length,a=Ja(o);++n<o;){var u=t[n];if(i){u=parseFloat(u);a[n]=Mr(u,r)?e[u]:x}else a[n]=e[u]}return a}function dn(e,t,n){if(!n){n=t;t={}}for(var r=-1,i=n.length;++r<i;){var o=n[r];t[o]=e[o]}return t}function gn(e,t){for(var n=-1,r=t.length;++n<r;){var i=t[n];e[i]=gr(e[i],k,e)}return e}function vn(e,t,n){var r=typeof e;return"function"==r?"undefined"!=typeof t&&Wr(e)?tr(e,t,n):e:null==e?Ra:"object"==r?Tn(e):"undefined"==typeof t?Gn(e+""):En(e+"",t)}function yn(e,t,n,r,i,o,a){var u;n&&(u=i?n(e,r,i):n(e));if("undefined"!=typeof u)return u;if(!Lo(e))return e;var c=tc(e);if(c){u=kr(e);if(!t)return Kt(e,u)}else{var l=uu.call(e),s=l==H;if(l!=Q&&l!=U&&(!s||i))return Ct[l]?Pr(e,l,t):i?e:{};u=Ar(s?{}:e);if(!t)return dn(e,u,ac(e))}o||(o=[]);a||(a=[]);for(var f=o.length;f--;)if(o[f]==e)return a[f];o.push(e);a.push(u);(c?Zt:Ln)(e,function(r,i){u[i]=yn(r,t,n,i,e,o,a)});return u}function _n(e,t,n,r){if("function"!=typeof e)throw new Za(E);return mu(function(){e.apply(x,Hn(n,r))},t)}function mn(e,n){var r=e?e.length:0,i=[];if(!r)return i;var o=-1,a=xr(),u=a==t,c=u&&n.length>=200?qu(n):null,l=n.length;if(c){a=Vt;u=!1;n=c}e:for(;++o<r;){var s=e[o];if(u&&s===s){for(var f=l;f--;)if(n[f]===s)continue e;i.push(s)}else a(n,s,0)<0&&i.push(s)}return i}function bn(e,t){var n=e?e.length:0;if(!Nr(n))return Ln(e,t);for(var r=-1,i=Tr(e);++r<n&&t(i[r],r,i)!==!1;);return e}function xn(e,t){var n=e?e.length:0;if(!Nr(n))return Rn(e,t);for(var r=Tr(e);n--&&t(r[n],n,r)!==!1;);return e}function wn(e,t){var n=!0;bn(e,function(e,r,i){n=!!t(e,r,i);return n});return n}function kn(e,t,n,r){var i=e.length;n=null==n?0:+n||0;0>n&&(n=-n>i?0:i+n);r="undefined"==typeof r||r>i?i:+r||0;0>r&&(r+=i);i=n>r?0:r>>>0;n>>>=0;for(;i>n;)e[n++]=t;return e}function An(e,t){var n=[];bn(e,function(e,r,i){t(e,r,i)&&n.push(e)});return n}function Pn(e,t,n,r){var i;n(e,function(e,n,o){if(t(e,n,o)){i=r?n:e;return!1}});return i}function Wn(e,t,n,r){for(var i=r-1,o=e.length,a=-1,u=[];++i<o;){var c=e[i];if(h(c)&&Nr(c.length)&&(tc(c)||ko(c))){t&&(c=Wn(c,t,n,0));var l=-1,s=c.length;u.length+=s;for(;++l<s;)u[++a]=c[l]}else n||(u[++a]=c)}return u}function Mn(e,t,n){for(var r=-1,i=Tr(e),o=n(e),a=o.length;++r<a;){var u=o[r];if(t(i[u],u,i)===!1)break}return e}function jn(e,t,n){for(var r=Tr(e),i=n(e),o=i.length;o--;){var a=i[o];if(t(r[a],a,r)===!1)break}return e}function Nn(e,t){return Mn(e,t,Zo)}function Ln(e,t){return Mn(e,t,ac)}function Rn(e,t){return jn(e,t,ac)}function On(e,t){for(var n=-1,r=t.length,i=-1,o=[];++n<r;){var a=t[n];rc(e[a])&&(o[++i]=a)}return o}function Fn(e,t,n){var r=-1,i="function"==typeof t,o=e?e.length:0,a=Nr(o)?Ja(o):[];bn(e,function(e){var o=i?t:null!=e&&e[t];a[++r]=o?o.apply(e,n):x});return a}function Dn(e,t,n,r,i,o){if(e===t)return 0!==e||1/e==1/t;var a=typeof e,u=typeof t;return"function"!=a&&"object"!=a&&"function"!=u&&"object"!=u||null==e||null==t?e!==e&&t!==t:In(e,t,Dn,n,r,i,o)}function In(e,t,n,r,i,o,a){var u=tc(e),c=tc(t),l=G,s=G;if(!u){l=uu.call(e);l==U?l=Q:l!=Q&&(u=To(e))}if(!c){s=uu.call(t);s==U?s=Q:s!=Q&&(c=To(t))}var f=l==Q,p=s==Q,h=l==s;if(h&&!u&&!f)return yr(e,t,l);var d=f&&ou.call(e,"__wrapped__"),g=p&&ou.call(t,"__wrapped__");if(d||g)return n(d?e.value():e,g?t.value():t,r,i,o,a);if(!h)return!1;o||(o=[]);a||(a=[]);for(var v=o.length;v--;)if(o[v]==e)return a[v]==t;o.push(e);a.push(t);var y=(u?vr:_r)(e,t,n,r,i,o,a);o.pop();a.pop();return y}function Cn(e,t,n,r,i){var o=t.length;if(null==e)return!o;for(var a=-1,u=!i;++a<o;)if(u&&r[a]?n[a]!==e[t[a]]:!ou.call(e,t[a]))return!1;a=-1;for(;++a<o;){var c=t[a];if(u&&r[a])var l=ou.call(e,c);else{var s=e[c],f=n[a];l=i?i(s,f,c):x;"undefined"==typeof l&&(l=Dn(f,s,i,!0))}if(!l)return!1}return!0}function Sn(e,t){var n=[];bn(e,function(e,r,i){n.push(t(e,r,i))});return n}function Tn(e){var t=ac(e),n=t.length;if(1==n){var r=t[0],i=e[r];if(Lr(i))return function(e){return null!=e&&e[r]===i&&ou.call(e,r)}}for(var o=Ja(n),a=Ja(n);n--;){i=e[t[n]];o[n]=i;a[n]=Lr(i)}return function(e){return Cn(e,t,o,a)}}function En(e,t){return Lr(t)?function(n){return null!=n&&n[e]===t}:function(n){return null!=n&&Dn(t,n[e],null,!0)}}function Bn(e,t,n,r,i){if(!Lo(e))return e;var o=Nr(t.length)&&(tc(t)||To(t));(o?Zt:Ln)(t,function(t,a,u){if(h(t)){r||(r=[]);i||(i=[]);return Un(e,u,a,Bn,n,r,i)}var c=e[a],l=n?n(c,t,a,e,u):x,s="undefined"==typeof l;s&&(l=t);!o&&"undefined"==typeof l||!s&&(l===l?l===c:c!==c)||(e[a]=l)});return e}function Un(e,t,n,r,i,o,a){for(var u=o.length,c=t[n];u--;)if(o[u]==c){e[n]=a[u];return}var l=e[n],s=i?i(l,c,n,e,t):x,f="undefined"==typeof s;if(f){s=c;Nr(c.length)&&(tc(c)||To(c))?s=tc(l)?l:l?Kt(l):[]:ic(c)||ko(c)?s=ko(l)?Uo(l):ic(l)?l:{}:f=!1}o.push(c);a.push(s);f?e[n]=r(s,c,i,o,a):(s===s?s!==l:l===l)&&(e[n]=s)}function Gn(e){return function(t){return null==t?x:t[e]}}function $n(t,n){var r=n.length,i=hn(t,n);n.sort(e);for(;r--;){var o=parseFloat(n[r]);if(o!=a&&Mr(o)){var a=o;bu.call(t,o,1)}}return i}function Jn(e,t){return e+du(Fu()*(t-e+1))}function qn(e,t,n,r,i){i(e,function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)});return n}function Hn(e,t,n){var r=-1,i=e.length;t=null==t?0:+t||0;0>t&&(t=-t>i?0:i+t);n="undefined"==typeof n||n>i?i:+n||0;0>n&&(n+=i);i=t>n?0:n-t>>>0;t>>>=0;for(var o=Ja(i);++r<i;)o[r]=e[r+t];return o}function zn(e,t){var n;bn(e,function(e,r,i){n=t(e,r,i);return!n});return!!n}function Yn(e,t){var n=e.length;e.sort(t);for(;n--;)e[n]=e[n].value;return e}function Qn(e,t,n){var r=-1,i=e.length,o=Nr(i)?Ja(i):[];bn(e,function(e){for(var n=t.length,i=Ja(n);n--;)i[n]=null==e?x:e[t[n]];o[++r]={criteria:i,index:r,value:e}});return Yn(o,function(e,t){return c(e,t,n)})}function Vn(e,n){var r=-1,i=xr(),o=e.length,a=i==t,u=a&&o>=200,c=u?qu():null,l=[];if(c){i=Vt;a=!1}else{u=!1;c=n?[]:l}e:for(;++r<o;){var s=e[r],f=n?n(s,r,e):s;if(a&&s===s){for(var p=c.length;p--;)if(c[p]===f)continue e;n&&c.push(f);l.push(s)}else if(i(c,f,0)<0){(n||u)&&c.push(f);l.push(s)}}return l}function Xn(e,t){for(var n=-1,r=t.length,i=Ja(r);++n<r;)i[n]=e[t[n]];return i}function Kn(e,t){var n=e;n instanceof Tt&&(n=n.value());for(var r=-1,i=t.length;++r<i;){var o=[n],a=t[r];vu.apply(o,a.args);n=a.func.apply(a.thisArg,o)}return n}function Zn(e,t,n){var r=0,i=e?e.length:r;if("number"==typeof t&&t===t&&Tu>=i){for(;i>r;){var o=r+i>>>1,a=e[o];(n?t>=a:t>a)?r=o+1:i=o}return i}return er(e,t,Ra,n)}function er(e,t,n,r){t=n(t);for(var i=0,o=e?e.length:0,a=t!==t,u="undefined"==typeof t;o>i;){var c=du((i+o)/2),l=n(e[c]),s=l===l;if(a)var f=s||r;else f=u?s&&(r||"undefined"!=typeof l):r?t>=l:t>l;f?i=c+1:o=c}return Nu(o,Su)}function tr(e,t,n){if("function"!=typeof e)return Ra;if("undefined"==typeof t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)};case 5:return function(n,r,i,o,a){return e.call(t,n,r,i,o,a)}}return function(){return e.apply(t,arguments)}}function nr(e){return fu.call(e,0)}function rr(e,t,n){for(var r=n.length,i=-1,o=ju(e.length-r,0),a=-1,u=t.length,c=Ja(o+u);++a<u;)c[a]=t[a];for(;++i<r;)c[n[i]]=e[i];for(;o--;)c[a++]=e[i++];return c}function ir(e,t,n){for(var r=-1,i=n.length,o=-1,a=ju(e.length-i,0),u=-1,c=t.length,l=Ja(a+c);++o<a;)l[o]=e[o];for(var s=o;++u<c;)l[s+u]=t[u];for(;++r<i;)l[s+n[r]]=e[o++];return l}function or(e,t){return function(n,r,i){var o=t?t():{};r=br(r,i,3);if(tc(n))for(var a=-1,u=n.length;++a<u;){var c=n[a];e(o,c,r(c,a,n),n)}else bn(n,function(t,n,i){e(o,t,r(t,n,i),i)});return o}}function ar(e){return function(){var t=arguments,n=t.length,r=t[0];if(2>n||null==r)return r;var i=t[n-2],o=t[n-1],a=t[3];if(n>3&&"function"==typeof i){i=tr(i,o,5);n-=2}else{i=n>2&&"function"==typeof o?o:null;n-=i?1:0}if(a&&jr(t[1],t[2],a)){i=3==n?null:i;n=2}for(var u=0;++u<n;){var c=t[u];c&&e(r,c,i)}return r}}function ur(e,t){function n(){return(this instanceof n?r:e).apply(t,arguments)}var r=sr(e);return n}function cr(e){return function(){var t=arguments.length,n=t,r=e?t-1:0;if(!t)return function(){return arguments[0]};for(var i=Ja(t);n--;){i[n]=arguments[n];if("function"!=typeof i[n])throw new Za(E)}return function(){for(var n=r,o=i[n].apply(this,arguments);e?n--:++n<t;)o=i[n].call(this,o);return o}}}function lr(e){return function(t){for(var n=-1,r=Ma(fa(t)),i=r.length,o="";++n<i;)o=e(o,r[n],n);return o}}function sr(e){return function(){var t=$u(e.prototype),n=e.apply(t,arguments);return Lo(n)?n:t}}function fr(e,t){return function(n,r,o){o&&jr(n,r,o)&&(r=null);var a=br(),u=null==r;if(a!==vn||!u){u=!1;r=a(r,o,3)}if(u){var c=tc(n);if(c||!So(n))return e(c?n:Sr(n));r=i}return mr(n,r,t)}}function pr(e,t,n,r,i,o,a,u,c,l){function s(){for(var b=arguments.length,x=b,w=Ja(b);x--;)w[x]=arguments[x];r&&(w=rr(w,r,i));o&&(w=ir(w,o,a));if(d||y){var P=s.placeholder,W=g(w,P);b-=W.length;if(l>b){var M=u?Kt(u):null,L=ju(l-b,0),R=d?W:null,O=d?null:W,F=d?w:null,D=d?null:w;t|=d?j:N;t&=~(d?N:j);v||(t&=~(k|A));var I=pr(e,t,n,F,R,D,O,M,c,L);I.placeholder=P;return I}}var C=p?n:this;h&&(e=C[m]);u&&(w=Dr(w,u));f&&c<w.length&&(w.length=c);return(this instanceof s?_||sr(e):e).apply(C,w)}var f=t&R,p=t&k,h=t&A,d=t&W,v=t&P,y=t&M,_=!h&&sr(e),m=e;return s}function hr(e,t,n){var r=e.length;t=+t;if(r>=t||!Wu(t))return"";var i=t-r;n=null==n?" ":n+"";return ma(n,pu(i/n.length)).slice(0,i)}function dr(e,t,n,r){function i(){for(var t=-1,u=arguments.length,c=-1,l=r.length,s=Ja(u+l);++c<l;)s[c]=r[c];for(;u--;)s[c++]=arguments[++t];return(this instanceof i?a:e).apply(o?n:this,s)}var o=t&k,a=sr(e);return i}function gr(e,t,n,r,i,o,a,u){var c=t&A;if(!c&&"function"!=typeof e)throw new Za(E);var l=r?r.length:0;if(!l){t&=~(j|N);r=i=null}l-=i?i.length:0;if(t&N){var s=r,f=i;r=i=null}var p=!c&&Hu(e),h=[e,t,n,r,i,s,f,o,a,u];if(p&&p!==!0){Rr(h,p);t=h[1];u=h[9]}h[9]=null==u?c?0:e.length:ju(u-l,0)||0;if(t==k)var d=ur(h[0],h[2]);else d=t!=j&&t!=(k|j)||h[4].length?pr.apply(x,h):dr.apply(x,h);var g=p?Ju:zu;return g(d,h)}function vr(e,t,n,r,i,o,a){var u=-1,c=e.length,l=t.length,s=!0;if(c!=l&&!(i&&l>c))return!1;for(;s&&++u<c;){var f=e[u],p=t[u];s=x;r&&(s=i?r(p,f,u):r(f,p,u));if("undefined"==typeof s)if(i)for(var h=l;h--;){p=t[h];s=f&&f===p||n(f,p,r,i,o,a);if(s)break}else s=f&&f===p||n(f,p,r,i,o,a)}return!!s}function yr(e,t,n){switch(n){case $:case J:return+e==+t;case q:return e.name==t.name&&e.message==t.message;case Y:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case V:case K:return e==t+""}return!1}function _r(e,t,n,r,i,o,a){var u=ac(e),c=u.length,l=ac(t),s=l.length;if(c!=s&&!i)return!1;for(var f,p=-1;++p<c;){var h=u[p],d=ou.call(t,h);if(d){var g=e[h],v=t[h];d=x;r&&(d=i?r(v,g,h):r(g,v,h));"undefined"==typeof d&&(d=g&&g===v||n(g,v,r,i,o,a))}if(!d)return!1;f||(f="constructor"==h)}if(!f){var y=e.constructor,_=t.constructor;if(y!=_&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _))return!1}return!0}function mr(e,t,n){var r=n?Iu:Du,i=r,o=i;bn(e,function(e,a,u){var c=t(e,a,u);if((n?i>c:c>i)||c===r&&c===o){i=c;o=e}});return o}function br(e,t,n){var r=z.callback||Na;r=r===Na?vn:r;return n?r(e,t,n):r}function xr(e,n,r){var i=z.indexOf||Zr;i=i===Zr?t:i;return e?i(e,n,r):i}function wr(e,t,n){for(var r=-1,i=n?n.length:0;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=Nu(t,e+a);break;case"takeRight":e=ju(e,t-a)}}return{start:e,end:t}}function kr(e){var t=e.length,n=new e.constructor(t);if(t&&"string"==typeof e[0]&&ou.call(e,"index")){n.index=e.index;n.input=e.input}return n}function Ar(e){var t=e.constructor;"function"==typeof t&&t instanceof t||(t=Va);return new t}function Pr(e,t,n){var r=e.constructor;switch(t){case et:return nr(e);case $:case J:return new r(+e);case tt:case nt:case rt:case it:case ot:case at:case ut:case ct:case lt:var i=e.buffer;return new r(n?nr(i):i,e.byteOffset,e.length);case Y:case K:return new r(e);case V:var o=new r(e.source,xt.exec(e));o.lastIndex=e.lastIndex}return o}function Wr(e){var t=z.support,n=!(t.funcNames?e.name:t.funcDecomp);if(!n){var r=ru.call(e);t.funcNames||(n=!wt.test(r));if(!n){n=Nt.test(r)||Fo(e);Ju(e,n)}}return n}function Mr(e,t){e=+e;t=null==t?Bu:t;return e>-1&&e%1==0&&t>e}function jr(e,t,n){if(!Lo(n))return!1;var r=typeof t;if("number"==r)var i=n.length,o=Nr(i)&&Mr(t,i);else o="string"==r&&t in n;if(o){var a=n[t];return e===e?e===a:a!==a}return!1}function Nr(e){return"number"==typeof e&&e>-1&&e%1==0&&Bu>=e}function Lr(e){return e===e&&(0===e?1/e>0:!Lo(e))}function Rr(e,t){var n=e[1],r=t[1],i=n|r,o=R|L,a=k|A,u=o|a|P|M,c=n&R&&!(r&R),l=n&L&&!(r&L),s=(l?e:t)[7],f=(c?e:t)[8],p=!(n>=L&&r>a||n>a&&r>=L),h=i>=o&&u>=i&&(L>n||(l||c)&&s.length<=f);if(!p&&!h)return e;if(r&k){e[2]=t[2];i|=n&k?0:P}var d=t[3];if(d){var v=e[3];e[3]=v?rr(v,d,t[4]):Kt(d);e[4]=v?g(e[3],B):Kt(t[4])}d=t[5];if(d){v=e[5];e[5]=v?ir(v,d,t[6]):Kt(d);e[6]=v?g(e[5],B):Kt(t[6])}d=t[7];d&&(e[7]=Kt(d));r&R&&(e[8]=null==e[8]?t[8]:Nu(e[8],t[8]));null==e[9]&&(e[9]=t[9]);e[0]=t[0];e[1]=i;return e}function Or(e,t){e=Tr(e);for(var n=-1,r=t.length,i={};++n<r;){var o=t[n];o in e&&(i[o]=e[o])}return i}function Fr(e,t){var n={};Nn(e,function(e,r,i){t(e,r,i)&&(n[r]=e)});return n}function Dr(e,t){for(var n=e.length,r=Nu(t.length,n),i=Kt(e);r--;){var o=t[r];e[r]=Mr(o,n)?i[o]:x}return e}function Ir(e){{var t;z.support}if(!h(e)||uu.call(e)!=Q||!ou.call(e,"constructor")&&(t=e.constructor,"function"==typeof t&&!(t instanceof t)))return!1;var n;Nn(e,function(e,t){n=t});return"undefined"==typeof n||ou.call(e,n)}function Cr(e){for(var t=Zo(e),n=t.length,r=n&&e.length,i=z.support,o=r&&Nr(r)&&(tc(e)||i.nonEnumArgs&&ko(e)),a=-1,u=[];++a<n;){var c=t[a];(o&&Mr(c,r)||ou.call(e,c))&&u.push(c)}return u}function Sr(e){return null==e?[]:Nr(e.length)?Lo(e)?e:Va(e):aa(e)}function Tr(e){return Lo(e)?e:Va(e)}function Er(e){return e instanceof Tt?e.clone():new Z(e.__wrapped__,e.__chain__,Kt(e.__actions__))}function Br(e,t,n){t=(n?jr(e,t,n):null==t)?1:ju(+t||1,1);for(var r=0,i=e?e.length:0,o=-1,a=Ja(pu(i/t));i>r;)a[++o]=Hn(e,r,r+=t);return a}function Ur(e){for(var t=-1,n=e?e.length:0,r=-1,i=[];++t<n;){var o=e[t];o&&(i[++r]=o)}return i}function Gr(){for(var e=arguments,t=-1,n=e.length;++t<n;){var r=e[t];if(tc(r)||ko(r))break}return mn(r,Wn(e,!1,!0,++t))}function $r(e,t,n){var r=e?e.length:0;if(!r)return[];(n?jr(e,t,n):null==t)&&(t=1);return Hn(e,0>t?0:t)}function Jr(e,t,n){var r=e?e.length:0;if(!r)return[];(n?jr(e,t,n):null==t)&&(t=1);t=r-(+t||0);return Hn(e,0,0>t?0:t)}function qr(e,t,n){var r=e?e.length:0;if(!r)return[];t=br(t,n,3);for(;r--&&t(e[r],r,e););return Hn(e,0,r+1)}function Hr(e,t,n){var r=e?e.length:0;if(!r)return[];var i=-1;t=br(t,n,3);for(;++i<r&&t(e[i],i,e););return Hn(e,i)}function zr(e,t,n,r){var i=e?e.length:0;if(!i)return[];if(n&&"number"!=typeof n&&jr(e,t,n)){n=0;r=i}return kn(e,t,n,r)}function Yr(e,t,n){var r=-1,i=e?e.length:0;t=br(t,n,3);for(;++r<i;)if(t(e[r],r,e))return r;return-1}function Qr(e,t,n){var r=e?e.length:0;t=br(t,n,3);for(;r--;)if(t(e[r],r,e))return r;return-1}function Vr(e){return e?e[0]:x}function Xr(e,t,n){var r=e?e.length:0;n&&jr(e,t,n)&&(t=!1);return r?Wn(e,t,!1,0):[]}function Kr(e){var t=e?e.length:0;return t?Wn(e,!0,!1,0):[]}function Zr(e,n,r){var i=e?e.length:0;if(!i)return-1;if("number"==typeof r)r=0>r?ju(i+r,0):r;else if(r){var o=Zn(e,n),a=e[o];return(n===n?n===a:a!==a)?o:-1}return t(e,n,r||0)}function ei(e){return Jr(e,1)}function ti(){for(var e=[],n=-1,r=arguments.length,i=[],o=xr(),a=o==t;++n<r;){var u=arguments[n];if(tc(u)||ko(u)){e.push(u);i.push(a&&u.length>=120?qu(n&&u):null)}}r=e.length;var c=e[0],l=-1,s=c?c.length:0,f=[],p=i[0];e:for(;++l<s;){u=c[l];if((p?Vt(p,u):o(f,u,0))<0){n=r;for(;--n;){var h=i[n];if((h?Vt(h,u):o(e[n],u,0))<0)continue e}p&&p.push(u);f.push(u)}}return f}function ni(e){var t=e?e.length:0;return t?e[t-1]:x}function ri(e,t,n){var r=e?e.length:0;if(!r)return-1;var i=r;if("number"==typeof n)i=(0>n?ju(r+n,0):Nu(n||0,r-1))+1;else if(n){i=Zn(e,t,!0)-1;var o=e[i];return(t===t?t===o:o!==o)?i:-1}if(t!==t)return p(e,i,!0);for(;i--;)if(e[i]===t)return i;return-1}function ii(){var e=arguments,t=e[0];if(!t||!t.length)return t;for(var n=0,r=xr(),i=e.length;++n<i;)for(var o=0,a=e[n];(o=r(t,a,o))>-1;)bu.call(t,o,1);return t}function oi(e){return $n(e||[],Wn(arguments,!1,!1,1))}function ai(e,t,n){var r=-1,i=e?e.length:0,o=[];t=br(t,n,3);for(;++r<i;){var a=e[r];if(t(a,r,e)){o.push(a);bu.call(e,r--,1);i--}}return o}function ui(e){return $r(e,1)}function ci(e,t,n){var r=e?e.length:0;if(!r)return[];if(n&&"number"!=typeof n&&jr(e,t,n)){t=0;n=r}return Hn(e,t,n)}function li(e,t,n,r){var i=br(n);return i===vn&&null==n?Zn(e,t):er(e,t,i(n,r,1))}function si(e,t,n,r){var i=br(n);return i===vn&&null==n?Zn(e,t,!0):er(e,t,i(n,r,1),!0)}function fi(e,t,n){var r=e?e.length:0;if(!r)return[];(n?jr(e,t,n):null==t)&&(t=1);return Hn(e,0,0>t?0:t)}function pi(e,t,n){var r=e?e.length:0;if(!r)return[];(n?jr(e,t,n):null==t)&&(t=1);t=r-(+t||0);return Hn(e,0>t?0:t)}function hi(e,t,n){var r=e?e.length:0;if(!r)return[];t=br(t,n,3);for(;r--&&t(e[r],r,e););return Hn(e,r+1)}function di(e,t,n){var r=e?e.length:0;if(!r)return[];var i=-1;t=br(t,n,3);for(;++i<r&&t(e[i],i,e););return Hn(e,0,i)}function gi(){return Vn(Wn(arguments,!1,!0,0))}function vi(e,n,r,i){var o=e?e.length:0;if(!o)return[];if(null!=n&&"boolean"!=typeof n){i=r;r=jr(e,n,i)?null:n;n=!1}var a=br();(a!==vn||null!=r)&&(r=a(r,i,3));return n&&xr()==t?v(e,r):Vn(e,r)}function yi(e){for(var t=-1,n=(e&&e.length&&on(rn(e,iu)))>>>0,r=Ja(n);++t<n;)r[t]=rn(e,Gn(t));return r}function _i(e){return mn(e,Hn(arguments,1))}function mi(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(tc(n)||ko(n))var r=r?mn(r,n).concat(mn(n,r)):n}return r?Vn(r):[]}function bi(){for(var e=arguments.length,t=Ja(e);e--;)t[e]=arguments[e];return yi(t)}function xi(e,t){var n=-1,r=e?e.length:0,i={};!r||t||tc(e[0])||(t=[]);for(;++n<r;){var o=e[n];t?i[o]=t[n]:o&&(i[o[0]]=o[1])}return i}function wi(e){var t=z(e);t.__chain__=!0;return t}function ki(e,t,n){t.call(n,e);return e}function Ai(e,t,n){return t.call(n,e)}function Pi(){return wi(this)}function Wi(){return new Z(this.value(),this.__chain__)}function Mi(e){for(var t,n=this;n instanceof X;){var r=Er(n);t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}i.__wrapped__=e;return t}function ji(){var e=this.__wrapped__;if(e instanceof Tt){this.__actions__.length&&(e=new Tt(this));return new Z(e.reverse(),this.__chain__)}return this.thru(function(e){return e.reverse()})}function Ni(){return this.value()+""}function Li(){return Kn(this.__wrapped__,this.__actions__)}function Ri(e){var t=e?e.length:0;Nr(t)&&(e=Sr(e));return hn(e,Wn(arguments,!1,!1,1))}function Oi(e,t,n){var r=tc(e)?tn:wn;("function"!=typeof t||"undefined"!=typeof n)&&(t=br(t,n,3));return r(e,t)}function Fi(e,t,n){var r=tc(e)?nn:An;t=br(t,n,3);return r(e,t)}function Di(e,t,n){if(tc(e)){var r=Yr(e,t,n);return r>-1?e[r]:x}t=br(t,n,3);return Pn(e,t,bn)}function Ii(e,t,n){t=br(t,n,3);return Pn(e,t,xn)}function Ci(e,t){return Di(e,Tn(t))}function Si(e,t,n){return"function"==typeof t&&"undefined"==typeof n&&tc(e)?Zt(e,t):bn(e,tr(t,n,3))}function Ti(e,t,n){return"function"==typeof t&&"undefined"==typeof n&&tc(e)?en(e,t):xn(e,tr(t,n,3))}function Ei(e,t,n){var r=e?e.length:0;if(!Nr(r)){e=aa(e);r=e.length}if(!r)return!1;n="number"==typeof n?0>n?ju(r+n,0):n||0:0;return"string"==typeof e||!tc(e)&&So(e)?r>n&&e.indexOf(t,n)>-1:xr(e,t,n)>-1}function Bi(e,t){return Fn(e,t,Hn(arguments,2))}function Ui(e,t,n){var r=tc(e)?rn:Sn;t=br(t,n,3);return r(e,t)}function Gi(e,t){return Ui(e,Gn(t))}function $i(e,t,n,r){var i=tc(e)?un:qn;return i(e,br(t,r,4),n,arguments.length<3,bn)}function Ji(e,t,n,r){var i=tc(e)?cn:qn;return i(e,br(t,r,4),n,arguments.length<3,xn)}function qi(e,t,n){var r=tc(e)?nn:An;t=br(t,n,3);return r(e,function(e,n,r){return!t(e,n,r)})}function Hi(e,t,n){if(n?jr(e,t,n):null==t){e=Sr(e);var r=e.length;return r>0?e[Jn(0,r-1)]:x}var i=zi(e);i.length=Nu(0>t?0:+t||0,i.length);return i}function zi(e){e=Sr(e);for(var t=-1,n=e.length,r=Ja(n);++t<n;){var i=Jn(0,t);t!=i&&(r[t]=r[i]);r[i]=e[t]}return r}function Yi(e){var t=e?e.length:0;return Nr(t)?t:ac(e).length}function Qi(e,t,n){var r=tc(e)?ln:zn;("function"!=typeof t||"undefined"!=typeof n)&&(t=br(t,n,3));return r(e,t)}function Vi(e,t,n){if(null==e)return[];var r=-1,i=e.length,o=Nr(i)?Ja(i):[];n&&jr(e,t,n)&&(t=null);t=br(t,n,3);bn(e,function(e,n,i){o[++r]={criteria:t(e,n,i),index:r,value:e}});return Yn(o,u)}function Xi(e){if(null==e)return[];var t=arguments,n=t[3];n&&jr(t[1],t[2],n)&&(t=[e,t[1]]);return Qn(e,Wn(t,!1,!1,1),[])}function Ki(e,t,n,r){if(null==e)return[];r&&jr(t,n,r)&&(n=null);tc(t)||(t=null==t?[]:[t]);tc(n)||(n=null==n?[]:[n]);return Qn(e,t,n)}function Zi(e,t){return Fi(e,Tn(t))}function eo(e,t){if("function"!=typeof t){if("function"!=typeof e)throw new Za(E);var n=e;e=t;t=n}e=Wu(e=+e)?e:0;return function(){return--e<1?t.apply(this,arguments):void 0}}function to(e,t,n){n&&jr(e,t,n)&&(t=null);t=e&&null==t?e.length:ju(+t||0,0);return gr(e,R,null,null,null,null,t)}function no(e,t){var n;if("function"!=typeof t){if("function"!=typeof e)throw new Za(E);var r=e;e=t;t=r}return function(){--e>0?n=t.apply(this,arguments):t=null;return n}}function ro(e,t){var n=k;if(arguments.length>2){var r=Hn(arguments,2),i=g(r,ro.placeholder);n|=j}return gr(e,n,t,r,i)}function io(e){return gn(e,arguments.length>1?Wn(arguments,!1,!1,1):Vo(e))}function oo(e,t){var n=k|A;if(arguments.length>2){var r=Hn(arguments,2),i=g(r,oo.placeholder);n|=j}return gr(t,n,e,r,i)}function ao(e,t,n){n&&jr(e,t,n)&&(t=null);var r=gr(e,W,null,null,null,null,null,t);r.placeholder=ao.placeholder;return r}function uo(e,t,n){n&&jr(e,t,n)&&(t=null);var r=gr(e,M,null,null,null,null,null,t);r.placeholder=uo.placeholder;return r}function co(e,t,n){function r(){p&&hu(p);c&&hu(c);c=p=h=x}function i(){var n=t-(Ku()-s);if(0>=n||n>t){c&&hu(c);var r=h;c=p=h=x;if(r){d=Ku();l=e.apply(f,u);p||c||(u=f=null)}}else p=mu(i,n)}function o(){p&&hu(p);c=p=h=x;if(v||g!==t){d=Ku();l=e.apply(f,u);p||c||(u=f=null)}}function a(){u=arguments;s=Ku();f=this;h=v&&(p||!y);if(g===!1)var n=y&&!p;else{c||y||(d=s);var r=g-(s-d),a=0>=r||r>g;if(a){c&&(c=hu(c));d=s;l=e.apply(f,u)}else c||(c=mu(o,r))}a&&p?p=hu(p):p||t===g||(p=mu(i,t));if(n){a=!0;l=e.apply(f,u)}!a||p||c||(u=f=null);return l}var u,c,l,s,f,p,h,d=0,g=!1,v=!0;if("function"!=typeof e)throw new Za(E);t=0>t?0:+t||0;if(n===!0){var y=!0;v=!1}else if(Lo(n)){y=n.leading;g="maxWait"in n&&ju(+n.maxWait||0,t);v="trailing"in n?n.trailing:v}a.cancel=r;return a}function lo(e){return _n(e,1,arguments,1)}function so(e,t){return _n(e,t,arguments,2)}function fo(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new Za(E);var n=function(){var r=arguments,i=n.cache,o=t?t.apply(this,r):r[0];if(i.has(o))return i.get(o);var a=e.apply(this,r);i.set(o,a);return a};n.cache=new fo.Cache;return n}function po(e){if("function"!=typeof e)throw new Za(E);return function(){return!e.apply(this,arguments)}}function ho(e){return no(e,2)}function go(e){var t=Hn(arguments,1),n=g(t,go.placeholder);return gr(e,j,null,t,n)}function vo(e){var t=Hn(arguments,1),n=g(t,vo.placeholder);return gr(e,N,null,t,n)}function yo(e){var t=Wn(arguments,!1,!1,1);return gr(e,L,null,null,null,t)}function _o(e){if("function"!=typeof e)throw new Za(E);return function(t){return e.apply(this,t)}}function mo(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new Za(E);if(n===!1)r=!1;else if(Lo(n)){r="leading"in n?!!n.leading:r;i="trailing"in n?!!n.trailing:i}St.leading=r;St.maxWait=+t;St.trailing=i;return co(e,t,St)}function bo(e,t){t=null==t?Ra:t;return gr(t,j,null,[e],[])}function xo(e,t,n,r){if(t&&"boolean"!=typeof t&&jr(e,t,n))t=!1;else if("function"==typeof t){r=n;n=t;t=!1}n="function"==typeof n&&tr(n,r,1);return yn(e,t,n)}function wo(e,t,n){t="function"==typeof t&&tr(t,n,1);return yn(e,!0,t)}function ko(e){var t=h(e)?e.length:x;return Nr(t)&&uu.call(e)==U||!1}function Ao(e){return e===!0||e===!1||h(e)&&uu.call(e)==$||!1}function Po(e){return h(e)&&uu.call(e)==J||!1}function Wo(e){return e&&1===e.nodeType&&h(e)&&uu.call(e).indexOf("Element")>-1||!1}function Mo(e){if(null==e)return!0;var t=e.length;return Nr(t)&&(tc(e)||So(e)||ko(e)||h(e)&&rc(e.splice))?!t:!ac(e).length}function jo(e,t,n,r){n="function"==typeof n&&tr(n,r,3);if(!n&&Lr(e)&&Lr(t))return e===t;var i=n?n(e,t):x;return"undefined"==typeof i?Dn(e,t,n):!!i}function No(e){return h(e)&&"string"==typeof e.message&&uu.call(e)==q||!1}function Lo(e){var t=typeof e;return"function"==t||e&&"object"==t||!1}function Ro(e,t,n,r){var i=ac(t),o=i.length;n="function"==typeof n&&tr(n,r,3);if(!n&&1==o){var a=i[0],u=t[a];if(Lr(u))return null!=e&&u===e[a]&&ou.call(e,a)}for(var c=Ja(o),l=Ja(o);o--;){u=c[o]=t[i[o]];l[o]=Lr(u)}return Cn(e,i,c,l,n)}function Oo(e){return Io(e)&&e!=+e}function Fo(e){return null==e?!1:uu.call(e)==H?lu.test(ru.call(e)):h(e)&&At.test(e)||!1}function Do(e){return null===e}function Io(e){return"number"==typeof e||h(e)&&uu.call(e)==Y||!1}function Co(e){return h(e)&&uu.call(e)==V||!1}function So(e){return"string"==typeof e||h(e)&&uu.call(e)==K||!1}function To(e){return h(e)&&Nr(e.length)&&It[uu.call(e)]||!1}function Eo(e){return"undefined"==typeof e}function Bo(e){var t=e?e.length:0;return Nr(t)?t?Kt(e):[]:aa(e)}function Uo(e){return dn(e,Zo(e))}function Go(e,t,n){var r=$u(e);n&&jr(e,t,n)&&(t=null);return t?dn(t,r,ac(t)):r}function $o(e){if(null==e)return e;var t=Kt(arguments);t.push(sn);return oc.apply(x,t)}function Jo(e,t,n){t=br(t,n,3);return Pn(e,t,Ln,!0)}function qo(e,t,n){t=br(t,n,3);return Pn(e,t,Rn,!0)}function Ho(e,t,n){("function"!=typeof t||"undefined"!=typeof n)&&(t=tr(t,n,3));return Mn(e,t,Zo)}function zo(e,t,n){t=tr(t,n,3);return jn(e,t,Zo)}function Yo(e,t,n){("function"!=typeof t||"undefined"!=typeof n)&&(t=tr(t,n,3));return Ln(e,t)}function Qo(e,t,n){t=tr(t,n,3);return jn(e,t,ac)}function Vo(e){return On(e,Zo(e))}function Xo(e,t){return e?ou.call(e,t):!1}function Ko(e,t,n){n&&jr(e,t,n)&&(t=null);for(var r=-1,i=ac(e),o=i.length,a={};++r<o;){var u=i[r],c=e[u];t?ou.call(a,c)?a[c].push(u):a[c]=[u]:a[c]=u}return a}function Zo(e){if(null==e)return[];Lo(e)||(e=Va(e));var t=e.length;t=t&&Nr(t)&&(tc(e)||Gu.nonEnumArgs&&ko(e))&&t||0;for(var n=e.constructor,r=-1,i="function"==typeof n&&n.prototype===e,o=Ja(t),a=t>0;++r<t;)o[r]=r+"";for(var u in e)a&&Mr(u,t)||"constructor"==u&&(i||!ou.call(e,u))||o.push(u);return o}function ea(e,t,n){var r={};t=br(t,n,3);Ln(e,function(e,n,i){r[n]=t(e,n,i)});return r}function ta(e,t,n){if(null==e)return{};if("function"!=typeof t){var r=rn(Wn(arguments,!1,!1,1),Ka);return Or(e,mn(Zo(e),r))}t=tr(t,n,3);return Fr(e,function(e,n,r){return!t(e,n,r)})}function na(e){for(var t=-1,n=ac(e),r=n.length,i=Ja(r);++t<r;){var o=n[t];i[t]=[o,e[o]]}return i}function ra(e,t,n){return null==e?{}:"function"==typeof t?Fr(e,tr(t,n,3)):Or(e,Wn(arguments,!1,!1,1))}function ia(e,t,n){var r=null==e?x:e[t];"undefined"==typeof r&&(r=n);return rc(r)?r.call(e):r}function oa(e,t,n,r){var i=tc(e)||To(e);t=br(t,r,4);if(null==n)if(i||Lo(e)){var o=e.constructor;n=i?tc(e)?new o:[]:$u(rc(o)&&o.prototype)}else n={};(i?Zt:Ln)(e,function(e,r,i){return t(n,e,r,i)});return n}function aa(e){return Xn(e,ac(e))}function ua(e){return Xn(e,Zo(e))}function ca(e,t,n){t=+t||0;if("undefined"==typeof n){n=t;t=0}else n=+n||0;return e>=t&&n>e}function la(e,t,n){n&&jr(e,t,n)&&(t=n=null);var r=null==e,i=null==t;if(null==n)if(i&&"boolean"==typeof e){n=e;
e=1}else if("boolean"==typeof t){n=t;i=!0}if(r&&i){t=1;i=!1}e=+e||0;if(i){t=e;e=0}else t=+t||0;if(n||e%1||t%1){var o=Fu();return Nu(e+o*(t-e+parseFloat("1e-"+((o+"").length-1))),t)}return Jn(e,t)}function sa(e){e=r(e);return e&&e.charAt(0).toUpperCase()+e.slice(1)}function fa(e){e=r(e);return e&&e.replace(Pt,l)}function pa(e,t,n){e=r(e);t+="";var i=e.length;n=("undefined"==typeof n?i:Nu(0>n?0:+n||0,i))-t.length;return n>=0&&e.indexOf(t,n)==n}function ha(e){e=r(e);return e&&vt.test(e)?e.replace(dt,s):e}function da(e){e=r(e);return e&&jt.test(e)?e.replace(Mt,"\\$&"):e}function ga(e,t,n){e=r(e);t=+t;var i=e.length;if(i>=t||!Wu(t))return e;var o=(t-i)/2,a=du(o),u=pu(o);n=hr("",u,n);return n.slice(0,a)+e+n}function va(e,t,n){e=r(e);return e&&hr(e,t,n)+e}function ya(e,t,n){e=r(e);return e&&e+hr(e,t,n)}function _a(e,t,n){n&&jr(e,t,n)&&(t=0);return Ou(e,t)}function ma(e,t){var n="";e=r(e);t=+t;if(1>t||!e||!Wu(t))return n;do{t%2&&(n+=e);t=du(t/2);e+=e}while(t);return n}function ba(e,t,n){e=r(e);n=null==n?0:Nu(0>n?0:+n||0,e.length);return e.lastIndexOf(t,n)==n}function xa(e,t,n){var i=z.templateSettings;n&&jr(e,t,n)&&(t=n=null);e=r(e);t=pn(pn({},n||t),i,fn);var o,a,u=pn(pn({},t.imports),i.imports,fn),c=ac(u),l=Xn(u,c),s=0,p=t.interpolate||Wt,h="__p += '",d=Xa((t.escape||Wt).source+"|"+p.source+"|"+(p===mt?bt:Wt).source+"|"+(t.evaluate||Wt).source+"|$","g"),g="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++Dt+"]")+"\n";e.replace(d,function(t,n,r,i,u,c){r||(r=i);h+=e.slice(s,c).replace(Lt,f);if(n){o=!0;h+="' +\n__e("+n+") +\n'"}if(u){a=!0;h+="';\n"+u+";\n__p += '"}r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'");s=c+t.length;return t});h+="';\n";var v=t.variable;v||(h="with (obj) {\n"+h+"\n}\n");h=(a?h.replace(st,""):h).replace(ft,"$1").replace(pt,"$1;");h="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var y=ja(function(){return za(c,g+"return "+h).apply(x,l)});y.source=h;if(No(y))throw y;return y}function wa(e,t,n){var i=e;e=r(e);if(!e)return e;if(n?jr(i,t,n):null==t)return e.slice(y(e),_(e)+1);t+="";return e.slice(o(e,t),a(e,t)+1)}function ka(e,t,n){var i=e;e=r(e);return e?e.slice((n?jr(i,t,n):null==t)?y(e):o(e,t+"")):e}function Aa(e,t,n){var i=e;e=r(e);return e?(n?jr(i,t,n):null==t)?e.slice(0,_(e)+1):e.slice(0,a(e,t+"")+1):e}function Pa(e,t,n){n&&jr(e,t,n)&&(t=null);var i=O,o=F;if(null!=t)if(Lo(t)){var a="separator"in t?t.separator:a;i="length"in t?+t.length||0:i;o="omission"in t?r(t.omission):o}else i=+t||0;e=r(e);if(i>=e.length)return e;var u=i-o.length;if(1>u)return o;var c=e.slice(0,u);if(null==a)return c+o;if(Co(a)){if(e.slice(u).search(a)){var l,s,f=e.slice(0,u);a.global||(a=Xa(a.source,(xt.exec(a)||"")+"g"));a.lastIndex=0;for(;l=a.exec(f);)s=l.index;c=c.slice(0,null==s?u:s)}}else if(e.indexOf(a,u)!=u){var p=c.lastIndexOf(a);p>-1&&(c=c.slice(0,p))}return c+o}function Wa(e){e=r(e);return e&&gt.test(e)?e.replace(ht,m):e}function Ma(e,t,n){n&&jr(e,t,n)&&(t=null);e=r(e);return e.match(t||Rt)||[]}function ja(){for(var e=arguments[0],t=arguments.length,n=Ja(t?t-1:0);--t>0;)n[t-1]=arguments[t];try{return e.apply(x,n)}catch(r){return No(r)?r:new Ha(r)}}function Na(e,t,n){n&&jr(e,t,n)&&(t=null);return h(e)?Oa(e):vn(e,t)}function La(e){return function(){return e}}function Ra(e){return e}function Oa(e){return Tn(yn(e,!0))}function Fa(e,t){return En(e+"",yn(t,!0))}function Da(e,t,n){if(null==n){var r=Lo(t),i=r&&ac(t),o=i&&i.length&&On(t,i);if(!(o?o.length:r)){o=!1;n=t;t=e;e=this}}o||(o=On(t,ac(t)));var a=!0,u=-1,c=rc(e),l=o.length;n===!1?a=!1:Lo(n)&&"chain"in n&&(a=n.chain);for(;++u<l;){var s=o[u],f=t[s];e[s]=f;c&&(e.prototype[s]=function(t){return function(){var n=this.__chain__;if(a||n){var r=e(this.__wrapped__);(r.__actions__=Kt(this.__actions__)).push({func:t,args:arguments,thisArg:e});r.__chain__=n;return r}var i=[this.value()];vu.apply(i,arguments);return t.apply(e,i)}}(f))}return e}function Ia(){d._=cu;return this}function Ca(){}function Sa(e){return Gn(e+"")}function Ta(e){return function(t){return null==e?x:e[t]}}function Ea(e,t,n){n&&jr(e,t,n)&&(t=n=null);e=+e||0;n=null==n?1:+n||0;if(null==t){t=e;e=0}else t=+t||0;for(var r=-1,i=ju(pu((t-e)/(n||1)),0),o=Ja(i);++r<i;){o[r]=e;e+=n}return o}function Ba(e,t,n){e=+e;if(1>e||!Wu(e))return[];var r=-1,i=Ja(Nu(e,Cu));t=tr(t,n,1);for(;++r<e;)Cu>r?i[r]=t(r):t(r);return i}function Ua(e){var t=++au;return r(e)+t}function Ga(e,t){return e+t}function $a(e){tc(e)||(e=Sr(e));for(var t=e.length,n=0;t--;)n+=+e[t]||0;return n}d=d?Qt.defaults(Yt.Object(),d,Qt.pick(Yt,Ft)):Yt;var Ja=d.Array,qa=d.Date,Ha=d.Error,za=d.Function,Ya=d.Math,Qa=d.Number,Va=d.Object,Xa=d.RegExp,Ka=d.String,Za=d.TypeError,eu=Ja.prototype,tu=Va.prototype,nu=(nu=d.window)&&nu.document,ru=za.prototype.toString,iu=Gn("length"),ou=tu.hasOwnProperty,au=0,uu=tu.toString,cu=d._,lu=Xa("^"+da(uu).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),su=Fo(su=d.ArrayBuffer)&&su,fu=Fo(fu=su&&new su(0).slice)&&fu,pu=Ya.ceil,hu=d.clearTimeout,du=Ya.floor,gu=Fo(gu=Va.getPrototypeOf)&&gu,vu=eu.push,yu=tu.propertyIsEnumerable,_u=Fo(_u=d.Set)&&_u,mu=d.setTimeout,bu=eu.splice,xu=Fo(xu=d.Uint8Array)&&xu,wu=Fo(wu=d.WeakMap)&&wu,ku=function(){try{var e=Fo(e=d.Float64Array)&&e,t=new e(new su(10),0,1)&&e}catch(n){}return t}(),Au=Fo(Au=Ja.isArray)&&Au,Pu=Fo(Pu=Va.create)&&Pu,Wu=d.isFinite,Mu=Fo(Mu=Va.keys)&&Mu,ju=Ya.max,Nu=Ya.min,Lu=Fo(Lu=qa.now)&&Lu,Ru=Fo(Ru=Qa.isFinite)&&Ru,Ou=d.parseInt,Fu=Ya.random,Du=Qa.NEGATIVE_INFINITY,Iu=Qa.POSITIVE_INFINITY,Cu=Ya.pow(2,32)-1,Su=Cu-1,Tu=Cu>>>1,Eu=ku?ku.BYTES_PER_ELEMENT:0,Bu=Ya.pow(2,53)-1,Uu=wu&&new wu,Gu=z.support={};!function(){Gu.funcDecomp=!Fo(d.WinRTError)&&Nt.test(b);Gu.funcNames="string"==typeof za.name;try{Gu.dom=11===nu.createDocumentFragment().nodeType}catch(e){Gu.dom=!1}try{Gu.nonEnumArgs=!yu.call(arguments,1)}catch(e){Gu.nonEnumArgs=!0}}(0,0);z.templateSettings={escape:yt,evaluate:_t,interpolate:mt,variable:"",imports:{_:z}};var $u=function(){function e(){}return function(t){if(Lo(t)){e.prototype=t;var n=new e;e.prototype=null}return n||d.Object()}}(),Ju=Uu?function(e,t){Uu.set(e,t);return e}:Ra;fu||(nr=su&&xu?function(e){var t=e.byteLength,n=ku?du(t/Eu):0,r=n*Eu,i=new su(t);if(n){var o=new ku(i,0,n);o.set(new ku(e,0,n))}if(t!=r){o=new xu(i,r);o.set(new xu(e,r))}return i}:La(null));var qu=Pu&&_u?function(e){return new zt(e)}:La(null),Hu=Uu?function(e){return Uu.get(e)}:Ca,zu=function(){var e=0,t=0;return function(n,r){var i=Ku(),o=I-(i-t);t=i;if(o>0){if(++e>=D)return n}else e=0;return Ju(n,r)}}(),Yu=or(function(e,t,n){ou.call(e,n)?++e[n]:e[n]=1}),Qu=or(function(e,t,n){ou.call(e,n)?e[n].push(t):e[n]=[t]}),Vu=or(function(e,t,n){e[n]=t}),Xu=or(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),Ku=Lu||function(){return(new qa).getTime()},Zu=cr(),ec=cr(!0),tc=Au||function(e){return h(e)&&Nr(e.length)&&uu.call(e)==G||!1};Gu.dom||(Wo=function(e){return e&&1===e.nodeType&&h(e)&&!ic(e)||!1});var nc=Ru||function(e){return"number"==typeof e&&Wu(e)},rc=n(/x/)||xu&&!n(xu)?function(e){return uu.call(e)==H}:n,ic=gu?function(e){if(!e||uu.call(e)!=Q)return!1;var t=e.valueOf,n=Fo(t)&&(n=gu(t))&&gu(n);return n?e==n||gu(e)==n:Ir(e)}:Ir,oc=ar(pn),ac=Mu?function(e){if(e)var t=e.constructor,n=e.length;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&n&&Nr(n)?Cr(e):Lo(e)?Mu(e):[]}:Cr,uc=ar(Bn),cc=lr(function(e,t,n){t=t.toLowerCase();return e+(n?t.charAt(0).toUpperCase()+t.slice(1):t)}),lc=lr(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()});8!=Ou(Ot+"08")&&(_a=function(e,t,n){(n?jr(e,t,n):null==t)?t=0:t&&(t=+t);e=wa(e);return Ou(e,t||(kt.test(e)?16:10))});var sc=lr(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),fc=lr(function(e,t,n){return e+(n?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),pc=fr(on),hc=fr(an,!0);z.prototype=X.prototype;Z.prototype=$u(X.prototype);Z.prototype.constructor=Z;Tt.prototype=$u(X.prototype);Tt.prototype.constructor=Tt;Gt.prototype["delete"]=$t;Gt.prototype.get=Jt;Gt.prototype.has=qt;Gt.prototype.set=Ht;zt.prototype.push=Xt;fo.Cache=Gt;z.after=eo;z.ary=to;z.assign=oc;z.at=Ri;z.before=no;z.bind=ro;z.bindAll=io;z.bindKey=oo;z.callback=Na;z.chain=wi;z.chunk=Br;z.compact=Ur;z.constant=La;z.countBy=Yu;z.create=Go;z.curry=ao;z.curryRight=uo;z.debounce=co;z.defaults=$o;z.defer=lo;z.delay=so;z.difference=Gr;z.drop=$r;z.dropRight=Jr;z.dropRightWhile=qr;z.dropWhile=Hr;z.fill=zr;z.filter=Fi;z.flatten=Xr;z.flattenDeep=Kr;z.flow=Zu;z.flowRight=ec;z.forEach=Si;z.forEachRight=Ti;z.forIn=Ho;z.forInRight=zo;z.forOwn=Yo;z.forOwnRight=Qo;z.functions=Vo;z.groupBy=Qu;z.indexBy=Vu;z.initial=ei;z.intersection=ti;z.invert=Ko;z.invoke=Bi;z.keys=ac;z.keysIn=Zo;z.map=Ui;z.mapValues=ea;z.matches=Oa;z.matchesProperty=Fa;z.memoize=fo;z.merge=uc;z.mixin=Da;z.negate=po;z.omit=ta;z.once=ho;z.pairs=na;z.partial=go;z.partialRight=vo;z.partition=Xu;z.pick=ra;z.pluck=Gi;z.property=Sa;z.propertyOf=Ta;z.pull=ii;z.pullAt=oi;z.range=Ea;z.rearg=yo;z.reject=qi;z.remove=ai;z.rest=ui;z.shuffle=zi;z.slice=ci;z.sortBy=Vi;z.sortByAll=Xi;z.sortByOrder=Ki;z.spread=_o;z.take=fi;z.takeRight=pi;z.takeRightWhile=hi;z.takeWhile=di;z.tap=ki;z.throttle=mo;z.thru=Ai;z.times=Ba;z.toArray=Bo;z.toPlainObject=Uo;z.transform=oa;z.union=gi;z.uniq=vi;z.unzip=yi;z.values=aa;z.valuesIn=ua;z.where=Zi;z.without=_i;z.wrap=bo;z.xor=mi;z.zip=bi;z.zipObject=xi;z.backflow=ec;z.collect=Ui;z.compose=ec;z.each=Si;z.eachRight=Ti;z.extend=oc;z.iteratee=Na;z.methods=Vo;z.object=xi;z.select=Fi;z.tail=ui;z.unique=vi;Da(z,z);z.add=Ga;z.attempt=ja;z.camelCase=cc;z.capitalize=sa;z.clone=xo;z.cloneDeep=wo;z.deburr=fa;z.endsWith=pa;z.escape=ha;z.escapeRegExp=da;z.every=Oi;z.find=Di;z.findIndex=Yr;z.findKey=Jo;z.findLast=Ii;z.findLastIndex=Qr;z.findLastKey=qo;z.findWhere=Ci;z.first=Vr;z.has=Xo;z.identity=Ra;z.includes=Ei;z.indexOf=Zr;z.inRange=ca;z.isArguments=ko;z.isArray=tc;z.isBoolean=Ao;z.isDate=Po;z.isElement=Wo;z.isEmpty=Mo;z.isEqual=jo;z.isError=No;z.isFinite=nc;z.isFunction=rc;z.isMatch=Ro;z.isNaN=Oo;z.isNative=Fo;z.isNull=Do;z.isNumber=Io;z.isObject=Lo;z.isPlainObject=ic;z.isRegExp=Co;z.isString=So;z.isTypedArray=To;z.isUndefined=Eo;z.kebabCase=lc;z.last=ni;z.lastIndexOf=ri;z.max=pc;z.min=hc;z.noConflict=Ia;z.noop=Ca;z.now=Ku;z.pad=ga;z.padLeft=va;z.padRight=ya;z.parseInt=_a;z.random=la;z.reduce=$i;z.reduceRight=Ji;z.repeat=ma;z.result=ia;z.runInContext=b;z.size=Yi;z.snakeCase=sc;z.some=Qi;z.sortedIndex=li;z.sortedLastIndex=si;z.startCase=fc;z.startsWith=ba;z.sum=$a;z.template=xa;z.trim=wa;z.trimLeft=ka;z.trimRight=Aa;z.trunc=Pa;z.unescape=Wa;z.uniqueId=Ua;z.words=Ma;z.all=Oi;z.any=Qi;z.contains=Ei;z.detect=Di;z.foldl=$i;z.foldr=Ji;z.head=Vr;z.include=Ei;z.inject=$i;Da(z,function(){var e={};Ln(z,function(t,n){z.prototype[n]||(e[n]=t)});return e}(),!1);z.sample=Hi;z.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(t){return Hi(t,e)}):Hi(this.value())};z.VERSION=w;Zt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){z[e].placeholder=z});Zt(["dropWhile","filter","map","takeWhile"],function(e,t){var n=t!=S,r=t==C;Tt.prototype[e]=function(e,i){var o=this.__filtered__,a=o&&r?new Tt(this):this.clone(),u=a.__iteratees__||(a.__iteratees__=[]);a.__filtered__=o||n;u.push({done:!1,index:0,iteratee:br(e,i,1),type:t});return a}});Zt(["drop","take"],function(e,t){var n="__"+e+"Count__",r=e+"While";Tt.prototype[e]=function(r){r=null==r?1:ju(du(r)||0,0);var i=this.clone();if(i.__filtered__){var o=i[n];i[n]=t?Nu(o,r):o+r}else{var a=i.__views__||(i.__views__=[]);a.push({size:r,type:e+(i.__dir__<0?"Right":"")})}return i};Tt.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()};Tt.prototype[e+"RightWhile"]=function(e,t){return this.reverse()[r](e,t).reverse()}});Zt(["first","last"],function(e,t){var n="take"+(t?"Right":"");Tt.prototype[e]=function(){return this[n](1).value()[0]}});Zt(["initial","rest"],function(e,t){var n="drop"+(t?"":"Right");Tt.prototype[e]=function(){return this[n](1)}});Zt(["pluck","where"],function(e,t){var n=t?"filter":"map",r=t?Tn:Gn;Tt.prototype[e]=function(e){return this[n](r(e))}});Tt.prototype.compact=function(){return this.filter(Ra)};Tt.prototype.reject=function(e,t){e=br(e,t,1);return this.filter(function(t){return!e(t)})};Tt.prototype.slice=function(e,t){e=null==e?0:+e||0;var n=0>e?this.takeRight(-e):this.drop(e);if("undefined"!=typeof t){t=+t||0;n=0>t?n.dropRight(-t):n.take(t-e)}return n};Tt.prototype.toArray=function(){return this.drop(0)};Ln(Tt.prototype,function(e,t){var n=z[t],r=/^(?:filter|map|reject)|While$/.test(t),i=/^(?:first|last)$/.test(t);z.prototype[t]=function(){var t=arguments,o=(t.length,this.__chain__),a=this.__wrapped__,u=!!this.__actions__.length,c=a instanceof Tt,l=t[0],s=c||tc(a);s&&r&&"function"==typeof l&&1!=l.length&&(c=s=!1);var f=c&&!u;if(i&&!o)return f?e.call(a):n.call(z,this.value());var p=function(e){var r=[e];vu.apply(r,t);return n.apply(z,r)};if(s){var h=f?a:new Tt(this),d=e.apply(h,t);if(!i&&(u||d.__actions__)){var g=d.__actions__||(d.__actions__=[]);g.push({func:Ai,args:[p],thisArg:z})}return new Z(d,o)}return this.thru(p)}});Zt(["concat","join","pop","push","shift","sort","splice","unshift"],function(e){var t=eu[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:join|pop|shift)$/.test(e);z.prototype[e]=function(){var e=arguments;return r&&!this.__chain__?t.apply(this.value(),e):this[n](function(n){return t.apply(n,e)})}});Tt.prototype.clone=Et;Tt.prototype.reverse=Bt;Tt.prototype.value=Ut;z.prototype.chain=Pi;z.prototype.commit=Wi;z.prototype.plant=Mi;z.prototype.reverse=ji;z.prototype.toString=Ni;z.prototype.run=z.prototype.toJSON=z.prototype.valueOf=z.prototype.value=Li;z.prototype.collect=z.prototype.map;z.prototype.head=z.prototype.first;z.prototype.select=z.prototype.filter;z.prototype.tail=z.prototype.rest;return z}var x,w="3.4.0",k=1,A=2,P=4,W=8,M=16,j=32,N=64,L=128,R=256,O=30,F="...",D=150,I=16,C=0,S=2,T=3,E="Expected a function",B="__lodash_placeholder__",U="[object Arguments]",G="[object Array]",$="[object Boolean]",J="[object Date]",q="[object Error]",H="[object Function]",z="[object Map]",Y="[object Number]",Q="[object Object]",V="[object RegExp]",X="[object Set]",K="[object String]",Z="[object WeakMap]",et="[object ArrayBuffer]",tt="[object Float32Array]",nt="[object Float64Array]",rt="[object Int8Array]",it="[object Int16Array]",ot="[object Int32Array]",at="[object Uint8Array]",ut="[object Uint8ClampedArray]",ct="[object Uint16Array]",lt="[object Uint32Array]",st=/\b__p \+= '';/g,ft=/\b(__p \+=) '' \+/g,pt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ht=/&(?:amp|lt|gt|quot|#39|#96);/g,dt=/[&<>"'`]/g,gt=RegExp(ht.source),vt=RegExp(dt.source),yt=/<%-([\s\S]+?)%>/g,_t=/<%([\s\S]+?)%>/g,mt=/<%=([\s\S]+?)%>/g,bt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,xt=/\w*$/,wt=/^\s*function[ \n\r\t]+\w/,kt=/^0[xX]/,At=/^\[object .+?Constructor\]$/,Pt=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Wt=/($^)/,Mt=/[.*+?^${}()|[\]\/\\]/g,jt=RegExp(Mt.source),Nt=/\bthis\b/,Lt=/['\n\r\u2028\u2029\\]/g,Rt=function(){var e="[A-Z\\xc0-\\xd6\\xd8-\\xde]",t="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(e+"+(?="+e+t+")|"+e+"?"+t+"|"+e+"+|[0-9]+","g")}(),Ot=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",Ft=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window","WinRTError"],Dt=-1,It={};It[tt]=It[nt]=It[rt]=It[it]=It[ot]=It[at]=It[ut]=It[ct]=It[lt]=!0;It[U]=It[G]=It[et]=It[$]=It[J]=It[q]=It[H]=It[z]=It[Y]=It[Q]=It[V]=It[X]=It[K]=It[Z]=!1;var Ct={};Ct[U]=Ct[G]=Ct[et]=Ct[$]=Ct[J]=Ct[tt]=Ct[nt]=Ct[rt]=Ct[it]=Ct[ot]=Ct[Y]=Ct[Q]=Ct[V]=Ct[K]=Ct[at]=Ct[ut]=Ct[ct]=Ct[lt]=!0;Ct[q]=Ct[H]=Ct[z]=Ct[X]=Ct[Z]=!1;var St={leading:!1,maxWait:0,trailing:!1},Tt={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Et={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Bt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Ut={"function":!0,object:!0},Gt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},$t=Ut[typeof exports]&&exports&&!exports.nodeType&&exports,Jt=Ut[typeof module]&&module&&!module.nodeType&&module,qt=$t&&Jt&&"object"==typeof global&&global,Ht=Ut[typeof window]&&window,zt=Jt&&Jt.exports===$t&&$t,Yt=qt||Ht!==(this&&this.window)&&Ht||this,Qt=b();if("function"==typeof define&&"object"==typeof define.amd&&define.amd){Yt._=Qt;define("lodash",[],function(){return Qt})}else $t&&Jt?zt?(Jt.exports=Qt)._=Qt:$t._=Qt:Yt._=Qt}).call(this);define("eventmanager",[""],function(){function e(e,t){topics.hasOwnProperty(e)||(topics[e]=[]);topics[e].push(t);return!0}function t(e,t){if(!topics.hasOwnProperty(e))return!1;for(var n=0,r=topics[e].length;r>n;n++)if(String(topics[e][n])===String(t)){topics[e].splice(n,1);return!0}return!1}function n(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(!topics.hasOwnProperty(t))return!1;for(var n=0,r=topics[t].length;r>n;n++)topics[t][n].apply(void 0,e);return!0}topics={};return{subscribe:e,unsubscrive:t,publish:n,topics:topics}});define("standardlib",["eventmanager"],function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function t(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function n(e,t){var n={};n.x=t+e;n.y=t-e;return n}function r(e,t){var n={};n.x=(e-t)/2;n.y=(e+t)/2;return n}function i(e){e=_.cloneDeep(e);e.x=e.x-app.config.actor.grid.width/2*app.config.actor.tile.width;var t=(e.x/(app.config.actor.tile.width/2)+e.y/(app.config.actor.tile.height/2))/2,n=(e.y/(app.config.actor.tile.height/2)-e.x/(app.config.actor.tile.width/2))/2;t=Math.floor(t);n=Math.floor(n);return{x:t,y:n}}function o(e){var t=i(e);return r(t.x,t.y)}function a(e){var t=r(e.x,e.y),n=t.y*app.config.actor.tile.height,i=t.x*app.config.actor.tile.width+app.config.actor.grid.width/2*app.config.actor.tile.width;return{x:i,y:n}}function u(e,t){var n=setInterval(function(){e()&&clearInterval(n)},1e3)}return{guid:t,isoToTwoD:n,twoDToIso:r,worldPosToGridPos:i,worldPosToIsoPos:o,gridPosToWorldPos:a,checkWait:u}});define("RNG",[],function(){function e(){n(Date.now())}function t(){return l}function n(e){e=1>e?1/e:e;l=e;s=(e>>>0)*d;e=69069*e+1>>>0;f=e*d;e=69069*e+1>>>0;p=e*d;h=1}function r(){var e=2091639*s+h*d;s=f;f=p;h=0|e;p=e-h;return p}function i(e,t){do var n=2*r()-1,i=2*r()-1,o=n*n+i*i;while(o>1||0==o);var a=n*Math.sqrt(-2*Math.log(o)/o);return(e||0)+a*(t||1)}function o(){return 1+Math.floor(100*r())}function a(e){var t=0;for(var n in e)t+=e[n];var i=Math.floor(r()*t),o=0;for(var n in e){o+=e[n];if(o>i)return n}return null}function u(){return[s,f,p,h]}function c(e){s=e[0];f=e[1];p=e[2];h=e[3]}var l,s=0,f=0,p=0,h=0,d=2.3283064365386963e-10;e();return{getSeed:t,setSeed:n,getUniform:r,getNormal:i,getPercentage:o,getWeightedValue:a,getState:u,setState:c}});define("world",["RNG"],function(e){function t(){l=_.compose(o,a,o,o,r,n)()}function n(){var e,t,n=[];for(e=0;c>e;e++){n[e]=[];for(t=0;u>t;t++)n[e][t]=0}return n}function r(t){var n,r;for(n=0;n<t.length;n++)for(r=0;r<t[0].length;r++)t[n][r]=e.getUniform()<h?1:0;return t}function i(e,t,n){for(var r=0,i=0;i<d.length;i++){var o=d[i],a=t+o[0],c=n+o[1];0>a||a>=u||0>a||c>=u||(r+=1===e[a][c]?1:0)}return r}function o(e){for(var t=0,r=n(),o=0;o<e.length;o++){var a=1,u=0;if(6===p){a=2;u=o%2}for(var c=u;c<e[0].length;c+=a){t++;var l=e[c][o],h=i(e,c,o);l&&-1!==f.indexOf(h)?r[c][o]=1:l||-1===s.indexOf(h)||(r[c][o]=1)}}return r}function a(e){for(var t=[],n=2,r=0;r<e.length;r++)for(var i=0;n>i;i++){var o=r*n+i;t[o]=[];for(var a=0;a<e[0].length;a++)for(var u=0;n>u;u++){var c=a*n+u;t[o][c]=e[r][a]}}return t}var u=app.config.terrain.grid.width,c=app.config.terrain.grid.height,l=[],s=[5,6,7,8],f=[4,5,6,7,8],p=8,h=.47,d=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];t();return{grid:l}});!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define("pathfinding",e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.PF=e()}}(function(){return function e(t,n,r){function i(a,u){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t){t.exports=e("./lib/heap")},{"./lib/heap":2}],2:[function(e,t){(function(){var e,n,r,i,o,a,u,c,l,s,f,p,h,d,g;r=Math.floor,s=Math.min;n=function(e,t){return t>e?-1:e>t?1:0};l=function(e,t,i,o,a){var u;null==i&&(i=0);null==a&&(a=n);if(0>i)throw new Error("lo must be non-negative");null==o&&(o=e.length);for(;o>i;){u=r((i+o)/2);a(t,e[u])<0?o=u:i=u+1}return[].splice.apply(e,[i,i-i].concat(t)),t};a=function(e,t,r){null==r&&(r=n);e.push(t);return d(e,0,e.length-1,r)};o=function(e,t){var r,i;null==t&&(t=n);r=e.pop();if(e.length){i=e[0];e[0]=r;g(e,0,t)}else i=r;return i};c=function(e,t,r){var i;null==r&&(r=n);i=e[0];e[0]=t;g(e,0,r);return i};u=function(e,t,r){var i;null==r&&(r=n);if(e.length&&r(e[0],t)<0){i=[e[0],t],t=i[0],e[0]=i[1];g(e,0,r)}return t};i=function(e,t){var i,o,a,u,c,l;null==t&&(t=n);u=function(){l=[];for(var t=0,n=r(e.length/2);n>=0?n>t:t>n;n>=0?t++:t--)l.push(t);return l}.apply(this).reverse();c=[];for(o=0,a=u.length;a>o;o++){i=u[o];c.push(g(e,i,t))}return c};h=function(e,t,r){var i;null==r&&(r=n);i=e.indexOf(t);if(-1!==i){d(e,0,i,r);return g(e,i,r)}};f=function(e,t,r){var o,a,c,l,s;null==r&&(r=n);a=e.slice(0,t);if(!a.length)return a;i(a,r);s=e.slice(t);for(c=0,l=s.length;l>c;c++){o=s[c];u(a,o,r)}return a.sort(r).reverse()};p=function(e,t,r){var a,u,c,f,p,h,d,g,v,y;null==r&&(r=n);if(10*t<=e.length){f=e.slice(0,t).sort(r);if(!f.length)return f;c=f[f.length-1];g=e.slice(t);for(p=0,d=g.length;d>p;p++){a=g[p];if(r(a,c)<0){l(f,a,0,null,r);f.pop();c=f[f.length-1]}}return f}i(e,r);y=[];for(u=h=0,v=s(t,e.length);v>=0?v>h:h>v;u=v>=0?++h:--h)y.push(o(e,r));return y};d=function(e,t,r,i){var o,a,u;null==i&&(i=n);o=e[r];for(;r>t;){u=r-1>>1;a=e[u];if(!(i(o,a)<0))break;e[r]=a;r=u}return e[r]=o};g=function(e,t,r){var i,o,a,u,c;null==r&&(r=n);o=e.length;c=t;a=e[t];i=2*t+1;for(;o>i;){u=i+1;o>u&&!(r(e[i],e[u])<0)&&(i=u);e[t]=e[i];t=i;i=2*t+1}e[t]=a;return d(e,c,t,r)};e=function(){function e(e){this.cmp=null!=e?e:n;this.nodes=[]}e.push=a;e.pop=o;e.replace=c;e.pushpop=u;e.heapify=i;e.updateItem=h;e.nlargest=f;e.nsmallest=p;e.prototype.push=function(e){return a(this.nodes,e,this.cmp)};e.prototype.pop=function(){return o(this.nodes,this.cmp)};e.prototype.peek=function(){return this.nodes[0]};e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)};e.prototype.replace=function(e){return c(this.nodes,e,this.cmp)};e.prototype.pushpop=function(e){return u(this.nodes,e,this.cmp)};e.prototype.heapify=function(){return i(this.nodes,this.cmp)};e.prototype.updateItem=function(e){return h(this.nodes,e,this.cmp)};e.prototype.clear=function(){return this.nodes=[]};e.prototype.empty=function(){return 0===this.nodes.length};e.prototype.size=function(){return this.nodes.length};e.prototype.clone=function(){var t;t=new e;t.nodes=this.nodes.slice(0);return t};e.prototype.toArray=function(){return this.nodes.slice(0)};e.prototype.insert=e.prototype.push;e.prototype.top=e.prototype.peek;e.prototype.front=e.prototype.peek;e.prototype.has=e.prototype.contains;e.prototype.copy=e.prototype.clone;return e}();("undefined"!=typeof t&&null!==t?t.exports:void 0)?t.exports=e:window.Heap=e}).call(this)},{}],3:[function(e,t){var n={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4};t.exports=n},{}],4:[function(e,t){function n(e,t,n){this.width=e;this.height=t;this.nodes=this._buildNodes(e,t,n)}var r=e("./Node"),i=e("./DiagonalMovement");n.prototype._buildNodes=function(e,t,n){var i,o,a=new Array(t);for(i=0;t>i;++i){a[i]=new Array(e);for(o=0;e>o;++o)a[i][o]=new r(o,i)}if(void 0===n)return a;if(n.length!==t||n[0].length!==e)throw new Error("Matrix size does not fit");for(i=0;t>i;++i)for(o=0;e>o;++o)n[i][o]&&(a[i][o].walkable=!1);return a};n.prototype.getNodeAt=function(e,t){return this.nodes[t][e]};n.prototype.isWalkableAt=function(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable};n.prototype.isInside=function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height};n.prototype.setWalkableAt=function(e,t,n){this.nodes[t][e].walkable=n};n.prototype.getNeighbors=function(e,t){var n=e.x,r=e.y,o=[],a=!1,u=!1,c=!1,l=!1,s=!1,f=!1,p=!1,h=!1,d=this.nodes;if(this.isWalkableAt(n,r-1)){o.push(d[r-1][n]);a=!0}if(this.isWalkableAt(n+1,r)){o.push(d[r][n+1]);c=!0}if(this.isWalkableAt(n,r+1)){o.push(d[r+1][n]);s=!0}if(this.isWalkableAt(n-1,r)){o.push(d[r][n-1]);p=!0}if(t===i.Never)return o;if(t===i.OnlyWhenNoObstacles){u=p&&a;l=a&&c;f=c&&s;h=s&&p}else if(t===i.IfAtMostOneObstacle){u=p||a;l=a||c;f=c||s;h=s||p}else{if(t!==i.Always)throw new Error("Incorrect value of diagonalMovement");u=!0;l=!0;f=!0;h=!0}u&&this.isWalkableAt(n-1,r-1)&&o.push(d[r-1][n-1]);l&&this.isWalkableAt(n+1,r-1)&&o.push(d[r-1][n+1]);f&&this.isWalkableAt(n+1,r+1)&&o.push(d[r+1][n+1]);h&&this.isWalkableAt(n-1,r+1)&&o.push(d[r+1][n-1]);return o};n.prototype.clone=function(){var e,t,i=this.width,o=this.height,a=this.nodes,u=new n(i,o),c=new Array(o);for(e=0;o>e;++e){c[e]=new Array(i);for(t=0;i>t;++t)c[e][t]=new r(t,e,a[e][t].walkable)}u.nodes=c;return u};t.exports=n},{"./DiagonalMovement":3,"./Node":6}],5:[function(e,t){t.exports={manhattan:function(e,t){return e+t},euclidean:function(e,t){return Math.sqrt(e*e+t*t)},octile:function(e,t){var n=Math.SQRT2-1;return t>e?n*e+t:n*t+e},chebyshev:function(e,t){return Math.max(e,t)}}},{}],6:[function(e,t){function n(e,t,n){this.x=e;this.y=t;this.walkable=void 0===n?!0:n}t.exports=n},{}],7:[function(e,t,n){function r(e){for(var t=[[e.x,e.y]];e.parent;){e=e.parent;t.push([e.x,e.y])}return t.reverse()}function i(e,t){var n=r(e),i=r(t);return n.concat(i.reverse())}function o(e){var t,n,r,i,o,a=0;for(t=1;t<e.length;++t){n=e[t-1];r=e[t];i=n[0]-r[0];o=n[1]-r[1];a+=Math.sqrt(i*i+o*o)}return a}function a(e,t,n,r){var i,o,a,u,c,l,s=Math.abs,f=[];a=s(n-e);u=s(r-t);i=n>e?1:-1;o=r>t?1:-1;c=a-u;for(;;){f.push([e,t]);if(e===n&&t===r)break;l=2*c;if(l>-u){c-=u;e+=i}if(a>l){c+=a;t+=o}}return f}function u(e){var t,n,r,i,o,u,c=[],l=e.length;if(2>l)return c;for(o=0;l-1>o;++o){t=e[o];n=e[o+1];r=a(t[0],t[1],n[0],n[1]);i=r.length;for(u=0;i-1>u;++u)c.push(r[u])}c.push(e[l-1]);return c}function c(e,t){var n,r,i,o,u,c,l,s,f,p,h,d=t.length,g=t[0][0],v=t[0][1],y=t[d-1][0],_=t[d-1][1];n=g;r=v;u=[[n,r]];for(c=2;d>c;++c){s=t[c];i=s[0];o=s[1];f=a(n,r,i,o);h=!1;for(l=1;l<f.length;++l){p=f[l];if(!e.isWalkableAt(p[0],p[1])){h=!0;break}}if(h){lastValidCoord=t[c-1];u.push(lastValidCoord);n=lastValidCoord[0];r=lastValidCoord[1]}}u.push([y,_]);return u}function l(e){if(e.length<3)return e;var t,n,r,i,o,a,u=[],c=e[0][0],l=e[0][1],s=e[1][0],f=e[1][1],p=s-c,h=f-l;o=Math.sqrt(p*p+h*h);p/=o;h/=o;u.push([c,l]);for(a=2;a<e.length;a++){t=s;n=f;r=p;i=h;s=e[a][0];f=e[a][1];p=s-t;h=f-n;o=Math.sqrt(p*p+h*h);p/=o;h/=o;(p!==r||h!==i)&&u.push([t,n])}u.push([s,f]);return u}n.backtrace=r;n.biBacktrace=i;n.pathLength=o;n.interpolate=a;n.expandPath=u;n.smoothenPath=c;n.compressPath=l},{}],8:[function(e,t){t.exports={Heap:e("heap"),Node:e("./core/Node"),Grid:e("./core/Grid"),Util:e("./core/Util"),DiagonalMovement:e("./core/DiagonalMovement"),Heuristic:e("./core/Heuristic"),AStarFinder:e("./finders/AStarFinder"),BestFirstFinder:e("./finders/BestFirstFinder"),BreadthFirstFinder:e("./finders/BreadthFirstFinder"),DijkstraFinder:e("./finders/DijkstraFinder"),BiAStarFinder:e("./finders/BiAStarFinder"),BiBestFirstFinder:e("./finders/BiBestFirstFinder"),BiBreadthFirstFinder:e("./finders/BiBreadthFirstFinder"),BiDijkstraFinder:e("./finders/BiDijkstraFinder"),IDAStarFinder:e("./finders/IDAStarFinder"),JumpPointFinder:e("./finders/JumpPointFinder")}},{"./core/DiagonalMovement":3,"./core/Grid":4,"./core/Heuristic":5,"./core/Node":6,"./core/Util":7,"./finders/AStarFinder":9,"./finders/BestFirstFinder":10,"./finders/BiAStarFinder":11,"./finders/BiBestFirstFinder":12,"./finders/BiBreadthFirstFinder":13,"./finders/BiDijkstraFinder":14,"./finders/BreadthFirstFinder":15,"./finders/DijkstraFinder":16,"./finders/IDAStarFinder":17,"./finders/JumpPointFinder":22,heap:1}],9:[function(e,t){function n(e){e=e||{};this.allowDiagonal=e.allowDiagonal;this.dontCrossCorners=e.dontCrossCorners;this.heuristic=e.heuristic||o.manhattan;this.weight=e.weight||1;this.diagonalMovement=e.diagonalMovement;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?a.OnlyWhenNoObstacles:a.IfAtMostOneObstacle:a.Never);this.heuristic=this.diagonalMovement===a.Never?e.heuristic||o.manhattan:e.heuristic||o.octile}var r=e("heap"),i=e("../core/Util"),o=e("../core/Heuristic"),a=e("../core/DiagonalMovement");n.prototype.findPath=function(e,t,n,o,a){var u,c,l,s,f,p,h,d,g=new r(function(e,t){return e.f-t.f}),v=a.getNodeAt(e,t),y=a.getNodeAt(n,o),_=this.heuristic,m=this.diagonalMovement,b=this.weight,x=Math.abs,w=Math.SQRT2;v.g=0;v.f=0;g.push(v);v.opened=!0;for(;!g.empty();){u=g.pop();u.closed=!0;if(u===y)return i.backtrace(y);c=a.getNeighbors(u,m);for(s=0,f=c.length;f>s;++s){l=c[s];if(!l.closed){p=l.x;h=l.y;d=u.g+(p-u.x===0||h-u.y===0?1:w);if(!l.opened||d<l.g){l.g=d;l.h=l.h||b*_(x(p-n),x(h-o));l.f=l.g+l.h;l.parent=u;if(l.opened)g.updateItem(l);else{g.push(l);l.opened=!0}}}}}return[]};t.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],10:[function(e,t){function n(e){r.call(this,e);var t=this.heuristic;this.heuristic=function(e,n){return 1e6*t(e,n)}}var r=e("./AStarFinder");n.prototype=new r;n.prototype.constructor=n;t.exports=n},{"./AStarFinder":9}],11:[function(e,t){function n(e){e=e||{};this.allowDiagonal=e.allowDiagonal;this.dontCrossCorners=e.dontCrossCorners;this.diagonalMovement=e.diagonalMovement;this.heuristic=e.heuristic||o.manhattan;this.weight=e.weight||1;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?a.OnlyWhenNoObstacles:a.IfAtMostOneObstacle:a.Never);this.heuristic=this.diagonalMovement===a.Never?e.heuristic||o.manhattan:e.heuristic||o.octile}var r=e("heap"),i=e("../core/Util"),o=e("../core/Heuristic"),a=e("../core/DiagonalMovement");n.prototype.findPath=function(e,t,n,o,a){var u,c,l,s,f,p,h,d,g=function(e,t){return e.f-t.f},v=new r(g),y=new r(g),_=a.getNodeAt(e,t),m=a.getNodeAt(n,o),b=this.heuristic,x=this.diagonalMovement,w=this.weight,k=Math.abs,A=Math.SQRT2,P=1,W=2;_.g=0;_.f=0;v.push(_);_.opened=P;m.g=0;m.f=0;y.push(m);m.opened=W;for(;!v.empty()&&!y.empty();){u=v.pop();u.closed=!0;c=a.getNeighbors(u,x);for(s=0,f=c.length;f>s;++s){l=c[s];if(!l.closed){if(l.opened===W)return i.biBacktrace(u,l);p=l.x;h=l.y;d=u.g+(p-u.x===0||h-u.y===0?1:A);if(!l.opened||d<l.g){l.g=d;l.h=l.h||w*b(k(p-n),k(h-o));l.f=l.g+l.h;l.parent=u;if(l.opened)v.updateItem(l);else{v.push(l);l.opened=P}}}}u=y.pop();u.closed=!0;c=a.getNeighbors(u,x);for(s=0,f=c.length;f>s;++s){l=c[s];if(!l.closed){if(l.opened===P)return i.biBacktrace(l,u);p=l.x;h=l.y;d=u.g+(p-u.x===0||h-u.y===0?1:A);if(!l.opened||d<l.g){l.g=d;l.h=l.h||w*b(k(p-e),k(h-t));
l.f=l.g+l.h;l.parent=u;if(l.opened)y.updateItem(l);else{y.push(l);l.opened=W}}}}}return[]};t.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],12:[function(e,t){function n(e){r.call(this,e);var t=this.heuristic;this.heuristic=function(e,n){return 1e6*t(e,n)}}var r=e("./BiAStarFinder");n.prototype=new r;n.prototype.constructor=n;t.exports=n},{"./BiAStarFinder":11}],13:[function(e,t){function n(e){e=e||{};this.allowDiagonal=e.allowDiagonal;this.dontCrossCorners=e.dontCrossCorners;this.diagonalMovement=e.diagonalMovement;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?i.OnlyWhenNoObstacles:i.IfAtMostOneObstacle:i.Never)}var r=e("../core/Util"),i=e("../core/DiagonalMovement");n.prototype.findPath=function(e,t,n,i,o){var a,u,c,l,s,f=o.getNodeAt(e,t),p=o.getNodeAt(n,i),h=[],d=[],g=this.diagonalMovement,v=0,y=1;h.push(f);f.opened=!0;f.by=v;d.push(p);p.opened=!0;p.by=y;for(;h.length&&d.length;){c=h.shift();c.closed=!0;a=o.getNeighbors(c,g);for(l=0,s=a.length;s>l;++l){u=a[l];if(!u.closed)if(u.opened){if(u.by===y)return r.biBacktrace(c,u)}else{h.push(u);u.parent=c;u.opened=!0;u.by=v}}c=d.shift();c.closed=!0;a=o.getNeighbors(c,g);for(l=0,s=a.length;s>l;++l){u=a[l];if(!u.closed)if(u.opened){if(u.by===v)return r.biBacktrace(u,c)}else{d.push(u);u.parent=c;u.opened=!0;u.by=y}}}return[]};t.exports=n},{"../core/DiagonalMovement":3,"../core/Util":7}],14:[function(e,t){function n(e){r.call(this,e);this.heuristic=function(){return 0}}var r=e("./BiAStarFinder");n.prototype=new r;n.prototype.constructor=n;t.exports=n},{"./BiAStarFinder":11}],15:[function(e,t){function n(e){e=e||{};this.allowDiagonal=e.allowDiagonal;this.dontCrossCorners=e.dontCrossCorners;this.diagonalMovement=e.diagonalMovement;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?i.OnlyWhenNoObstacles:i.IfAtMostOneObstacle:i.Never)}var r=e("../core/Util"),i=e("../core/DiagonalMovement");n.prototype.findPath=function(e,t,n,i,o){var a,u,c,l,s,f=[],p=this.diagonalMovement,h=o.getNodeAt(e,t),d=o.getNodeAt(n,i);f.push(h);h.opened=!0;for(;f.length;){c=f.shift();c.closed=!0;if(c===d)return r.backtrace(d);a=o.getNeighbors(c,p);for(l=0,s=a.length;s>l;++l){u=a[l];if(!u.closed&&!u.opened){f.push(u);u.opened=!0;u.parent=c}}}return[]};t.exports=n},{"../core/DiagonalMovement":3,"../core/Util":7}],16:[function(e,t){function n(e){r.call(this,e);this.heuristic=function(){return 0}}var r=e("./AStarFinder");n.prototype=new r;n.prototype.constructor=n;t.exports=n},{"./AStarFinder":9}],17:[function(e,t){function n(e){e=e||{};this.allowDiagonal=e.allowDiagonal;this.dontCrossCorners=e.dontCrossCorners;this.diagonalMovement=e.diagonalMovement;this.heuristic=e.heuristic||r.manhattan;this.weight=e.weight||1;this.trackRecursion=e.trackRecursion||!1;this.timeLimit=e.timeLimit||1/0;this.diagonalMovement||(this.diagonalMovement=this.allowDiagonal?this.dontCrossCorners?o.OnlyWhenNoObstacles:o.IfAtMostOneObstacle:o.Never);this.heuristic=this.diagonalMovement===o.Never?e.heuristic||r.manhattan:e.heuristic||r.octile}var r=(e("../core/Util"),e("../core/Heuristic")),i=e("../core/Node"),o=e("../core/DiagonalMovement");n.prototype.findPath=function(e,t,n,r,o){var a,u,c,l=0,s=(new Date).getTime(),f=function(e,t){return this.heuristic(Math.abs(t.x-e.x),Math.abs(t.y-e.y))}.bind(this),p=function(e,t){return e.x===t.x||e.y===t.y?1:Math.SQRT2},h=function(e,t,n,r,a){l++;if(this.timeLimit>0&&(new Date).getTime()-s>1e3*this.timeLimit)return 1/0;var u=t+f(e,g)*this.weight;if(u>n)return u;if(e==g){r[a]=[e.x,e.y];return e}var c,d,v,y,_=o.getNeighbors(e,this.diagonalMovement);for(v=0,c=1/0;y=_[v];++v){if(this.trackRecursion){y.retainCount=y.retainCount+1||1;y.tested!==!0&&(y.tested=!0)}d=h(y,t+p(e,y),n,r,a+1);if(d instanceof i){r[a]=[e.x,e.y];return d}this.trackRecursion&&0===--y.retainCount&&(y.tested=!1);c>d&&(c=d)}return c}.bind(this),d=o.getNodeAt(e,t),g=o.getNodeAt(n,r),v=f(d,g);for(a=0;!0;++a){u=[];c=h(d,0,v,u,0);if(1/0===c)return[];if(c instanceof i)return u;v=c}return[]};t.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Node":6,"../core/Util":7}],18:[function(e,t){function n(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");n.prototype=new r;n.prototype.constructor=n;n.prototype._jump=function(e,t,n,r){var i=this.grid,o=e-n,a=t-r;if(!i.isWalkableAt(e,t))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0);if(i.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==o&&0!==a){if(i.isWalkableAt(e-o,t+a)&&!i.isWalkableAt(e-o,t)||i.isWalkableAt(e+o,t-a)&&!i.isWalkableAt(e,t-a))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+a,e,t))return[e,t]}else if(0!==o){if(i.isWalkableAt(e+o,t+1)&&!i.isWalkableAt(e,t+1)||i.isWalkableAt(e+o,t-1)&&!i.isWalkableAt(e,t-1))return[e,t]}else if(i.isWalkableAt(e+1,t+a)&&!i.isWalkableAt(e+1,t)||i.isWalkableAt(e-1,t+a)&&!i.isWalkableAt(e-1,t))return[e,t];return this._jump(e+o,t+a,e,t)};n.prototype._findNeighbors=function(e){var t,n,r,o,a,u,c,l,s=e.parent,f=e.x,p=e.y,h=this.grid,d=[];if(s){t=s.x;n=s.y;r=(f-t)/Math.max(Math.abs(f-t),1);o=(p-n)/Math.max(Math.abs(p-n),1);if(0!==r&&0!==o){h.isWalkableAt(f,p+o)&&d.push([f,p+o]);h.isWalkableAt(f+r,p)&&d.push([f+r,p]);h.isWalkableAt(f+r,p+o)&&d.push([f+r,p+o]);h.isWalkableAt(f-r,p)||d.push([f-r,p+o]);h.isWalkableAt(f,p-o)||d.push([f+r,p-o])}else if(0===r){h.isWalkableAt(f,p+o)&&d.push([f,p+o]);h.isWalkableAt(f+1,p)||d.push([f+1,p+o]);h.isWalkableAt(f-1,p)||d.push([f-1,p+o])}else{h.isWalkableAt(f+r,p)&&d.push([f+r,p]);h.isWalkableAt(f,p+1)||d.push([f+r,p+1]);h.isWalkableAt(f,p-1)||d.push([f+r,p-1])}}else{a=h.getNeighbors(e,i.Always);for(c=0,l=a.length;l>c;++c){u=a[c];d.push([u.x,u.y])}}return d};t.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],19:[function(e,t){function n(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");n.prototype=new r;n.prototype.constructor=n;n.prototype._jump=function(e,t,n,r){var i=this.grid,o=e-n,a=t-r;if(!i.isWalkableAt(e,t))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0);if(i.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==o&&0!==a){if(i.isWalkableAt(e-o,t+a)&&!i.isWalkableAt(e-o,t)||i.isWalkableAt(e+o,t-a)&&!i.isWalkableAt(e,t-a))return[e,t];if(this._jump(e+o,t,e,t)||this._jump(e,t+a,e,t))return[e,t]}else if(0!==o){if(i.isWalkableAt(e+o,t+1)&&!i.isWalkableAt(e,t+1)||i.isWalkableAt(e+o,t-1)&&!i.isWalkableAt(e,t-1))return[e,t]}else if(i.isWalkableAt(e+1,t+a)&&!i.isWalkableAt(e+1,t)||i.isWalkableAt(e-1,t+a)&&!i.isWalkableAt(e-1,t))return[e,t];return i.isWalkableAt(e+o,t)||i.isWalkableAt(e,t+a)?this._jump(e+o,t+a,e,t):null};n.prototype._findNeighbors=function(e){var t,n,r,o,a,u,c,l,s=e.parent,f=e.x,p=e.y,h=this.grid,d=[];if(s){t=s.x;n=s.y;r=(f-t)/Math.max(Math.abs(f-t),1);o=(p-n)/Math.max(Math.abs(p-n),1);if(0!==r&&0!==o){h.isWalkableAt(f,p+o)&&d.push([f,p+o]);h.isWalkableAt(f+r,p)&&d.push([f+r,p]);(h.isWalkableAt(f,p+o)||h.isWalkableAt(f+r,p))&&d.push([f+r,p+o]);!h.isWalkableAt(f-r,p)&&h.isWalkableAt(f,p+o)&&d.push([f-r,p+o]);!h.isWalkableAt(f,p-o)&&h.isWalkableAt(f+r,p)&&d.push([f+r,p-o])}else if(0===r){if(h.isWalkableAt(f,p+o)){d.push([f,p+o]);h.isWalkableAt(f+1,p)||d.push([f+1,p+o]);h.isWalkableAt(f-1,p)||d.push([f-1,p+o])}}else if(h.isWalkableAt(f+r,p)){d.push([f+r,p]);h.isWalkableAt(f,p+1)||d.push([f+r,p+1]);h.isWalkableAt(f,p-1)||d.push([f+r,p-1])}}else{a=h.getNeighbors(e,i.IfAtMostOneObstacle);for(c=0,l=a.length;l>c;++c){u=a[c];d.push([u.x,u.y])}}return d};t.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],20:[function(e,t){function n(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");n.prototype=new r;n.prototype.constructor=n;n.prototype._jump=function(e,t,n,r){var i=this.grid,o=e-n,a=t-r;if(!i.isWalkableAt(e,t))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0);if(i.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==o&&0!==a){if(this._jump(e+o,t,e,t)||this._jump(e,t+a,e,t))return[e,t]}else if(0!==o){if(i.isWalkableAt(e,t-1)&&!i.isWalkableAt(e-o,t-1)||i.isWalkableAt(e,t+1)&&!i.isWalkableAt(e-o,t+1))return[e,t]}else if(0!==a&&(i.isWalkableAt(e-1,t)&&!i.isWalkableAt(e-1,t-a)||i.isWalkableAt(e+1,t)&&!i.isWalkableAt(e+1,t-a)))return[e,t];return i.isWalkableAt(e+o,t)&&i.isWalkableAt(e,t+a)?this._jump(e+o,t+a,e,t):null};n.prototype._findNeighbors=function(e){var t,n,r,o,a,u,c,l,s=e.parent,f=e.x,p=e.y,h=this.grid,d=[];if(s){t=s.x;n=s.y;r=(f-t)/Math.max(Math.abs(f-t),1);o=(p-n)/Math.max(Math.abs(p-n),1);if(0!==r&&0!==o){h.isWalkableAt(f,p+o)&&d.push([f,p+o]);h.isWalkableAt(f+r,p)&&d.push([f+r,p]);h.isWalkableAt(f,p+o)&&h.isWalkableAt(f+r,p)&&d.push([f+r,p+o])}else{var g;if(0!==r){g=h.isWalkableAt(f+r,p);var v=h.isWalkableAt(f,p+1),y=h.isWalkableAt(f,p-1);if(g){d.push([f+r,p]);v&&d.push([f+r,p+1]);y&&d.push([f+r,p-1])}v&&d.push([f,p+1]);y&&d.push([f,p-1])}else if(0!==o){g=h.isWalkableAt(f,p+o);var _=h.isWalkableAt(f+1,p),m=h.isWalkableAt(f-1,p);if(g){d.push([f,p+o]);_&&d.push([f+1,p+o]);m&&d.push([f-1,p+o])}_&&d.push([f+1,p]);m&&d.push([f-1,p])}}}else{a=h.getNeighbors(e,i.OnlyWhenNoObstacles);for(c=0,l=a.length;l>c;++c){u=a[c];d.push([u.x,u.y])}}return d};t.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],21:[function(e,t){function n(e){r.call(this,e)}var r=e("./JumpPointFinderBase"),i=e("../core/DiagonalMovement");n.prototype=new r;n.prototype.constructor=n;n.prototype._jump=function(e,t,n,r){var i=this.grid,o=e-n,a=t-r;if(!i.isWalkableAt(e,t))return null;this.trackJumpRecursion===!0&&(i.getNodeAt(e,t).tested=!0);if(i.getNodeAt(e,t)===this.endNode)return[e,t];if(0!==o){if(i.isWalkableAt(e,t-1)&&!i.isWalkableAt(e-o,t-1)||i.isWalkableAt(e,t+1)&&!i.isWalkableAt(e-o,t+1))return[e,t]}else{if(0===a)throw new Error("Only horizontal and vertical movements are allowed");if(i.isWalkableAt(e-1,t)&&!i.isWalkableAt(e-1,t-a)||i.isWalkableAt(e+1,t)&&!i.isWalkableAt(e+1,t-a))return[e,t];if(this._jump(e+1,t,e,t)||this._jump(e-1,t,e,t))return[e,t]}return this._jump(e+o,t+a,e,t)};n.prototype._findNeighbors=function(e){var t,n,r,o,a,u,c,l,s=e.parent,f=e.x,p=e.y,h=this.grid,d=[];if(s){t=s.x;n=s.y;r=(f-t)/Math.max(Math.abs(f-t),1);o=(p-n)/Math.max(Math.abs(p-n),1);if(0!==r){h.isWalkableAt(f,p-1)&&d.push([f,p-1]);h.isWalkableAt(f,p+1)&&d.push([f,p+1]);h.isWalkableAt(f+r,p)&&d.push([f+r,p])}else if(0!==o){h.isWalkableAt(f-1,p)&&d.push([f-1,p]);h.isWalkableAt(f+1,p)&&d.push([f+1,p]);h.isWalkableAt(f,p+o)&&d.push([f,p+o])}}else{a=h.getNeighbors(e,i.Never);for(c=0,l=a.length;l>c;++c){u=a[c];d.push([u.x,u.y])}}return d};t.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],22:[function(e,t){function n(e){e=e||{};return e.diagonalMovement===r.Never?new i(e):e.diagonalMovement===r.Always?new o(e):e.diagonalMovement===r.OnlyWhenNoObstacles?new a(e):new u(e)}var r=e("../core/DiagonalMovement"),i=e("./JPFNeverMoveDiagonally"),o=e("./JPFAlwaysMoveDiagonally"),a=e("./JPFMoveDiagonallyIfNoObstacles"),u=e("./JPFMoveDiagonallyIfAtMostOneObstacle");t.exports=n},{"../core/DiagonalMovement":3,"./JPFAlwaysMoveDiagonally":18,"./JPFMoveDiagonallyIfAtMostOneObstacle":19,"./JPFMoveDiagonallyIfNoObstacles":20,"./JPFNeverMoveDiagonally":21}],23:[function(e,t){function n(e){e=e||{};this.heuristic=e.heuristic||o.manhattan;this.trackJumpRecursion=e.trackJumpRecursion||!1}{var r=e("heap"),i=e("../core/Util"),o=e("../core/Heuristic");e("../core/DiagonalMovement")}n.prototype.findPath=function(e,t,n,o,a){var u,c=this.openList=new r(function(e,t){return e.f-t.f}),l=this.startNode=a.getNodeAt(e,t),s=this.endNode=a.getNodeAt(n,o);this.grid=a;l.g=0;l.f=0;c.push(l);l.opened=!0;for(;!c.empty();){u=c.pop();u.closed=!0;if(u===s)return i.expandPath(i.backtrace(s));this._identifySuccessors(u)}return[]};n.prototype._identifySuccessors=function(e){{var t,n,r,i,a,u,c,l,s,f,p=this.grid,h=this.heuristic,d=this.openList,g=this.endNode.x,v=this.endNode.y,y=e.x,_=e.y,m=Math.abs;Math.max}t=this._findNeighbors(e);for(i=0,a=t.length;a>i;++i){n=t[i];r=this._jump(n[0],n[1],y,_);if(r){u=r[0];c=r[1];f=p.getNodeAt(u,c);if(f.closed)continue;l=o.octile(m(u-y),m(c-_));s=e.g+l;if(!f.opened||s<f.g){f.g=s;f.h=f.h||h(m(u-g),m(c-v));f.f=f.g+f.h;f.parent=e;if(f.opened)d.updateItem(f);else{d.push(f);f.opened=!0}}}}};t.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}]},{},[8])(8)});define("spriteSheet",[""],function(){var e=function(e,t){var n=[],r=e,i=t,o=function(){_.forEach(r.frames,function(e){var t=e,n=.5*-t.frame.w,r=.5*-t.frame.h;if(t.trimmed){n=t.spriteSourceSize.x-.5*t.sourceSize.w;r=t.spriteSourceSize.y-.5*t.sourceSize.h}a(t.filename,t.frame.x,t.frame.y,t.frame.w,t.frame.h,n,r)})},a=function(e,t,r,i,o,a,u){var c={id:e,x:t,y:r,w:i,h:o,cx:null===a?0:a,cy:null===u?0:u};n.push(c)};o();return{img:i,sprites:n}};return e});define("text!assetsList",[],function(){return'{\n  "0" : {\n    "name": "mapTiles",\n    "type": "atlas",\n    "configuration": "./art/panama.json",\n    "file": "./art/panama.png"\n  }\n}'});!function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("q",e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else{if("undefined"==typeof self)throw new Error("This environment was not anticiapted by Q. Please file a bug.");self.Q=e()}}(function(){function e(e){return function(){return z.apply(e,arguments)}}function t(e){return e===Object(e)}function n(e){return"[object StopIteration]"===tt(e)||e instanceof $}function r(e,t){if(B&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(nt)){for(var n=[],r=t;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(e.stack);var o=n.join("\n"+nt+"\n");e.stack=i(o)}}function i(e){for(var t=e.split("\n"),n=[],r=0;r<t.length;++r){var i=t[r];u(i)||o(i)||!i||n.push(i)}return n.join("\n")}function o(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function a(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function u(e){var t=a(e);if(!t)return!1;var n=t[0],r=t[1];return n===G&&r>=J&&at>=r}function c(){if(B)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=t[0].indexOf("@")>0?t[1]:t[2],r=a(n);if(!r)return;G=r[0];return r[1]}}function l(e,t,n){return function(){"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack);return e.apply(e,arguments)}}function s(e){return e instanceof d?e:_(e)?M(e):W(e)}function f(){function e(e){t=e;o.source=e;Q(n,function(t,n){s.nextTick(function(){e.promiseDispatch.apply(e,n)})},void 0);n=void 0;r=void 0}var t,n=[],r=[],i=K(f.prototype),o=K(d.prototype);o.promiseDispatch=function(e,i,o){var a=Y(arguments);if(n){n.push(a);"when"===i&&o[1]&&r.push(o[1])}else s.nextTick(function(){t.promiseDispatch.apply(t,a)})};o.valueOf=function(){if(n)return o;var e=v(t);y(e)&&(t=e);return e};o.inspect=function(){return t?t.inspect():{state:"pending"}};if(s.longStackSupport&&B)try{throw new Error}catch(a){o.stack=a.stack.substring(a.stack.indexOf("\n")+1)}i.promise=o;i.resolve=function(n){t||e(s(n))};i.fulfill=function(n){t||e(W(n))};i.reject=function(n){t||e(P(n))};i.notify=function(e){t||Q(r,function(t,n){s.nextTick(function(){n(e)})},void 0)};return i}function p(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=f();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function h(e){return p(function(t,n){for(var r=0,i=e.length;i>r;r++)s(e[r]).then(t,n)})}function d(e,t,n){void 0===t&&(t=function(e){return P(new Error("Promise does not support operation: "+e))});void 0===n&&(n=function(){return{state:"unknown"}});var r=K(d.prototype);r.promiseDispatch=function(n,i,o){var a;try{a=e[i]?e[i].apply(r,o):t.call(r,i,o)}catch(u){a=P(u)}n&&n(a)};r.inspect=n;if(n){var i=n();"rejected"===i.state&&(r.exception=i.reason);r.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?r:e.value}}return r}function g(e,t,n,r){return s(e).then(t,n,r)}function v(e){if(y(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function y(e){return e instanceof d}function _(e){return t(e)&&"function"==typeof e.then}function m(e){return y(e)&&"pending"===e.inspect().state}function b(e){return!y(e)||"fulfilled"===e.inspect().state}function x(e){return y(e)&&"rejected"===e.inspect().state}function w(){rt.length=0;it.length=0;ot||(ot=!0)}function k(e,t){if(ot){it.push(e);rt.push(t&&"undefined"!=typeof t.stack?t.stack:"(no stack) "+t)}}function A(e){if(ot){var t=V(it,e);if(-1!==t){it.splice(t,1);rt.splice(t,1)}}}function P(e){var t=d({when:function(t){t&&A(this);return t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});k(t,e);return t}function W(e){return d({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return et(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function M(e){var t=f();s.nextTick(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}});return t.promise}function j(e){return d({isDef:function(){}},function(t,n){return D(e,t,n)},function(){return s(e).inspect()})}function N(e,t,n){return s(e).spread(t,n)}function L(e){return function(){function t(e,t){var a;if("undefined"==typeof StopIteration){try{a=r[e](t)}catch(u){return P(u)}return a.done?s(a.value):g(a.value,i,o)}try{a=r[e](t)}catch(u){return n(u)?s(u.value):P(u)}return g(a,i,o)}var r=e.apply(this,arguments),i=t.bind(t,"next"),o=t.bind(t,"throw");return i()}}function R(e){s.done(s.async(e)())}function O(e){throw new $(e)}function F(e){return function(){return N([this,I(arguments)],function(t,n){return e.apply(t,n)})}}function D(e,t,n){return s(e).dispatch(t,n)}function I(e){return g(e,function(e){var t=0,n=f();Q(e,function(r,i,o){var a;if(y(i)&&"fulfilled"===(a=i.inspect()).state)e[o]=a.value;else{++t;g(i,function(r){e[o]=r;0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:o,value:e})})}},void 0);0===t&&n.resolve(e);return n.promise})}function C(e){return g(e,function(e){e=X(e,s);return g(I(X(e,function(e){return g(e,q,q)})),function(){return e})})}function S(e){return s(e).allSettled()}function T(e,t){return s(e).then(void 0,void 0,t)}function E(e,t){return s(e).nodeify(t)}var B=!1;try{throw new Error}catch(U){B=!!U.stack}var G,$,J=c(),q=function(){},H=function(){function e(){for(;t.next;){t=t.next;var n=t.task;t.task=void 0;var i=t.domain;if(i){t.domain=void 0;i.enter()}try{n()}catch(a){if(o){i&&i.exit();setTimeout(e,0);i&&i.enter();throw a}setTimeout(function(){throw a},0)}i&&i.exit()}r=!1}var t={task:void 0,next:null},n=t,r=!1,i=void 0,o=!1;H=function(e){n=n.next={task:e,domain:o&&process.domain,next:null};if(!r){r=!0;i()}};if("undefined"!=typeof process&&process.nextTick){o=!0;i=function(){process.nextTick(e)}}else if("function"==typeof setImmediate)i="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var a=new MessageChannel;a.port1.onmessage=function(){i=u;a.port1.onmessage=e;e()};var u=function(){a.port2.postMessage(0)};i=function(){setTimeout(e,0);u()}}else i=function(){setTimeout(e,0)};return H}(),z=Function.call,Y=e(Array.prototype.slice),Q=e(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)n in this&&(t=e(t,this[n],n));return t}),V=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),X=e(Array.prototype.map||function(e,t){var n=this,r=[];Q(n,function(i,o,a){r.push(e.call(t,o,a,n))},void 0);return r}),K=Object.create||function(e){function t(){}t.prototype=e;return new t},Z=e(Object.prototype.hasOwnProperty),et=Object.keys||function(e){var t=[];for(var n in e)Z(e,n)&&t.push(n);return t},tt=e(Object.prototype.toString);$="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var nt="From previous event:";s.resolve=s;s.nextTick=H;s.longStackSupport=!1;"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(s.longStackSupport=!0);s.defer=f;f.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):e.resolve(arguments.length>2?Y(arguments,1):n)}};s.Promise=p;s.promise=p;p.race=h;p.all=I;p.reject=P;p.resolve=s;s.passByCopy=function(e){return e};d.prototype.passByCopy=function(){return this};s.join=function(e,t){return s(e).join(t)};d.prototype.join=function(e){return s([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})};s.race=h;d.prototype.race=function(){return this.then(s.race)};s.makePromise=d;d.prototype.toString=function(){return"[object Promise]"};d.prototype.then=function(e,t,n){function i(t){try{return"function"==typeof e?e(t):t}catch(n){return P(n)}}function o(e){if("function"==typeof t){r(e,u);try{return t(e)}catch(n){return P(n)}}return P(e)}function a(e){return"function"==typeof n?n(e):e}var u=this,c=f(),l=!1;s.nextTick(function(){u.promiseDispatch(function(e){if(!l){l=!0;c.resolve(i(e))}},"when",[function(e){if(!l){l=!0;c.resolve(o(e))}}])});u.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=a(e)}catch(r){n=!0;if(!s.onerror)throw r;s.onerror(r)}n||c.notify(t)}]);return c.promise};s.tap=function(e,t){return s(e).tap(t)};d.prototype.tap=function(e){e=s(e);return this.then(function(t){return e.fcall(t).thenResolve(t)})};s.when=g;d.prototype.thenResolve=function(e){return this.then(function(){return e})};s.thenResolve=function(e,t){return s(e).thenResolve(t)};d.prototype.thenReject=function(e){return this.then(function(){throw e})};s.thenReject=function(e,t){return s(e).thenReject(t)};s.nearer=v;s.isPromise=y;s.isPromiseAlike=_;s.isPending=m;d.prototype.isPending=function(){return"pending"===this.inspect().state};s.isFulfilled=b;d.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state};s.isRejected=x;d.prototype.isRejected=function(){return"rejected"===this.inspect().state};var rt=[],it=[],ot=!0;s.resetUnhandledRejections=w;s.getUnhandledReasons=function(){return rt.slice()};s.stopUnhandledRejectionTracking=function(){w();ot=!1};w();s.reject=P;s.fulfill=W;s.master=j;s.spread=N;d.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)};s.async=L;s.spawn=R;s["return"]=O;s.promised=F;s.dispatch=D;d.prototype.dispatch=function(e,t){var n=this,r=f();s.nextTick(function(){n.promiseDispatch(r.resolve,e,t)});return r.promise};s.get=function(e,t){return s(e).dispatch("get",[t])};d.prototype.get=function(e){return this.dispatch("get",[e])};s.set=function(e,t,n){return s(e).dispatch("set",[t,n])};d.prototype.set=function(e,t){return this.dispatch("set",[e,t])};s.del=s["delete"]=function(e,t){return s(e).dispatch("delete",[t])};d.prototype.del=d.prototype["delete"]=function(e){return this.dispatch("delete",[e])};s.mapply=s.post=function(e,t,n){return s(e).dispatch("post",[t,n])};d.prototype.mapply=d.prototype.post=function(e,t){return this.dispatch("post",[e,t])};s.send=s.mcall=s.invoke=function(e,t){return s(e).dispatch("post",[t,Y(arguments,2)])};d.prototype.send=d.prototype.mcall=d.prototype.invoke=function(e){return this.dispatch("post",[e,Y(arguments,1)])};s.fapply=function(e,t){return s(e).dispatch("apply",[void 0,t])};d.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])};s["try"]=s.fcall=function(e){return s(e).dispatch("apply",[void 0,Y(arguments,1)])};d.prototype.fcall=function(){return this.dispatch("apply",[void 0,Y(arguments)])};s.fbind=function(e){var t=s(e),n=Y(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(Y(arguments))])}};d.prototype.fbind=function(){var e=this,t=Y(arguments);return function(){return e.dispatch("apply",[this,t.concat(Y(arguments))])}};s.keys=function(e){return s(e).dispatch("keys",[])};d.prototype.keys=function(){return this.dispatch("keys",[])};s.all=I;d.prototype.all=function(){return I(this)};s.allResolved=l(C,"allResolved","allSettled");d.prototype.allResolved=function(){return C(this)};s.allSettled=S;d.prototype.allSettled=function(){return this.then(function(e){return I(X(e,function(e){function t(){return e.inspect()}e=s(e);return e.then(t,t)}))})};s.fail=s["catch"]=function(e,t){return s(e).then(void 0,t)};d.prototype.fail=d.prototype["catch"]=function(e){return this.then(void 0,e)};s.progress=T;d.prototype.progress=function(e){return this.then(void 0,void 0,e)};s.fin=s["finally"]=function(e,t){return s(e)["finally"](t)};d.prototype.fin=d.prototype["finally"]=function(e){e=s(e);return this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})};s.done=function(e,t,n,r){return s(e).done(t,n,r)};d.prototype.done=function(e,t,n){var i=function(e){s.nextTick(function(){r(e,o);if(!s.onerror)throw e;s.onerror(e)})},o=e||t||n?this.then(e,t,n):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i));o.then(void 0,i)};s.timeout=function(e,t,n){return s(e).timeout(t,n)};d.prototype.timeout=function(e,t){var n=f(),r=setTimeout(function(){if(!t||"string"==typeof t){t=new Error(t||"Timed out after "+e+" ms");t.code="ETIMEDOUT"}n.reject(t)},e);this.then(function(e){clearTimeout(r);n.resolve(e)},function(e){clearTimeout(r);n.reject(e)},n.notify);return n.promise};s.delay=function(e,t){if(void 0===t){t=e;e=void 0}return s(e).delay(t)};d.prototype.delay=function(e){return this.then(function(t){var n=f();setTimeout(function(){n.resolve(t)},e);return n.promise})};s.nfapply=function(e,t){return s(e).nfapply(t)};d.prototype.nfapply=function(e){var t=f(),n=Y(e);n.push(t.makeNodeResolver());this.fapply(n).fail(t.reject);return t.promise};s.nfcall=function(e){var t=Y(arguments,1);return s(e).nfapply(t)};d.prototype.nfcall=function(){var e=Y(arguments),t=f();e.push(t.makeNodeResolver());this.fapply(e).fail(t.reject);return t.promise};s.nfbind=s.denodeify=function(e){var t=Y(arguments,1);return function(){var n=t.concat(Y(arguments)),r=f();n.push(r.makeNodeResolver());s(e).fapply(n).fail(r.reject);return r.promise}};d.prototype.nfbind=d.prototype.denodeify=function(){var e=Y(arguments);e.unshift(this);return s.denodeify.apply(void 0,e)};s.nbind=function(e,t){var n=Y(arguments,2);return function(){function r(){return e.apply(t,arguments)}var i=n.concat(Y(arguments)),o=f();i.push(o.makeNodeResolver());s(r).fapply(i).fail(o.reject);return o.promise}};d.prototype.nbind=function(){var e=Y(arguments,0);e.unshift(this);return s.nbind.apply(void 0,e)};s.nmapply=s.npost=function(e,t,n){return s(e).npost(t,n)};d.prototype.nmapply=d.prototype.npost=function(e,t){var n=Y(t||[]),r=f();n.push(r.makeNodeResolver());this.dispatch("post",[e,n]).fail(r.reject);return r.promise};s.nsend=s.nmcall=s.ninvoke=function(e,t){var n=Y(arguments,2),r=f();n.push(r.makeNodeResolver());s(e).dispatch("post",[t,n]).fail(r.reject);return r.promise};d.prototype.nsend=d.prototype.nmcall=d.prototype.ninvoke=function(e){var t=Y(arguments,1),n=f();t.push(n.makeNodeResolver());this.dispatch("post",[e,t]).fail(n.reject);return n.promise};s.nodeify=E;d.prototype.nodeify=function(e){if(!e)return this;this.then(function(t){s.nextTick(function(){e(null,t)})},function(t){s.nextTick(function(){e(t)})});return void 0};var at=c();return s});define("assetLoader",["spriteSheet","text!assetsList","q","eventmanager"],function(e,t,n,r){var i={config:{},loaded:{atlas:[],music:[]}};i.config=JSON.parse(t);var o=function(){_.forEach(i.config,function(t){switch(t.type){case"atlas":jQuery.getJSON(t.configuration,function(e){t.configuration=e}).then(function(){var n=new Image;n.src=t.file;n.onload=function(){i.loaded.atlas.push({name:t.name,sprite:new e(t.configuration,n)});r.publish("game.init")}});break;case"music":}})};return{preloadassets:o,assets:i}});define("center",["eventmanager"],function(e){function t(){var t={x:0,y:0};1===i.up&&(t.y=t.y-1);1===i.down&&(t.y=t.y+1);1===i.left&&(t.x=t.x-1);1===i.right&&(t.x=t.x+1);if(0!==t.x||0!==t.y){t={x:r.x+t.x,y:r.y+t.y};r.x=t.x;r.y=t.y;e.publish("center.update.start")}else e.publish("center.update.stop")}function n(e,t){var n={};n.x=(e-t)/2;n.y=(e+t)/2;return n}var r=n(0,0),i={up:0,down:0,left:0,right:0};e.subscribe("new.frame",function(){t()});e.subscribe("pan.up",function(e){i.up=e});e.subscribe("pan.down",function(e){i.down=e});e.subscribe("pan.left",function(e){i.left=e});e.subscribe("pan.right",function(e){i.right=e});return r});define("collisionGrid",["eventmanager","world","pathfinding","eventmanager","assetLoader","standardlib","center"],function(e,t,n){function r(e){for(var t=[],n=2,r=0;r<e.length;r++)for(var i=0;n>i;i++){var o=r*n+i;t[o]=[];for(var a=0;a<e[0].length;a++)for(var u=0;n>u;u++){var c=a*n+u;t[o][c]=e[r][a]}}return t}var i={};i.updateQueue=[];i.debugGrid={};i.init=function(){i.grid={};i.grid.dynamic=r(_.cloneDeep(t.grid));i.grid["static"]=_.cloneDeep(i.grid.dynamic);i.updateStatic({tooArray:[],fromArray:[]})};i.update=function(e){var t=i.generateUpdateArray({grid:e.too,height:e.height,width:e.width}),n=i.generateUpdateArray({grid:e.from,height:e.height,width:e.width}),r=i.intersect(t,n),o=!0;_.each(r,function(e){0!==i.grid.dynamic[e.x][e.y]&&(o=!1)});if(o){_.each(n,function(e){i.grid.dynamic[e.x][e.y]=0});_.each(t,function(e){i.grid.dynamic[e.x][e.y]=1});"undefined"!=typeof e.success&&e.success();e["static"]&&i.updateStatic({tooArray:t,fromArray:n})}else"undefined"!=typeof e.failure&&e.failure(t)};i.generateUpdateArray=function(e){var t=[];if("undefined"!=typeof e.grid)for(var n=0;n<e.height;n++)for(var r=0;r<e.width;r++)t.push({x:e.grid.x+r,y:e.grid.y+n});return t};i.intersect=function(e,t){var n=[];_.each(e,function(e){_.findWhere(t,e)||n.push(e)});return n};i.isOpen=function(e){return 0===i.grid.dynamic[e["new"].y][e["new"].x]};i.getSubGrid=function(e){for(var t=[],r=0;r<=e.size;r++){t[r]=[];for(var o=0;o<=e.size;o++)t[r][o]=i.grid.dynamic[e.start.x+r][e.start.y+o]}return new n.Grid(e.size+1,e.size+1,t)};i.updateStatic=function(e){_.each(e.fromArray,function(e){i.grid["static"][e.x][e.y]=0});_.each(e.tooArray,function(e){i.grid["static"][e.x][e.y]=1});i.grid.graph=new n.Grid(i.grid["static"].length,i.grid["static"][0].length,i.grid["static"])};i.init();return i});define("actor",["eventmanager","standardlib","collisionGrid"],function(e,t,n){return function(r){var i={};i.variables={coordinates:{current:r.coordinates,previous:_.cloneDeep(r.coordinates),next:_.cloneDeep(r.coordinates)},collision:{width:1,height:1},tile:{width:app.config.terrain.tile.width,height:app.config.terrain.tile.height},uuid:t.guid(),direction:"down",hp:0,rendered:!1,canvas:{}};i.init=function(){var o={too:t.worldPosToGridPos(r.coordinates),height:i.variables.collision.height,width:i.variables.collision.width,success:function(){_.each(i.handlers,function(t,n){_.each(t,function(t,r){e[n](r,i[t])})});e.publish("actor.create",i.getInfo())},failure:function(){}};n.update(o)};i.handlers={subscribe:{"actor.selected":"actorSelect"}};i.actorSelect=function(e){i.variables.selected=i.variables.uuid==e?!0:!1};i.getInfo=function(){return i};i.destroy=function(){e.publish("actor.delete",variables.uuid)};return i}});define("actorMovement",["collisionGrid","standardlib","pathfinding"],function(e,t,n){var r={};r.finder=new n.AStarFinder({allowDiagonal:!0,dontCrossCorners:!0});r.generatePath=function(i){var o=e.grid.graph.clone(),a=t.worldPosToGridPos(i.from),u=t.worldPosToGridPos(i.too),c=r.finder.findPath(a.y,a.x,u.y,u.x,o),l=n.Util.smoothenPath(o,c);
return l};r.move=function(e){var n=e.coordinates.current;e.localGoal=t.gridPosToWorldPos({x:e.path[0][1],y:e.path[0][0]});if(e.stuck){r.generateLocalPath(e);e.coordinates.next=_.cloneDeep(r.updateNext(e))}else e.coordinates.next=_.cloneDeep(r.updateNext(e));n.x==e.localGoal.x&&n.y==e.localGoal.y&&e.path.shift()};r.generateLocalPath=function(n){var i=n.path.length>5?5:n.path.length-1;if(i>1){var o=t.worldPosToGridPos(n.coordinates.current),a={},u={};a.x=o.x<=n.path[0][1]?o.x:n.path[0][1];u.x=o.x>n.path[0][1]?o.x:n.path[0][1];a.y=o.y<=n.path[0][0]?o.y:n.path[0][0];u.y=o.y>n.path[0][0]?o.y:n.path[0][0];var c=u.x-a.x<u.y-a.y?u.y-a.y:u.x-a.x,l={x:a.x<c?a.x:c,y:a.y<c?a.y:c},s=e.getSubGrid({start:{x:a.x-l.x,y:a.y-l.y},size:c+(l.x<l.y?l.x:l.y)}),f=r.finder.findPath(a.y-a.y,a.x-a.x,u.y-a.y,u.x-a.x,s);_.each(f,function(e){e[0]=e[0]+a.y;e[1]=e[1]+a.x});if(f.length>0){n.path.splice(0,i);n.path=f.concat(n.path)}}};r.updateNext=function(e){var t=e.coordinates.current,n=_.cloneDeep(t);if(t.x>e.localGoal.x){var r=e.localGoal.x-t.x;n.x=r<=e.speed?e.localGoal.x:t.x-e.speed}else if(t.x<e.localGoal.x){var r=t.x-e.localGoal.x;n.x=r<=e.speed?e.localGoal.x:t.x+e.speed}if(t.y>e.localGoal.y){var r=e.localGoal.y-t.y;n.y=r<=e.speed?e.localGoal.y:t.y-e.speed/2}else if(t.y<e.localGoal.y){var r=t.y-e.localGoal.y;n.y=r<=e.speed?e.localGoal.y:t.y+e.speed/2}return n};return r});define("actor.unit",["actor","eventmanager","collisionGrid","standardlib","actorMovement"],function(e,t,n,r,i){return function(t){var n=e(t),r={path:[],focus:"",height:2,width:2,strenght:0,dexterity:0,intelligence:0,health:0,death:!1,hp:0,speed:5,attack:10,stuck:!1},o={"new.gamecycle":"move"};_.extend(n.variables,r);_.extend(n.handlers.subscribe,o);n.move=function(){n.variables.path.length>0&&i.move({path:n.variables.path,coordinates:n.variables.coordinates,speed:n.variables.speed,height:n.variables.collision.height,width:n.variables.collision.width})};n.generatePath=function(e){n.variables.path=i.generatePath({from:n.variables.coordinates.current,too:e,stuck:n.variables.stuck})};return n}});define("actor.unit.local",["actor.unit"],function(e){return function(t){var n=e(t),r={focus:"",state:"base"};_.extend(n.variables,r);var i={"map.click":"checkMapClick"};_.extend(n.handlers.subscribe,i);n.checkMapClick=function(e){n.variables.selected&&n.generatePath(e)};return n}});define("plane",["actor.unit.local","eventmanager"],function(e){return function(t){var n=e(t),r={focus:"",state:"base",direction:0,collision:{width:2,height:2},sprite:{center:{x:24,y:20},height:80,width:55,base:{0:["plane/base/Plane_Large_face0_0.png","plane/base/Plane_Large_face0_1.png","plane/base/Plane_Large_face0_2.png","plane/base/Plane_Large_face0_3.png"],1:["plane/base/Plane_Large_face1_0.png","plane/base/Plane_Large_face1_1.png","plane/base/Plane_Large_face1_2.png","plane/base/Plane_Large_face1_3.png"],2:["plane/base/Plane_Large_face2_0.png","plane/base/Plane_Large_face2_1.png","plane/base/Plane_Large_face2_2.png","plane/base/Plane_Large_face2_3.png"],3:["plane/base/Plane_Large_face3_0.png","plane/base/Plane_Large_face3_1.png","plane/base/Plane_Large_face3_2.png","plane/base/Plane_Large_face3_3.png"]},explode:{0:["plane/explode/color0_Plane_Large_face0_fiery_explode_0.png","plane/explode/color0_Plane_Large_face0_fiery_explode_1.png","plane/explode/color0_Plane_Large_face0_fiery_explode_2.png","plane/explode/color0_Plane_Large_face0_fiery_explode_3.png","plane/explode/color0_Plane_Large_face0_fiery_explode_4.png","plane/explode/color0_Plane_Large_face0_fiery_explode_5.png","plane/explode/color0_Plane_Large_face0_fiery_explode_6.png","plane/explode/color0_Plane_Large_face0_fiery_explode_7.png","plane/explode/color0_Plane_Large_face0_fiery_explode_8.png","plane/explode/color0_Plane_Large_face0_fiery_explode_9.png","plane/explode/color0_Plane_Large_face0_fiery_explode_10.png","plane/explode/color0_Plane_Large_face0_fiery_explode_11.png"],1:["plane/explode/color0_Plane_Large_face1_fiery_explode_0.png","plane/explode/color0_Plane_Large_face1_fiery_explode_1.png","plane/explode/color0_Plane_Large_face1_fiery_explode_2.png","plane/explode/color0_Plane_Large_face1_fiery_explode_3.png","plane/explode/color0_Plane_Large_face1_fiery_explode_4.png","plane/explode/color0_Plane_Large_face1_fiery_explode_5.png","plane/explode/color0_Plane_Large_face1_fiery_explode_6.png","plane/explode/color0_Plane_Large_face1_fiery_explode_7.png","plane/explode/color0_Plane_Large_face1_fiery_explode_8.png","plane/explode/color0_Plane_Large_face1_fiery_explode_9.png","plane/explode/color0_Plane_Large_face1_fiery_explode_10.png","plane/explode/color0_Plane_Large_face1_fiery_explode_11.png"],2:["plane/explode/color0_Plane_Large_face2_fiery_explode_0.png","plane/explode/color0_Plane_Large_face2_fiery_explode_1.png","plane/explode/color0_Plane_Large_face2_fiery_explode_2.png","plane/explode/color0_Plane_Large_face2_fiery_explode_3.png","plane/explode/color0_Plane_Large_face2_fiery_explode_4.png","plane/explode/color0_Plane_Large_face2_fiery_explode_5.png","plane/explode/color0_Plane_Large_face2_fiery_explode_6.png","plane/explode/color0_Plane_Large_face2_fiery_explode_7.png","plane/explode/color0_Plane_Large_face2_fiery_explode_8.png","plane/explode/color0_Plane_Large_face2_fiery_explode_9.png","plane/explode/color0_Plane_Large_face2_fiery_explode_10.png","plane/explode/color0_Plane_Large_face2_fiery_explode_11.png"],3:["plane/explode/color0_Plane_Large_face3_fiery_explode_0.png","plane/explode/color0_Plane_Large_face3_fiery_explode_1.png","plane/explode/color0_Plane_Large_face3_fiery_explode_2.png","plane/explode/color0_Plane_Large_face3_fiery_explode_3.png","plane/explode/color0_Plane_Large_face3_fiery_explode_4.png","plane/explode/color0_Plane_Large_face3_fiery_explode_5.png","plane/explode/color0_Plane_Large_face3_fiery_explode_6.png","plane/explode/color0_Plane_Large_face3_fiery_explode_7.png","plane/explode/color0_Plane_Large_face3_fiery_explode_8.png","plane/explode/color0_Plane_Large_face3_fiery_explode_9.png","plane/explode/color0_Plane_Large_face3_fiery_explode_10.png","plane/explode/color0_Plane_Large_face3_fiery_explode_11.png"]}},health:75,death:!1,hp:100,speed:25};_.extend(n.variables,r);return n}});define("commandQueue",[""],function(){function e(e){r.push(e)}function t(){r=[]}function n(){return r}var r=[];return{add:e,get:n,clear:t}});define("command",["commandQueue","eventmanager"],function(e,t){function n(t){e.add(t)}function r(){var n=e.get();_.forEach(n,function(e){t.publish(e.event,e.parameters)});e.clear()}t.subscribe("command",function(e){n(e)});t.subscribe("new.gamecycle",function(){r()})});define("gamecycle",["eventmanager","command"],function(e){function t(){n()}function n(){setTimeout(n,app.config.cycle);e.publish("new.gamecycle")}e.subscribe("game.init",function(){t()})});define("RequestAnimationFrame",[""],function(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/16.5)}}()});define("map",["eventmanager","world","standardlib","center","assetLoader"],function(e,t,n,r,i){function o(){p.canvas=app.config.shadowRoot.getElementById("mapCanvas");p.context=p.canvas.getContext("2d");p.canvas.width=app.config.terrain.grid.width*app.config.terrain.tile.width;p.canvas.height=app.config.terrain.grid.height*app.config.terrain.tile.height;p.canvas.addEventListener("contextmenu",function(t){var n=p.canvas.relmouseCoordinates(t);e.publish("map.click",n)});p.canvas.addEventListener("mousedown",function(e){if(1==e.which){$(app.config.shadowRoot).find("#ghost-select").addClass("ghost-active");$(app.config.shadowRoot).find("#ghost-select").css({left:e.pageX,top:e.pageY});initialW=e.pageX;initialH=e.pageY;$(document).bind("mouseup",a);$(document).bind("mousemove",u)}});c();s()}function a(){$(document).unbind("mousemove",u);$(document).unbind("mouseup",a);var t=app.config.shadowRoot.getElementById("ghost-select");e.publish("map.selection",{width:t.offsetWidth,height:t.offsetHeight,left:t.offsetLeft,top:t.offsetTop});$(app.config.shadowRoot).find("#ghost-select").css({left:0,top:0,width:0,height:0}).removeClass("ghost-active")}function u(e){var t=Math.abs(initialW-e.pageX),n=Math.abs(initialH-e.pageY);$(app.config.shadowRoot).find("#ghost-select").css({width:t,height:n});e.pageX<=initialW&&e.pageY>=initialH?$(app.config.shadowRoot).find("#ghost-select").css({left:e.pageX}):e.pageY<=initialH&&e.pageX>=initialW?$(app.config.shadowRoot).find("#ghost-select").css({top:e.pageY}):e.pageY<initialH&&e.pageX<initialW&&$(app.config.shadowRoot).find("#ghost-select").css({left:e.pageX,top:e.pageY})}function c(){p.context.clearRect(0,0,p.canvas.width,p.canvas.height);for(var e={x:0,y:0},n=0;n<t.grid.length;n++)for(var r=0;r<t.grid[0].length;r++)l(1===t.grid[e.y+r][e.x+n]?{sprite:"trees_2.png",x:e.x+r,y:e.y+n,correction:15}:{sprite:"landscapeTiles_066.png",x:e.x+r,y:e.y+n,correction:15})}function l(e){var t,r,o;_.findIndex(i.assets.loaded.atlas,function(n){t=_.findWhere(n.sprite.sprites,{id:e.sprite});o=n.sprite.img;!_.isEmpty(n)});if(!_.isEmpty(t)){r=n.twoDToIso(e.x,e.y);r.x=r.x*app.config.terrain.tile.width+p.canvas.width/2-app.config.terrain.tile.width/2;r.y=r.y*app.config.terrain.tile.height+(t.w/2-(t.h-e.correction));p.context.drawImage(o,t.x,t.y,t.w,t.h,r.x,r.y,t.w,t.h)}}function s(){var e=window.innerWidth/2,t=window.innerHeight/2,n={};n.x=-(r.x*app.config.actor.tile.width+p.canvas.width/2-e);n.y=-((r.y+app.config.terrain.tile.height/app.config.actor.tile.height)*app.config.actor.tile.height)+t;$(app.config.shadowRoot).find(p.canvas).css("margin-left",n.x).css("margin-top",n.y)}function f(){s(r)}var p={};e.subscribe("new.frame",function(){f()});e.subscribe("game.init",function(){o()})});define("actorList",["eventmanager"],function(e){var t=[],n=[];e.subscribe("actor.create",function(e){t.push(e)});e.subscribe("actor.update",function(e){var n=_.findWhere(t,{uuid:e.variables.uuid});_.merge(n,e)});e.subscribe("actor.delete",function(e){var r=_.findWhere(t,{uuid:e});n.push(r.variables.uuid);t=_.without(t,r)});var r=function(){return t},i=function(){return n},o=function(){n=[]};return{getCleanUpList:i,clearCleanUpList:o,getActorList:r}});define("actors",["eventmanager","standardlib","actorList","center","assetLoader","collisionGrid"],function(e,t,n,r,i,o){function a(){_.each(n.getCleanUpList(),function(e){$(app.config.shadowRoot).find("canvas."+e.uuid).remove()});n.clearCleanUpList();_.each(n.getActorList(),function(t){if(s(t.variables.coordinates.current)){if(!t.variables.rendered){app.config.shadowRoot.getElementById("ActorsWrapper").insertAdjacentHTML("beforeend",'<canvas id="'+t.variables.uuid+'"></canvas>');t.variables.canvas=app.config.shadowRoot.getElementById(t.variables.uuid);t.variables.canvas.context=t.variables.canvas.getContext("2d");t.variables.canvas.addEventListener("click",function(){e.publish("actor.selected",t.variables.uuid)});t.variables.rendered=!0}u(t);c(t);l(t)}else{if(t.variables.rendered){$(app.config.shadowRoot).find("canvas#"+t.variables.uuid).remove();t.variables.rendered=!1;t.variables.canvas=""}c(t)}})}function u(e){var t=e.variables.coordinates.next,n=e.variables.coordinates.current,r={x:n.x-t.x,y:n.y-t.y};r.x<0?e.variables.direction=0:r.x>0?e.variables.direction=2:r.y<0?e.variables.direction=1:r.y>0&&(e.variables.direction=3)}function c(e){var n=window.innerWidth,i=window.innerHeight,a=e.variables.coordinates.current,u=e.variables.coordinates.next;e.variables.coordinates.previous=_.cloneDeep(a);var c=e.variables.speed/(app.config.framerate/(1e3/app.config.cycle)),l={};if(a.x>u.x){var s=a.x-u.x;l.x=c>=s?u.x:a.x-c}else if(a.x<u.x){var s=u.x-a.x;l.x=c>=s?u.x:a.x+c}else l.x=a.x;if(a.y>u.y){var s=a.y-u.y;l.y=c>=s?u.y:a.y-c/2}else if(a.y<u.y){var s=u.y-a.y;l.y=c>=s?u.y:a.y+c/2}else l.y=a.y;var f={from:t.worldPosToGridPos(a),too:t.worldPosToGridPos(l),height:e.variables.collision.height,width:e.variables.collision.width,"static":!1,success:function(){e.variables.coordinates.current=_.cloneDeep(l);var t=a.y-r.y*app.config.actor.tile.height,o=i/2-t,u=a.x-app.config.actor.tile.width*app.config.actor.grid.width/2-e.variables.sprite.width/2-(r.x*app.config.actor.tile.width-n/2);$(app.config.shadowRoot).find(e.variables.canvas).css("z-index",Math.floor(e.variables.coordinates.current.y/app.config.actor.tile.height)).css("bottom",o).css("left",u);e.variables.stuck=!1},failure:function(){var t=a.y-r.y*app.config.actor.tile.height,o=i/2-t,u=a.x-app.config.actor.tile.width*app.config.actor.grid.width/2-e.variables.sprite.width/2-(r.x*app.config.actor.tile.width-n/2);$(app.config.shadowRoot).find(e.variables.canvas).css("z-index",Math.floor(e.variables.coordinates.current.y/app.config.actor.tile.height)).css("bottom",o).css("left",u);e.variables.stuck=!0}};o.update(f)}function l(e){e.variables.canvas.context.clearRect(0,0,e.variables.canvas.width,e.variables.canvas.height);"undefined"==typeof e.variables.sprite[e.variables.state][e.variables.direction][e.variables.spriteIndex]&&(e.variables.spriteIndex=0);f(e);e.variables.selected&&p(e);e.variables.spriteIndex++}function s(e){var n=t.worldPosToIsoPos({x:e.x,y:e.y}),i=r,o=Math.ceil(window.innerWidth/app.config.actor.tile.width),a=Math.ceil(window.innerHeight/app.config.actor.tile.height);return n.x>=i.x-o/2&&n.x<=i.x+o/2&&n.y>=i.y-a/2&&n.y<=i.y+a/2?!0:!1}function f(e){var t,n;_.findIndex(i.assets.loaded.atlas,function(r){t=_.findWhere(r.sprite.sprites,{id:e.variables.sprite[e.variables.state][e.variables.direction][e.variables.spriteIndex]});n=r.sprite.img;!_.isEmpty(r)});if(!_.isEmpty(t)){e.variables.canvas.width=e.variables.sprite.width;e.variables.canvas.height=e.variables.sprite.height+d;var r=0,o=e.variables.canvas.height-t.h;e.variables.canvas.context.drawImage(n,t.x,t.y,t.w,t.h,r,o,t.w,t.h)}}function p(e){e.variables.canvas.context.fillStyle="red";e.variables.canvas.context.fillRect((e.variables.canvas.width-40)/2,0,38,d-2);e.variables.canvas.context.fillStyle="green";var t=e.variables.health/e.variables.hp;e.variables.canvas.context.fillRect((e.variables.canvas.width-40)/2,0,38*t,d-2)}function h(e){var i=window.innerWidth/2,o=window.innerHeight/2,a={};a.x=-(r.x*app.config.actor.tile.width+app.config.actor.grid.width*app.config.actor.tile.width/2-i);a.y=-(r.y*app.config.actor.tile.height)+o;var u=-a.x+e.left,c=-a.y+e.top,l=t.worldPosToIsoPos({x:u,y:c}),s=t.worldPosToIsoPos({x:u+e.width,y:c+e.height});_.each(n.getActorList(),function(e){var n=t.worldPosToIsoPos({x:e.variables.coordinates.current.x,y:e.variables.coordinates.current.y});e.variables.selected=n.x>=l.x&&n.x<=s.x&&n.y>=l.y&&n.y<=s.y?!0:!1})}var d=7.5;e.subscribe("new.frame",function(){a()});e.subscribe("center.update.start",function(){$(app.config.shadowRoot).find(".ActorsWrapper").removeClass("no-panning")});e.subscribe("center.update.stop",function(){$(app.config.shadowRoot).find(".ActorsWrapper").addClass("no-panning")});e.subscribe("map.selection",function(e){h(e)})});define("animate",["eventmanager","RequestAnimationFrame","map","actors"],function(e){function t(){e.publish("new.frame");window.setTimeout(t,1e3/app.config.framerate)}e.subscribe("game.init",function(){t()});return{}});define("mouse",["eventmanager"],function(e){HTMLCanvasElement.prototype.relmouseCoordinates=function(e){var t=0,n=0,r=0,i=0,o=this;do{t+=o.offsetLeft-o.scrollLeft;n+=o.offsetTop-o.scrollTop}while(o===o.offsetParent);r=e.pageX-t;i=e.pageY-n;return{x:r,y:i}};window.oncontextmenu=function(e){e.preventDefault();e.stopPropagation();return!1};var t=function(){};e.subscribe("game.init",function(){t()})});define("input",["eventmanager","mouse","Keypress"],function(e,t,n){var r=new n.Listener,i=[{keys:"up",prevent_repeat:!0,on_keydown:function(){e.publish("pan.up",1)},on_keyup:function(){e.publish("pan.up",0)}},{keys:"down",prevent_repeat:!0,on_keydown:function(){e.publish("pan.down",1)},on_keyup:function(){e.publish("pan.down",0)}},{keys:"left",prevent_repeat:!0,on_keydown:function(){e.publish("pan.left",1)},on_keyup:function(){e.publish("pan.left",0)}},{keys:"right",prevent_repeat:!0,on_keydown:function(){e.publish("pan.right",1)},on_keyup:function(){e.publish("pan.right",0)}}];r.register_many(i)});define("scripts/app",["lodash","jquery","plane","assetLoader","eventmanager","gamecycle","animate","input"],function(e,t,n,r){r.preloadassets();n({coordinates:{x:3960,y:0}}).init(),n({coordinates:{x:4e3,y:200}}).init()});